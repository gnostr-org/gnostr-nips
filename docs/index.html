

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nips">NIPs</h1>
<p>NIPs stand for <strong>Nostr Implementation
Possibilities</strong>.</p>
<p>They exist to document what may be implemented by <a
href="https://github.com/nostr-protocol/nostr">Nostr</a>-compatible
<em>relay</em> and <em>client</em> software.</p>
<hr />
<ul>
<li><a href="#list">List</a></li>
<li><a href="#event-kinds">Event Kinds</a></li>
<li><a href="#message-types">Message Types</a>
<ul>
<li><a href="#client-to-relay">Client to Relay</a></li>
<li><a href="#relay-to-client">Relay to Client</a></li>
</ul></li>
<li><a href="#standardized-tags">Standardized Tags</a></li>
<li><a href="#criteria-for-acceptance-of-nips">Criteria for acceptance
of NIPs</a></li>
<li><a href="#is-this-repository-a-centralizing-factor">Is this
repository a centralizing factor?</a></li>
<li><a href="#how-this-repository-works">How this repository
works</a></li>
<li><a href="#breaking-changes">Breaking Changes</a></li>
<li><a href="#license">License</a></li>
</ul>
<hr />
<h2 id="list">List</h2>
<ul>
<li><a href="01.md.css.html">NIP-01: Basic protocol flow description</a></li>
<li><a href="02.md.css.html">NIP-02: Follow List</a></li>
<li><a href="03.md.css.html">NIP-03: OpenTimestamps Attestations for
Events</a></li>
<li><a href="04.md.css.html">NIP-04: Encrypted Direct Message</a> —
<strong>unrecommended</strong>: deprecated in favor of <a
href="17.md.css.html">NIP-17</a></li>
<li><a href="05.md.css.html">NIP-05: Mapping Nostr keys to DNS-based internet
identifiers</a></li>
<li><a href="06.md.css.html">NIP-06: Basic key derivation from mnemonic seed
phrase</a></li>
<li><a href="07.md.css.html">NIP-07: <code>window.nostr</code> capability for web
browsers</a></li>
<li><a href="08.md.css.html">NIP-08: Handling Mentions</a> —
<strong>unrecommended</strong>: deprecated in favor of <a
href="27.md.css.html">NIP-27</a></li>
<li><a href="09.md.css.html">NIP-09: Event Deletion</a></li>
<li><a href="10.md.css.html">NIP-10: Conventions for clients’ use of
<code>e</code> and <code>p</code> tags in text events</a></li>
<li><a href="11.md.css.html">NIP-11: Relay Information Document</a></li>
<li><a href="13.md.css.html">NIP-13: Proof of Work</a></li>
<li><a href="14.md.css.html">NIP-14: Subject tag in text events</a></li>
<li><a href="15.md.css.html">NIP-15: Nostr Marketplace (for resilient
marketplaces)</a></li>
<li><a href="17.md.css.html">NIP-17: Private Direct Messages</a></li>
<li><a href="18.md.css.html">NIP-18: Reposts</a></li>
<li><a href="19.md.css.html">NIP-19: bech32-encoded entities</a></li>
<li><a href="21.md.css.html">NIP-21: <code>nostr:</code> URI scheme</a></li>
<li><a href="23.md.css.html">NIP-23: Long-form Content</a></li>
<li><a href="24.md.css.html">NIP-24: Extra metadata fields and tags</a></li>
<li><a href="25.md.css.html">NIP-25: Reactions</a></li>
<li><a href="26.md.css.html">NIP-26: Delegated Event Signing</a></li>
<li><a href="27.md.css.html">NIP-27: Text Note References</a></li>
<li><a href="28.md.css.html">NIP-28: Public Chat</a></li>
<li><a href="29.md.css.html">NIP-29: Relay-based Groups</a></li>
<li><a href="30.md.css.html">NIP-30: Custom Emoji</a></li>
<li><a href="31.md.css.html">NIP-31: Dealing with Unknown Events</a></li>
<li><a href="32.md.css.html">NIP-32: Labeling</a></li>
<li><a href="34.md.css.html">NIP-34: <code>git</code> stuff</a></li>
<li><a href="36.md.css.html">NIP-36: Sensitive Content</a></li>
<li><a href="38.md.css.html">NIP-38: User Statuses</a></li>
<li><a href="39.md.css.html">NIP-39: External Identities in Profiles</a></li>
<li><a href="40.md.css.html">NIP-40: Expiration Timestamp</a></li>
<li><a href="42.md.css.html">NIP-42: Authentication of clients to relays</a></li>
<li><a href="44.md.css.html">NIP-44: Versioned Encryption</a></li>
<li><a href="45.md.css.html">NIP-45: Counting results</a></li>
<li><a href="46.md.css.html">NIP-46: Nostr Connect</a></li>
<li><a href="47.md.css.html">NIP-47: Wallet Connect</a></li>
<li><a href="48.md.css.html">NIP-48: Proxy Tags</a></li>
<li><a href="49.md.css.html">NIP-49: Private Key Encryption</a></li>
<li><a href="50.md.css.html">NIP-50: Search Capability</a></li>
<li><a href="51.md.css.html">NIP-51: Lists</a></li>
<li><a href="52.md.css.html">NIP-52: Calendar Events</a></li>
<li><a href="53.md.css.html">NIP-53: Live Activities</a></li>
<li><a href="54.md.css.html">NIP-54: Wiki</a></li>
<li><a href="56.md.css.html">NIP-56: Reporting</a></li>
<li><a href="57.md.css.html">NIP-57: Lightning Zaps</a></li>
<li><a href="58.md.css.html">NIP-58: Badges</a></li>
<li><a href="59.md.css.html">NIP-59: Gift Wrap</a></li>
<li><a href="65.md.css.html">NIP-65: Relay List Metadata</a></li>
<li><a href="72.md.css.html">NIP-72: Moderated Communities</a></li>
<li><a href="75.md.css.html">NIP-75: Zap Goals</a></li>
<li><a href="78.md.css.html">NIP-78: Application-specific data</a></li>
<li><a href="84.md.css.html">NIP-84: Highlights</a></li>
<li><a href="89.md.css.html">NIP-89: Recommended Application Handlers</a></li>
<li><a href="90.md.css.html">NIP-90: Data Vending Machines</a></li>
<li><a href="92.md.css.html">NIP-92: Media Attachments</a></li>
<li><a href="94.md.css.html">NIP-94: File Metadata</a></li>
<li><a href="96.md.css.html">NIP-96: HTTP File Storage Integration</a></li>
<li><a href="98.md.css.html">NIP-98: HTTP Auth</a></li>
<li><a href="99.md.css.html">NIP-99: Classified Listings</a></li>
</ul>
<h2 id="event-kinds">Event Kinds</h2>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 41%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="header">
<th>kind</th>
<th>description</th>
<th>NIP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>0</code></td>
<td>Metadata</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="even">
<td><code>1</code></td>
<td>Short Text Note</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="odd">
<td><code>2</code></td>
<td>Recommend Relay</td>
<td>01 (deprecated)</td>
</tr>
<tr class="even">
<td><code>3</code></td>
<td>Follows</td>
<td><a href="02.md.css.html">02</a></td>
</tr>
<tr class="odd">
<td><code>4</code></td>
<td>Encrypted Direct Messages</td>
<td><a href="04.md.css.html">04</a></td>
</tr>
<tr class="even">
<td><code>5</code></td>
<td>Event Deletion</td>
<td><a href="09.md.css.html">09</a></td>
</tr>
<tr class="odd">
<td><code>6</code></td>
<td>Repost</td>
<td><a href="18.md.css.html">18</a></td>
</tr>
<tr class="even">
<td><code>7</code></td>
<td>Reaction</td>
<td><a href="25.md.css.html">25</a></td>
</tr>
<tr class="odd">
<td><code>8</code></td>
<td>Badge Award</td>
<td><a href="58.md.css.html">58</a></td>
</tr>
<tr class="even">
<td><code>9</code></td>
<td>Group Chat Message</td>
<td><a href="29.md.css.html">29</a></td>
</tr>
<tr class="odd">
<td><code>10</code></td>
<td>Group Chat Threaded Reply</td>
<td><a href="29.md.css.html">29</a></td>
</tr>
<tr class="even">
<td><code>11</code></td>
<td>Group Thread</td>
<td><a href="29.md.css.html">29</a></td>
</tr>
<tr class="odd">
<td><code>12</code></td>
<td>Group Thread Reply</td>
<td><a href="29.md.css.html">29</a></td>
</tr>
<tr class="even">
<td><code>13</code></td>
<td>Seal</td>
<td><a href="59.md.css.html">59</a></td>
</tr>
<tr class="odd">
<td><code>14</code></td>
<td>Direct Message</td>
<td><a href="17.md.css.html">17</a></td>
</tr>
<tr class="even">
<td><code>16</code></td>
<td>Generic Repost</td>
<td><a href="18.md.css.html">18</a></td>
</tr>
<tr class="odd">
<td><code>40</code></td>
<td>Channel Creation</td>
<td><a href="28.md.css.html">28</a></td>
</tr>
<tr class="even">
<td><code>41</code></td>
<td>Channel Metadata</td>
<td><a href="28.md.css.html">28</a></td>
</tr>
<tr class="odd">
<td><code>42</code></td>
<td>Channel Message</td>
<td><a href="28.md.css.html">28</a></td>
</tr>
<tr class="even">
<td><code>43</code></td>
<td>Channel Hide Message</td>
<td><a href="28.md.css.html">28</a></td>
</tr>
<tr class="odd">
<td><code>44</code></td>
<td>Channel Mute User</td>
<td><a href="28.md.css.html">28</a></td>
</tr>
<tr class="even">
<td><code>818</code></td>
<td>Merge Requests</td>
<td><a href="54.md.css.html">54</a></td>
</tr>
<tr class="odd">
<td><code>1021</code></td>
<td>Bid</td>
<td><a href="15.md.css.html">15</a></td>
</tr>
<tr class="even">
<td><code>1022</code></td>
<td>Bid confirmation</td>
<td><a href="15.md.css.html">15</a></td>
</tr>
<tr class="odd">
<td><code>1040</code></td>
<td>OpenTimestamps</td>
<td><a href="03.md.css.html">03</a></td>
</tr>
<tr class="even">
<td><code>1059</code></td>
<td>Gift Wrap</td>
<td><a href="59.md.css.html">59</a></td>
</tr>
<tr class="odd">
<td><code>1063</code></td>
<td>File Metadata</td>
<td><a href="94.md.css.html">94</a></td>
</tr>
<tr class="even">
<td><code>1311</code></td>
<td>Live Chat Message</td>
<td><a href="53.md.css.html">53</a></td>
</tr>
<tr class="odd">
<td><code>1617</code></td>
<td>Patches</td>
<td><a href="34.md.css.html">34</a></td>
</tr>
<tr class="even">
<td><code>1621</code></td>
<td>Issues</td>
<td><a href="34.md.css.html">34</a></td>
</tr>
<tr class="odd">
<td><code>1622</code></td>
<td>Replies</td>
<td><a href="34.md.css.html">34</a></td>
</tr>
<tr class="even">
<td><code>1630</code>-<code>1633</code></td>
<td>Status</td>
<td><a href="34.md.css.html">34</a></td>
</tr>
<tr class="odd">
<td><code>1971</code></td>
<td>Problem Tracker</td>
<td><a
href="https://github.com/nostrocket/NIPS/blob/main/Problems.md.css.html">nostrocket</a></td>
</tr>
<tr class="even">
<td><code>1984</code></td>
<td>Reporting</td>
<td><a href="56.md.css.html">56</a></td>
</tr>
<tr class="odd">
<td><code>1985</code></td>
<td>Label</td>
<td><a href="32.md.css.html">32</a></td>
</tr>
<tr class="even">
<td><code>4550</code></td>
<td>Community Post Approval</td>
<td><a href="72.md.css.html">72</a></td>
</tr>
<tr class="odd">
<td><code>5000</code>-<code>5999</code></td>
<td>Job Request</td>
<td><a href="90.md.css.html">90</a></td>
</tr>
<tr class="even">
<td><code>6000</code>-<code>6999</code></td>
<td>Job Result</td>
<td><a href="90.md.css.html">90</a></td>
</tr>
<tr class="odd">
<td><code>7000</code></td>
<td>Job Feedback</td>
<td><a href="90.md.css.html">90</a></td>
</tr>
<tr class="even">
<td><code>9000</code>-<code>9030</code></td>
<td>Group Control Events</td>
<td><a href="29.md.css.html">29</a></td>
</tr>
<tr class="odd">
<td><code>9041</code></td>
<td>Zap Goal</td>
<td><a href="75.md.css.html">75</a></td>
</tr>
<tr class="even">
<td><code>9734</code></td>
<td>Zap Request</td>
<td><a href="57.md.css.html">57</a></td>
</tr>
<tr class="odd">
<td><code>9735</code></td>
<td>Zap</td>
<td><a href="57.md.css.html">57</a></td>
</tr>
<tr class="even">
<td><code>9802</code></td>
<td>Highlights</td>
<td><a href="84.md.css.html">84</a></td>
</tr>
<tr class="odd">
<td><code>10000</code></td>
<td>Mute list</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="even">
<td><code>10001</code></td>
<td>Pin list</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="odd">
<td><code>10002</code></td>
<td>Relay List Metadata</td>
<td><a href="65.md.css.html">65</a></td>
</tr>
<tr class="even">
<td><code>10003</code></td>
<td>Bookmark list</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="odd">
<td><code>10004</code></td>
<td>Communities list</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="even">
<td><code>10005</code></td>
<td>Public chats list</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="odd">
<td><code>10006</code></td>
<td>Blocked relays list</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="even">
<td><code>10007</code></td>
<td>Search relays list</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="odd">
<td><code>10009</code></td>
<td>User groups</td>
<td><a href="51.md.css.html">51</a>, <a href="29.md.css.html">29</a></td>
</tr>
<tr class="even">
<td><code>10015</code></td>
<td>Interests list</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="odd">
<td><code>10030</code></td>
<td>User emoji list</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="even">
<td><code>10050</code></td>
<td>Relay list to receive DMs</td>
<td><a href="17.md.css.html">17</a></td>
</tr>
<tr class="odd">
<td><code>10096</code></td>
<td>File storage server list</td>
<td><a href="96.md.css.html">96</a></td>
</tr>
<tr class="even">
<td><code>13194</code></td>
<td>Wallet Info</td>
<td><a href="47.md.css.html">47</a></td>
</tr>
<tr class="odd">
<td><code>21000</code></td>
<td>Lightning Pub RPC</td>
<td><a
href="https://github.com/shocknet/Lightning.Pub/blob/master/proto/autogenerated/client.md.css.html">Lightning.Pub</a></td>
</tr>
<tr class="even">
<td><code>22242</code></td>
<td>Client Authentication</td>
<td><a href="42.md.css.html">42</a></td>
</tr>
<tr class="odd">
<td><code>23194</code></td>
<td>Wallet Request</td>
<td><a href="47.md.css.html">47</a></td>
</tr>
<tr class="even">
<td><code>23195</code></td>
<td>Wallet Response</td>
<td><a href="47.md.css.html">47</a></td>
</tr>
<tr class="odd">
<td><code>24133</code></td>
<td>Nostr Connect</td>
<td><a href="46.md.css.html">46</a></td>
</tr>
<tr class="even">
<td><code>27235</code></td>
<td>HTTP Auth</td>
<td><a href="98.md.css.html">98</a></td>
</tr>
<tr class="odd">
<td><code>30000</code></td>
<td>Follow sets</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="even">
<td><code>30001</code></td>
<td>Generic lists</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="odd">
<td><code>30002</code></td>
<td>Relay sets</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="even">
<td><code>30003</code></td>
<td>Bookmark sets</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="odd">
<td><code>30004</code></td>
<td>Curation sets</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="even">
<td><code>30008</code></td>
<td>Profile Badges</td>
<td><a href="58.md.css.html">58</a></td>
</tr>
<tr class="odd">
<td><code>30009</code></td>
<td>Badge Definition</td>
<td><a href="58.md.css.html">58</a></td>
</tr>
<tr class="even">
<td><code>30015</code></td>
<td>Interest sets</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="odd">
<td><code>30017</code></td>
<td>Create or update a stall</td>
<td><a href="15.md.css.html">15</a></td>
</tr>
<tr class="even">
<td><code>30018</code></td>
<td>Create or update a product</td>
<td><a href="15.md.css.html">15</a></td>
</tr>
<tr class="odd">
<td><code>30019</code></td>
<td>Marketplace UI/UX</td>
<td><a href="15.md.css.html">15</a></td>
</tr>
<tr class="even">
<td><code>30020</code></td>
<td>Product sold as an auction</td>
<td><a href="15.md.css.html">15</a></td>
</tr>
<tr class="odd">
<td><code>30023</code></td>
<td>Long-form Content</td>
<td><a href="23.md.css.html">23</a></td>
</tr>
<tr class="even">
<td><code>30024</code></td>
<td>Draft Long-form Content</td>
<td><a href="23.md.css.html">23</a></td>
</tr>
<tr class="odd">
<td><code>30030</code></td>
<td>Emoji sets</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="even">
<td><code>30063</code></td>
<td>Release artifact sets</td>
<td><a href="51.md.css.html">51</a></td>
</tr>
<tr class="odd">
<td><code>30078</code></td>
<td>Application-specific Data</td>
<td><a href="78.md.css.html">78</a></td>
</tr>
<tr class="even">
<td><code>30311</code></td>
<td>Live Event</td>
<td><a href="53.md.css.html">53</a></td>
</tr>
<tr class="odd">
<td><code>30315</code></td>
<td>User Statuses</td>
<td><a href="38.md.css.html">38</a></td>
</tr>
<tr class="even">
<td><code>30402</code></td>
<td>Classified Listing</td>
<td><a href="99.md.css.html">99</a></td>
</tr>
<tr class="odd">
<td><code>30403</code></td>
<td>Draft Classified Listing</td>
<td><a href="99.md.css.html">99</a></td>
</tr>
<tr class="even">
<td><code>30617</code></td>
<td>Repository announcements</td>
<td><a href="34.md.css.html">34</a></td>
</tr>
<tr class="odd">
<td><code>30818</code></td>
<td>Wiki article</td>
<td><a href="54.md.css.html">54</a></td>
</tr>
<tr class="even">
<td><code>30819</code></td>
<td>Redirects</td>
<td><a href="54.md.css.html">54</a></td>
</tr>
<tr class="odd">
<td><code>31922</code></td>
<td>Date-Based Calendar Event</td>
<td><a href="52.md.css.html">52</a></td>
</tr>
<tr class="even">
<td><code>31923</code></td>
<td>Time-Based Calendar Event</td>
<td><a href="52.md.css.html">52</a></td>
</tr>
<tr class="odd">
<td><code>31924</code></td>
<td>Calendar</td>
<td><a href="52.md.css.html">52</a></td>
</tr>
<tr class="even">
<td><code>31925</code></td>
<td>Calendar Event RSVP</td>
<td><a href="52.md.css.html">52</a></td>
</tr>
<tr class="odd">
<td><code>31989</code></td>
<td>Handler recommendation</td>
<td><a href="89.md.css.html">89</a></td>
</tr>
<tr class="even">
<td><code>31990</code></td>
<td>Handler information</td>
<td><a href="89.md.css.html">89</a></td>
</tr>
<tr class="odd">
<td><code>34550</code></td>
<td>Community Definition</td>
<td><a href="72.md.css.html">72</a></td>
</tr>
<tr class="even">
<td><code>39000-9</code></td>
<td>Group metadata events</td>
<td><a href="29.md.css.html">29</a></td>
</tr>
</tbody>
</table>
<h2 id="message-types">Message types</h2>
<h3 id="client-to-relay">Client to Relay</h3>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 73%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th>type</th>
<th>description</th>
<th>NIP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>EVENT</code></td>
<td>used to publish events</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="even">
<td><code>REQ</code></td>
<td>used to request events and subscribe to new updates</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="odd">
<td><code>CLOSE</code></td>
<td>used to stop previous subscriptions</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="even">
<td><code>AUTH</code></td>
<td>used to send authentication events</td>
<td><a href="42.md.css.html">42</a></td>
</tr>
<tr class="odd">
<td><code>COUNT</code></td>
<td>used to request event counts</td>
<td><a href="45.md.css.html">45</a></td>
</tr>
</tbody>
</table>
<h3 id="relay-to-client">Relay to Client</h3>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 74%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="header">
<th>type</th>
<th>description</th>
<th>NIP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>EOSE</code></td>
<td>used to notify clients all stored events have been sent</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="even">
<td><code>EVENT</code></td>
<td>used to send events requested to clients</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="odd">
<td><code>NOTICE</code></td>
<td>used to send human-readable messages to clients</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="even">
<td><code>OK</code></td>
<td>used to notify clients if an EVENT was successful</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="odd">
<td><code>CLOSED</code></td>
<td>used to notify clients that a REQ was ended and why</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="even">
<td><code>AUTH</code></td>
<td>used to send authentication challenges</td>
<td><a href="42.md.css.html">42</a></td>
</tr>
<tr class="odd">
<td><code>COUNT</code></td>
<td>used to send requested event counts to clients</td>
<td><a href="45.md.css.html">45</a></td>
</tr>
</tbody>
</table>
<p>Please update these lists when proposing NIPs introducing new event
kinds.</p>
<h2 id="standardized-tags">Standardized Tags</h2>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 32%" />
<col style="width: 18%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>name</th>
<th>value</th>
<th>other parameters</th>
<th>NIP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>e</code></td>
<td>event id (hex)</td>
<td>relay URL, marker</td>
<td><a href="01.md.css.html">01</a>, <a href="10.md.css.html">10</a></td>
</tr>
<tr class="even">
<td><code>p</code></td>
<td>pubkey (hex)</td>
<td>relay URL, petname</td>
<td><a href="01.md.css.html">01</a>, <a href="02.md.css.html">02</a></td>
</tr>
<tr class="odd">
<td><code>a</code></td>
<td>coordinates to an event</td>
<td>relay URL</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="even">
<td><code>d</code></td>
<td>identifier</td>
<td>–</td>
<td><a href="01.md.css.html">01</a></td>
</tr>
<tr class="odd">
<td><code>g</code></td>
<td>geohash</td>
<td>–</td>
<td><a href="52.md.css.html">52</a></td>
</tr>
<tr class="even">
<td><code>i</code></td>
<td>identity</td>
<td>proof</td>
<td><a href="39.md.css.html">39</a></td>
</tr>
<tr class="odd">
<td><code>k</code></td>
<td>kind number (string)</td>
<td>–</td>
<td><a href="18.md.css.html">18</a>, <a href="25.md.css.html">25</a>, <a
href="72.md.css.html">72</a></td>
</tr>
<tr class="even">
<td><code>l</code></td>
<td>label, label namespace</td>
<td>annotations</td>
<td><a href="32.md.css.html">32</a></td>
</tr>
<tr class="odd">
<td><code>L</code></td>
<td>label namespace</td>
<td>–</td>
<td><a href="32.md.css.html">32</a></td>
</tr>
<tr class="even">
<td><code>m</code></td>
<td>MIME type</td>
<td>–</td>
<td><a href="94.md.css.html">94</a></td>
</tr>
<tr class="odd">
<td><code>q</code></td>
<td>event id (hex)</td>
<td>relay URL</td>
<td><a href="18.md.css.html">18</a></td>
</tr>
<tr class="even">
<td><code>r</code></td>
<td>a reference (URL, etc)</td>
<td>petname</td>
<td></td>
</tr>
<tr class="odd">
<td><code>r</code></td>
<td>relay url</td>
<td>marker</td>
<td><a href="65.md.css.html">65</a></td>
</tr>
<tr class="even">
<td><code>t</code></td>
<td>hashtag</td>
<td>–</td>
<td></td>
</tr>
<tr class="odd">
<td><code>alt</code></td>
<td>summary</td>
<td>–</td>
<td><a href="31.md.css.html">31</a></td>
</tr>
<tr class="even">
<td><code>amount</code></td>
<td>millisatoshis, stringified</td>
<td>–</td>
<td><a href="57.md.css.html">57</a></td>
</tr>
<tr class="odd">
<td><code>bolt11</code></td>
<td><code>bolt11</code> invoice</td>
<td>–</td>
<td><a href="57.md.css.html">57</a></td>
</tr>
<tr class="even">
<td><code>challenge</code></td>
<td>challenge string</td>
<td>–</td>
<td><a href="42.md.css.html">42</a></td>
</tr>
<tr class="odd">
<td><code>client</code></td>
<td>name, address</td>
<td>relay URL</td>
<td><a href="89.md.css.html">89</a></td>
</tr>
<tr class="even">
<td><code>clone</code></td>
<td>git clone URL</td>
<td>–</td>
<td><a href="34.md.css.html">34</a></td>
</tr>
<tr class="odd">
<td><code>content-warning</code></td>
<td>reason</td>
<td>–</td>
<td><a href="36.md.css.html">36</a></td>
</tr>
<tr class="even">
<td><code>delegation</code></td>
<td>pubkey, conditions, delegation token</td>
<td>–</td>
<td><a href="26.md.css.html">26</a></td>
</tr>
<tr class="odd">
<td><code>description</code></td>
<td>description</td>
<td>–</td>
<td><a href="34.md.css.html">34</a>, <a href="57.md.css.html">57</a>, <a
href="58.md.css.html">58</a></td>
</tr>
<tr class="even">
<td><code>emoji</code></td>
<td>shortcode, image URL</td>
<td>–</td>
<td><a href="30.md.css.html">30</a></td>
</tr>
<tr class="odd">
<td><code>encrypted</code></td>
<td>–</td>
<td>–</td>
<td><a href="90.md.css.html">90</a></td>
</tr>
<tr class="even">
<td><code>expiration</code></td>
<td>unix timestamp (string)</td>
<td>–</td>
<td><a href="40.md.css.html">40</a></td>
</tr>
<tr class="odd">
<td><code>goal</code></td>
<td>event id (hex)</td>
<td>relay URL</td>
<td><a href="75.md.css.html">75</a></td>
</tr>
<tr class="even">
<td><code>image</code></td>
<td>image URL</td>
<td>dimensions in pixels</td>
<td><a href="23.md.css.html">23</a>, <a href="58.md.css.html">58</a></td>
</tr>
<tr class="odd">
<td><code>imeta</code></td>
<td>inline metadata</td>
<td>–</td>
<td><a href="92.md.css.html">92</a></td>
</tr>
<tr class="even">
<td><code>lnurl</code></td>
<td><code>bech32</code> encoded <code>lnurl</code></td>
<td>–</td>
<td><a href="57.md.css.html">57</a></td>
</tr>
<tr class="odd">
<td><code>location</code></td>
<td>location string</td>
<td>–</td>
<td><a href="52.md.css.html">52</a>, <a href="99.md.css.html">99</a></td>
</tr>
<tr class="even">
<td><code>name</code></td>
<td>name</td>
<td>–</td>
<td><a href="34.md.css.html">34</a>, <a href="58.md.css.html">58</a></td>
</tr>
<tr class="odd">
<td><code>nonce</code></td>
<td>random</td>
<td>–</td>
<td><a href="13.md.css.html">13</a></td>
</tr>
<tr class="even">
<td><code>preimage</code></td>
<td>hash of <code>bolt11</code> invoice</td>
<td>–</td>
<td><a href="57.md.css.html">57</a></td>
</tr>
<tr class="odd">
<td><code>price</code></td>
<td>price</td>
<td>currency, frequency</td>
<td><a href="99.md.css.html">99</a></td>
</tr>
<tr class="even">
<td><code>proxy</code></td>
<td>external ID</td>
<td>protocol</td>
<td><a href="48.md.css.html">48</a></td>
</tr>
<tr class="odd">
<td><code>published_at</code></td>
<td>unix timestamp (string)</td>
<td>–</td>
<td><a href="23.md.css.html">23</a></td>
</tr>
<tr class="even">
<td><code>relay</code></td>
<td>relay url</td>
<td>–</td>
<td><a href="42.md.css.html">42</a>, <a href="17.md.css.html">17</a></td>
</tr>
<tr class="odd">
<td><code>relays</code></td>
<td>relay list</td>
<td>–</td>
<td><a href="57.md.css.html">57</a></td>
</tr>
<tr class="even">
<td><code>server</code></td>
<td>file storage server url</td>
<td>–</td>
<td><a href="96.md.css.html">96</a></td>
</tr>
<tr class="odd">
<td><code>subject</code></td>
<td>subject</td>
<td>–</td>
<td><a href="14.md.css.html">14</a>, <a href="17.md.css.html">17</a></td>
</tr>
<tr class="even">
<td><code>summary</code></td>
<td>article summary</td>
<td>–</td>
<td><a href="23.md.css.html">23</a></td>
</tr>
<tr class="odd">
<td><code>thumb</code></td>
<td>badge thumbnail</td>
<td>dimensions in pixels</td>
<td><a href="58.md.css.html">58</a></td>
</tr>
<tr class="even">
<td><code>title</code></td>
<td>article title</td>
<td>–</td>
<td><a href="23.md.css.html">23</a></td>
</tr>
<tr class="odd">
<td><code>web</code></td>
<td>webpage URL</td>
<td>–</td>
<td><a href="34.md.css.html">34</a></td>
</tr>
<tr class="even">
<td><code>zap</code></td>
<td>pubkey (hex), relay URL</td>
<td>weight</td>
<td><a href="57.md.css.html">57</a></td>
</tr>
</tbody>
</table>
<h2 id="criteria-for-acceptance-of-nips">Criteria for acceptance of
NIPs</h2>
<ol type="1">
<li>They should be implemented in at least two clients and one relay –
when applicable.</li>
<li>They should make sense.</li>
<li>They should be optional and backwards-compatible: care must be taken
such that clients and relays that choose to not implement them do not
stop working when interacting with the ones that choose to.</li>
<li>There should be no more than one way of doing the same thing.</li>
<li>Other rules will be made up when necessary.</li>
</ol>
<h2 id="is-this-repository-a-centralizing-factor">Is this repository a
centralizing factor?</h2>
<p>To promote interoperability, we standards that everybody can follow,
and we need them to define a <strong>single way of doing each
thing</strong> without ever hurting
<strong>backwards-compatibility</strong>, and for that purpose there is
no way around getting everybody to agree on the same thing and keep a
centralized index of these standards. However the fact that such index
exists doesn’t hurt the decentralization of Nostr. <em>At any point the
central index can be challenged if it is failing to fulfill the needs of
the protocol</em> and it can migrate to other places and be maintained
by other people.</p>
<p>It can even fork into multiple and then some clients would go one
way, others would go another way, and some clients would adhere to both
competing standards. This would hurt the simplicity, openness and
interoperability of Nostr a little, but everything would still work in
the short term.</p>
<p>There is a list of notable Nostr software developers who have commit
access to this repository, but that exists mostly for practical reasons,
as by the nature of the thing we’re dealing with the repository owner
can revoke membership and rewrite history as they want – and if these
actions are unjustified or perceived as bad or evil the community must
react.</p>
<h2 id="how-this-repository-works">How this repository works</h2>
<p>Standards may emerge in two ways: the first way is that someone
starts doing something, then others copy it; the second way is that
someone has an idea of a new standard that could benefit multiple
clients and the protocol in general without breaking
<strong>backwards-compatibility</strong> and the principle of having
<strong>a single way of doing things</strong>, then they write that idea
and submit it to this repository, other interested parties read it and
give their feedback, then once most people reasonably agree we codify
that in a NIP which client and relay developers that are interested in
the feature can proceed to implement.</p>
<p>These two ways of standardizing things are supported by this
repository. Although the second is preferred, an effort will be made to
codify standards emerged outside this repository into NIPs that can be
later referenced and easily understood and implemented by others – but
obviously as in any human system discretion may be applied when
standards are considered harmful.</p>
<h2 id="breaking-changes">Breaking Changes</h2>
<p><a href="BREAKING.md.css.html">Breaking Changes</a></p>
<h2 id="license">License</h2>
<p>All NIPs are public domain.</p>
<h2 id="contributors">Contributors</h2>
<p><a align="center" href="https://github.com/nostr-protocol/nips/graphs/contributors">
<img src="https://contrib.rocks/image?repo=nostr-protocol/nips" />
</a></p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>BREAKING</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="breaking-changes">Breaking Changes</h1>
<p>This is a history of NIP changes that potentially break pre-existing
implementations, in reverse chronological order.</p>
<table>
<colgroup>
<col style="width: 32%" />
<col style="width: 26%" />
<col style="width: 23%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="header">
<th>Date</th>
<th>Commit</th>
<th>NIP</th>
<th>Change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2024-04-30</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/bad88262">bad88262</a></td>
<td><a href="34.md.css.html">NIP-34</a></td>
<td>‘earliest-unique-commit’ tag was removed (use ‘r’ tag instead)</td>
</tr>
<tr class="even">
<td>2024-02-25</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/4a171cb0">4a171cb0</a></td>
<td><a href="18.md.css.html">NIP-18</a></td>
<td>quote repost should use <code>q</code> tag</td>
</tr>
<tr class="odd">
<td>2024-02-21</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/c6cd655c">c6cd655c</a></td>
<td><a href="46.md.css.html">NIP-46</a></td>
<td>Params were stringified</td>
</tr>
<tr class="even">
<td>2024-02-16</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/cbec02ab">cbec02ab</a></td>
<td><a href="49.md.css.html">NIP-49</a></td>
<td>Password first normalized to NFKC</td>
</tr>
<tr class="odd">
<td>2024-02-15</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/afbb8dd0">afbb8dd0</a></td>
<td><a href="39.md.css.html">NIP-39</a></td>
<td>PGP identity was removed</td>
</tr>
<tr class="even">
<td>2024-02-07</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/d3dad114">d3dad114</a></td>
<td><a href="46.md.css.html">NIP-46</a></td>
<td>Connection token format was changed</td>
</tr>
<tr class="odd">
<td>2024-01-30</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/1a2b21b6">1a2b21b6</a></td>
<td><a href="59.md.css.html">NIP-59</a></td>
<td>‘p’ tag became optional</td>
</tr>
<tr class="even">
<td>2023-01-27</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/c2f34817">c2f34817</a></td>
<td><a href="47.md.css.html">NIP-47</a></td>
<td>optional expiration tag should be honored</td>
</tr>
<tr class="odd">
<td>2024-01-10</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/3d8652ea">3d8652ea</a></td>
<td><a href="02.md.css.html">NIP-02</a></td>
<td>list entries should be chronological</td>
</tr>
<tr class="even">
<td>2024-01-10</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/3d8652ea">3d8652ea</a></td>
<td><a href="51.md.css.html">NIP-51</a></td>
<td>list entries should be chronological</td>
</tr>
<tr class="odd">
<td>2023-12-30</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/29869821">29869821</a></td>
<td><a href="52.md.css.html">NIP-52</a></td>
<td>‘name’ tag was removed (use ‘title’ tag instead)</td>
</tr>
<tr class="even">
<td>2023-12-27</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/17c67ef5">17c67ef5</a></td>
<td><a href="94.md.css.html">NIP-94</a></td>
<td>‘aes-256-gcm’ tag was removed</td>
</tr>
<tr class="odd">
<td>2023-12-03</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/0ba45895">0ba45895</a></td>
<td><a href="01.md.css.html">NIP-01</a></td>
<td>WebSocket status code <code>4000</code> was replaced by ‘CLOSED’
message</td>
</tr>
<tr class="even">
<td>2023-11-28</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/6de35f9e">6de35f9e</a></td>
<td><a href="89.md.css.html">NIP-89</a></td>
<td>‘client’ tag value was changed</td>
</tr>
<tr class="odd">
<td>2023-11-20</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/7822a8b1">7822a8b1</a></td>
<td><a href="51.md.css.html">NIP-51</a></td>
<td><code>kind: 30000</code> and <code>kind: 30001</code> were
deprecated</td>
</tr>
<tr class="even">
<td>2023-11-11</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/cbdca1e9">cbdca1e9</a></td>
<td><a href="84.md.css.html">NIP-84</a></td>
<td>‘range’ tag was removed</td>
</tr>
<tr class="odd">
<td>2023-11-07</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/108b7f16">108b7f16</a></td>
<td><a href="01.md.css.html">NIP-01</a></td>
<td>‘OK’ message must have 4 items</td>
</tr>
<tr class="even">
<td>2023-10-17</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/cf672b76">cf672b76</a></td>
<td><a href="03.md.css.html">NIP-03</a></td>
<td>‘block’ tag was removed</td>
</tr>
<tr class="odd">
<td>2023-09-29</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/7dc6385f">7dc6385f</a></td>
<td><a href="57.md.css.html">NIP-57</a></td>
<td>optional ‘a’ tag was included in <code>zap receipt</code></td>
</tr>
<tr class="even">
<td>2023-08-21</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/89915e02">89915e02</a></td>
<td><a href="11.md.css.html">NIP-11</a></td>
<td>‘min_prefix’ was removed</td>
</tr>
<tr class="odd">
<td>2023-08-20</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/37c4375e">37c4375e</a></td>
<td><a href="01.md.css.html">NIP-01</a></td>
<td>replaceable events with same timestamp should be retained event with
lowest id</td>
</tr>
<tr class="even">
<td>2023-08-15</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/88ee873c">88ee873c</a></td>
<td><a href="15.md.css.html">NIP-15</a></td>
<td>‘countries’ tag was renamed to ‘regions’</td>
</tr>
<tr class="odd">
<td>2023-08-14</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/72bb8a12">72bb8a12</a></td>
<td><a href="12.md.css.html">NIP-12</a></td>
<td>NIP-12, 16, 20 and 33 were merged into NIP-01</td>
</tr>
<tr class="even">
<td>2023-08-14</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/72bb8a12">72bb8a12</a></td>
<td><a href="16.md.css.html">NIP-16</a></td>
<td>NIP-12, 16, 20 and 33 were merged into NIP-01</td>
</tr>
<tr class="odd">
<td>2023-08-14</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/72bb8a12">72bb8a12</a></td>
<td><a href="20.md.css.html">NIP-20</a></td>
<td>NIP-12, 16, 20 and 33 were merged into NIP-01</td>
</tr>
<tr class="even">
<td>2023-08-14</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/72bb8a12">72bb8a12</a></td>
<td><a href="33.md.css.html">NIP-33</a></td>
<td>NIP-12, 16, 20 and 33 were merged into NIP-01</td>
</tr>
<tr class="odd">
<td>2023-08-11</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/d87f8617">d87f8617</a></td>
<td><a href="25.md.css.html">NIP-25</a></td>
<td>empty <code>content</code> should be considered as “+”</td>
</tr>
<tr class="even">
<td>2023-08-01</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/5d63b157">5d63b157</a></td>
<td><a href="57.md.css.html">NIP-57</a></td>
<td>‘zap’ tag was changed</td>
</tr>
<tr class="odd">
<td>2023-07-15</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/d1814405">d1814405</a></td>
<td><a href="01.md.css.html">NIP-01</a></td>
<td><code>since</code> and <code>until</code> filters should be
<code>since &lt;= created_at &lt;= until</code></td>
</tr>
<tr class="even">
<td>2023-07-12</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/a1cd2bd8">a1cd2bd8</a></td>
<td><a href="25.md.css.html">NIP-25</a></td>
<td>custom emoji was supported</td>
</tr>
<tr class="odd">
<td>2023-06-18</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/83cbd3e1">83cbd3e1</a></td>
<td><a href="11.md.css.html">NIP-11</a></td>
<td>‘image’ was renamed to ‘icon’</td>
</tr>
<tr class="even">
<td>2023-04-13</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/bf0a0da6">bf0a0da6</a></td>
<td><a href="15.md.css.html">NIP-15</a></td>
<td>different NIP was re-added as NIP-15</td>
</tr>
<tr class="odd">
<td>2023-04-09</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/fb5b7c73">fb5b7c73</a></td>
<td><a href="15.md.css.html">NIP-15</a></td>
<td>NIP-15 was merged into NIP-01</td>
</tr>
<tr class="even">
<td>2023-03-15</td>
<td><a
href="https://github.com/nostr-protocol/nips/commit/e1004d3d">e1004d3d</a></td>
<td><a href="19.md.css.html">NIP-19</a></td>
<td><code>1: relay</code> was changed to optionally</td>
</tr>
</tbody>
</table>
<p>Breaking changes prior to 2023-03-01 are not yet documented.</p>
<h2 id="notes">NOTES</h2>
<ul>
<li>If it isn’t clear that a change is breaking or not, we list it.</li>
<li>The date is the date it was merged, not necessarily the date of the
commit.</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>99</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-99">NIP-99</h1>
<h2 id="classified-listings">Classified Listings</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines <code>kind:30402</code>: a parameterized replaceable
event to describe classified listings that list any arbitrary product,
service, or other thing for sale or offer and includes enough structured
metadata to make them useful.</p>
<p>The category of classifieds includes a very broad range of physical
goods, services, work opportunities, rentals, free giveaways, personals,
etc. and is distinct from the more strictly structured marketplaces
defined in <a
href="https://github.com/nostr-protocol/nips/blob/master/15.md.css.html">NIP-15</a>
that often sell many units of specific products through very specific
channels.</p>
<p>The structure of these events is very similar to <a
href="https://github.com/nostr-protocol/nips/blob/master/23.md.css.html">NIP-23</a>
long-form content events.</p>
<h3 id="draft-inactive-listings">Draft / Inactive Listings</h3>
<p><code>kind:30403</code> has the same structure as
<code>kind:30402</code> and is used to save draft or inactive classified
listings.</p>
<h3 id="content">Content</h3>
<p>The <code>.content</code> field should be a description of what is
being offered and by whom. These events should be a string in Markdown
syntax.</p>
<h3 id="author">Author</h3>
<p>The <code>.pubkey</code> field of these events are treated as the
party creating the listing.</p>
<h3 id="metadata">Metadata</h3>
<ul>
<li>For “tags”/“hashtags” (i.e. categories or keywords of relevance for
the listing) the <code>"t"</code> event tag should be used, as per <a
href="https://github.com/nostr-protocol/nips/blob/master/12.md.css.html">NIP-12</a>.</li>
<li>For images, whether included in the markdown content or not, clients
SHOULD use <code>image</code> tags as described in <a
href="https://github.com/nostr-protocol/nips/blob/master/58.md.css.html">NIP-58</a>.
This allows clients to display images in carousel format more
easily.</li>
</ul>
<p>The following tags, used for structured metadata, are standardized
and SHOULD be included. Other tags may be added as necessary.</p>
<ul>
<li><code>"title"</code>, a title for the listing</li>
<li><code>"summary"</code>, for short tagline or summary for the
listing</li>
<li><code>"published_at"</code>, for the timestamp (in unix seconds –
converted to string) of the first time the listing was published.</li>
<li><code>"location"</code>, for the location.</li>
<li><code>"price"</code>, for the price of the thing being listed. This
is an array in the format
<code>[ "price", "&lt;number&gt;", "&lt;currency&gt;", "&lt;frequency&gt;" ]</code>.
<ul>
<li><code>"price"</code> is the name of the tag</li>
<li><code>"&lt;number&gt;"</code> is the amount in numeric format (but
included in the tag as a string)</li>
<li><code>"&lt;currency&gt;"</code> is the currency unit in 3-character
ISO 4217 format or ISO 4217-like currency code (e.g. <code>"btc"</code>,
<code>"eth"</code>).</li>
<li><code>"&lt;frequency&gt;"</code> is optional and can be used to
describe recurring payments. SHOULD be in noun format (hour, day, week,
month, year, etc.)</li>
</ul></li>
<li><ul>
<li><code>"status"</code> (optional), the status of the listing. SHOULD
be either “active” or “sold”.</li>
</ul></li>
</ul>
<h4 id="price-examples"><code>price</code> examples</h4>
<ul>
<li>$50 one-time payment <code>["price", "50", "USD"]</code></li>
<li>€15 per month <code>["price", "15", "EUR", "month"]</code></li>
<li>£50,000 per year <code>["price", "50000", "GBP", "year"]</code></li>
</ul>
<p>Other standard tags that might be useful.</p>
<ul>
<li><code>"g"</code>, a geohash for more precise location</li>
</ul>
<h2 id="example-event">Example Event</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">30402</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1675642635</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">//</span> <span class="er">Markdown</span> <span class="er">content</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Lorem [ipsum][nostr:nevent1qqst8cujky046negxgwwm5ynqwn53t8aqjr6afd8g59nfqwxpdhylpcpzamhxue69uhhyetvv9ujuetcv9khqmr99e3k7mg8arnc9] dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span><span class="ch">\n\n</span><span class="st">Read more at nostr:naddr1qqzkjurnw4ksz9thwden5te0wfjkccte9ehx7um5wghx7un8qgs2d90kkcq3nk2jry62dyf50k0h36rhpdtd594my40w9pkal876jxgrqsqqqa28pccpzu.&quot;</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;lorem-ipsum&quot;</span><span class="ot">],</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;title&quot;</span><span class="ot">,</span> <span class="st">&quot;Lorem Ipsum&quot;</span><span class="ot">],</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;published_at&quot;</span><span class="ot">,</span> <span class="st">&quot;1296962229&quot;</span><span class="ot">],</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;t&quot;</span><span class="ot">,</span> <span class="st">&quot;electronics&quot;</span><span class="ot">],</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;image&quot;</span><span class="ot">,</span> <span class="st">&quot;https://url.to.img&quot;</span><span class="ot">,</span> <span class="st">&quot;256x256&quot;</span><span class="ot">],</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;summary&quot;</span><span class="ot">,</span> <span class="st">&quot;More lorem ipsum that is a little more than the title&quot;</span><span class="ot">],</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;location&quot;</span><span class="ot">,</span> <span class="st">&quot;NYC&quot;</span><span class="ot">],</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;price&quot;</span><span class="ot">,</span> <span class="st">&quot;100&quot;</span><span class="ot">,</span> <span class="st">&quot;USD&quot;</span><span class="ot">],</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;e&quot;</span><span class="ot">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;b3e392b11f5d4f28321cedd09303a748acfd0487aea5a7450b3481c60b6e4f87&quot;</span><span class="ot">,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;wss://relay.example.com&quot;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="ot">],</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;a&quot;</span><span class="ot">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;30023:a695f6b60119d9521934a691347d9f78e8770b56da16bb255ee286ddf9fda919:ipsum&quot;</span><span class="ot">,</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;wss://relay.nostr.org&quot;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;...&quot;</span><span class="fu">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;...&quot;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>98</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-98">NIP-98</h1>
<h2 id="http-auth">HTTP Auth</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines an ephemeral event used to authorize requests to
HTTP servers using nostr events.</p>
<p>This is useful for HTTP services which are built for Nostr and deal
with Nostr user accounts.</p>
<h2 id="nostr-event">Nostr event</h2>
<p>A <code>kind 27235</code> (In reference to <a
href="https://www.rfc-editor.org/rfc/rfc7235">RFC 7235</a>) event is
used.</p>
<p>The <code>content</code> SHOULD be empty.</p>
<p>The following tags MUST be included.</p>
<ul>
<li><code>u</code> - absolute URL</li>
<li><code>method</code> - HTTP Request Method</li>
</ul>
<p>Example event:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;fe964e758903360f28d8424d092da8494ed207cba823110be3a57dfe4b578734&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;63fe6318dc58583cfe16810f86dd09e18bfd76aabc24a0081ce2856f330504ed&quot;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">27235</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1682327852</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;u&quot;</span><span class="ot">,</span> <span class="st">&quot;https://api.snort.social/api/v1/n5sp/list&quot;</span><span class="ot">],</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;method&quot;</span><span class="ot">,</span> <span class="st">&quot;GET&quot;</span><span class="ot">]</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;5ed9d8ec958bc854f997bdc24ac337d005af372324747efe4a00e24f4c30437ff4dd8308684bed467d9d6be3e5a517bb43b1732cc7d33949a3aaf86705c22184&quot;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Servers MUST perform the following checks in order to validate the
event: 1. The <code>kind</code> MUST be <code>27235</code>. 2. The
<code>created_at</code> timestamp MUST be within a reasonable time
window (suggestion 60 seconds). 3. The <code>u</code> tag MUST be
exactly the same as the absolute request URL (including query
parameters). 4. The <code>method</code> tag MUST be the same HTTP method
used for the requested resource.</p>
<p>When the request contains a body (as in POST/PUT/PATCH methods)
clients SHOULD include a SHA256 hash of the request body in a
<code>payload</code> tag as hex
(<code>["payload", "&lt;sha256-hex&gt;"]</code>), servers MAY check this
to validate that the requested payload is authorized.</p>
<p>If one of the checks was to fail the server SHOULD respond with a 401
Unauthorized response code.</p>
<p>Servers MAY perform additional implementation-specific validation
checks.</p>
<h2 id="request-flow">Request Flow</h2>
<p>Using the <code>Authorization</code> HTTP header, the
<code>kind 27235</code> event MUST be <code>base64</code> encoded and
use the Authorization scheme <code>Nostr</code></p>
<p>Example HTTP Authorization header:</p>
<pre><code>Authorization: Nostr eyJpZCI6ImZlOTY0ZTc1ODkwMzM2MGYyOGQ4NDI0ZDA5MmRhODQ5NGVkMjA3Y2JhODIzMTEwYmUzYTU3ZGZlNGI1Nzg3MzQiLCJwdWJrZXkiOiI2M2ZlNjMxOGRjNTg1ODNjZmUxNjgxMGY4NmRkMDllMThiZmQ3NmFhYmMyNGEwMDgxY2UyODU2ZjMzMDUwNGVkIiwiY29udGVudCI6IiIsImtpbmQiOjI3MjM1LCJjcmVhdGVkX2F0IjoxNjgyMzI3ODUyLCJ0YWdzIjpbWyJ1cmwiLCJodHRwczovL2FwaS5zbm9ydC5zb2NpYWwvYXBpL3YxL241c3AvbGlzdCJdLFsibWV0aG9kIiwiR0VUIl1dLCJzaWciOiI1ZWQ5ZDhlYzk1OGJjODU0Zjk5N2JkYzI0YWMzMzdkMDA1YWYzNzIzMjQ3NDdlZmU0YTAwZTI0ZjRjMzA0MzdmZjRkZDgzMDg2ODRiZWQ0NjdkOWQ2YmUzZTVhNTE3YmI0M2IxNzMyY2M3ZDMzOTQ5YTNhYWY4NjcwNWMyMjE4NCJ9</code></pre>
<h2 id="reference-implementations">Reference Implementations</h2>
<ul>
<li>C# ASP.NET <code>AuthenticationHandler</code> <a
href="https://gist.github.com/v0l/74346ae530896115bfe2504c8cd018d3">NostrAuth.cs</a></li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>96</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-96">NIP-96</h1>
<h2 id="http-file-storage-integration">HTTP File Storage
Integration</h2>
<p><code>draft</code> <code>optional</code></p>
<h2 id="introduction">Introduction</h2>
<p>This NIP defines a REST API for HTTP file storage servers intended to
be used in conjunction with the nostr network. The API will enable nostr
users to upload files and later reference them by url on nostr
notes.</p>
<p>The spec DOES NOT use regular nostr events through websockets for
storing, requesting nor retrieving data because, for simplicity, the
server will not have to learn anything about nostr relays.</p>
<h2 id="server-adaptation">Server Adaptation</h2>
<p>File storage servers wishing to be accessible by nostr users should
opt-in by making available an https route at
<code>/.well-known/nostr/nip96.json</code> with
<code>api_url</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Required</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// File upload and deletion are served from this url</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Also downloads if &quot;download_url&quot; field is absent or empty string</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;api_url&quot;</span><span class="op">:</span> <span class="st">&quot;https://your-file-server.example/custom-api-path&quot;</span><span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Optional</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// If absent, downloads are served from the api_url</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;download_url&quot;</span><span class="op">:</span> <span class="st">&quot;https://a-cdn.example/a-path&quot;</span><span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Optional</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Note: This field is not meant to be set by HTTP Servers.</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Use this if you are a nostr relay using your /.well-known/nostr/nip96.json</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// just to redirect to someone else&#39;s http file storage server&#39;s /.well-known/nostr/nip96.json</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// In this case, &quot;api_url&quot; field must be an empty string</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;delegated_to_url&quot;</span><span class="op">:</span> <span class="st">&quot;https://your-file-server.example&quot;</span><span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Optional</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;supported_nips&quot;</span><span class="op">:</span> [<span class="dv">60</span>]<span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Optional</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tos_url&quot;</span><span class="op">:</span> <span class="st">&quot;https://your-file-server.example/terms-of-service&quot;</span><span class="op">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Optional</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content_types&quot;</span><span class="op">:</span> [<span class="st">&quot;image/jpeg&quot;</span><span class="op">,</span> <span class="st">&quot;video/webm&quot;</span><span class="op">,</span> <span class="st">&quot;audio/*&quot;</span>]<span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Optional</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;plans&quot;</span><span class="op">:</span> {</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// &quot;free&quot; is the only standardized plan key and</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// clients may use its presence to learn if server offers free storage</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;free&quot;</span><span class="op">:</span> {</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;Free Tier&quot;</span><span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Default is true</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="co">// All plans MUST support NIP-98 uploads</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">// but some plans may also allow uploads without it</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;is_nip98_required&quot;</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;url&quot;</span><span class="op">:</span> <span class="st">&quot;https://...&quot;</span><span class="op">,</span> <span class="co">// plan&#39;s landing page if there is one</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;max_byte_size&quot;</span><span class="op">:</span> <span class="dv">10485760</span><span class="op">,</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Range in days / 0 for no expiration</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">// [7, 0] means it may vary from 7 days to unlimited persistence,</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      <span class="co">// [0, 0] means it has no expiration</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      <span class="co">// early expiration may be due to low traffic or any other factor</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;file_expiration&quot;</span><span class="op">:</span> [<span class="dv">14</span><span class="op">,</span> <span class="dv">90</span>]<span class="op">,</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;media_transformations&quot;</span><span class="op">:</span> {</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;image&quot;</span><span class="op">:</span> [</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;resizing&#39;</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="relay-hints">Relay Hints</h3>
<p>Note: This section is not meant to be used by HTTP Servers.</p>
<p>A nostr relay MAY redirect to someone else’s HTTP file storage server
by adding a <code>/.well-known/nostr/nip96.json</code> with
“delegated_to_url” field pointing to the url where the server hosts its
own <code>/.well-known/nostr/nip96.json</code>. In this case, the
“api_url” field must be an empty string and all other fields must be
absent.</p>
<p>If the nostr relay is also an HTTP file storage server, it must use
the “api_url” field instead.</p>
<h3 id="list-of-supporting-file-storage-servers">List of Supporting File
Storage Servers</h3>
<p>See
https://github.com/aljazceru/awesome-nostr#nip-96-file-storage-servers.</p>
<h2 id="upload">Upload</h2>
<p>A file can be uploaded one at a time to
<code>https://your-file-server.example/custom-api-path</code> (route
from
<code>https://your-file-server.example/.well-known/nostr/nip96.json</code>
“api_url” field) as <code>multipart/form-data</code> content type using
<code>POST</code> method with the file object set to the
<code>file</code> form data field.</p>
<p><code>Clients</code> must add an <a href="98.md.css.html">NIP-98</a>
<code>Authorization</code> header (<strong>optionally</strong> with the
encoded <code>payload</code> tag set to the base64-encoded 256-bit
SHA-256 hash of the file - not the hash of the whole request body). If
using an html form, use an <code>Authorization</code> form data field
instead.</p>
<p>These following <strong>optional</strong> form data fields MAY be
used by <code>servers</code> and SHOULD be sent by <code>clients</code>:
- <code>expiration</code>: string of the UNIX timestamp in seconds.
Empty string if file should be stored forever. The server isn’t required
to honor this; - <code>size</code>: string of the file byte size. This
is just a value the server can use to reject early if the file size
exceeds the server limits; - <code>alt</code>: (recommended) strict
description text for visibility-impaired users; - <code>caption</code>:
loose description; - <code>media_type</code>: “avatar” or “banner”.
Informs the server if the file will be used as an avatar or banner. If
absent, the server will interpret it as a normal upload, without special
treatment; - <code>content_type</code>: mime type such as “image/jpeg”.
This is just a value the server can use to reject early if the mime type
isn’t supported.</p>
<p>Others custom form data fields may be used depending on specific
<code>server</code> support. The <code>server</code> isn’t required to
store any metadata sent by <code>clients</code>.</p>
<p>Note for <code>clients</code>: if using an HTML form, it is important
for the <code>file</code> form field to be the <strong>last</strong>
one, or be re-ordered right before sending or be appended as the last
field of XHR2’s FormData object.</p>
<p>The <code>filename</code> embedded in the file may not be honored by
the <code>server</code>, which could internally store just the SHA-256
hash value as the file name, ignoring extra metadata. The hash is enough
to uniquely identify a file, that’s why it will be used on the
“download” and “delete” routes.</p>
<p>The <code>server</code> MUST link the user’s <code>pubkey</code>
string (which is embedded in the decoded header value) as the owner of
the file so to later allow them to delete the file. Note that if a file
with the same hash of a previously received file (so the same file) is
uploaded by another user, the server doesn’t need to store the new file.
It should just add the new user’s <code>pubkey</code> to the list of the
owners of the already stored file with said hash (if it wants to save
space by keeping just one copy of the same file, because multiple
uploads of the same file results in the same file hash).</p>
<p>The <code>server</code> MAY also store the <code>Authorization</code>
header/field value (decoded or not) for accountability purpose as this
proves that the user with the unique pubkey did ask for the upload of
the file with a specific hash. However, storing the pubkey is sufficient
to establish ownership.</p>
<p>The <code>server</code> MUST reject with 413 Payload Too Large if
file size exceeds limits.</p>
<p>The <code>server</code> MUST reject with 400 Bad Request status if
some fields are invalid.</p>
<p>The <code>server</code> MUST reply to the upload with 200 OK status
if the <code>payload</code> tag value contains an already used SHA-256
hash (if file is already owned by the same pubkey) or reject the upload
with 403 Forbidden status if it isn’t the same of the received file.</p>
<p>The <code>server</code> MAY reject the upload with 402 Payment
Required status if the user has a pending payment (Payment flow is not
strictly required. Server owners decide if the storage is free or not.
Monetization schemes may be added later to correlated NIPs.).</p>
<p>On successful uploads the <code>server</code> MUST reply with
<strong>201 Created</strong> HTTP status code or <strong>202
Accepted</strong> if a <code>processing_url</code> field is added to the
response so that the <code>client</code> can follow the processing
status (see <a href="#delayed-processing">Delayed Processing</a>
section).</p>
<p>The upload response is a json object as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// &quot;success&quot; if successful or &quot;error&quot; if not</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">status</span><span class="op">:</span> <span class="st">&quot;success&quot;</span><span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Free text success, failure or info message</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;Upload successful.&quot;</span><span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Optional. See &quot;Delayed Processing&quot; section</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">processing_url</span><span class="op">:</span> <span class="st">&quot;...&quot;</span><span class="op">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This uses the NIP-94 event format but DO NOT need</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// to fill some fields like &quot;id&quot;, &quot;pubkey&quot;, &quot;created_at&quot; and &quot;sig&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This holds the download url (&quot;url&quot;),</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// the ORIGINAL file hash before server transformations (&quot;ox&quot;)</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// and, optionally, all file metadata the server wants to make available</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// nip94_event field is absent if unsuccessful upload</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">nip94_event</span><span class="op">:</span> {</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Required tags: &quot;url&quot; and &quot;ox&quot;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tags</span><span class="op">:</span> [</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Can be same from /.well-known/nostr/nip96.json&#39;s &quot;download_url&quot; field</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      <span class="co">// (or &quot;api_url&quot; field if &quot;download_url&quot; is absent or empty) with appended</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      <span class="co">// original file hash.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">//</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Note we appended .png file extension to the `ox` value</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">// (it is optional but extremely recommended to add the extension as it will help nostr clients</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>      <span class="co">// with detecting the file type by using regular expression)</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>      <span class="co">//</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Could also be any url to download the file</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>      <span class="co">// (using or not using the /.well-known/nostr/nip96.json&#39;s &quot;download_url&quot; prefix),</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">// for load balancing purposes for example.</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>      [<span class="st">&quot;url&quot;</span><span class="op">,</span> <span class="st">&quot;https://your-file-server.example/custom-api-path/719171db19525d9d08dd69cb716a18158a249b7b3b3ec4bbdec5698dca104b7b.png&quot;</span>]<span class="op">,</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">// SHA-256 hash of the ORIGINAL file, before transformations.</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>      <span class="co">// The server MUST store it even though it represents the ORIGINAL file because</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>      <span class="co">// users may try to download/delete the transformed file using this value</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>      [<span class="st">&quot;ox&quot;</span><span class="op">,</span> <span class="st">&quot;719171db19525d9d08dd69cb716a18158a249b7b3b3ec4bbdec5698dca104b7b&quot;</span>]<span class="op">,</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Optional. SHA-256 hash of the saved file after any server transformations.</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>      <span class="co">// The server can but does not need to store this value.</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>      [<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="st">&quot;543244319525d9d08dd69cb716a18158a249b7b3b3ec4bbde5435543acb34443&quot;</span>]<span class="op">,</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Optional. Recommended for helping clients to easily know file type before downloading it.</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>      [<span class="st">&quot;m&quot;</span><span class="op">,</span> <span class="st">&quot;image/png&quot;</span>]</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Optional. Recommended for helping clients to reserve an adequate UI space to show the file before downloading it.</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>      [<span class="st">&quot;dim&quot;</span><span class="op">,</span> <span class="st">&quot;800x600&quot;</span>]</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ... other optional NIP-94 tags</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;&quot;</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... other custom fields (please consider adding them to this NIP or to NIP-94 tags)</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note that if the server didn’t apply any transformation to the
received file, both <code>nip94_event.tags.*.ox</code> and
<code>nip94_event.tags.*.x</code> fields will have the same value. The
server MUST link the saved file to the SHA-256 hash of the
<strong>original</strong> file before any server transformations (the
<code>nip94_event.tags.*.ox</code> tag value). The
<strong>original</strong> file’s SHA-256 hash will be used to identify
the saved file when downloading or deleting it.</p>
<p><code>Clients</code> may upload the same file to one or many
<code>servers</code>. After successful upload, the <code>client</code>
may optionally generate and send to any set of nostr <code>relays</code>
a <a href="94.md.css.html">NIP-94</a> event by including the missing fields.</p>
<p>Alternatively, instead of using NIP-94, the <code>client</code> can
share or embed on a nostr note just the above url.</p>
<h3 id="delayed-processing">Delayed Processing</h3>
<p>Sometimes the server may want to place the uploaded file in a
processing queue for deferred file processing.</p>
<p>In that case, the server MUST serve the original file while the
processing isn’t done, then swap the original file for the processed one
when the processing is over. The upload response is the same as usual
but some optional metadata like <code>nip94_event.tags.*.x</code> and
<code>nip94_event.tags.*.size</code> won’t be available.</p>
<p>The expected resulting metadata that is known in advance should be
returned on the response. For example, if the file processing would
change a file from “jpg” to “webp”, use “.webp” extension on the
<code>nip94_event.tags.*.url</code> field value and set “image/webp” to
the <code>nip94_event.tags.*.m</code> field. If some metadata are
unknown before processing ends, omit them from the response.</p>
<p>The upload response MAY include a <code>processing_url</code> field
informing a temporary url that may be used by clients to check if the
file processing is done.</p>
<p>If the processing isn’t done, the server should reply at the
<code>processing_url</code> url with <strong>200 OK</strong> and the
following JSON:</p>
<pre><code>{
  // It should be &quot;processing&quot;. If &quot;error&quot; it would mean the processing failed.
  status: &quot;processing&quot;,
  message: &quot;Processing. Please check again later for updated status.&quot;,
  percentage: 15 // Processing percentage. An integer between 0 and 100.
}</code></pre>
<p>When the processing is over, the server replies at the
<code>processing_url</code> url with <strong>201 Created</strong> status
and a regular successful JSON response already mentioned before (now
<strong>without</strong> a <code>processing_url</code> field), possibly
including optional metadata at <code>nip94_event.tags.*</code> fields
that weren’t available before processing.</p>
<h3 id="file-compression">File compression</h3>
<p>File compression and other transformations like metadata stripping
can be applied by the server. However, for all file actions, such as
download and deletion, the <strong>original</strong> file SHA-256 hash
is what identifies the file in the url string.</p>
<h2 id="download">Download</h2>
<p><code>Servers</code> must make available the route
<code>https://your-file-server.example/custom-api-path/&lt;sha256-file-hash&gt;(.ext)</code>
(route taken from
<code>https://your-file-server.example/.well-known/nostr/nip96.json</code>
“api_url” or “download_url” field) with <code>GET</code> method for file
download.</p>
<p>The primary file download url informed at the upload’s response field
<code>nip94_event.tags.*.url</code> can be that or not (it can be any
non-standard url the server wants). If not, the server still MUST also
respond to downloads at the standard url mentioned on the previous
paragraph, to make it possible for a client to try downloading a file on
any NIP-96 compatible server by knowing just the SHA-256 file hash.</p>
<p>Note that the “&lt;sha256-file-hash&gt;” part is from the
<strong>original</strong> file, <strong>not</strong> from the
<strong>transformed</strong> file if the uploaded file went through any
server transformation.</p>
<p>Supporting “.ext”, meaning “file extension”, is required for
<code>servers</code>. It is optional, although recommended, for
<code>clients</code> to append it to the path. When present it may be
used by <code>servers</code> to know which <code>Content-Type</code>
header to send (e.g.: “Content-Type”: “image/png” for “.png” extension).
The file extension may be absent because the hash is the only needed
string to uniquely identify a file.</p>
<p>Example:
<code>https://your-file-server.example/custom-api-path/719171db19525d9d08dd69cb716a18158a249b7b3b3ec4bbdec5698dca104b7b.png</code></p>
<h3 id="media-transformations">Media Transformations</h3>
<p><code>Servers</code> may respond to some media transformation query
parameters and ignore those they don’t support by serving the original
media file without transformations.</p>
<h4 id="image-transformations">Image Transformations</h4>
<h5 id="resizing">Resizing</h5>
<p>Upon upload, <code>servers</code> may create resized image variants,
such as thumbnails, respecting the original aspect ratio.
<code>Clients</code> may use the <code>w</code> query parameter to
request an image version with the desired pixel width.
<code>Servers</code> can then serve the variant with the closest width
to the parameter value or an image variant generated on the fly.</p>
<p>Example:
<code>https://your-file-server.example/custom-api-path/&lt;sha256-file-hash&gt;.png?w=32</code></p>
<h2 id="deletion">Deletion</h2>
<p><code>Servers</code> must make available the route
<code>https://deletion.domain/deletion-path/&lt;sha256-file-hash&gt;(.ext)</code>
(route taken from
<code>https://your-file-server.example/.well-known/nostr/nip96.json</code>
“api_url” field) with <code>DELETE</code> method for file deletion.</p>
<p>Note that the “&lt;sha256-file-hash&gt;” part is from the
<strong>original</strong> file, <strong>not</strong> from the
<strong>transformed</strong> file if the uploaded file went through any
server transformation.</p>
<p>The extension is optional as the file hash is the only needed file
identification.</p>
<p><code>Clients</code> should send a <code>DELETE</code> request to the
server deletion route in the above format. It must include a NIP-98
<code>Authorization</code> header.</p>
<p>The <code>server</code> should reject deletes from users other than
the original uploader. The <code>pubkey</code> encoded on the header
value identifies the user.</p>
<p>It should be noted that more than one user may have uploaded the same
file (with the same hash). In this case, a delete must not really delete
the file but just remove the user’s <code>pubkey</code> from the file
owners list (considering the server keeps just one copy of the same
file, because multiple uploads of the same file results in the same file
hash).</p>
<p>The successful response is a 200 OK one with just basic JSON
fields:</p>
<pre><code>{
  status: &quot;success&quot;,
  message: &quot;File deleted.&quot;
}</code></pre>
<h2 id="selecting-a-server">Selecting a Server</h2>
<p>Note: HTTP File Storage Server developers may skip this section. This
is meant for client developers.</p>
<p>A File Server Preference event is a kind 10096 replaceable event
meant to select one or more servers the user wants to upload files to.
Servers are listed as <code>server</code> tags:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">10096</span><span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;server&quot;</span><span class="op">,</span> <span class="st">&quot;https://file.server.one&quot;</span>]<span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;server&quot;</span><span class="op">,</span> <span class="st">&quot;https://file.server.two&quot;</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>94</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-94">NIP-94</h1>
<h2 id="file-metadata">File Metadata</h2>
<p><code>draft</code> <code>optional</code></p>
<p>The purpose of this NIP is to allow an organization and
classification of shared files. So that relays can filter and organize
in any way that is of interest. With that, multiple types of filesharing
clients can be created. NIP-94 support is not expected to be implemented
by “social” clients that deal with <code>kind:1</code> notes or by
longform clients that deal with <code>kind:30023</code> articles.</p>
<h2 id="event-format">Event format</h2>
<p>This NIP specifies the use of the <code>1063</code> event type,
having in <code>content</code> a description of the file content, and a
list of tags described below:</p>
<ul>
<li><code>url</code> the url to download the file</li>
<li><code>m</code> a string indicating the data type of the file. The <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types">MIME
types</a> format must be used, and they should be lowercase.</li>
<li><code>x</code> containing the SHA-256 hexencoded string of the
file.</li>
<li><code>ox</code> containing the SHA-256 hexencoded string of the
original file, before any transformations done by the upload server</li>
<li><code>size</code> (optional) size of file in bytes</li>
<li><code>dim</code> (optional) size of file in pixels in the form
<code>&lt;width&gt;x&lt;height&gt;</code></li>
<li><code>magnet</code> (optional) URI to magnet file</li>
<li><code>i</code> (optional) torrent infohash</li>
<li><code>blurhash</code>(optional) the <a
href="https://github.com/woltapp/blurhash">blurhash</a> to show while
the file is being loaded by the client</li>
<li><code>thumb</code> (optional) url of thumbnail with same aspect
ratio</li>
<li><code>image</code> (optional) url of preview image with same
dimensions</li>
<li><code>summary</code> (optional) text excerpt</li>
<li><code>alt</code> (optional) description for accessibility</li>
<li><code>fallback</code> (optional) zero or more fallback file sources
in case <code>url</code> fails</li>
</ul>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1063</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;url&quot;</span><span class="ot">,</span><span class="er">&lt;string</span> <span class="er">with</span> <span class="er">URI</span> <span class="er">of</span> <span class="er">file&gt;</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;m&quot;</span><span class="ot">,</span> <span class="er">&lt;MIME</span> <span class="er">type&gt;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;x&quot;</span><span class="ot">,</span><span class="er">&lt;Hash</span> <span class="er">SHA</span><span class="dv">-256</span><span class="er">&gt;</span><span class="ot">],</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;ox&quot;</span><span class="ot">,</span><span class="er">&lt;Hash</span> <span class="er">SHA</span><span class="dv">-256</span><span class="er">&gt;</span><span class="ot">],</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;size&quot;</span><span class="ot">,</span> <span class="er">&lt;size</span> <span class="er">of</span> <span class="er">file</span> <span class="er">in</span> <span class="er">bytes&gt;</span><span class="ot">],</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;dim&quot;</span><span class="ot">,</span> <span class="er">&lt;size</span> <span class="er">of</span> <span class="er">file</span> <span class="er">in</span> <span class="er">pixels&gt;</span><span class="ot">],</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;magnet&quot;</span><span class="ot">,</span><span class="er">&lt;magnet</span> <span class="er">URI&gt;</span> <span class="ot">],</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;i&quot;</span><span class="ot">,</span><span class="er">&lt;torrent</span> <span class="er">infohash&gt;</span><span class="ot">],</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;blurhash&quot;</span><span class="ot">,</span> <span class="er">&lt;value&gt;</span><span class="ot">],</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;thumb&quot;</span><span class="ot">,</span> <span class="er">&lt;string</span> <span class="er">with</span> <span class="er">thumbnail</span> <span class="er">URI&gt;</span><span class="ot">],</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;image&quot;</span><span class="ot">,</span> <span class="er">&lt;string</span> <span class="er">with</span> <span class="er">preview</span> <span class="er">URI&gt;</span><span class="ot">],</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;summary&quot;</span><span class="ot">,</span> <span class="er">&lt;excerpt&gt;</span><span class="ot">],</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;alt&quot;</span><span class="ot">,</span> <span class="er">&lt;description&gt;</span><span class="ot">]</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;caption&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="suggested-use-cases">Suggested use cases</h2>
<ul>
<li>A relay for indexing shared files. For example, to promote
torrents.</li>
<li>A pinterest-like client where people can share their portfolio and
inspire others.</li>
<li>A simple way to distribute configurations and software updates.</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>92</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-92">NIP-92</h1>
<h2 id="media-attachments">Media Attachments</h2>
<p>Media attachments (images, videos, and other files) may be added to
events by including a URL in the event content, along with a matching
<code>imeta</code> tag.</p>
<p><code>imeta</code> (“inline metadata”) tags add information about
media URLs in the event’s content. Each <code>imeta</code> tag SHOULD
match a URL in the event content. Clients may replace imeta URLs with
rich previews.</p>
<p>The <code>imeta</code> tag is variadic, and each entry is a
space-delimited key/value pair. Each <code>imeta</code> tag MUST have a
<code>url</code>, and at least one other field. <code>imeta</code> may
include any field specified by <a href="./94.md.css.html">NIP 94</a>. There
SHOULD be only one <code>imeta</code> tag per URL.</p>
<h2 id="example">Example</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;More image metadata tests don’t mind me https://nostr.build/i/my-image.jpg&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;imeta&quot;</span><span class="ot">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;url https://nostr.build/i/my-image.jpg&quot;</span><span class="ot">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;m image/jpeg&quot;</span><span class="ot">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;blurhash eVF$^OI:${M{o#*0-nNFxakD-?xVM}WEWB%iNKxvR-oetmo#R-aen$&quot;</span><span class="ot">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;dim 3024x4032&quot;</span><span class="ot">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;alt A scenic photo overlooking the coast of Costa Rica&quot;</span><span class="ot">,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;x &lt;sha256 hash as specified in NIP 94&gt;&quot;</span><span class="ot">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;fallback https://nostrcheck.me/alt1.jpg&quot;</span><span class="ot">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;fallback https://void.cat/alt1.jpg&quot;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="recommended-client-behavior">Recommended client behavior</h2>
<p>When uploading files during a new post, clients MAY include this
metadata after the file is uploaded and included in the post.</p>
<p>When pasting URLs during post composition, the client MAY download
the file and add this metadata before the post is sent.</p>
<p>The client MAY ignore <code>imeta</code> tags that do not match the
URL in the event content.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>90</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-90">NIP-90</h1>
<h2 id="data-vending-machine">Data Vending Machine</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines the interaction between customers and Service
Providers for performing on-demand computation.</p>
<p>Money in, data out.</p>
<h2 id="kinds">Kinds</h2>
<p>This NIP reserves the range <code>5000-7000</code> for data vending
machine use.</p>
<table>
<thead>
<tr class="header">
<th>Kind</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5000-5999</td>
<td>Job request kinds</td>
</tr>
<tr class="even">
<td>6000-6999</td>
<td>Job result</td>
</tr>
<tr class="odd">
<td>7000</td>
<td>Job feedback</td>
</tr>
</tbody>
</table>
<p>Job results always use a kind number that is <code>1000</code> higher
than the job request kind. (e.g. request: <code>kind:5001</code> gets a
result: <code>kind:6001</code>).</p>
<p>Job request types are defined <a
href="https://github.com/nostr-protocol/data-vending-machines/tree/master/kinds">separately</a>.</p>
<h2 id="rationale">Rationale</h2>
<p>Nostr can act as a marketplace for data processing, where users
request jobs to be processed in certain ways (e.g., “speech-to-text”,
“summarization”, etc.), but they don’t necessarily care about “who”
processes the data.</p>
<p>This NIP is not to be confused with a 1:1 marketplace; instead, it
describes a flow where a user announces a desired output, willingness to
pay, and service providers compete to fulfill the job requirement in the
best way possible.</p>
<h3 id="actors">Actors</h3>
<p>There are two actors in the workflow described in this NIP: *
Customers (npubs who request a job) * Service providers (npubs who
fulfill jobs)</p>
<h2 id="job-request-kind5000-5999">Job request
(<code>kind:5000-5999</code>)</h2>
<p>A request to process data, published by a customer. This event
signals that a customer is interested in receiving the result of some
kind of compute.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="er">xxx</span><span class="fu">,</span> <span class="er">//</span> <span class="er">kind</span> <span class="er">in</span> <span class="er">5000-5999</span> <span class="er">range</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="ot">[</span> <span class="st">&quot;i&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;data&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;input-type&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;relay&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;marker&gt;&quot;</span> <span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="ot">[</span> <span class="st">&quot;output&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;mime-type&gt;&quot;</span> <span class="ot">],</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="ot">[</span> <span class="st">&quot;relays&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://...&quot;</span> <span class="ot">],</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="ot">[</span> <span class="st">&quot;bid&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;msat-amount&gt;&quot;</span> <span class="ot">],</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="ot">[</span> <span class="st">&quot;t&quot;</span><span class="ot">,</span> <span class="st">&quot;bitcoin&quot;</span> <span class="ot">]</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>All tags are optional.</p>
<ul>
<li><code>i</code> tag: Input data for the job (zero or more inputs)
<ul>
<li><code>&lt;data&gt;</code>: The argument for the input</li>
<li><code>&lt;input-type&gt;</code>: The way this argument should be
interpreted. MUST be one of:
<ul>
<li><code>url</code>: A URL to be fetched of the data that should be
processed.</li>
<li><code>event</code>: A Nostr event ID.</li>
<li><code>job</code>: The output of a previous job with the specified
event ID. The dermination of which output to build upon is up to the
service provider to decide (e.g. waiting for a signaling from the
customer, waiting for a payment, etc.)</li>
<li><code>text</code>: <code>&lt;data&gt;</code> is the value of the
input, no resolution is needed</li>
</ul></li>
<li><code>&lt;relay&gt;</code>: If <code>event</code> or
<code>job</code> input-type, the relay where the event/job was
published, otherwise optional or empty string</li>
<li><code>&lt;marker&gt;</code>: An optional field indicating how this
input should be used within the context of the job</li>
</ul></li>
<li><code>output</code>: Expected output format. Different job request
<code>kind</code> defines this more precisely.</li>
<li><code>param</code>: Optional parameters for the job as key (first
argument)/value (second argument). Different job request
<code>kind</code> defines this more precisely.
(e.g. <code>[ "param", "lang", "es" ]</code>)</li>
<li><code>bid</code>: Customer MAY specify a maximum amount (in
millisats) they are willing to pay</li>
<li><code>relays</code>: List of relays where Service Providers SHOULD
publish responses to</li>
<li><code>p</code>: Service Providers the customer is interested in.
Other SPs MIGHT still choose to process the job</li>
</ul>
<h2 id="encrypted-params">Encrypted Params</h2>
<p>If the user wants to keep the input parameters a secret, they can
encrypt the <code>i</code> and <code>param</code> tags with the service
provider’s ‘p’ tag and add it to the content field. Add a tag
<code>encrypted</code> as tags. Encryption for private tags will use <a
href="https://github.com/nostr-protocol/nips/blob/master/04.md.css.html">NIP-04 -
Encrypted Direct Message encryption</a>, using the user’s private and
service provider’s public key for the shared secret</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;i&quot;</span><span class="ot">,</span> <span class="st">&quot;what is the capital of France? &quot;</span><span class="ot">,</span> <span class="st">&quot;text&quot;</span><span class="ot">],</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;param&quot;</span><span class="ot">,</span> <span class="st">&quot;model&quot;</span><span class="ot">,</span> <span class="st">&quot;LLaMA-2&quot;</span><span class="ot">],</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;param&quot;</span><span class="ot">,</span> <span class="st">&quot;max_tokens&quot;</span><span class="ot">,</span> <span class="st">&quot;512&quot;</span><span class="ot">],</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;param&quot;</span><span class="ot">,</span> <span class="st">&quot;temperature&quot;</span><span class="ot">,</span> <span class="st">&quot;0.5&quot;</span><span class="ot">],</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;param&quot;</span><span class="ot">,</span> <span class="st">&quot;top-k&quot;</span><span class="ot">,</span> <span class="st">&quot;50&quot;</span><span class="ot">],</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;param&quot;</span><span class="ot">,</span> <span class="st">&quot;top-p&quot;</span><span class="ot">,</span> <span class="st">&quot;0.7&quot;</span><span class="ot">],</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;param&quot;</span><span class="ot">,</span> <span class="st">&quot;frequency_penalty&quot;</span><span class="ot">,</span> <span class="st">&quot;1&quot;</span><span class="ot">]</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>This param data will be encrypted and added to the
<code>content</code> field and <code>p</code> tag should be present</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;BE2Y4xvS6HIY7TozIgbEl3sAHkdZoXyLRRkZv4fLPh3R7LtviLKAJM5qpkC7D6VtMbgIt4iNcMpLtpo...&quot;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;04f74530a6ede6b24731b976b8e78fb449ea61f40ff10e3d869a3030c4edc91f&quot;</span><span class="ot">],</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;encrypted&quot;</span><span class="ot">]</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="job-result-kind6000-6999">Job result
(<code>kind:6000-6999</code>)</h2>
<p>Service providers publish job results, providing the output of the
job result. They should tag the original job request event id as well as
the customer’s pubkey.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;service-provider pubkey&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;payload&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">6</span><span class="er">xxx</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;request&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;job-request&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;job-request-id&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;relay-hint&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;i&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;input-data&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;customer&#39;s-pubkey&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;amount&quot;</span><span class="ot">,</span> <span class="st">&quot;requested-payment-amount&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;optional-bolt11&gt;&quot;</span><span class="ot">]</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><code>request</code>: The job request event stringified-JSON.</li>
<li><code>amount</code>: millisats that the Service Provider is
requesting to be paid. An optional third value can be a bolt11
invoice.</li>
<li><code>i</code>: The original input(s) specified in the request.</li>
</ul>
<h2 id="encrypted-output">Encrypted Output</h2>
<p>If the request has encrypted params, then output should be encrypted
and placed in <code>content</code> field. If the output is encrypted,
then avoid including <code>i</code> tag with input-data as clear text.
Add a tag encrypted to mark the output content as
<code>encrypted</code></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;service-provider pubkey&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;encrypted payload&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">6</span><span class="er">xxx</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;request&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;job-request&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;job-request-id&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;relay-hint&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;customer&#39;s-pubkey&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;amount&quot;</span><span class="ot">,</span> <span class="st">&quot;requested-payment-amount&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;optional-bolt11&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;encrypted&quot;</span><span class="ot">]</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="job-feedback">Job feedback</h2>
<p>Service providers can give feedback about a job back to the
customer.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">7000</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;empty-or-payload&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;status&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;status&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;extra-info&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;amount&quot;</span><span class="ot">,</span> <span class="st">&quot;requested-payment-amount&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;bolt11&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;job-request-id&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;relay-hint&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;customer&#39;s-pubkey&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><p><code>content</code>: Either empty or a job-result (e.g. for
partial-result samples)</p></li>
<li><p><code>amount</code> tag: as defined in the <a
href="#job-result-kind6000-6999">Job Result</a> section.</p></li>
<li><p><code>status</code> tag: Service Providers SHOULD indicate what
this feedback status refers to. <a href="#job-feedback-status">Job
Feedback Status</a> defines status. Extra human-readable information can
be added as an extra argument.</p></li>
<li><p>NOTE: If the input params requires input to be encrypted, then
<code>content</code> field will have encrypted payload with
<code>p</code> tag as key.</p></li>
</ul>
<h3 id="job-feedback-status">Job feedback status</h3>
<table>
<colgroup>
<col style="width: 38%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="header">
<th>status</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>payment-required</code></td>
<td>Service Provider requires payment before continuing.</td>
</tr>
<tr class="even">
<td><code>processing</code></td>
<td>Service Provider is processing the job.</td>
</tr>
<tr class="odd">
<td><code>error</code></td>
<td>Service Provider was unable to process the job.</td>
</tr>
<tr class="even">
<td><code>success</code></td>
<td>Service Provider successfully processed the job.</td>
</tr>
<tr class="odd">
<td><code>partial</code></td>
<td>Service Provider partially processed the job. The
<code>.content</code> might include a sample of the partial
results.</td>
</tr>
</tbody>
</table>
<p>Any job feedback event MIGHT include results in the
<code>.content</code> field, as described in the <a
href="#job-result-kind6000-6999">Job Result</a> section. This is useful
for service providers to provide a sample of the results that have been
processed so far.</p>
<h1 id="protocol-flow">Protocol Flow</h1>
<ul>
<li>Customer publishes a job request (e.g. <code>kind:5000</code>
speech-to-text).</li>
<li>Service Providers MAY submit <code>kind:7000</code> job-feedback
events (e.g. <code>payment-required</code>, <code>processing</code>,
<code>error</code>, etc.).</li>
<li>Upon completion, the service provider publishes the result of the
job with a <code>kind:6000</code> job-result event.</li>
<li>At any point, if there is an <code>amount</code> pending to be paid
as instructed by the service provider, the user can pay the included
<code>bolt11</code> or zap the job result event the service provider has
sent to the user</li>
</ul>
<p>Job feedback (<code>kind:7000</code>) and Job Results
(<code>kind:6000-6999</code>) events MAY include an <code>amount</code>
tag, this can be interpreted as a suggestion to pay. Service Providers
MUST use the <code>payment-required</code> feedback event to signal that
a payment is required and no further actions will be performed until the
payment is sent.</p>
<p>Customers can always either pay the included <code>bolt11</code>
invoice or zap the event requesting the payment and service providers
should monitor for both if they choose to include a bolt11 invoice.</p>
<h2 id="notes-about-the-protocol-flow">Notes about the protocol
flow</h2>
<p>The flow is deliberately ambiguous, allowing vast flexibility for the
interaction between customers and service providers so that service
providers can model their behavior based on their own
decisions/perceptions of risk.</p>
<p>Some service providers might choose to submit a
<code>payment-required</code> as the first reaction before sending a
<code>processing</code> or before delivering results, some might choose
to serve partial results for the job (e.g. a sample), send a
<code>payment-required</code> to deliver the rest of the results, and
some service providers might choose to assess likelihood of payment
based on an npub’s past behavior and thus serve the job results before
requesting payment for the best possible UX.</p>
<p>It’s not up to this NIP to define how individual vending machines
should choose to run their business.</p>
<h1 id="cancellation">Cancellation</h1>
<p>A job request might be canceled by publishing a <code>kind:5</code>
delete request event tagging the job request event.</p>
<h1 id="appendix-1-job-chaining">Appendix 1: Job chaining</h1>
<p>A Customer MAY request multiple jobs to be processed as a chain,
where the output of a job is the input of another job. (e.g. podcast
transcription -&gt; summarization of the transcription). This is done by
specifying as input an event id of a different job with the
<code>job</code> type.</p>
<p>Service Providers MAY begin processing a subsequent job the moment
they see the prior job’s result, but they will likely wait for a zap to
be published first. This introduces a risk that Service Provider of job
#1 might delay publishing the zap event in order to have an advantage.
This risk is up to Service Providers to mitigate or to decide whether
the service provider of job #1 tends to have good-enough results so as
to not wait for an explicit zap to assume the job was accepted.</p>
<p>This gives a higher level of flexibility to service providers (which
sophisticated service providers would take anyway).</p>
<h1 id="appendix-2-service-provider-discoverability">Appendix 2: Service
provider discoverability</h1>
<p>Service Providers MAY use NIP-89 announcements to advertise their
support for job kinds:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">31990</span><span class="op">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;pubkey&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;pubkey&gt;&quot;</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    \<span class="st">&quot;name</span><span class="sc">\&quot;</span><span class="st">: </span><span class="sc">\&quot;</span><span class="st">Translating DVM</span><span class="sc">\&quot;</span><span class="st">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    \<span class="st">&quot;about</span><span class="sc">\&quot;</span><span class="st">: </span><span class="sc">\&quot;</span><span class="st">I&#39;m a DVM specialized in translating Bitcoin content.</span><span class="sc">\&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  }<span class="st">&quot;,</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;k&quot;</span><span class="op">,</span> <span class="st">&quot;5005&quot;</span>]<span class="op">,</span> <span class="co">// e.g. translation</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;t&quot;</span><span class="op">,</span> <span class="st">&quot;bitcoin&quot;</span>] <span class="co">// e.g. optionally advertises it specializes in bitcoin audio transcription that won&#39;t confuse &quot;Drivechains&quot; with &quot;Ridechains&quot;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Customers can use NIP-89 to see what service providers their follows
use.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>89</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-89">NIP-89</h1>
<h2 id="recommended-application-handlers">Recommended Application
Handlers</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP describes <code>kind:31989</code> and
<code>kind:31990</code>: a way to discover applications that can handle
unknown event-kinds.</p>
<h2 id="rationale">Rationale</h2>
<p>Nostr’s discoverability and transparent event interaction is one of
its most interesting/novel mechanics. This NIP provides a simple way for
clients to discover applications that handle events of a specific kind
to ensure smooth cross-client and cross-kind interactions.</p>
<h3 id="parties-involved">Parties involved</h3>
<p>There are three actors to this workflow:</p>
<ul>
<li>application that handles a specific event kind (note that an
application doesn’t necessarily need to be a distinct entity and it
could just be the same pubkey as user A)
<ul>
<li>Publishes <code>kind:31990</code>, detailing how apps should
redirect to it</li>
</ul></li>
<li>user A, who recommends an app that handles a specific event kind
<ul>
<li>Publishes <code>kind:31989</code></li>
</ul></li>
<li>user B, who seeks a recommendation for an app that handles a
specific event kind
<ul>
<li>Queries for <code>kind:31989</code> and, based on results, queries
for <code>kind:31990</code></li>
</ul></li>
</ul>
<h2 id="events">Events</h2>
<h3 id="recommendation-event">Recommendation event</h3>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">31989</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="er">&lt;recommender-user-pubkey&gt;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="er">&lt;supported-event-kind&gt;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;31990:app1-pubkey:&lt;d-identifier&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://relay1&quot;</span><span class="ot">,</span> <span class="st">&quot;ios&quot;</span><span class="ot">],</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;31990:app2-pubkey:&lt;d-identifier&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://relay2&quot;</span><span class="ot">,</span> <span class="st">&quot;web&quot;</span><span class="ot">]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The <code>d</code> tag in <code>kind:31989</code> is the supported
event kind this event is recommending.</p>
<p>Multiple <code>a</code> tags can appear on the same
<code>kind:31989</code>.</p>
<p>The second value of the tag SHOULD be a relay hint. The third value
of the tag SHOULD be the platform where this recommendation might
apply.</p>
<h2 id="handler-information">Handler information</h2>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">31990</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;application-pubkey&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;optional-kind:0-style-metadata&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="er">&lt;random-id&gt;</span><span class="ot">],</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;k&quot;</span><span class="ot">,</span> <span class="er">&lt;supported-event-kind&gt;</span><span class="ot">],</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;web&quot;</span><span class="ot">,</span> <span class="st">&quot;https://..../a/&lt;bech32&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;nevent&quot;</span><span class="ot">],</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;web&quot;</span><span class="ot">,</span> <span class="st">&quot;https://..../p/&lt;bech32&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;nprofile&quot;</span><span class="ot">],</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;web&quot;</span><span class="ot">,</span> <span class="st">&quot;https://..../e/&lt;bech32&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;ios&quot;</span><span class="ot">,</span> <span class="st">&quot;.../&lt;bech32&gt;&quot;</span><span class="ot">]</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><code>content</code> is an optional <code>metadata</code>-like
stringified JSON object, as described in NIP-01. This content is useful
when the pubkey creating the <code>kind:31990</code> is not an
application. If <code>content</code> is empty, the <code>kind:0</code>
of the pubkey should be used to display application information
(e.g. name, picture, web, LUD16, etc.)</li>
<li><code>k</code> tags’ value is the event kind that is supported by
this <code>kind:31990</code>. Using a <code>k</code> tag(s) (instead of
having the kind of the <code>d</code> tag) provides:
<ul>
<li>Multiple <code>k</code> tags can exist in the same event if the
application supports more than one event kind and their handler URLs are
the same.</li>
<li>The same pubkey can have multiple events with different apps that
handle the same event kind.</li>
</ul></li>
<li><code>bech32</code> in a URL MUST be replaced by clients with the
NIP-19-encoded entity that should be loaded by the application.</li>
</ul>
<p>Multiple tags might be registered by the app, following NIP-19
nomenclature as the second value of the array.</p>
<p>A tag without a second value in the array SHOULD be considered a
generic handler for any NIP-19 entity that is not handled by a different
tag.</p>
<h1 id="client-tag">Client tag</h1>
<p>When publishing events, clients MAY include a <code>client</code>
tag. Identifying the client that published the note. This tag is a tuple
of <code>name</code>, <code>address</code> identifying a handler event
and, a relay <code>hint</code> for finding the handler event. This has
privacy implications for users, so clients SHOULD allow users to opt-out
of using this tag.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;client&quot;</span><span class="ot">,</span> <span class="st">&quot;My Client&quot;</span><span class="ot">,</span> <span class="st">&quot;31990:app1-pubkey:&lt;d-identifier&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://relay1&quot;</span><span class="ot">]</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="user-flow">User flow</h2>
<p>A user A who uses a non-<code>kind:1</code>-centric nostr app could
choose to announce/recommend a certain kind-handler application.</p>
<p>When user B sees an unknown event kind, e.g. in a social-media
centric nostr client, the client would allow user B to interact with the
unknown-kind event (e.g. tapping on it).</p>
<p>The client MIGHT query for the user’s and the user’s follows
handler.</p>
<h2 id="example">Example</h2>
<h3 id="user-a-recommends-a-kind31337-handler">User A recommends a
<code>kind:31337</code>-handler</h3>
<p>User A might be a user of Zapstr, a <code>kind:31337</code>-centric
client (tracks). Using Zapstr, user A publishes an event recommending
Zapstr as a <code>kind:31337</code>-handler.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">31989</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;31337&quot;</span><span class="ot">],</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;31990:1743058db7078661b94aaf4286429d97ee5257d14a86d6bfa54cb0482b876fb0:abcd&quot;</span><span class="ot">,</span> <span class="er">&lt;relay-url&gt;</span><span class="ot">,</span> <span class="st">&quot;web&quot;</span><span class="ot">]</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="user-b-interacts-with-a-kind31337-handler">User B interacts with
a <code>kind:31337</code>-handler</h3>
<p>User B might see in their timeline an event referring to a
<code>kind:31337</code> event (e.g. a <code>kind:1</code> tagging a
<code>kind:31337</code>).</p>
<p>User B’s client, not knowing how to handle a <code>kind:31337</code>
might display the event using its <code>alt</code> tag (as described in
NIP-31). When the user clicks on the event, the application queries for
a handler for this <code>kind</code>:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;REQ&quot;</span><span class="ot">,</span> <span class="er">&lt;id&gt;</span><span class="ot">,</span> <span class="er">&#39;</span><span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">31989</span><span class="ot">]</span><span class="fu">,</span> <span class="dt">&quot;#d&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;31337&quot;</span><span class="ot">]</span><span class="fu">,</span> <span class="er">&#39;authors&#39;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">&lt;user&gt;</span><span class="ot">,</span> <span class="er">&lt;users-contact-list&gt;</span><span class="ot">]</span> <span class="fu">}</span><span class="ot">]</span><span class="er">&#39;</span><span class="ot">]</span></span></code></pre></div>
<p>User B, who follows User A, sees that <code>kind:31989</code> event
and fetches the <code>a</code>-tagged event for the app and handler
information.</p>
<p>User B’s client sees the application’s <code>kind:31990</code> which
includes the information to redirect the user to the relevant URL with
the desired entity replaced in the URL.</p>
<h3 id="alternative-query-bypassing-kind31989">Alternative query
bypassing <code>kind:31989</code></h3>
<p>Alternatively, users might choose to query directly for
<code>kind:31990</code> for an event kind. Clients SHOULD be careful
doing this and use spam-prevention mechanisms or querying high-quality
restricted relays to avoid directing users to malicious handlers.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;REQ&quot;</span><span class="ot">,</span> <span class="er">&lt;id&gt;</span><span class="ot">,</span> <span class="er">&#39;</span><span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">31990</span><span class="ot">]</span><span class="fu">,</span> <span class="dt">&quot;#k&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">&lt;desired-event-kind&gt;</span><span class="ot">]</span><span class="fu">,</span> <span class="er">&#39;authors&#39;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">...</span><span class="ot">]</span> <span class="fu">}</span><span class="ot">]</span><span class="er">&#39;</span><span class="ot">]</span></span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>84</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-84">NIP-84</h1>
<h2 id="highlights">Highlights</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines <code>kind:9802</code>, a “highlight” event, to
signal content a user finds valuable.</p>
<h2 id="format">Format</h2>
<p>The <code>.content</code> of these events is the highlighted portion
of the text.</p>
<p><code>.content</code> might be empty for highlights of non-text based
media (e.g. NIP-94 audio/video).</p>
<h3 id="references">References</h3>
<p>Events SHOULD tag the source of the highlight, whether nostr-native
or not. <code>a</code> or <code>e</code> tags should be used for nostr
events and <code>r</code> tags for URLs.</p>
<p>When tagging a URL, clients generating these events SHOULD do a best
effort of cleaning the URL from trackers or obvious non-useful
information from the query string.</p>
<h3 id="attribution">Attribution</h3>
<p>Clients MAY include one or more <code>p</code> tags, tagging the
original authors of the material being highlighted; this is particularly
useful when highlighting non-nostr content for which the client might be
able to get a nostr pubkey somehow (e.g. prompting the user or reading a
<code>&lt;meta name="nostr:nprofile1..." /&gt;</code> tag on the
document). A role MAY be included as the last value of the tag.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;pubkey-hex&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;relay-url&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;author&quot;</span><span class="ot">],</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;pubkey-hex&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;relay-url&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;author&quot;</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;pubkey-hex&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;relay-url&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;editor&quot;</span><span class="ot">]</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="context">Context</h3>
<p>Clients MAY include a <code>context</code> tag, useful when the
highlight is a subset of a paragraph and displaying the surrounding
content might be beneficial to give context to the highlight.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>78</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-78">NIP-78</h1>
<h2 id="arbitrary-custom-app-data">Arbitrary custom app data</h2>
<p><code>draft</code> <code>optional</code></p>
<p>The goal of this NIP is to enable <a
href="https://remotestorage.io/">remoteStorage</a>-like capabilities for
custom applications that do not care about interoperability.</p>
<p>Even though interoperability is great, some apps do not want or do
not need interoperability, and it wouldn’t make sense for them. Yet
Nostr can still serve as a generalized data storage for these apps in a
“bring your own database” way, for example: a user would open an app and
somehow input their preferred relay for storage, which would then enable
these apps to store application-specific data there.</p>
<h2 id="nostr-event">Nostr event</h2>
<p>This NIP specifies the use of event kind <code>30078</code>
(parameterized replaceable event) with a <code>d</code> tag containing
some reference to the app name and context – or any other arbitrary
string. <code>content</code> and other <code>tags</code> can be anything
or in any format.</p>
<h2 id="some-use-cases">Some use cases</h2>
<ul>
<li>User personal settings on Nostr clients (and other apps unrelated to
Nostr)</li>
<li>A way for client developers to propagate dynamic parameters to users
without these having to update</li>
<li>Personal private data generated by apps that have nothing to do with
Nostr, but allow users to use Nostr relays as their personal
database</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>75</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-75">NIP-75</h1>
<h2 id="zap-goals">Zap Goals</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines an event for creating fundraising goals. Users can
contribute funds towards the goal by zapping the goal event.</p>
<h2 id="nostr-event">Nostr Event</h2>
<p>A <code>kind:9041</code> event is used.</p>
<p>The <code>.content</code> contains a human-readable description of
the goal.</p>
<p>The following tags are defined as REQUIRED.</p>
<ul>
<li><code>amount</code> - target amount in milisats.</li>
<li><code>relays</code> - a list of relays the zaps to this goal will be
sent to and tallied from.</li>
</ul>
<p>Example event:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">9041</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;relays&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://alicerelay.example.com&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://bobrelay.example.com&quot;</span><span class="ot">,</span> <span class="er">...</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;amount&quot;</span><span class="ot">,</span> <span class="st">&quot;210000&quot;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Nostrasia travel expenses&quot;</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span></code></pre></div>
<p>The following tags are OPTIONAL.</p>
<ul>
<li><code>closed_at</code> - timestamp for determining which zaps are
included in the tally. Zap receipts published after the
<code>closed_at</code> timestamp SHOULD NOT count towards the goal
progress.</li>
<li><code>image</code> - an image for the goal</li>
<li><code>summary</code> - a brief description</li>
</ul>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">9041</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;relays&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://alicerelay.example.com&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://bobrelay.example.com&quot;</span><span class="ot">,</span> <span class="er">...</span><span class="ot">],</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;amount&quot;</span><span class="ot">,</span> <span class="st">&quot;210000&quot;</span><span class="ot">],</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;closed_at&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;unix timestamp in seconds&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;image&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;image URL&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;summary&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;description of the goal&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Nostrasia travel expenses&quot;</span><span class="fu">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The goal MAY include an <code>r</code> or <code>a</code> tag linking
to a URL or parameterized replaceable event.</p>
<p>The goal MAY include multiple beneficiary pubkeys by specifying <a
href="57.md.css.html#appendix-g-zap-tag-on-other-events"><code>zap</code>
tags</a>.</p>
<p>Parameterized replaceable events can link to a goal by using a
<code>goal</code> tag specifying the event id and an optional relay
hint.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">3</span><span class="er">xxxx</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;goal&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;event id&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;Relay URL (optional)&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="client-behavior">Client behavior</h2>
<p>Clients MAY display funding goals on user profiles.</p>
<p>When zapping a goal event, clients MUST include the relays in the
<code>relays</code> tag of the goal event in the zap request
<code>relays</code> tag.</p>
<p>When zapping a parameterized replaceable event with a
<code>goal</code> tag, clients SHOULD tag the goal event id in the
<code>e</code> tag of the zap request.</p>
<h2 id="use-cases">Use cases</h2>
<ul>
<li>Fundraising clients</li>
<li>Adding funding goals to events such as long form posts, badges or
live streams</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>72</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-72">NIP-72</h1>
<h2 id="moderated-communities-reddit-style">Moderated Communities
(Reddit Style)</h2>
<p><code>draft</code> <code>optional</code></p>
<p>The goal of this NIP is to create moderator-approved public
communities around a topic. It defines the replaceable event
<code>kind:34550</code> to define the community and the current list of
moderators/administrators. Users that want to post into the community,
simply tag any Nostr event with the community’s <code>a</code> tag.
Moderators issue an approval event <code>kind:4550</code> that links the
community with the new post.</p>
<h1 id="community-definition">Community Definition</h1>
<p><code>kind:34550</code> SHOULD include any field that helps define
the community and the set of moderators. <code>relay</code> tags MAY be
used to describe the preferred relay to download requests and
approvals.</p>
<pre class="jsonc"><code>{
  &quot;created_at&quot;: &lt;Unix timestamp in seconds&gt;,
  &quot;kind&quot;: 34550,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;&lt;community-d-identifier&gt;&quot;],
    [&quot;description&quot;, &quot;&lt;Community description&gt;&quot;],
    [&quot;image&quot;, &quot;&lt;Community image url&gt;&quot;, &quot;&lt;Width&gt;x&lt;Height&gt;&quot;],

    //.. other tags relevant to defining the community

    // moderators
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey1&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;moderator&quot;],
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey2&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;moderator&quot;],
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey3&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;moderator&quot;],

    // relays used by the community (w/optional marker)
    [&quot;relay&quot;, &quot;&lt;relay hosting author kind 0&gt;&quot;, &quot;author&quot;],
    [&quot;relay&quot;, &quot;&lt;relay where to send and receive requests&gt;&quot;, &quot;requests&quot;],
    [&quot;relay&quot;, &quot;&lt;relay where to send and receive approvals&gt;&quot;, &quot;approvals&quot;],
    [&quot;relay&quot;, &quot;&lt;relay where to post requests to and fetch approvals from&gt;&quot;]
  ],
  ...
}</code></pre>
<h1 id="new-post-request">New Post Request</h1>
<p>Any Nostr event can be submitted to a community by anyone for
approval. Clients MUST add the community’s <code>a</code> tag to the new
post event in order to be presented for the moderator’s approval.</p>
<pre class="jsonc"><code>{
  &quot;kind&quot;: 1,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;34550:&lt;community event author pubkey&gt;:&lt;community-d-identifier&gt;&quot;, &quot;&lt;optional-relay-url&gt;&quot;],
  ],
  &quot;content&quot;: &quot;hello world&quot;,
  // ...
}</code></pre>
<p>Community management clients MAY filter all mentions to a given
<code>kind:34550</code> event and request moderators to approve each
submission. Moderators MAY delete his/her approval of a post at any time
using event deletions (See <a href="09.md.css.html">NIP-09</a>).</p>
<h1 id="post-approval-by-moderators">Post Approval by moderators</h1>
<p>The post-approval event MUST include <code>a</code> tags of the
communities the moderator is posting into (one or more), the
<code>e</code> tag of the post and <code>p</code> tag of the author of
the post (for approval notifications). The event SHOULD also include the
stringified <code>post request</code> event inside the
<code>.content</code> (<a href="18.md.css.html">NIP-18-style</a>) and a
<code>k</code> tag with the original post’s event kind to allow
filtering of approved posts by kind.</p>
<pre class="jsonc"><code>{
  &quot;pubkey&quot;: &quot;&lt;32-bytes lowercase hex-encoded public key of the event creator&gt;&quot;,
  &quot;kind&quot;: 4550,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;34550:&lt;event-author-pubkey&gt;:&lt;community-d-identifier&gt;&quot;, &quot;&lt;optional-relay-url&gt;&quot;],
    [&quot;e&quot;, &quot;&lt;post-id&gt;&quot;, &quot;&lt;optional-relay-url&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;port-author-pubkey&gt;&quot;, &quot;&lt;optional-relay-url&gt;&quot;],
    [&quot;k&quot;, &quot;&lt;post-request-kind&gt;&quot;]
  ],
  &quot;content&quot;: &quot;&lt;the full approved event, JSON-encoded&gt;&quot;,
  // ...
}</code></pre>
<p>It’s recommended that multiple moderators approve posts to avoid
deleting them from the community when a moderator is removed from the
owner’s list. In case the full list of moderators must be rotated, the
new moderator set must sign new approvals for posts in the past or the
community will restart. The owner can also periodically copy and re-sign
of each moderator’s approval events to make sure posts don’t disappear
with moderators.</p>
<p>Post Approvals of replaceable events can be created in three ways:
(i) by tagging the replaceable event as an <code>e</code> tag if
moderators want to approve each individual change to the replaceable
event; (ii) by tagging the replaceable event as an <code>a</code> tag if
the moderator authorizes the replaceable event author to make changes
without additional approvals and (iii) by tagging the replaceable event
with both its <code>e</code> and <code>a</code> tag which empowers
clients to display the original and updated versions of the event, with
appropriate remarks in the UI. Since relays are instructed to delete old
versions of a replaceable event, the <code>.content</code> of an
<code>e</code>-approval MUST have the specific version of the event or
Clients might not be able to find that version of the content
anywhere.</p>
<p>Clients SHOULD evaluate any non-<code>34550:*</code> <code>a</code>
tag as posts to be included in all <code>34550:*</code> <code>a</code>
tags.</p>
<h1 id="displaying">Displaying</h1>
<p>Community clients SHOULD display posts that have been approved by at
least 1 moderator or by the community owner.</p>
<p>The following filter displays the approved posts.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;REQ&quot;</span><span class="ot">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;_&quot;</span><span class="ot">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;authors&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;&lt;owner-pubkey&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;moderator1-pubkey&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;moderator2-pubkey&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;moderator3-pubkey&gt;&quot;</span><span class="ot">,</span> <span class="er">...</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">4550</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;#a&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;34550:&lt;Community event author pubkey&gt;:&lt;d-identifier of the community&gt;&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>Clients MAY hide approvals by blocked moderators at the user’s
request.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>65</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-65">NIP-65</h1>
<h2 id="relay-list-metadata">Relay List Metadata</h2>
<p><code>draft</code> <code>optional</code></p>
<p>Defines a replaceable event using <code>kind:10002</code> to
advertise preferred relays for discovering a user’s content and
receiving fresh content from others.</p>
<p>The event MUST include a list of <code>r</code> tags with relay URIs
and a <code>read</code> or <code>write</code> marker. Relays marked as
<code>read</code> / <code>write</code> are called READ / WRITE relays,
respectively. If the marker is omitted, the relay is used for both
purposes.</p>
<p>The <code>.content</code> is not used.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">10002</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;r&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://alicerelay.example.com&quot;</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;r&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://brando-relay.com&quot;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;r&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://expensive-relay.example2.com&quot;</span><span class="ot">,</span> <span class="st">&quot;write&quot;</span><span class="ot">],</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;r&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://nostr-relay.example.com&quot;</span><span class="ot">,</span> <span class="st">&quot;read&quot;</span><span class="ot">]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="er">...other</span> <span class="er">fields</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>This NIP doesn’t fully replace relay lists that are designed to
configure a client’s usage of relays (such as <code>kind:3</code> style
relay lists). Clients MAY use other relay lists in situations where a
<code>kind:10002</code> relay list cannot be found.</p>
<h2 id="when-to-use-read-and-write-relays">When to Use Read and Write
Relays</h2>
<p>When seeking events <strong>from</strong> a user, Clients SHOULD use
the WRITE relays of the user’s <code>kind:10002</code>.</p>
<p>When seeking events <strong>about</strong> a user, where the user was
tagged, Clients SHOULD use the READ relays of the user’s
<code>kind:10002</code>.</p>
<p>When broadcasting an event, Clients SHOULD:</p>
<ul>
<li>Broadcast the event to the WRITE relays of the author</li>
<li>Broadcast the event all READ relays of each tagged user</li>
</ul>
<h2 id="motivation">Motivation</h2>
<p>The old model of using a fixed relay list per user centralizes in
large relay operators:</p>
<ul>
<li>Most users submit their posts to the same highly popular relays,
aiming to achieve greater visibility among a broader audience</li>
<li>Many users are pulling events from a large number of relays in order
to get more data at the expense of duplication</li>
<li>Events are being copied between relays, oftentimes to many different
relays</li>
</ul>
<p>This NIP allows Clients to connect directly with the most up-to-date
relay set from each individual user, eliminating the need of
broadcasting events to popular relays.</p>
<h2 id="final-considerations">Final Considerations</h2>
<ol type="1">
<li><p>Clients SHOULD guide users to keep <code>kind:10002</code> lists
small (2-4 relays).</p></li>
<li><p>Clients SHOULD spread an author’s <code>kind:10002</code> event
to as many relays as viable.</p></li>
<li><p><code>kind:10002</code> events should primarily be used to
advertise the user’s preferred relays to others. A user’s own client may
use other heuristics for selecting relays for fetching data.</p></li>
<li><p>DMs SHOULD only be broadcasted to the author’s WRITE relays and
to the receiver’s READ relays to keep maximum privacy.</p></li>
<li><p>If a relay signals support for this NIP in their <a
href="11.md.css.html">NIP-11</a> document that means they’re willing to accept
kind 10002 events from a broad range of users, not only their paying
customers or whitelisted group.</p></li>
<li><p>Clients SHOULD deduplicate connections by normalizing relay URIs
according to <a
href="https://datatracker.ietf.org/doc/html/rfc3986#section-6">RFC
3986</a>.</p></li>
</ol>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>59</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-59">NIP-59</h1>
<h2 id="gift-wrap">Gift Wrap</h2>
<p><code>optional</code></p>
<p>This NIP defines a protocol for encapsulating any nostr event. This
makes it possible to obscure most metadata for a given event, perform
collaborative signing, and more.</p>
<p>This NIP <em>does not</em> define any messaging protocol.
Applications of this NIP should be defined separately.</p>
<p>This NIP relies on <a href="./44.md.css.html">NIP-44</a>’s versioned
encryption algorithms.</p>
<h1 id="overview">Overview</h1>
<p>This protocol uses three main concepts to protect the transmission of
a target event: <code>rumor</code>s, <code>seal</code>s, and
<code>gift wrap</code>s.</p>
<ul>
<li>A <code>rumor</code> is a regular nostr event, but is <strong>not
signed</strong>. This means that if it is leaked, it cannot be
verified.</li>
<li>A <code>rumor</code> is serialized to JSON, encrypted, and placed in
the <code>content</code> field of a <code>seal</code>. The
<code>seal</code> is then signed by the author of the note. The only
information publicly available on a <code>seal</code> is who signed it,
but not what was said.</li>
<li>A <code>seal</code> is serialized to JSON, encrypted, and placed in
the <code>content</code> field of a <code>gift wrap</code>.</li>
</ul>
<p>This allows the isolation of concerns across layers:</p>
<ul>
<li>A rumor carries the content but is unsigned, which means if leaked
it will be rejected by relays and clients, and can’t be authenticated.
This provides a measure of deniability.</li>
<li>A seal identifies the author without revealing the content or the
recipient.</li>
<li>A gift wrap can add metadata (recipient, tags, a different author)
without revealing the true author.</li>
</ul>
<h1 id="protocol-description">Protocol Description</h1>
<h2 id="the-rumor-event-kind">1. The Rumor Event Kind</h2>
<p>A <code>rumor</code> is the same thing as an unsigned event. Any
event kind can be made a <code>rumor</code> by removing the
signature.</p>
<h2 id="the-seal-event-kind">2. The Seal Event Kind</h2>
<p>A <code>seal</code> is a <code>kind:13</code> event that wraps a
<code>rumor</code> with the sender’s regular key. The <code>seal</code>
is <strong>always</strong> encrypted to a receiver’s pubkey but there is
no <code>p</code> tag pointing to the receiver. There is no way to know
who the rumor is for without the receiver’s or the sender’s private key.
The only public information in this event is who is signing it.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;id&gt;&quot;</span><span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;pubkey&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;real author&#39;s pubkey&gt;&quot;</span><span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;encrypted rumor&gt;&quot;</span><span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">13</span><span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;created_at&quot;</span><span class="op">:</span> <span class="dv">1686840217</span><span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;sig&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;real author&#39;s pubkey signature&gt;&quot;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tags MUST must always be empty in a <code>kind:13</code>. The inner
event MUST always be unsigned.</p>
<h2 id="gift-wrap-event-kind">3. Gift Wrap Event Kind</h2>
<p>A <code>gift wrap</code> event is a <code>kind:1059</code> event that
wraps any other event. <code>tags</code> SHOULD include any information
needed to route the event to its intended recipient, including the
recipient’s <code>p</code> tag or <a href="13.md.css.html">NIP-13</a> proof of
work.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;id&gt;&quot;</span><span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;pubkey&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;random, one-time-use pubkey&gt;&quot;</span><span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;encrypted kind 13&gt;&quot;</span><span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">1059</span><span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;created_at&quot;</span><span class="op">:</span> <span class="dv">1686840217</span><span class="op">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [[<span class="st">&quot;p&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;recipient pubkey&gt;&quot;</span>]]<span class="op">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;sig&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;random, one-time-use pubkey signature&gt;&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h1 id="encrypting-payloads">Encrypting Payloads</h1>
<p>Encryption is done following <a href="44.md.css.html">NIP-44</a> on the
JSON-encoded event. Place the encryption payload in the
<code>.content</code> of the wrapper event (either a <code>seal</code>
or a <code>gift wrap</code>).</p>
<h1 id="other-considerations">Other Considerations</h1>
<p>If a <code>rumor</code> is intended for more than one party, or if
the author wants to retain an encrypted copy, a single
<code>rumor</code> may be wrapped and addressed for each recipient
individually.</p>
<p>The canonical <code>created_at</code> time belongs to the
<code>rumor</code>. All other timestamps SHOULD be tweaked to thwart
time-analysis attacks. Note that some relays don’t serve events dated in
the future, so all timestamps SHOULD be in the past.</p>
<p>Relays may choose not to store gift wrapped events due to them not
being publicly useful. Clients MAY choose to attach a certain amount of
proof-of-work to the wrapper event per <a href="13.md.css.html">NIP-13</a> in a
bid to demonstrate that the event is not spam or a denial-of-service
attack.</p>
<p>To protect recipient metadata, relays SHOULD guard access to
<code>kind 1059</code> events based on user AUTH. When possible, clients
should only send wrapped events to relays that offer this
protection.</p>
<p>To protect recipient metadata, relays SHOULD only serve
<code>kind 1059</code> events intended for the marked recipient. When
possible, clients should only send wrapped events to <code>read</code>
relays for the recipient that implement AUTH, and refuse to serve
wrapped events to non-recipients.</p>
<h1 id="an-example">An Example</h1>
<p>Let’s send a wrapped <code>kind 1</code> message between two parties
asking “Are you going to the party tonight?”</p>
<ul>
<li>Author private key:
<code>0beebd062ec8735f4243466049d7747ef5d6594ee838de147f8aab842b15e273</code></li>
<li>Recipient private key:
<code>e108399bd8424357a710b606ae0c13166d853d327e47a6e5e038197346bdbf45</code></li>
<li>Ephemeral wrapper key:
<code>4f02eac59266002db5801adc5270700ca69d5b8f761d8732fab2fbf233c90cbd</code></li>
</ul>
<p>Note that this messaging protocol should not be used in practice,
this is just an example. Refer to other NIPs for concrete messaging
protocols that depend on gift wraps.</p>
<h2 id="create-an-event">1. Create an event</h2>
<p>Create a <code>kind 1</code> event with the message, the receivers,
and any other tags you want, signed by the author. Do not sign the
event.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1691518405</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Are you going to the party tonight?&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;611df01bfcf85c26ae65453b772d8f1dfd25c264621c0277e1fc1518686faef9&quot;</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;9dd003c6d3b73b74a85a9ab099469ce251653a7af76f523671ab828acd2a0ef9&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="seal-the-rumor">2. Seal the rumor</h2>
<p>Encrypt the JSON-encoded <code>rumor</code> with a conversation key
derived using the author’s private key and the recipient’s public key.
Place the result in the <code>content</code> field of a
<code>kind 13</code> <code>seal</code> event. Sign it with the author’s
key.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;AqBCdwoS7/tPK+QGkPCadJTn8FxGkd24iApo3BR9/M0uw6n4RFAFSPAKKMgkzVMoRyR3ZS/aqATDFvoZJOkE9cPG/TAzmyZvr/WUIS8kLmuI1dCA+itFF6+ULZqbkWS0YcVU0j6UDvMBvVlGTzHz+UHzWYJLUq2LnlynJtFap5k8560+tBGtxi9Gx2NIycKgbOUv0gEqhfVzAwvg1IhTltfSwOeZXvDvd40rozONRxwq8hjKy+4DbfrO0iRtlT7G/eVEO9aJJnqagomFSkqCscttf/o6VeT2+A9JhcSxLmjcKFG3FEK3Try/WkarJa1jM3lMRQqVOZrzHAaLFW/5sXano6DqqC5ERD6CcVVsrny0tYN4iHHB8BHJ9zvjff0NjLGG/v5Wsy31+BwZA8cUlfAZ0f5EYRo9/vKSd8TV0wRb9DQ=&quot;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">13</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1703015180</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;611df01bfcf85c26ae65453b772d8f1dfd25c264621c0277e1fc1518686faef9&quot;</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;28a87d7c074d94a58e9e89bb3e9e4e813e2189f285d797b1c56069d36f59eaa7&quot;</span><span class="fu">,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;02fc3facf6621196c32912b1ef53bac8f8bfe9db51c0e7102c073103586b0d29c3f39bdaa1e62856c20e90b6c7cc5dc34ca8bb6a528872cf6e65e6284519ad73&quot;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="wrap-the-seal">3. Wrap the seal</h2>
<p>Encrypt the JSON-encoded <code>kind 13</code> event with your
ephemeral, single-use random key. Place the result in the
<code>content</code> field of a <code>kind 1059</code>. Add a single
<code>p</code> tag containing the recipient’s public key. Sign the
<code>gift wrap</code> using the random key generated in the previous
step.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;AhC3Qj/QsKJFWuf6xroiYip+2yK95qPwJjVvFujhzSguJWb/6TlPpBW0CGFwfufCs2Zyb0JeuLmZhNlnqecAAalC4ZCugB+I9ViA5pxLyFfQjs1lcE6KdX3euCHBLAnE9GL/+IzdV9vZnfJH6atVjvBkNPNzxU+OLCHO/DAPmzmMVx0SR63frRTCz6Cuth40D+VzluKu1/Fg2Q1LSst65DE7o2efTtZ4Z9j15rQAOZfE9jwMCQZt27rBBK3yVwqVEriFpg2mHXc1DDwHhDADO8eiyOTWF1ghDds/DxhMcjkIi/o+FS3gG1dG7gJHu3KkGK5UXpmgyFKt+421m5o++RMD/BylS3iazS1S93IzTLeGfMCk+7IKxuSCO06k1+DaasJJe8RE4/rmismUvwrHu/HDutZWkvOAhd4z4khZo7bJLtiCzZCZ74lZcjOB4CYtuAX2ZGpc4I1iOKkvwTuQy9BWYpkzGg3ZoSWRD6ty7U+KN+fTTmIS4CelhBTT15QVqD02JxfLF7nA6sg3UlYgtiGw61oH68lSbx16P3vwSeQQpEB5JbhofW7t9TLZIbIW/ODnI4hpwj8didtk7IMBI3Ra3uUP7ya6vptkd9TwQkd/7cOFaSJmU+BIsLpOXbirJACMn+URoDXhuEtiO6xirNtrPN8jYqpwvMUm5lMMVzGT3kMMVNBqgbj8Ln8VmqouK0DR+gRyNb8fHT0BFPwsHxDskFk5yhe5c/2VUUoKCGe0kfCcX/EsHbJLUUtlHXmTqaOJpmQnW1tZ/siPwKRl6oEsIJWTUYxPQmrM2fUpYZCuAo/29lTLHiHMlTbarFOd6J/ybIbICy2gRRH/LFSryty3Cnf6aae+A9uizFBUdCwTwffc3vCBae802+R92OL78bbqHKPbSZOXNC+6ybqziezwG+OPWHx1Qk39RYaF0aFsM4uZWrFic97WwVrH5i+/Nsf/OtwWiuH0gV/SqvN1hnkxCTF/+XNn/laWKmS3e7wFzBsG8+qwqwmO9aVbDVMhOmeUXRMkxcj4QreQkHxLkCx97euZpC7xhvYnCHarHTDeD6nVK+xzbPNtzeGzNpYoiMqxZ9bBJwMaHnEoI944Vxoodf51cMIIwpTmmRvAzI1QgrfnOLOUS7uUjQ/IZ1Qa3lY08Nqm9MAGxZ2Ou6R0/Z5z30ha/Q71q6meAs3uHQcpSuRaQeV29IASmye2A2Nif+lmbhV7w8hjFYoaLCRsdchiVyNjOEM4VmxUhX4VEvw6KoCAZ/XvO2eBF/SyNU3Of4SO&quot;</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1059</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1703021488</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;18b1a75918f1f2c90c23da616bce317d36e348bcf5f7ba55e75949319210c87c&quot;</span><span class="fu">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;5c005f3ccf01950aa8d131203248544fb1e41a0d698e846bd419cec3890903ac&quot;</span><span class="fu">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;35fabdae4634eb630880a1896a886e40fd6ea8a60958e30b89b33a93e6235df750097b04f9e13053764251b8bc5dd7e8e0794a3426a90b6bcc7e5ff660f54259&quot;</span><span class="fu">,</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;166bf3765ebd1fc55decfe395beff2ea3b2a4e0a8946e7eb578512b555737c99&quot;</span><span class="ot">]]</span><span class="fu">,</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="broadcast-selectively">4. Broadcast Selectively</h2>
<p>Broadcast the <code>kind 1059</code> event to the recipient’s relays
only. Delete all the other events.</p>
<h1 id="code-samples">Code Samples</h1>
<h2 id="javascript">JavaScript</h2>
<div class="sourceCode" id="cb6"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {bytesToHex} <span class="im">from</span> <span class="st">&quot;@noble/hashes/utils&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> type {EventTemplate<span class="op">,</span> UnsignedEvent<span class="op">,</span> <span class="bu">Event</span>} <span class="im">from</span> <span class="st">&quot;nostr-tools&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {getPublicKey<span class="op">,</span> getEventHash<span class="op">,</span> nip19<span class="op">,</span> nip44<span class="op">,</span> finalizeEvent<span class="op">,</span> generateSecretKey} <span class="im">from</span> <span class="st">&quot;nostr-tools&quot;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>type Rumor <span class="op">=</span> UnsignedEvent <span class="op">&amp;</span> {<span class="dt">id</span><span class="op">:</span> string}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> TWO_DAYS <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> now <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> randomNow <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="fu">now</span>() <span class="op">-</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">*</span> TWO_DAYS))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nip44ConversationKey <span class="op">=</span> (privateKey<span class="op">:</span> <span class="bu">Uint8Array</span><span class="op">,</span> publicKey<span class="op">:</span> string) <span class="kw">=&gt;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  nip44<span class="op">.</span><span class="at">v2</span><span class="op">.</span><span class="at">utils</span><span class="op">.</span><span class="fu">getConversationKey</span>(<span class="fu">bytesToHex</span>(privateKey)<span class="op">,</span> publicKey)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nip44Encrypt <span class="op">=</span> (data<span class="op">:</span> EventTemplate<span class="op">,</span> privateKey<span class="op">:</span> <span class="bu">Uint8Array</span><span class="op">,</span> publicKey<span class="op">:</span> string) <span class="kw">=&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  nip44<span class="op">.</span><span class="at">v2</span><span class="op">.</span><span class="fu">encrypt</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(data)<span class="op">,</span> <span class="fu">nip44ConversationKey</span>(privateKey<span class="op">,</span> publicKey))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nip44Decrypt <span class="op">=</span> (data<span class="op">:</span> <span class="bu">Event</span><span class="op">,</span> privateKey<span class="op">:</span> <span class="bu">Uint8Array</span>) <span class="kw">=&gt;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(nip44<span class="op">.</span><span class="at">v2</span><span class="op">.</span><span class="fu">decrypt</span>(data<span class="op">.</span><span class="at">content</span><span class="op">,</span> <span class="fu">nip44ConversationKey</span>(privateKey<span class="op">,</span> data<span class="op">.</span><span class="at">pubkey</span>)))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> createRumor <span class="op">=</span> (<span class="bu">event</span><span class="op">:</span> Partial<span class="op">&lt;</span>UnsignedEvent<span class="op">&gt;,</span> privateKey<span class="op">:</span> <span class="bu">Uint8Array</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rumor <span class="op">=</span> {</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">created_at</span><span class="op">:</span> <span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tags</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span><span class="bu">event</span><span class="op">,</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pubkey</span><span class="op">:</span> <span class="fu">getPublicKey</span>(privateKey)<span class="op">,</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  } <span class="im">as</span> any</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  rumor<span class="op">.</span><span class="at">id</span> <span class="op">=</span> <span class="fu">getEventHash</span>(rumor)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> rumor <span class="im">as</span> Rumor</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> createSeal <span class="op">=</span> (rumor<span class="op">:</span> Rumor<span class="op">,</span> privateKey<span class="op">:</span> <span class="bu">Uint8Array</span><span class="op">,</span> recipientPublicKey<span class="op">:</span> string) <span class="kw">=&gt;</span> {</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">finalizeEvent</span>(</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>      <span class="dt">kind</span><span class="op">:</span> <span class="dv">13</span><span class="op">,</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>      <span class="dt">content</span><span class="op">:</span> <span class="fu">nip44Encrypt</span>(rumor<span class="op">,</span> privateKey<span class="op">,</span> recipientPublicKey)<span class="op">,</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>      <span class="dt">created_at</span><span class="op">:</span> <span class="fu">randomNow</span>()<span class="op">,</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tags</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    privateKey</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="im">as</span> <span class="bu">Event</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> createWrap <span class="op">=</span> (<span class="bu">event</span><span class="op">:</span> <span class="bu">Event</span><span class="op">,</span> recipientPublicKey<span class="op">:</span> string) <span class="kw">=&gt;</span> {</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> randomKey <span class="op">=</span> <span class="fu">generateSecretKey</span>()</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">finalizeEvent</span>(</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>      <span class="dt">kind</span><span class="op">:</span> <span class="dv">1059</span><span class="op">,</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>      <span class="dt">content</span><span class="op">:</span> <span class="fu">nip44Encrypt</span>(<span class="bu">event</span><span class="op">,</span> randomKey<span class="op">,</span> recipientPublicKey)<span class="op">,</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>      <span class="dt">created_at</span><span class="op">:</span> <span class="fu">randomNow</span>()<span class="op">,</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tags</span><span class="op">:</span> [[<span class="st">&quot;p&quot;</span><span class="op">,</span> recipientPublicKey]]<span class="op">,</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    randomKey</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  ) <span class="im">as</span> <span class="bu">Event</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co">// Test case using the above example</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> senderPrivateKey <span class="op">=</span> nip19<span class="op">.</span><span class="fu">decode</span>(<span class="vs">`nsec1p0ht6p3wepe47sjrgesyn4m50m6avk2waqudu9rl324cg2c4ufesyp6rdg`</span>)<span class="op">.</span><span class="at">data</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> recipientPrivateKey <span class="op">=</span> nip19<span class="op">.</span><span class="fu">decode</span>(<span class="vs">`nsec1uyyrnx7cgfp40fcskcr2urqnzekc20fj0er6de0q8qvhx34ahazsvs9p36`</span>)<span class="op">.</span><span class="at">data</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> recipientPublicKey <span class="op">=</span> <span class="fu">getPublicKey</span>(recipientPrivateKey)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> rumor <span class="op">=</span> <span class="fu">createRumor</span>(</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    <span class="dt">kind</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;Are you going to the party tonight?&quot;</span><span class="op">,</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>  senderPrivateKey</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> seal <span class="op">=</span> <span class="fu">createSeal</span>(rumor<span class="op">,</span> senderPrivateKey<span class="op">,</span> recipientPublicKey)</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> wrap <span class="op">=</span> <span class="fu">createWrap</span>(seal<span class="op">,</span> recipientPublicKey)</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="co">// Recipient unwraps with his/her private key.</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> unwrappedSeal <span class="op">=</span> <span class="fu">nip44Decrypt</span>(wrap<span class="op">,</span> recipientPrivateKey)</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> unsealedRumor <span class="op">=</span> <span class="fu">nip44Decrypt</span>(unwrappedSeal<span class="op">,</span> recipientPrivateKey)</span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>58</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-58">NIP-58</h1>
<h2 id="badges">Badges</h2>
<p><code>draft</code> <code>optional</code></p>
<p>Three special events are used to define, award and display badges in
user profiles:</p>
<ol type="1">
<li><p>A “Badge Definition” event is defined as a parameterized
replaceable event with kind <code>30009</code> having a <code>d</code>
tag with a value that uniquely identifies the badge
(e.g. <code>bravery</code>) published by the badge issuer. Badge
definitions can be updated.</p></li>
<li><p>A “Badge Award” event is a kind <code>8</code> event with a
single <code>a</code> tag referencing a “Badge Definition” event and one
or more <code>p</code> tags, one for each pubkey the badge issuer wishes
to award. Awarded badges are immutable and non-transferrable.</p></li>
<li><p>A “Profile Badges” event is defined as a parameterized
replaceable event with kind <code>30008</code> with a <code>d</code> tag
with the value <code>profile_badges</code>. Profile badges contain an
ordered list of pairs of <code>a</code> and <code>e</code> tags
referencing a <code>Badge Definition</code> and a
<code>Badge Award</code> for each badge to be displayed.</p></li>
</ol>
<h3 id="badge-definition-event">Badge Definition event</h3>
<p>The following tags MUST be present:</p>
<ul>
<li><code>d</code> tag with the unique name of the badge.</li>
</ul>
<p>The following tags MAY be present:</p>
<ul>
<li>A <code>name</code> tag with a short name for the badge.</li>
<li><code>image</code> tag whose value is the URL of a high-resolution
image representing the badge. The second value optionally specifies the
dimensions of the image as <code>width</code>x<code>height</code> in
pixels. Badge recommended dimensions is 1024x1024 pixels.</li>
<li>A <code>description</code> tag whose value MAY contain a textual
representation of the image, the meaning behind the badge, or the reason
of its issuance.</li>
<li>One or more <code>thumb</code> tags whose first value is an URL
pointing to a thumbnail version of the image referenced in the
<code>image</code> tag. The second value optionally specifies the
dimensions of the thumbnail as <code>width</code>x<code>height</code> in
pixels.</li>
</ul>
<h3 id="badge-award-event">Badge Award event</h3>
<p>The following tags MUST be present:</p>
<ul>
<li>An <code>a</code> tag referencing a kind <code>30009</code> Badge
Definition event.</li>
<li>One or more <code>p</code> tags referencing each pubkey
awarded.</li>
</ul>
<h3 id="profile-badges-event">Profile Badges Event</h3>
<p>The number of badges a pubkey can be awarded is unbounded. The
Profile Badge event allows individual users to accept or reject awarded
badges, as well as choose the display order of badges on their
profiles.</p>
<p>The following tags MUST be present:</p>
<ul>
<li>A <code>d</code> tag with the unique identifier
<code>profile_badges</code></li>
</ul>
<p>The following tags MAY be present:</p>
<ul>
<li>Zero or more ordered consecutive pairs of <code>a</code> and
<code>e</code> tags referencing a kind <code>30009</code> Badge
Definition and kind <code>8</code> Badge Award, respectively. Clients
SHOULD ignore <code>a</code> without corresponding <code>e</code> tag
and viceversa. Badge Awards referenced by the <code>e</code> tags should
contain the same <code>a</code> tag.</li>
</ul>
<h3 id="motivation">Motivation</h3>
<p>Users MAY be awarded badges (but not limited to) in recognition, in
gratitude, for participation, or in appreciation of a certain goal, task
or cause.</p>
<p>Users MAY choose to decorate their profiles with badges for fame,
notoriety, recognition, support, etc., from badge issuers they deem
reputable.</p>
<h3 id="recommendations">Recommendations</h3>
<p>Clients MAY whitelist badge issuers (pubkeys) for the purpose of
ensuring they retain a valuable/special factor for their users.</p>
<p>Badge image recommended aspect ratio is 1:1 with a high-res size of
1024x1024 pixels.</p>
<p>Badge thumbnail image recommended dimensions are: 512x512 (xl),
256x256 (l), 64x64 (m), 32x32 (s) and 16x16 (xs).</p>
<p>Clients MAY choose to render less badges than those specified by
users in the Profile Badges event or replace the badge image and
thumbnails with ones that fits the theme of the client.</p>
<p>Clients SHOULD attempt to render the most appropriate badge thumbnail
according to the number of badges chosen by the user and space
available. Clients SHOULD attempt render the high-res version on user
action (click, tap, hover).</p>
<h3 id="example-of-a-badge-definition-event">Example of a Badge
Definition event</h3>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;alice&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">30009</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;bravery&quot;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;name&quot;</span><span class="ot">,</span> <span class="st">&quot;Medal of Bravery&quot;</span><span class="ot">],</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;description&quot;</span><span class="ot">,</span> <span class="st">&quot;Awarded to users demonstrating bravery&quot;</span><span class="ot">],</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;image&quot;</span><span class="ot">,</span> <span class="st">&quot;https://nostr.academy/awards/bravery.png&quot;</span><span class="ot">,</span> <span class="st">&quot;1024x1024&quot;</span><span class="ot">],</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;thumb&quot;</span><span class="ot">,</span> <span class="st">&quot;https://nostr.academy/awards/bravery_256x256.png&quot;</span><span class="ot">,</span> <span class="st">&quot;256x256&quot;</span><span class="ot">]</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="example-of-badge-award-event">Example of Badge Award event</h3>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;badge award event id&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">8</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;alice&quot;</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;30009:alice:bravery&quot;</span><span class="ot">],</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;bob&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://relay&quot;</span><span class="ot">],</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;charlie&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://relay&quot;</span><span class="ot">]</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="example-of-a-profile-badges-event">Example of a Profile Badges
event</h3>
<p>Honorable Bob The Brave:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">30008</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;bob&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;profile_badges&quot;</span><span class="ot">],</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;30009:alice:bravery&quot;</span><span class="ot">],</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;bravery badge award event id&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://nostr.academy&quot;</span><span class="ot">],</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;30009:alice:honor&quot;</span><span class="ot">],</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;honor badge award event id&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://nostr.academy&quot;</span><span class="ot">]</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>57</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-57">NIP-57</h1>
<h2 id="lightning-zaps">Lightning Zaps</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines two new event types for recording lightning payments
between users. <code>9734</code> is a <code>zap request</code>,
representing a payer’s request to a recipient’s lightning wallet for an
invoice. <code>9735</code> is a <code>zap receipt</code>, representing
the confirmation by the recipient’s lightning wallet that the invoice
issued in response to a <code>zap request</code> has been paid.</p>
<p>Having lightning receipts on nostr allows clients to display
lightning payments from entities on the network. These can be used for
fun or for spam deterrence.</p>
<h2 id="protocol-flow">Protocol flow</h2>
<ol type="1">
<li>Client calculates a recipient’s lnurl pay request url from the
<code>zap</code> tag on the event being zapped (see Appendix G), or by
decoding their lud06 or lud16 field on their profile according to the <a
href="https://github.com/lnurl/luds">lnurl specifications</a>. The
client MUST send a GET request to this url and parse the response. If
<code>allowsNostr</code> exists and it is <code>true</code>, and if
<code>nostrPubkey</code> exists and is a valid BIP 340 public key in
hex, the client should associate this information with the user, along
with the response’s <code>callback</code>, <code>minSendable</code>, and
<code>maxSendable</code> values.</li>
<li>Clients may choose to display a lightning zap button on each post or
on a user’s profile. If the user’s lnurl pay request endpoint supports
nostr, the client SHOULD use this NIP to request a
<code>zap receipt</code> rather than a normal lnurl invoice.</li>
<li>When a user (the “sender”) indicates they want to send a zap to
another user (the “recipient”), the client should create a
<code>zap request</code> event as described in Appendix A of this NIP
and sign it.</li>
<li>Instead of publishing the <code>zap request</code>, the
<code>9734</code> event should instead be sent to the
<code>callback</code> url received from the lnurl pay endpoint for the
recipient using a GET request. See Appendix B for details and an
example.</li>
<li>The recipient’s lnurl server will receive this
<code>zap request</code> and validate it. See Appendix C for details on
how to properly configure an lnurl server to support zaps, and Appendix
D for details on how to validate the <code>nostr</code> query
parameter.</li>
<li>If the <code>zap request</code> is valid, the server should fetch a
description hash invoice where the description is this
<code>zap request</code> note and this note only. No additional lnurl
metadata is included in the description. This will be returned in the
response according to <a
href="https://github.com/lnurl/luds/blob/luds/06.md.css.html">LUD06</a>.</li>
<li>On receiving the invoice, the client MAY pay it or pass it to an app
that can pay the invoice.</li>
<li>Once the invoice is paid, the recipient’s lnurl server MUST generate
a <code>zap receipt</code> as described in Appendix E, and publish it to
the <code>relays</code> specified in the <code>zap request</code>.</li>
<li>Clients MAY fetch <code>zap receipt</code>s on posts and profiles,
but MUST authorize their validity as described in Appendix F. If the
<code>zap request</code> note contains a non-empty <code>content</code>,
it may display a zap comment. Generally clients should show users the
<code>zap request</code> note, and use the <code>zap receipt</code> to
show “zap authorized by …” but this is optional.</li>
</ol>
<h2 id="reference-and-examples">Reference and examples</h2>
<h3 id="appendix-a-zap-request-event">Appendix A: Zap Request Event</h3>
<p>A <code>zap request</code> is an event of kind <code>9734</code> that
is <em>not</em> published to relays, but is instead sent to a
recipient’s lnurl pay <code>callback</code> url. This event’s
<code>content</code> MAY be an optional message to send along with the
payment. The event MUST include the following tags:</p>
<ul>
<li><code>relays</code> is a list of relays the recipient’s wallet
should publish its <code>zap receipt</code> to. Note that relays should
not be nested in an additional list, but should be included as shown in
the example below.</li>
<li><code>amount</code> is the amount in <em>millisats</em> the sender
intends to pay, formatted as a string. This is recommended, but
optional.</li>
<li><code>lnurl</code> is the lnurl pay url of the recipient, encoded
using bech32 with the prefix <code>lnurl</code>. This is recommended,
but optional.</li>
<li><code>p</code> is the hex-encoded pubkey of the recipient.</li>
</ul>
<p>In addition, the event MAY include the following tags:</p>
<ul>
<li><code>e</code> is an optional hex-encoded event id. Clients MUST
include this if zapping an event rather than a person.</li>
<li><code>a</code> is an optional event coordinate that allows tipping
parameterized replaceable events such as NIP-23 long-form notes.</li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">9734</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Zap!&quot;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;relays&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://nostr-pub.wellorder.com&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://anotherrelay.example.com&quot;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;amount&quot;</span><span class="ot">,</span> <span class="st">&quot;21000&quot;</span><span class="ot">],</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;lnurl&quot;</span><span class="ot">,</span> <span class="st">&quot;lnurl1dp68gurn8ghj7um5v93kketj9ehx2amn9uh8wetvdskkkmn0wahz7mrww4excup0dajx2mrv92x9xp&quot;</span><span class="ot">],</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;04c915daefee38317fa734444acee390a8269fe5810b2241e5e6dd343dfbecc9&quot;</span><span class="ot">],</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;9ae37aa68f48645127299e9453eb5d908a0cbb6058ff340d528ed4d37c8994fb&quot;</span><span class="ot">]</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;97c70a44366a6535c145b333f973ea86dfdc2d7a99da618c40c64705ad98e322&quot;</span><span class="fu">,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1679673265</span><span class="fu">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;30efed56a035b2549fcaeec0bf2c1595f9a9b3bb4b1a38abaf8ee9041c4b7d93&quot;</span><span class="fu">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;f2cb581a84ed10e4dc84937bd98e27acac71ab057255f6aa8dfa561808c981fe8870f4a03c1e3666784d82a9c802d3704e174371aa13d63e2aeaf24ff5374d9d&quot;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="appendix-b-zap-request-http-request">Appendix B: Zap Request
HTTP Request</h3>
<p>A signed <code>zap request</code> event is not published, but is
instead sent using a HTTP GET request to the recipient’s
<code>callback</code> url, which was provided by the recipient’s lnurl
pay endpoint. This request should have the following query parameters
defined:</p>
<ul>
<li><code>amount</code> is the amount in <em>millisats</em> the sender
intends to pay</li>
<li><code>nostr</code> is the <code>9734</code> <code>zap request</code>
event, JSON encoded then URI encoded</li>
<li><code>lnurl</code> is the lnurl pay url of the recipient, encoded
using bech32 with the prefix <code>lnurl</code></li>
</ul>
<p>This request should return a JSON response with a <code>pr</code>
key, which is the invoice the sender must pay to finalize his zap. Here
is an example flow in javascript:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> senderPubkey <span class="co">// The sender&#39;s pubkey</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> recipientPubkey <span class="op">=</span> <span class="co">// The recipient&#39;s pubkey</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> callback <span class="op">=</span> <span class="co">// The callback received from the recipients lnurl pay endpoint</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> lnurl <span class="op">=</span> <span class="co">// The recipient&#39;s lightning address, encoded as a lnurl</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sats <span class="op">=</span> <span class="dv">21</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> amount <span class="op">=</span> sats <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> relays <span class="op">=</span> [<span class="st">&#39;wss://nostr-pub.wellorder.net&#39;</span>]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="bu">event</span> <span class="op">=</span> <span class="pp">encodeURI</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="cf">await</span> <span class="fu">signEvent</span>({</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">kind</span><span class="op">:</span> <span class="dv">9734</span><span class="op">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pubkey</span><span class="op">:</span> senderPubkey<span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">created_at</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span>)<span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">tags</span><span class="op">:</span> [</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;relays&quot;</span><span class="op">,</span> <span class="op">...</span>relays]<span class="op">,</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;amount&quot;</span><span class="op">,</span> amount<span class="op">.</span><span class="fu">toString</span>()]<span class="op">,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;lnurl&quot;</span><span class="op">,</span> lnurl]<span class="op">,</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;p&quot;</span><span class="op">,</span> recipientPubkey]<span class="op">,</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>})))</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> {<span class="dt">pr</span><span class="op">:</span> invoice} <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetchJson</span>(<span class="vs">`</span><span class="sc">${</span>callback<span class="sc">}</span><span class="vs">?amount=</span><span class="sc">${</span>amount<span class="sc">}</span><span class="vs">&amp;nostr=</span><span class="sc">${</span><span class="bu">event</span><span class="sc">}</span><span class="vs">&amp;lnurl=</span><span class="sc">${</span>lnurl<span class="sc">}</span><span class="vs">`</span>)</span></code></pre></div>
<h3 id="appendix-c-lnurl-server-configuration">Appendix C: LNURL Server
Configuration</h3>
<p>The lnurl server will need some additional pieces of information so
that clients can know that zap invoices are supported:</p>
<ol type="1">
<li>Add a <code>nostrPubkey</code> to the lnurl-pay static endpoint
<code>/.well-known/lnurlp/&lt;user&gt;</code>, where
<code>nostrPubkey</code> is the nostr pubkey your server will use to
sign <code>zap receipt</code> events. Clients will use this to validate
<code>zap receipt</code>s.</li>
<li>Add an <code>allowsNostr</code> field and set it to true.</li>
</ol>
<h3 id="appendix-d-lnurl-server-zap-request-validation">Appendix D:
LNURL Server Zap Request Validation</h3>
<p>When a client sends a <code>zap request</code> event to a server’s
lnurl-pay callback URL, there will be a <code>nostr</code> query
parameter whose value is that event which is URI- and JSON-encoded. If
present, the <code>zap request</code> event must be validated in the
following ways:</p>
<ol type="1">
<li>It MUST have a valid nostr signature</li>
<li>It MUST have tags</li>
<li>It MUST have only one <code>p</code> tag</li>
<li>It MUST have 0 or 1 <code>e</code> tags</li>
<li>There should be a <code>relays</code> tag with the relays to send
the <code>zap receipt</code> to.</li>
<li>If there is an <code>amount</code> tag, it MUST be equal to the
<code>amount</code> query parameter.</li>
<li>If there is an <code>a</code> tag, it MUST be a valid event
coordinate</li>
<li>There MUST be 0 or 1 <code>P</code> tags. If there is one, it MUST
be equal to the <code>zap receipt</code>’s <code>pubkey</code>.</li>
</ol>
<p>The event MUST then be stored for use later, when the invoice is
paid.</p>
<h3 id="appendix-e-zap-receipt-event">Appendix E: Zap Receipt Event</h3>
<p>A <code>zap receipt</code> is created by a lightning node when an
invoice generated by a <code>zap request</code> is paid.
<code>Zap receipt</code>s are only created when the invoice description
(committed to the description hash) contains a <code>zap request</code>
note.</p>
<p>When receiving a payment, the following steps are executed:</p>
<ol type="1">
<li>Get the description for the invoice. This needs to be saved
somewhere during the generation of the description hash invoice. It is
saved automatically for you with CLN, which is the reference
implementation used here.</li>
<li>Parse the bolt11 description as a JSON nostr event. This SHOULD be
validated based on the requirements in Appendix D, either when it is
received, or before the invoice is paid.</li>
<li>Create a nostr event of kind <code>9735</code> as described below,
and publish it to the <code>relays</code> declared in the
<code>zap request</code>.</li>
</ol>
<p>The following should be true of the <code>zap receipt</code>
event:</p>
<ul>
<li>The <code>content</code> SHOULD be empty.</li>
<li>The <code>created_at</code> date SHOULD be set to the invoice
<code>paid_at</code> date for idempotency.</li>
<li><code>tags</code> MUST include the <code>p</code> tag (zap
recipient) AND optional <code>e</code> tag from the
<code>zap request</code> AND optional <code>a</code> tag from the
<code>zap request</code> AND optional <code>P</code> tag from the pubkey
of the zap request (zap sender).</li>
<li>The <code>zap receipt</code> MUST have a <code>bolt11</code> tag
containing the description hash bolt11 invoice.</li>
<li>The <code>zap receipt</code> MUST contain a <code>description</code>
tag which is the JSON-encoded invoice description.</li>
<li><code>SHA256(description)</code> MUST match the description hash in
the bolt11 invoice.</li>
<li>The <code>zap receipt</code> MAY contain a <code>preimage</code> tag
to match against the payment hash of the bolt11 invoice. This isn’t
really a payment proof, there is no real way to prove that the invoice
is real or has been paid. You are trusting the author of the
<code>zap receipt</code> for the legitimacy of the payment.</li>
</ul>
<p>The <code>zap receipt</code> is not a proof of payment, all it proves
is that some nostr user fetched an invoice. The existence of the
<code>zap receipt</code> implies the invoice as paid, but it could be a
lie given a rogue implementation.</p>
<p>A reference implementation for a zap-enabled lnurl server can be
found <a href="https://github.com/jb55/cln-nostr-zapper">here</a>.</p>
<p>Example <code>zap receipt</code>:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;67b48a14fb66c60c8f9070bdeb37afdfcc3d08ad01989460448e4081eddda446&quot;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;9630f464cca6a5147aa8a35f0bcdd3ce485324e732fd39e09233b1d848238f31&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1674164545</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">9735</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;32e1827635450ebb3c5a7d12c1f8e7b2b514439ac10a67eef3d9fd9c5c68e245&quot;</span><span class="ot">],</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;P&quot;</span><span class="ot">,</span> <span class="st">&quot;97c70a44366a6535c145b333f973ea86dfdc2d7a99da618c40c64705ad98e322&quot;</span><span class="ot">],</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;3624762a1274dd9636e0c552b53086d70bc88c165bc4dc0f9e836a1eaf86c3b8&quot;</span><span class="ot">],</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;bolt11&quot;</span><span class="ot">,</span> <span class="st">&quot;lnbc10u1p3unwfusp5t9r3yymhpfqculx78u027lxspgxcr2n2987mx2j55nnfs95nxnzqpp5jmrh92pfld78spqs78v9euf2385t83uvpwk9ldrlvf6ch7tpascqhp5zvkrmemgth3tufcvflmzjzfvjt023nazlhljz2n9hattj4f8jq8qxqyjw5qcqpjrzjqtc4fc44feggv7065fqe5m4ytjarg3repr5j9el35xhmtfexc42yczarjuqqfzqqqqqqqqlgqqqqqqgq9q9qxpqysgq079nkq507a5tw7xgttmj4u990j7wfggtrasah5gd4ywfr2pjcn29383tphp4t48gquelz9z78p4cq7ml3nrrphw5w6eckhjwmhezhnqpy6gyf0&quot;</span><span class="ot">],</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;description&quot;</span><span class="ot">,</span> <span class="st">&quot;{</span><span class="ch">\&quot;</span><span class="st">pubkey</span><span class="ch">\&quot;</span><span class="st">:</span><span class="ch">\&quot;</span><span class="st">97c70a44366a6535c145b333f973ea86dfdc2d7a99da618c40c64705ad98e322</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">content</span><span class="ch">\&quot;</span><span class="st">:</span><span class="ch">\&quot;\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">id</span><span class="ch">\&quot;</span><span class="st">:</span><span class="ch">\&quot;</span><span class="st">d9cc14d50fcb8c27539aacf776882942c1a11ea4472f8cdec1dea82fab66279d</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">created_at</span><span class="ch">\&quot;</span><span class="st">:1674164539,</span><span class="ch">\&quot;</span><span class="st">sig</span><span class="ch">\&quot;</span><span class="st">:</span><span class="ch">\&quot;</span><span class="st">77127f636577e9029276be060332ea565deaf89ff215a494ccff16ae3f757065e2bc59b2e8c113dd407917a010b3abd36c8d7ad84c0e3ab7dab3a0b0caa9835d</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">kind</span><span class="ch">\&quot;</span><span class="st">:9734,</span><span class="ch">\&quot;</span><span class="st">tags</span><span class="ch">\&quot;</span><span class="st">:[[</span><span class="ch">\&quot;</span><span class="st">e</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">3624762a1274dd9636e0c552b53086d70bc88c165bc4dc0f9e836a1eaf86c3b8</span><span class="ch">\&quot;</span><span class="st">],[</span><span class="ch">\&quot;</span><span class="st">p</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">32e1827635450ebb3c5a7d12c1f8e7b2b514439ac10a67eef3d9fd9c5c68e245</span><span class="ch">\&quot;</span><span class="st">],[</span><span class="ch">\&quot;</span><span class="st">relays</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">wss://relay.damus.io</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">wss://nostr-relay.wlvs.space</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">wss://nostr.fmt.wiz.biz</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">wss://relay.nostr.bg</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">wss://nostr.oxtr.dev</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">wss://nostr.v0l.io</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">wss://brb.io</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">wss://nostr.bitcoiner.social</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">ws://monad.jb55.com:8080</span><span class="ch">\&quot;</span><span class="st">,</span><span class="ch">\&quot;</span><span class="st">wss://relay.snort.social</span><span class="ch">\&quot;</span><span class="st">]]}&quot;</span><span class="ot">],</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;preimage&quot;</span><span class="ot">,</span> <span class="st">&quot;5d006d2cf1e73c7148e7519a4c68adc81642ce0e25a432b2434c99f97344c15f&quot;</span><span class="ot">]</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span></code></pre></div>
<h3 id="appendix-f-validating-zap-receipts">Appendix F: Validating Zap
Receipts</h3>
<p>A client can retrieve <code>zap receipt</code>s on events and pubkeys
using a NIP-01 filter, for example
<code>{"kinds": [9735], "#e": [...]}</code>. Zaps MUST be validated
using the following steps:</p>
<ul>
<li>The <code>zap receipt</code> event’s <code>pubkey</code> MUST be the
same as the recipient’s lnurl provider’s <code>nostrPubkey</code>
(retrieved in step 1 of the protocol flow).</li>
<li>The <code>invoiceAmount</code> contained in the <code>bolt11</code>
tag of the <code>zap receipt</code> MUST equal the <code>amount</code>
tag of the <code>zap request</code> (if present).</li>
<li>The <code>lnurl</code> tag of the <code>zap request</code> (if
present) SHOULD equal the recipient’s <code>lnurl</code>.</li>
</ul>
<h3 id="appendix-g-zap-tag-on-other-events">Appendix G: <code>zap</code>
tag on other events</h3>
<p>When an event includes one or more <code>zap</code> tags, clients
wishing to zap it SHOULD calculate the lnurl pay request based on the
tags value instead of the event author’s profile field. The tag’s second
argument is the <code>hex</code> string of the receiver’s pub key and
the third argument is the relay to download the receiver’s metadata
(Kind-0). An optional fourth parameter specifies the weight (a
generalization of a percentage) assigned to the respective receiver.
Clients should parse all weights, calculate a sum, and then a percentage
to each receiver. If weights are not present, CLIENTS should equally
divide the zap amount to all receivers. If weights are only partially
present, receivers without a weight should not be zapped
(<code>weight = 0</code>).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        [ <span class="st">&quot;zap&quot;</span><span class="op">,</span> <span class="st">&quot;82341f882b6eabcd2ba7f1ef90aad961cf074af15b9ef44a09f9d2a8fbfbe6a2&quot;</span><span class="op">,</span> <span class="st">&quot;wss://nostr.oxtr.dev&quot;</span><span class="op">,</span> <span class="st">&quot;1&quot;</span> ]<span class="op">,</span>  <span class="co">// 25%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        [ <span class="st">&quot;zap&quot;</span><span class="op">,</span> <span class="st">&quot;fa984bd7dbb282f07e16e7ae87b26a2a7b9b90b7246a44771f0cf5ae58018f52&quot;</span><span class="op">,</span> <span class="st">&quot;wss://nostr.wine/&quot;</span><span class="op">,</span>    <span class="st">&quot;1&quot;</span> ]<span class="op">,</span>  <span class="co">// 25%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        [ <span class="st">&quot;zap&quot;</span><span class="op">,</span> <span class="st">&quot;460c25e682fda7832b52d1f22d3d22b3176d972f60dcdc3212ed8c92ef85065c&quot;</span><span class="op">,</span> <span class="st">&quot;wss://nos.lol/&quot;</span><span class="op">,</span>       <span class="st">&quot;2&quot;</span> ]   <span class="co">// 50%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Clients MAY display the zap split configuration in the note.</p>
<h2 id="future-work">Future Work</h2>
<p>Zaps can be extended to be more private by encrypting
<code>zap request</code> notes to the target user, but for simplicity it
has been left out of this initial draft.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>56</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-56">NIP-56</h1>
<h2 id="reporting">Reporting</h2>
<p><code>optional</code></p>
<p>A report is a <code>kind 1984</code> event that signals to users and
relays that some referenced content is objectionable. The definition of
objectionable is obviously subjective and all agents on the network
(users, apps, relays, etc.) may consume and take action on them as they
see fit.</p>
<p>The <code>content</code> MAY contain additional information submitted
by the entity reporting the content.</p>
<h2 id="tags">Tags</h2>
<p>The report event MUST include a <code>p</code> tag referencing the
pubkey of the user you are reporting.</p>
<p>If reporting a note, an <code>e</code> tag MUST also be included
referencing the note id.</p>
<p>A <code>report type</code> string MUST be included as the 3rd entry
to the <code>e</code> or <code>p</code> tag being reported, which
consists of the following report types:</p>
<ul>
<li><code>nudity</code> - depictions of nudity, porn, etc.</li>
<li><code>malware</code> - virus, trojan horse, worm, robot, spyware,
adware, back door, ransomware, rootkit, kidnapper, etc.</li>
<li><code>profanity</code> - profanity, hateful speech, etc.</li>
<li><code>illegal</code> - something which may be illegal in some
jurisdiction</li>
<li><code>spam</code> - spam</li>
<li><code>impersonation</code> - someone pretending to be someone
else</li>
<li><code>other</code> - for reports that don’t fit in the above
categories</li>
</ul>
<p>Some report tags only make sense for profile reports, such as
<code>impersonation</code></p>
<p><code>l</code> and <code>L</code> tags MAY be also be used as defined
in <a href="32.md.css.html">NIP-32</a> to support further qualification and
querying.</p>
<h2 id="example-events">Example events</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1984</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;pubkey&gt;</span><span class="ot">,</span> <span class="st">&quot;nudity&quot;</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;L&quot;</span><span class="ot">,</span> <span class="st">&quot;social.nos.ontology&quot;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;l&quot;</span><span class="ot">,</span> <span class="st">&quot;NS-nud&quot;</span><span class="ot">,</span> <span class="st">&quot;social.nos.ontology&quot;</span><span class="ot">]</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1984</span><span class="fu">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;eventId&gt;</span><span class="ot">,</span> <span class="st">&quot;illegal&quot;</span><span class="ot">],</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;pubkey&gt;</span><span class="ot">]</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;He&#39;s insulting the king!&quot;</span><span class="fu">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1984</span><span class="fu">,</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;impersonator</span> <span class="er">pubkey&gt;</span><span class="ot">,</span> <span class="st">&quot;impersonation&quot;</span><span class="ot">]</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Profile is impersonating nostr:&lt;victim bech32 pubkey&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="client-behavior">Client behavior</h2>
<p>Clients can use reports from friends to make moderation decisions if
they choose to. For instance, if 3+ of your friends report a profile for
<code>nudity</code>, clients can have an option to automatically blur
photos from said account.</p>
<h2 id="relay-behavior">Relay behavior</h2>
<p>It is not recommended that relays perform automatic moderation using
reports, as they can be easily gamed. Admins could use reports from
trusted moderators to takedown illegal or explicit content if the relay
does not allow such things.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>54</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-54">NIP-54</h1>
<h2 id="wiki">Wiki</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines <code>kind:30818</code> (a <em>parameterized
replaceable event</em>) for long-form text content similar to <a
href="23.md.css.html">NIP-23</a>, but with one important difference: articles are
meant to be descriptions, or encyclopedia entries, of particular
subjects, and it’s expected that multiple people will write articles
about the exact same subjects, with either small variations or
completely independent content.</p>
<p>Articles are identified by lowercase, normalized ascii <code>d</code>
tags.</p>
<h3 id="articles">Articles</h3>
<pre class="jsonc"><code>{
  &quot;content&quot;: &quot;A wiki is a hypertext publication collaboratively edited and managed by its own audience.&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;wiki&quot;],
    [&quot;title&quot;, &quot;Wiki&quot;],
  ]
}</code></pre>
<h3 id="d-tag-normalization-rules"><code>d</code> tag normalization
rules</h3>
<ul>
<li>Any non-letter character MUST be converted to a <code>-</code>.</li>
<li>All letters MUST be converted to lowercase.</li>
</ul>
<h3 id="content-rules">Content rules</h3>
<p>The content should be Markdown, following the same rules as of <a
href="23.md.css.html">NIP-23</a>, although it takes some extra (optional)
metadata tags:</p>
<ul>
<li><code>title</code>: for when the display title should be different
from the <code>d</code> tag.</li>
<li><code>summary</code>: for display in lists.</li>
<li><code>a</code> and <code>e</code>: for referencing the original
event a wiki article was forked from.</li>
</ul>
<p>One extra functionality is added: <strong>wikilinks</strong>. Unlike
normal Markdown links <code>[]()</code> that link to webpages, wikilinks
<code>[[]]</code> link to other articles in the wiki. In this case, the
wiki is the entirety of Nostr. Clicking on a wikilink should cause the
client to ask relays for events with <code>d</code> tags equal to the
target of that wikilink.</p>
<h3 id="merge-requests">Merge Requests</h3>
<p>Event <code>kind:818</code> represents a request to merge from a
forked article into the source. It is directed to a pubkey and
references the original article and the modified event.</p>
<p>[INSERT EVENT EXAMPLE]</p>
<h3 id="redirects">Redirects</h3>
<p>Event <code>kind:30819</code> is also defined to stand for “wiki
redirects”, i.e. if one thinks <code>Shell structure</code> should
redirect to <code>Thin-shell structure</code> they can issue one of
these events instead of replicating the content. These events can be
used for automatically redirecting between articles on a client, but
also for generating crowdsourced “disambiguation” pages (<a
href="https://en.wikipedia.org/wiki/Help:Disambiguation">common in
Wikipedia</a>).</p>
<p>[INSERT EVENT EXAMPLE]</p>
<h2 id="how-to-decide-what-article-to-display">How to decide what
article to display</h2>
<p>As there could be many articles for each given name, some kind of
prioritization must be done by clients. Criteria for this should vary
between users and clients, but some means that can be used are described
below:</p>
<h3 id="reactions">Reactions</h3>
<p><a href="25.md.css.html">NIP-25</a> reactions are very simple and can be used
to create a simple web-of-trust between wiki article writers and their
content. While just counting a raw number of “likes” is unproductive,
reacting to any wiki article event with a <code>+</code> can be
interpreted as a recommendation for that article specifically and a
partial recommendation of the author of that article. When 2 or 3-level
deep recommendations are followed, suddenly a big part of all the
articles may have some form of tagging.</p>
<h3 id="relays">Relays</h3>
<p><a href="51.md.css.html">NIP-51</a> lists of relays can be created with the
kind 10102 and then used by wiki clients in order to determine where to
query articles first and to rank these differently in relation to other
events fetched from other relays.</p>
<h3 id="contact-lists">Contact lists</h3>
<p><a href="02.md.css.html">NIP-02</a> contact lists can form the basis of a
recommendation system that is then expanded with relay lists and
reaction lists through nested queries. These lists form a good starting
point only because they are so widespread.</p>
<h3 id="wiki-related-contact-lists">Wiki-related contact lists</h3>
<p><a href="51.md.css.html">NIP-51</a> lists can also be used to create a list of
users that are trusted only in the context of wiki authorship or wiki
curationship.</p>
<h2 id="forks">Forks</h2>
<p>Wiki-events can tag other wiki-events with a <code>fork</code> marker
to specify that this event came from a different version. Both
<code>a</code> and <code>e</code> tags SHOULD be used and have the
<code>fork</code> marker applied, to identify the exact version it was
forked from.</p>
<h2 id="deference">Deference</h2>
<p>Wiki-events can tag other wiki-events with a <code>defer</code>
marker to indicate that it considers someone else’s entry as a “better”
version of itself. If using a <code>defer</code> marker both
<code>a</code> and <code>e</code> tags SHOULD be used.</p>
<p>This is a stronger signal of trust than a <code>+</code>
reaction.</p>
<p>This marker is useful when a user edits someone else’s entry; if the
original author includes the editor’s changes and the editor doesn’t
want to keep/maintain an independent version, the <code>link</code> tag
could effectively be a considered a “deletion” of the editor’s version
and putting that pubkey’s WoT weight behind the original author’s
version.</p>
<h2 id="why-markdown">Why Markdown?</h2>
<p>If the idea is to make a wiki then the most obvious text format to
use is probably the mediawiki/wikitext format used by Wikipedia since
it’s widely deployed in all mediawiki installations and used for decades
with great success. However, it turns out that format is very bloated
and convoluted, has way too many features and probably because of that
it doesn’t have many alternative implementations out there, and the ones
that exist are not complete and don’t look very trustworthy. Also it is
very much a centralized format that can probably be changed at the whims
of the Wikipedia owners.</p>
<p>On the other hand, Markdown has proven to work well for small scale
wikis and one of the biggest wikis in the planet (which is not very
often thought of as a wiki), <a
href="https://stackoverflow.com">StackOverflow</a> and its child sites,
and also one of the biggest “personal wiki” software, <a
href="https://obsidian.md.css.html/">Obsidian</a>. Markdown can probably deliver
95% of the functionality of wikitext. When augmented with tables,
diagram generators and MathJax (which are common extensions that exist
in the wild and can be included in this NIP) that rate probably goes to
99%, and its simplicity is a huge benefit that can’t be overlooked.
Wikitext format can also be transpíled into Markdown using Pandoc. Given
all that, I think it’s a reasonable suspicion that mediawiki is not
inherently better than Markdown, the success of Wikipedia probably
cannot be predicated on the syntax language choice.</p>
<h1 id="appendix-1-merge-requests">Appendix 1: Merge requests</h1>
<p>Users can request other users to get their entries merged into
someone else’s entry by creating a <code>kind:818</code> event.</p>
<pre class="jsonc"><code>{
  &quot;content&quot;: &quot;I added information about how to make hot ice-creams&quot;,
  &quot;kind&quot;: 818,
  &quot;tags&quot;: [
    [ &quot;a&quot;, &quot;30818:&lt;destination-pubkey&gt;:hot-ice-creams&quot;, &quot;&lt;relay-url&gt;&quot; ],
    [ &quot;e&quot;, &quot;&lt;version-against-which-the-modification-was-made&gt;&quot;, &quot;&lt;relay-url&gt;&#39; ],
    [ &quot;p&quot;, &quot;&lt;destination-pubkey&gt;&quot; ],
    [ &quot;e&quot;, &quot;&lt;version-to-be-merged&gt;&quot;, &quot;&lt;relay-url&gt;&quot;, &quot;source&quot; ]
  ]
}</code></pre>
<p><code>.content</code>: an optional explanation detailing why this
merge is being requested. <code>a</code> tag: tag of the article which
should be modified (i.e. the target of this merge request).
<code>e</code> tag: optional version of the article in which this
modifications is based <code>e</code> tag with <code>source</code>
marker: the ID of the event that should be merged. This event id MUST be
of a <code>kind:30818</code> as defined in this NIP.</p>
<p>The destination-pubkey (the pubkey being requested to merge something
into their article can create [[NIP-25]] reactions that tag the
<code>kind:818</code> event with <code>+</code> or <code>-</code></p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>53</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-53">NIP-53</h1>
<h2 id="live-activities">Live Activities</h2>
<p><code>draft</code> <code>optional</code></p>
<p>Service providers want to offer live activities to the Nostr network
in such a way that participants can easily log and query by clients.
This NIP describes a general framework to advertise the involvement of
pubkeys in such live activities.</p>
<h2 id="concepts">Concepts</h2>
<h3 id="live-event">Live Event</h3>
<p>A special event with <code>kind:30311</code> “Live Event” is defined
as a <em>parameterized replaceable event</em> of public <code>p</code>
tags. Each <code>p</code> tag SHOULD have a <strong>displayable</strong>
marker name for the current role (e.g. <code>Host</code>,
<code>Speaker</code>, <code>Participant</code>) of the user in the event
and the relay information MAY be empty. This event will be constantly
updated as participants join and leave the activity.</p>
<p>For example:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">30311</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;unique identifier&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;title&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;name of the event&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;summary&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;description&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;image&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;preview image url&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;t&quot;</span><span class="ot">,</span> <span class="st">&quot;hashtag&quot;</span><span class="ot">]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;streaming&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;url&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;recording&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;url&gt;&quot;</span><span class="ot">],</span> <span class="er">//</span> <span class="er">used</span> <span class="er">to</span> <span class="er">place</span> <span class="er">the</span> <span class="er">edited</span> <span class="er">video</span> <span class="er">once</span> <span class="er">the</span> <span class="er">activity</span> <span class="er">is</span> <span class="er">over</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;starts&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;unix timestamp in seconds&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;ends&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;unix timestamp in seconds&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;status&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;planned, live, ended&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;current_participants&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;number&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;total_participants&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;number&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;91cf9..4e5ca&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://provider1.com/&quot;</span><span class="ot">,</span> <span class="st">&quot;Host&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;proof&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;14aeb..8dad4&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://provider2.com/nostr&quot;</span><span class="ot">,</span> <span class="st">&quot;Speaker&quot;</span><span class="ot">],</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;612ae..e610f&quot;</span><span class="ot">,</span> <span class="st">&quot;ws://provider3.com/ws&quot;</span><span class="ot">,</span> <span class="st">&quot;Participant&quot;</span><span class="ot">],</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;relays&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://one.com&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://two.com&quot;</span><span class="ot">,</span> <span class="er">...</span><span class="ot">]</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>A distinct <code>d</code> tag should be used for each activity. All
other tags are optional.</p>
<p>Providers SHOULD keep the participant list small (e.g. under 1000
users) and, when limits are reached, Providers SHOULD select which
participants get named in the event. Clients should not expect a
comprehensive list. Once the activity ends, the event can be deleted or
updated to summarize the activity and provide async content
(e.g. recording of the event).</p>
<p>Clients are expected to subscribe to <code>kind:30311</code> events
in general or for given follow lists and statuses. Clients MAY display
participants’ roles in activities as well as access points to join the
activity.</p>
<p>Live Activity management clients are expected to constantly update
<code>kind:30311</code> during the event. Clients MAY choose to consider
<code>status=live</code> events after 1hr without any update as
<code>ended</code>. The <code>starts</code> and <code>ends</code>
timestamp SHOULD be updated when the status changes to and from
<code>live</code></p>
<p>The activity MUST be linked to using the <a href="19.md.css.html">NIP-19</a>
<code>naddr</code> code along with the <code>a</code> tag.</p>
<h3 id="proof-of-agreement-to-participate">Proof of Agreement to
Participate</h3>
<p>Event owners can add proof as the 5th term in each <code>p</code> tag
to clarify the participant’s agreement in joining the event. The proof
is a signed SHA256 of the complete <code>a</code> Tag of the event
(<code>kind:pubkey:dTag</code>) by each <code>p</code>’s private key,
encoded in hex.</p>
<p>Clients MAY only display participants if the proof is available or
MAY display participants as “invited” if the proof is not available.</p>
<p>This feature is important to avoid malicious event owners adding
large account holders to the event, without their knowledge, to lure
their followers into the malicious owner’s trap.</p>
<h3 id="live-chat-message">Live Chat Message</h3>
<p>Event <code>kind:1311</code> is live chat’s channel message. Clients
MUST include the <code>a</code> tag of the activity with a
<code>root</code> marker. Other Kind-1 tags such as <code>reply</code>
and <code>mention</code> can also be used.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1311</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;30311:&lt;Community event author pubkey&gt;:&lt;d-identifier of the community&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;Optional relay url&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;root&quot;</span><span class="ot">],</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Zaps to live streams is beautiful.&quot;</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="use-cases">Use Cases</h2>
<p>Common use cases include meeting rooms/workshops, watch-together
activities, or event spaces, such as <a
href="https://live.snort.social">live.snort.social</a> and <a
href="https://nostrnests.com">nostrnests.com</a>.</p>
<h2 id="example">Example</h2>
<h3 id="live-streaming">Live Streaming</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;57f28dbc264990e2c61e80a883862f7c114019804208b14da0bff81371e484d2&quot;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;1597246ac22f7d1375041054f2a4986bd971d8d196d7997e48973263ac9879ec&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1687182672</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">30311</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;demo-cf-stream&quot;</span><span class="ot">],</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;title&quot;</span><span class="ot">,</span> <span class="st">&quot;Adult Swim Metalocalypse&quot;</span><span class="ot">],</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;summary&quot;</span><span class="ot">,</span> <span class="st">&quot;Live stream from IPTV-ORG collection&quot;</span><span class="ot">],</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;streaming&quot;</span><span class="ot">,</span> <span class="st">&quot;https://adultswim-vodlive.cdn.turner.com/live/metalocalypse/stream.m3u8&quot;</span><span class="ot">],</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;starts&quot;</span><span class="ot">,</span> <span class="st">&quot;1687182672&quot;</span><span class="ot">],</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;status&quot;</span><span class="ot">,</span> <span class="st">&quot;live&quot;</span><span class="ot">],</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;t&quot;</span><span class="ot">,</span> <span class="st">&quot;animation&quot;</span><span class="ot">],</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;t&quot;</span><span class="ot">,</span> <span class="st">&quot;iptv&quot;</span><span class="ot">],</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;image&quot;</span><span class="ot">,</span> <span class="st">&quot;https://i.imgur.com/CaKq6Mt.png&quot;</span><span class="ot">]</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;5bc7a60f5688effa5287244a24768cbe0dcd854436090abc3bef172f7f5db1410af4277508dbafc4f70a754a891c90ce3b966a7bc47e7c1eb71ff57640f3d389&quot;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="live-streaming-chat-message">Live Streaming chat message</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;97aa81798ee6c5637f7b21a411f89e10244e195aa91cb341bf49f718e36c8188&quot;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;3f770d65d3a764a9c5cb503ae123e62ec7598ad035d836e2a810f3877a745b24&quot;</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1687286726</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1311</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;30311:1597246ac22f7d1375041054f2a4986bd971d8d196d7997e48973263ac9879ec:demo-cf-stream&quot;</span><span class="ot">,</span> <span class="st">&quot;&quot;</span><span class="ot">,</span> <span class="st">&quot;root&quot;</span><span class="ot">]</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Zaps to live streams is beautiful.&quot;</span><span class="fu">,</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;997f62ddfc0827c121043074d50cfce7a528e978c575722748629a4137c45b75bdbc84170bedc723ef0a5a4c3daebf1fef2e93f5e2ddb98e5d685d022c30b622&quot;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>52</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-52">NIP-52</h1>
<h2 id="calendar-events">Calendar Events</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This specification defines calendar events representing an occurrence
at a specific moment or between moments. These calendar events are
<em>parameterized replaceable</em> and deletable per <a
href="09.md.css.html">NIP-09</a>.</p>
<p>Unlike the term <code>calendar event</code> specific to this NIP, the
term <code>event</code> is used broadly in all the NIPs to describe any
Nostr event. The distinction is being made here to discern between the
two terms.</p>
<h2 id="calendar-events-1">Calendar Events</h2>
<p>There are two types of calendar events represented by different
kinds: date-based and time-based calendar events. Calendar events are
not required to be part of a <a href="#calendar">calendar</a>.</p>
<h3 id="date-based-calendar-event">Date-Based Calendar Event</h3>
<p>This kind of calendar event starts on a date and ends before a
different date in the future. Its use is appropriate for all-day or
multi-day events where time and time zone hold no significance. e.g.,
anniversary, public holidays, vacation days.</p>
<h4 id="format">Format</h4>
<p>The format uses a parameterized replaceable event kind
<code>31922</code>.</p>
<p>The <code>.content</code> of these events should be a detailed
description of the calendar event. It is required but can be an empty
string.</p>
<p>The list of tags are as follows: * <code>d</code> (required)
universally unique identifier (UUID). Generated by the client creating
the calendar event. * <code>title</code> (required) title of the
calendar event * <code>start</code> (required) inclusive start date in
ISO 8601 format (YYYY-MM-DD). Must be less than <code>end</code>, if it
exists. * <code>end</code> (optional) exclusive end date in ISO 8601
format (YYYY-MM-DD). If omitted, the calendar event ends on the same
date as <code>start</code>. * <code>location</code> (optional, repeated)
location of the calendar event. e.g. address, GPS coordinates, meeting
room name, link to video call * <code>g</code> (optional) <a
href="https://en.wikipedia.org/wiki/Geohash">geohash</a> to associate
calendar event with a searchable physical location * <code>p</code>
(optional, repeated) 32-bytes hex pubkey of a participant, optional
recommended relay URL, and participant’s role in the meeting *
<code>t</code> (optional, repeated) hashtag to categorize calendar event
* <code>r</code> (optional, repeated) references / links to web pages,
documents, video calls, recorded videos, etc.</p>
<p>The following tags are deprecated: * <code>name</code> name of the
calendar event. Use only if <code>title</code> is not available.</p>
<pre class="jsonc"><code>{
  &quot;id&quot;: &lt;32-bytes lowercase hex-encoded SHA-256 of the the serialized event data&gt;,
  &quot;pubkey&quot;: &lt;32-bytes lowercase hex-encoded public key of the event creator&gt;,
  &quot;created_at&quot;: &lt;Unix timestamp in seconds&gt;,
  &quot;kind&quot;: 31922,
  &quot;content&quot;: &quot;&lt;description of calendar event&gt;&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;&lt;UUID&gt;&quot;],

    [&quot;title&quot;, &quot;&lt;title of calendar event&gt;&quot;],

    // Dates
    [&quot;start&quot;, &quot;&lt;YYYY-MM-DD&gt;&quot;],
    [&quot;end&quot;, &quot;&lt;YYYY-MM-DD&gt;&quot;],

    // Location
    [&quot;location&quot;, &quot;&lt;location&gt;&quot;],
    [&quot;g&quot;, &quot;&lt;geohash&gt;&quot;],

    // Participants
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;&lt;role&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;&lt;role&gt;&quot;],

    // Hashtags
    [&quot;t&quot;, &quot;&lt;tag&gt;&quot;],
    [&quot;t&quot;, &quot;&lt;tag&gt;&quot;],

    // Reference links
    [&quot;r&quot;, &quot;&lt;url&gt;&quot;],
    [&quot;r&quot;, &quot;&lt;url&gt;&quot;]
  ]
}</code></pre>
<h3 id="time-based-calendar-event">Time-Based Calendar Event</h3>
<p>This kind of calendar event spans between a start time and end
time.</p>
<h4 id="format-1">Format</h4>
<p>The format uses a parameterized replaceable event kind
<code>31923</code>.</p>
<p>The <code>.content</code> of these events should be a detailed
description of the calendar event. It is required but can be an empty
string.</p>
<p>The list of tags are as follows: * <code>d</code> (required)
universally unique identifier (UUID). Generated by the client creating
the calendar event. * <code>title</code> (required) title of the
calendar event * <code>start</code> (required) inclusive start Unix
timestamp in seconds. Must be less than <code>end</code>, if it exists.
* <code>end</code> (optional) exclusive end Unix timestamp in seconds.
If omitted, the calendar event ends instantaneously. *
<code>start_tzid</code> (optional) time zone of the start timestamp, as
defined by the IANA Time Zone Database. e.g.,
<code>America/Costa_Rica</code> * <code>end_tzid</code> (optional) time
zone of the end timestamp, as defined by the IANA Time Zone Database.
e.g., <code>America/Costa_Rica</code>. If omitted and
<code>start_tzid</code> is provided, the time zone of the end timestamp
is the same as the start timestamp. * <code>location</code> (optional,
repeated) location of the calendar event. e.g. address, GPS coordinates,
meeting room name, link to video call * <code>g</code> (optional) <a
href="https://en.wikipedia.org/wiki/Geohash">geohash</a> to associate
calendar event with a searchable physical location * <code>p</code>
(optional, repeated) 32-bytes hex pubkey of a participant, optional
recommended relay URL, and participant’s role in the meeting *
<code>t</code> (optional, repeated) hashtag to categorize calendar event
* <code>r</code> (optional, repeated) references / links to web pages,
documents, video calls, recorded videos, etc.</p>
<p>The following tags are deprecated: * <code>name</code> name of the
calendar event. Use only if <code>title</code> is not available.</p>
<pre class="jsonc"><code>{
  &quot;id&quot;: &lt;32-bytes lowercase hex-encoded SHA-256 of the the serialized event data&gt;,
  &quot;pubkey&quot;: &lt;32-bytes lowercase hex-encoded public key of the event creator&gt;,
  &quot;created_at&quot;: &lt;Unix timestamp in seconds&gt;,
  &quot;kind&quot;: 31923,
  &quot;content&quot;: &quot;&lt;description of calendar event&gt;&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;&lt;UUID&gt;&quot;],

    [&quot;title&quot;, &quot;&lt;title of calendar event&gt;&quot;],

    // Timestamps
    [&quot;start&quot;, &quot;&lt;Unix timestamp in seconds&gt;&quot;],
    [&quot;end&quot;, &quot;&lt;Unix timestamp in seconds&gt;&quot;],

    [&quot;start_tzid&quot;, &quot;&lt;IANA Time Zone Database identifier&gt;&quot;],
    [&quot;end_tzid&quot;, &quot;&lt;IANA Time Zone Database identifier&gt;&quot;],

    // Location
    [&quot;location&quot;, &quot;&lt;location&gt;&quot;],
    [&quot;g&quot;, &quot;&lt;geohash&gt;&quot;],

    // Participants
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;&lt;role&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;&lt;role&gt;&quot;],

    // Hashtags
    [&quot;t&quot;, &quot;&lt;tag&gt;&quot;],
    [&quot;t&quot;, &quot;&lt;tag&gt;&quot;],

    // Reference links
    [&quot;r&quot;, &quot;&lt;url&gt;&quot;],
    [&quot;r&quot;, &quot;&lt;url&gt;&quot;]
  ]
}</code></pre>
<h2 id="calendar">Calendar</h2>
<p>A calendar is a collection of calendar events, represented as a
custom replaceable list event using kind <code>31924</code>. A user can
have multiple calendars. One may create a calendar to segment calendar
events for specific purposes. e.g., personal, work, travel, meetups, and
conferences.</p>
<h3 id="format-2">Format</h3>
<p>The <code>.content</code> of these events should be a detailed
description of the calendar. It is required but can be an empty
string.</p>
<p>The format uses a custom replaceable list of kind <code>31924</code>
with a list of tags as described below: * <code>d</code> (required)
universally unique identifier. Generated by the client creating the
calendar. * <code>title</code> (required) calendar title *
<code>a</code> (repeated) reference tag to kind <code>31922</code> or
<code>31923</code> calendar event being responded to</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;</span><span class="dv">32</span><span class="er">-bytes</span> <span class="er">lowercase</span> <span class="er">hex-encoded</span> <span class="er">SHA</span><span class="dv">-256</span> <span class="er">of</span> <span class="er">the</span> <span class="er">the</span> <span class="er">serialized</span> <span class="er">event</span> <span class="er">data&gt;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="er">&lt;</span><span class="dv">32</span><span class="er">-bytes</span> <span class="er">lowercase</span> <span class="er">hex-encoded</span> <span class="er">public</span> <span class="er">key</span> <span class="er">of</span> <span class="er">the</span> <span class="er">event</span> <span class="er">creator&gt;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="er">&lt;Unix</span> <span class="er">timestamp</span> <span class="er">in</span> <span class="er">seconds&gt;</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">31924</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;description of calendar&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;UUID&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;title&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;calendar title&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;31922 or 31923&gt;:&lt;calendar event author pubkey&gt;:&lt;d-identifier of calendar event&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;optional relay url&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;31922 or 31923&gt;:&lt;calendar event author pubkey&gt;:&lt;d-identifier of calendar event&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;optional relay url&gt;&quot;</span><span class="ot">]</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="calendar-event-rsvp">Calendar Event RSVP</h2>
<p>A calendar event RSVP is a response to a calendar event to indicate a
user’s attendance intention.</p>
<p>If a calendar event tags a pubkey, that can be interpreted as the
calendar event creator inviting that user to attend. Clients MAY choose
to prompt the user to RSVP for the calendar event.</p>
<p>Any user may RSVP, even if they were not tagged on the calendar
event. Clients MAY choose to prompt the calendar event creator to invite
the user who RSVP’d. Clients also MAY choose to ignore these RSVPs.</p>
<p>This NIP is intentionally not defining who is authorized to attend a
calendar event if the user who RSVP’d has not been tagged. It is up to
the calendar event creator to determine the semantics.</p>
<p>This NIP is also intentionally not defining what happens if a
calendar event changes after an RSVP is submitted.</p>
<h3 id="format-3">Format</h3>
<p>The format uses a parameterized replaceable event kind
<code>31925</code>.</p>
<p>The <code>.content</code> of these events is optional and should be a
free-form note that adds more context to this calendar event
response.</p>
<p>The list of tags are as follows: * <code>a</code> (required)
reference tag to kind <code>31922</code> or <code>31923</code> calendar
event being responded to. * <code>d</code> (required) universally unique
identifier. Generated by the client creating the calendar event RSVP. *
<code>status</code> (required) <code>accepted</code>,
<code>declined</code>, or <code>tentative</code>. Determines attendance
status to the referenced calendar event. * <code>fb</code> (optional)
<code>free</code> or <code>busy</code>. Determines if the user would be
free or busy for the duration of the calendar event. This tag must be
omitted or ignored if the <code>status</code> label is set to
<code>declined</code>.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;</span><span class="dv">32</span><span class="er">-bytes</span> <span class="er">lowercase</span> <span class="er">hex-encoded</span> <span class="er">SHA</span><span class="dv">-256</span> <span class="er">of</span> <span class="er">the</span> <span class="er">the</span> <span class="er">serialized</span> <span class="er">event</span> <span class="er">data&gt;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="er">&lt;</span><span class="dv">32</span><span class="er">-bytes</span> <span class="er">lowercase</span> <span class="er">hex-encoded</span> <span class="er">public</span> <span class="er">key</span> <span class="er">of</span> <span class="er">the</span> <span class="er">event</span> <span class="er">creator&gt;</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="er">&lt;Unix</span> <span class="er">timestamp</span> <span class="er">in</span> <span class="er">seconds&gt;</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">31925</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;note&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;31922 or 31923&gt;:&lt;calendar event author pubkey&gt;:&lt;d-identifier of calendar event&gt;&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;optional relay url&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;UUID&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;status&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;accepted/declined/tentative&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;fb&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;free/busy&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="unsolved-limitations">Unsolved Limitations</h2>
<ul>
<li>No private events</li>
</ul>
<h2 id="intentionally-unsupported-scenarios">Intentionally Unsupported
Scenarios</h2>
<h3 id="recurring-calendar-events">Recurring Calendar Events</h3>
<p>Recurring calendar events come with a lot of complexity, making it
difficult for software and humans to deal with. This complexity includes
time zone differences between invitees, daylight savings, leap years,
multiple calendar systems, one-off changes in schedule or other
metadata, etc.</p>
<p>This NIP intentionally omits support for recurring calendar events
and pushes that complexity up to clients to manually implement if they
desire. i.e., individual calendar events with duplicated metadata
represent recurring calendar events.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>51</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-51">NIP-51</h1>
<h2 id="lists">Lists</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines lists of things that users can create. Lists can
contain references to anything, and these references can be
<strong>public</strong> or <strong>private</strong>.</p>
<p>Public items in a list are specified in the event <code>tags</code>
array, while private items are specified in a JSON array that mimics the
structure of the event <code>tags</code> array, but stringified and
encrypted using the same scheme from <a href="04.md.css.html">NIP-04</a> (the
shared key is computed using the author’s public and private key) and
stored in the <code>.content</code>.</p>
<p>When new items are added to an existing list, clients SHOULD append
them to the end of the list, so they are stored in chronological
order.</p>
<h2 id="types-of-lists">Types of lists</h2>
<h2 id="standard-lists">Standard lists</h2>
<p>Standard lists use non-parameterized replaceable events, meaning
users may only have a single list of each kind. They have special
meaning and clients may rely on them to augment a user’s profile or
browsing experience.</p>
<p>For example, <em>mute list</em> can contain the public keys of
spammers and bad actors users don’t want to see in their feeds or
receive annoying notifications from.</p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>name</th>
<th>kind</th>
<th>description</th>
<th>expected tag items</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mute list</td>
<td>10000</td>
<td>things the user doesn’t want to see in their feeds</td>
<td><code>"p"</code> (pubkeys), <code>"t"</code> (hashtags),
<code>"word"</code> (lowercase string), <code>"e"</code> (threads)</td>
</tr>
<tr class="even">
<td>Pinned notes</td>
<td>10001</td>
<td>events the user intends to showcase in their profile page</td>
<td><code>"e"</code> (kind:1 notes)</td>
</tr>
<tr class="odd">
<td>Bookmarks</td>
<td>10003</td>
<td>uncategorized, “global” list of things a user wants to save</td>
<td><code>"e"</code> (kind:1 notes), <code>"a"</code> (kind:30023
articles), <code>"t"</code> (hashtags), <code>"r"</code> (URLs)</td>
</tr>
<tr class="even">
<td>Communities</td>
<td>10004</td>
<td><a href="72.md.css.html">NIP-72</a> communities the user belongs to</td>
<td><code>"a"</code> (kind:34550 community definitions)</td>
</tr>
<tr class="odd">
<td>Public chats</td>
<td>10005</td>
<td><a href="28.md.css.html">NIP-28</a> chat channels the user is in</td>
<td><code>"e"</code> (kind:40 channel definitions)</td>
</tr>
<tr class="even">
<td>Blocked relays</td>
<td>10006</td>
<td>relays clients should never connect to</td>
<td><code>"relay"</code> (relay URLs)</td>
</tr>
<tr class="odd">
<td>Search relays</td>
<td>10007</td>
<td>relays clients should use when performing search queries</td>
<td><code>"relay"</code> (relay URLs)</td>
</tr>
<tr class="even">
<td>Simple groups</td>
<td>10009</td>
<td><a href="29.md.css.html">NIP-29</a> groups the user is in</td>
<td><code>"group"</code> (<a href="29.md.css.html">NIP-29</a> group ids +
mandatory relay URL)</td>
</tr>
<tr class="odd">
<td>Interests</td>
<td>10015</td>
<td>topics a user may be interested in and pointers</td>
<td><code>"t"</code> (hashtags) and <code>"a"</code> (kind:30015
interest set)</td>
</tr>
<tr class="even">
<td>Emojis</td>
<td>10030</td>
<td>user preferred emojis and pointers to emoji sets</td>
<td><code>"emoji"</code> (see <a href="30.md.css.html">NIP-30</a>) and
<code>"a"</code> (kind:30030 emoji set)</td>
</tr>
<tr class="odd">
<td>Good wiki authors</td>
<td>10101</td>
<td><a href="54.md.css.html">NIP-54</a> user recommended wiki authors</td>
<td><code>"p"</code> (pubkeys)</td>
</tr>
<tr class="even">
<td>Good wiki relays</td>
<td>10102</td>
<td><a href="54.md.css.html">NIP-54</a> relays deemed to only host useful
articles</td>
<td><code>"relay"</code> (relay URLs)</td>
</tr>
</tbody>
</table>
<h2 id="sets">Sets</h2>
<p>Sets are lists with well-defined meaning that can enhance the
functionality and the UI of clients that rely on them. Unlike standard
lists, users are expected to have more than one set of each kind,
therefore each of them must be assigned a different <code>"d"</code>
identifier.</p>
<p>For example, <em>relay sets</em> can be displayed in a dropdown UI to
give users the option to switch to which relays they will publish an
event or from which relays they will read the replies to an event;
<em>curation sets</em> can be used by apps to showcase curations made by
others tagged to different topics.</p>
<p>Aside from their main identifier, the <code>"d"</code> tag, sets can
optionally have a <code>"title"</code>, an <code>"image"</code> and a
<code>"description"</code> tags that can be used to enhance their
UI.</p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>name</th>
<th>kind</th>
<th>description</th>
<th>expected tag items</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Follow sets</td>
<td>30000</td>
<td>categorized groups of users a client may choose to check out in
different circumstances</td>
<td><code>"p"</code> (pubkeys)</td>
</tr>
<tr class="even">
<td>Relay sets</td>
<td>30002</td>
<td>user-defined relay groups the user can easily pick and choose from
during various operations</td>
<td><code>"relay"</code> (relay URLs)</td>
</tr>
<tr class="odd">
<td>Bookmark sets</td>
<td>30003</td>
<td>user-defined bookmarks categories , for when bookmarks must be in
labeled separate groups</td>
<td><code>"e"</code> (kind:1 notes), <code>"a"</code> (kind:30023
articles), <code>"t"</code> (hashtags), <code>"r"</code> (URLs)</td>
</tr>
<tr class="even">
<td>Curation sets</td>
<td>30004</td>
<td>groups of articles picked by users as interesting and/or belonging
to the same category</td>
<td><code>"a"</code> (kind:30023 articles), <code>"e"</code> (kind:1
notes)</td>
</tr>
<tr class="odd">
<td>Curation sets</td>
<td>30005</td>
<td>groups of videos picked by users as interesting and/or belonging to
the same category</td>
<td><code>"a"</code> (kind:34235 videos)</td>
</tr>
<tr class="even">
<td>Interest sets</td>
<td>30015</td>
<td>interest topics represented by a bunch of “hashtags”</td>
<td><code>"t"</code> (hashtags)</td>
</tr>
<tr class="odd">
<td>Emoji sets</td>
<td>30030</td>
<td>categorized emoji groups</td>
<td><code>"emoji"</code> (see <a href="30.md.css.html">NIP-30</a>)</td>
</tr>
<tr class="even">
<td>Release artifact sets</td>
<td>30063</td>
<td>groups of files of a software release</td>
<td><code>"e"</code> (kind:1063 <a href="94.md.css.html">file metadata</a>
events), <code>"i"</code> (application identifier, typically reverse
domain notation), <code>"version"</code></td>
</tr>
</tbody>
</table>
<h2 id="deprecated-standard-lists">Deprecated standard lists</h2>
<p>Some clients have used these lists in the past, but they should work
on transitioning to the <a href="#standard-lists">standard formats</a>
above.</p>
<table>
<thead>
<tr class="header">
<th>kind</th>
<th>“d” tag</th>
<th>use instead</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>30000</td>
<td><code>"mute"</code></td>
<td>kind 10000 <em>mute list</em></td>
</tr>
<tr class="even">
<td>30001</td>
<td><code>"pin"</code></td>
<td>kind 10001 <em>pin list</em></td>
</tr>
<tr class="odd">
<td>30001</td>
<td><code>"bookmark"</code></td>
<td>kind 10003 <em>bookmarks list</em></td>
</tr>
<tr class="even">
<td>30001</td>
<td><code>"communities"</code></td>
<td>kind 10004 <em>communities list</em></td>
</tr>
</tbody>
</table>
<h2 id="examples">Examples</h2>
<h3 id="a-mute-list-with-some-public-items-and-some-encrypted-items">A
<em>mute list</em> with some public items and some encrypted items</h3>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;a92a316b75e44cfdc19986c634049158d4206fcc0b7b9c7ccbcdabe28beebcd0&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;854043ae8f1f97430ca8c1f1a090bdde6488bd5115c7a45307a2a212750ae4cb&quot;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1699597889</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">10000</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;07caba282f76441955b695551c3c5c742e5b9202a3784780f8086fdcdc1da3a9&quot;</span><span class="ot">],</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;a55c15f5e41d5aebd236eca5e0142789c5385703f1a7485aa4b38d94fd18dcc4&quot;</span><span class="ot">]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;TJob1dQrf2nd.md.css.htmlbeGU+05HT5GMnBSx3fx8QdDY/g3NvCa7klfzgaQCmRZuo1d3WQjHDOjzSY1+MgTK5WjewFFumCcOZniWtOMSga9tJk1ky00tLoUUzyLnb1v9x95h/iT/KpkICJyAwUZ+LoJBUzLrK52wNTMt8M5jSLvCkRx8C0BmEwA/00pjOp4eRndy19H4WUUehhjfV2/VV/k4hMAjJ7Bb5Hp9xdmzmCLX9+64+MyeIQQjQAHPj8dkSsRahP7KS3MgMpjaF8nL48Bg5suZMxJayXGVp3BLtgRZx5z5nOk9xyrYk+71e2tnP9IDvSMkiSe76BcMct+m7kGVrRcavDI4n62goNNh25IpghT+a1OjjkpXt9me5wmaL7fxffV1pchdm+A7KJKIUU3kLC7QbUifF22EucRA9xiEyxETusNludBXN24O3llTbOy4vYFsq35BeZl4v1Cse7n2htZicVkItMz3wjzj1q1I1VqbnorNXFgllkRZn4/YXfTG/RMnoK/bDogRapOV+XToZ+IvsN0BqwKSUDx+ydKpci6htDRF2WDRkU+VQMqwM0CoLzy2H6A2cqyMMMD9SLRRzBg==?iv=S3rFeFr1gsYqmQA7bNnNTQ==&quot;</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;1173822c53261f8cffe7efbf43ba4a97a9198b3e402c2a1df130f42a8985a2d0d3430f4de350db184141e45ca844ab4e5364ea80f11d720e36357e1853dba6ca&quot;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="a-curation-set-of-articles-and-notes-about-yaks">A <em>curation
set</em> of articles and notes about yaks</h3>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;567b41fc9060c758c4216fe5f8d3df7c57daad7ae757fa4606f0c39d4dd220ef&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;d6dc95542e18b8b7aec2f14610f55c335abebec76f3db9e58c254661d0593a0c&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1695327657</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">30004</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;jvdy9i4&quot;</span><span class="ot">],</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;name&quot;</span><span class="ot">,</span> <span class="st">&quot;Yaks&quot;</span><span class="ot">],</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;picture&quot;</span><span class="ot">,</span> <span class="st">&quot;https://cdn.britannica.com/40/188540-050-9AC748DE/Yak-Himalayas-Nepal.jpg&quot;</span><span class="ot">],</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;about&quot;</span><span class="ot">,</span> <span class="st">&quot;The domestic yak, also known as the Tartary ox, grunting ox, or hairy cattle, is a species of long-haired domesticated cattle found throughout the Himalayan region of the Indian subcontinent, the Tibetan Plateau, Gilgit-Baltistan, Tajikistan and as far north as Mongolia and Siberia.&quot;</span><span class="ot">],</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;30023:26dc95542e18b8b7aec2f14610f55c335abebec76f3db9e58c254661d0593a0c:95ODQzw3ajNoZ8SyMDOzQ&quot;</span><span class="ot">],</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;30023:54af95542e18b8b7aec2f14610f55c335abebec76f3db9e58c254661d0593a0c:1-MYP8dAhramH9J5gJWKx&quot;</span><span class="ot">],</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;30023:f8fe95542e18b8b7aec2f14610f55c335abebec76f3db9e58c254661d0593a0c:D2Tbd38bGrFvU0bIbvSMt&quot;</span><span class="ot">],</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;d78ba0d5dce22bfff9db0a9e996c9ef27e2c91051de0c4e1da340e0326b4941e&quot;</span><span class="ot">]</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;a9a4e2192eede77e6c9d24ddfab95ba3ff7c03fbd07ad011fff245abea431fb4d3787c2d04aad001cb039cb8de91d83ce30e9a94f82ac3c5a2372aa1294a96bd&quot;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="a-release-artifact-set-of-an-example-app">A <em>release artifact
set</em> of an Example App</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;567b41fc9060c758c4216fe5f8d3df7c57daad7ae757fa4606f0c39d4dd220ef&quot;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;d6dc95542e18b8b7aec2f14610f55c335abebec76f3db9e58c254661d0593a0c&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1695327657</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">30063</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;ak8dy3v7&quot;</span><span class="ot">],</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;i&quot;</span><span class="ot">,</span> <span class="st">&quot;com.example.app&quot;</span><span class="ot">],</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;version&quot;</span><span class="ot">,</span> <span class="st">&quot;0.0.1&quot;</span><span class="ot">],</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;title&quot;</span><span class="ot">,</span> <span class="st">&quot;Example App&quot;</span><span class="ot">],</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;image&quot;</span><span class="ot">,</span> <span class="st">&quot;http://cdn.site/p/com.example.app/icon.png&quot;</span><span class="ot">],</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;d78ba0d5dce22bfff9db0a9e996c9ef27e2c91051de0c4e1da340e0326b4941e&quot;</span><span class="ot">],</span> <span class="er">//</span> <span class="er">Windows</span> <span class="er">exe</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;f27e2c91051de0c4e1da0d5dce22bfff9db0a9340e0326b4941ed78bae996c9e&quot;</span><span class="ot">],</span> <span class="er">//</span> <span class="er">MacOS</span> <span class="er">dmg</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;9d24ddfab95ba3ff7c03fbd07ad011fff245abea431fb4d3787c2d04aad02332&quot;</span><span class="ot">],</span> <span class="er">//</span> <span class="er">Linux</span> <span class="er">AppImage</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;340e0326b340e0326b4941ed78ba340e0326b4941ed78ba340e0326b49ed78ba&quot;</span><span class="ot">]</span> <span class="er">//</span> <span class="er">PWA</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Example App is a decentralized marketplace for apps&quot;</span><span class="fu">,</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;a9a4e2192eede77e6c9d24ddfab95ba3ff7c03fbd07ad011fff245abea431fb4d3787c2d04aad001cb039cb8de91d83ce30e9a94f82ac3c5a2372aa1294a96bd&quot;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="encryption-process-pseudocode">Encryption process
pseudocode</h2>
<div class="sourceCode" id="cb4"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> private_items <span class="op">=</span> <span class="op">[</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="st">&quot;p&quot;</span><span class="op">,</span> <span class="st">&quot;07caba282f76441955b695551c3c5c742e5b9202a3784780f8086fdcdc1da3a9&quot;</span><span class="op">],</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="st">&quot;a&quot;</span><span class="op">,</span> <span class="st">&quot;a55c15f5e41d5aebd236eca5e0142789c5385703f1a7485aa4b38d94fd18dcc4&quot;</span><span class="op">],</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> base64blob <span class="op">=</span> nip04<span class="op">.</span><span class="fu">encrypt</span><span class="op">(</span>json<span class="op">.</span><span class="fu">encode_to_string</span><span class="op">(</span>private_items<span class="op">))</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>event<span class="op">.</span>content <span class="op">=</span> base64blob</span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>50</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-50">NIP-50</h1>
<h2 id="search-capability">Search Capability</h2>
<p><code>draft</code> <code>optional</code></p>
<h2 id="abstract">Abstract</h2>
<p>Many Nostr use cases require some form of general search feature, in
addition to structured queries by tags or ids. Specifics of the search
algorithms will differ between event kinds, this NIP only describes a
general extensible framework for performing such queries.</p>
<h2 id="search-filter-field"><code>search</code> filter field</h2>
<p>A new <code>search</code> field is introduced for <code>REQ</code>
messages from clients:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;search&quot;</span><span class="fu">:</span> <span class="er">&lt;string&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><code>search</code> field is a string describing a query in a
human-readable form, i.e. “best nostr apps”. Relays SHOULD interpret the
query to the best of their ability and return events that match it.
Relays SHOULD perform matching against <code>content</code> event field,
and MAY perform matching against other fields if that makes sense in the
context of a specific kind.</p>
<p>A query string may contain <code>key:value</code> pairs (two words
separated by colon), these are extensions, relays SHOULD ignore
extensions they don’t support.</p>
<p>Clients may specify several search filters,
i.e. <code>["REQ", "", { "search": "orange" }, { "kinds": [1, 2], "search": "purple" }]</code>.
Clients may include <code>kinds</code>, <code>ids</code> and other
filter field to restrict the search results to particular event
kinds.</p>
<p>Clients SHOULD use the supported_nips field to learn if a relay
supports <code>search</code> filter. Clients MAY send
<code>search</code> filter queries to any relay, if they are prepared to
filter out extraneous responses from relays that do not support this
NIP.</p>
<p>Clients SHOULD query several relays supporting this NIP to compensate
for potentially different implementation details between relays.</p>
<p>Clients MAY verify that events returned by a relay match the
specified query in a way that suits the client’s use case, and MAY stop
querying relays that have low precision.</p>
<p>Relays SHOULD exclude spam from search results by default if they
support some form of spam filtering.</p>
<h2 id="extensions">Extensions</h2>
<p>Relay MAY support these extensions: - <code>include:spam</code> -
turn off spam filtering, if it was enabled by default -
<code>domain:&lt;domain&gt;</code> - include only events from users
whose valid nip05 domain matches the domain -
<code>language:&lt;two letter ISO 639-1 language code&gt;</code> -
include only events of a specified language -
<code>sentiment:&lt;negative/neutral/positive&gt;</code> - include only
events of a specific sentiment - <code>nsfw:&lt;true/false&gt;</code> -
include or exclude nsfw events (default: true)</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>49</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-49">NIP-49</h1>
<h2 id="private-key-encryption">Private Key Encryption</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines a method by which clients can encrypt (and decrypt)
a user’s private key with a password.</p>
<h2 id="symmetric-encryption-key-derivation">Symmetric Encryption Key
derivation</h2>
<p>PASSWORD = Read from the user. The password should be unicode
normalized to NFKC format to ensure that the password can be entered
identically on other computers/clients.</p>
<p>LOG_N = Let the user or implementer choose one byte representing a
power of 2 (e.g. 18 represents 262,144) which is used as the number of
rounds for scrypt. Larger numbers take more time and more memory, and
offer better protection:</p>
<pre><code>| LOG_N | MEMORY REQUIRED | APPROX TIME ON FAST COMPUTER |
|-------|-----------------|----------------------------- |
| 16    | 64 MiB          | 100 ms                       |
| 18    | 256 MiB         |                              |
| 20    | 1 GiB           | 2 seconds                    |
| 21    | 2 GiB           |                              |
| 22    | 4 GiB           |                              |</code></pre>
<p>SALT = 16 random bytes</p>
<p>SYMMETRIC_KEY = scrypt(password=PASSWORD, salt=SALT, log_n=LOG_N,
r=8, p=1)</p>
<p>The symmetric key should be 32 bytes long.</p>
<p>This symmetric encryption key is temporary and should be zeroed and
discarded after use and not stored or reused for any other purpose.</p>
<h2 id="encrypting-a-private-key">Encrypting a private key</h2>
<p>The private key encryption process is as follows:</p>
<p>PRIVATE_KEY = User’s private (secret) secp256k1 key as 32 raw bytes
(not hex or bech32 encoded!)</p>
<p>KEY_SECURITY_BYTE = one of:</p>
<ul>
<li>0x00 - if the key has been known to have been handled insecurely
(stored unencrypted, cut and paste unencrypted, etc)</li>
<li>0x01 - if the key has NOT been known to have been handled insecurely
(stored unencrypted, cut and paste unencrypted, etc)</li>
<li>0x02 - if the client does not track this data</li>
</ul>
<p>ASSOCIATED_DATA = KEY_SECURITY_BYTE</p>
<p>NONCE = 24 byte random nonce</p>
<p>CIPHERTEXT = XChaCha20-Poly1305( plaintext=PRIVATE_KEY,
associated_data=ASSOCIATED_DATA, nonce=NONCE, key=SYMMETRIC_KEY )</p>
<p>VERSION_NUMBER = 0x02</p>
<p>CIPHERTEXT_CONCATENATION = concat( VERSION_NUMBER, LOG_N, SALT,
NONCE, ASSOCIATED_DATA, CIPHERTEXT )</p>
<p>ENCRYPTED_PRIVATE_KEY = bech32_encode(‘ncryptsec’,
CIPHERTEXT_CONCATENATION)</p>
<p>The output prior to bech32 encoding should be 91 bytes long.</p>
<p>The decryption process operates in the reverse.</p>
<h2 id="test-data">Test Data</h2>
<h2 id="password-unicode-normalization">Password Unicode
Normalization</h2>
<p>The following password input: “ÅΩẛ̣” - Unicode Codepoints: U+212B
U+2126 U+1E9B U+0323 - UTF-8 bytes: [0xE2, 0x84, 0xAB, 0xE2, 0x84, 0xA6,
0xE1, 0xBA, 0x9B, 0xCC, 0xA3]</p>
<p>Should be converted into the unicode normalized NFKC format prior to
use in scrypt: “ÅΩẛ̣” - Unicode Codepoints: U+00C5 U+03A9 U+1E69 - UTF-8
bytes: [0xC3, 0x85, 0xCE, 0xA9, 0xE1, 0xB9, 0xA9]</p>
<h2 id="encryption">Encryption</h2>
<p>The encryption process is non-deterministic due to the random
nonce.</p>
<h2 id="decryption">Decryption</h2>
<p>The following encrypted private key:</p>
<p><code>ncryptsec1qgg9947rlpvqu76pj5ecreduf9jxhselq2nae2kghhvd5g7dgjtcxfqtd67p9m0w57lspw8gsq6yphnm8623nsl8xn9j4jdzz84zm3frztj3z7s35vpzmqf6ksu8r89qk5z2zxfmu5gv8th8wclt0h4p</code></p>
<p>When decrypted with password=‘nostr’ and log_n=16 yields the
following hex-encoded private key:</p>
<p><code>3501454135014541350145413501453fefb02227e449e57cf4d3a3ce05378683</code></p>
<h2 id="discussion">Discussion</h2>
<h3 id="on-key-derivation">On Key Derivation</h3>
<p>Passwords make poor cryptographic keys. Prior to use as a
cryptographic key, two things need to happen:</p>
<ol type="1">
<li>An encryption key needs to be deterministically created from the
password such that is has a uniform functionally random distribution of
bits, such that the symmetric encryption algorithm’s assumptions are
valid, and</li>
<li>A slow irreversible algorithm should be injected into the process,
so that brute-force attempts to decrypt by trying many passwords are
severely hampered.</li>
</ol>
<p>These are achieved using a password-based key derivation function. We
use scrypt, which has been proven to be maximally memory hard and which
several cryptographers have indicated to the author is better than
argon2 even though argon2 won a competition in 2015.</p>
<h3 id="on-the-symmetric-encryption-algorithm">On the symmetric
encryption algorithm</h3>
<p>XChaCha20-Poly1305 is typically favored by cryptographers over AES
and is less associated with the U.S. government. It (or it’s earlier
variant without the ‘X’) is gaining wide usage, is used in TLS and
OpenSSH, and is available in most modern crypto libraries.</p>
<h2 id="recommendations">Recommendations</h2>
<p>It is not recommended that users publish these encrypted private keys
to nostr, as cracking a key may become easier when an attacker can amass
many encrypted private keys.</p>
<p>It is recommended that clients zero out the memory of passwords and
private keys before freeing that memory.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>48</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-48">NIP-48</h1>
<h2 id="proxy-tags">Proxy Tags</h2>
<p><code>draft</code> <code>optional</code></p>
<p>Nostr events bridged from other protocols such as ActivityPub can
link back to the source object by including a <code>"proxy"</code> tag,
in the form:</p>
<pre><code>[&quot;proxy&quot;, &lt;id&gt;, &lt;protocol&gt;]</code></pre>
<p>Where:</p>
<ul>
<li><code>&lt;id&gt;</code> is the ID of the source object. The ID
format varies depending on the protocol. The ID must be universally
unique, regardless of the protocol.</li>
<li><code>&lt;protocol&gt;</code> is the name of the protocol,
e.g. <code>"activitypub"</code>.</li>
</ul>
<p>Clients may use this information to reconcile duplicated content
bridged from other protocols, or to display a link to the source
object.</p>
<p>Proxy tags may be added to any event kind, and doing so indicates
that the event did not originate on the Nostr protocol, and instead
originated elsewhere on the web.</p>
<h3 id="supported-protocols">Supported protocols</h3>
<p>This list may be extended in the future.</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 37%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="header">
<th>Protocol</th>
<th>ID format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>activitypub</code></td>
<td>URL</td>
<td><code>https://gleasonator.com/objects/9f524868-c1a0-4ee7-ad51-aaa23d68b526</code></td>
</tr>
<tr class="even">
<td><code>atproto</code></td>
<td>AT URI</td>
<td><code>at://did:plc:zhbjlbmir5dganqhueg7y4i3/app.bsky.feed.post/3jt5hlibeol2i</code></td>
</tr>
<tr class="odd">
<td><code>rss</code></td>
<td>URL with guid fragment</td>
<td><code>https://soapbox.pub/rss/feed.xml#https%3A%2F%2Fsoapbox.pub%2Fblog%2Fmostr-fediverse-nostr-bridge</code></td>
</tr>
<tr class="even">
<td><code>web</code></td>
<td>URL</td>
<td><code>https://twitter.com/jack/status/20</code></td>
</tr>
</tbody>
</table>
<h3 id="examples">Examples</h3>
<p>ActivityPub object:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;I&#39;m vegan btw&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;proxy&quot;</span><span class="ot">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;https://gleasonator.com/objects/8f6fac53-4f66-4c6e-ac7d-92e5e78c3e79&quot;</span><span class="ot">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;activitypub&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;79c2cae114ea28a981e7559b4fe7854a473521a8d22a66bbab9fa248eb820ff6&quot;</span><span class="fu">,</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1691091365</span><span class="fu">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;55920b758b9c7b17854b6e3d44e6a02a83d1cb49e1227e75a30426dea94d4cb2&quot;</span><span class="fu">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;a72f12c08f18e85d98fb92ae89e2fe63e48b8864c5e10fbdd5335f3c9f936397a6b0a7350efe251f8168b1601d7012d4a6d0ee6eec958067cf22a14f5a5ea579&quot;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="see-also">See also</h3>
<ul>
<li><a
href="https://codeberg.org/fediverse/fep/src/branch/main/fep/fffd/fep-fffd.md.css.html">FEP-fffd:
Proxy Objects</a></li>
<li><a href="https://mostr.pub/">Mostr bridge</a></li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>47</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-47">NIP-47</h1>
<h2 id="nostr-wallet-connect">Nostr Wallet Connect</h2>
<p><code>draft</code> <code>optional</code></p>
<h2 id="rationale">Rationale</h2>
<p>This NIP describes a way for clients to access a remote Lightning
wallet through a standardized protocol. Custodians may implement this,
or the user may run a bridge that bridges their wallet/node and the
Nostr Wallet Connect protocol.</p>
<h2 id="terms">Terms</h2>
<ul>
<li><strong>client</strong>: Nostr app on any platform that wants to pay
Lightning invoices.</li>
<li><strong>user</strong>: The person using the <strong>client</strong>,
and want’s to connect their wallet app to their
<strong>client</strong>.</li>
<li><strong>wallet service</strong>: Nostr app that typically runs on an
always-on computer (eg. in the cloud or on a Raspberry Pi). This app has
access to the APIs of the wallets it serves.</li>
</ul>
<h2 id="theory-of-operation">Theory of Operation</h2>
<ol type="1">
<li><p><strong>Users</strong> who wish to use this NIP to send lightning
payments to other nostr users must first acquire a special “connection”
URI from their NIP-47 compliant wallet application. The wallet
application may provide this URI using a QR screen, or a pasteable
string, or some other means.</p></li>
<li><p>The <strong>user</strong> should then copy this URI into their
<strong>client(s)</strong> by pasting, or scanning the QR, etc. The
<strong>client(s)</strong> should save this URI and use it later
whenever the <strong>user</strong> makes a payment. The
<strong>client</strong> should then request an <code>info</code> (13194)
event from the relay(s) specified in the URI. The <strong>wallet
service</strong> will have sent that event to those relays earlier, and
the relays will hold it as a replaceable event.</p></li>
<li><p>When the <strong>user</strong> initiates a payment their nostr
<strong>client</strong> create a <code>pay_invoice</code> request,
encrypts it using a token from the URI, and sends it (kind 23194) to the
relay(s) specified in the connection URI. The <strong>wallet
service</strong> will be listening on those relays and will decrypt the
request and then contact the <strong>user’s</strong> wallet application
to send the payment. The <strong>wallet service</strong> will know how
to talk to the wallet application because the connection URI specified
relay(s) that have access to the wallet app API.</p></li>
<li><p>Once the payment is complete the <strong>wallet service</strong>
will send an encrypted <code>response</code> (kind 23195) to the
<strong>user</strong> over the relay(s) in the URI.</p></li>
</ol>
<h2 id="events">Events</h2>
<p>There are three event kinds: - <code>NIP-47 info event</code>: 13194
- <code>NIP-47 request</code>: 23194 - <code>NIP-47 response</code>:
23195</p>
<p>The info event should be a replaceable event that is published by the
<strong>wallet service</strong> on the relay to indicate which commands
it supports. The content should be a plaintext string with the supported
commands, space-separated, eg. <code>pay_invoice get_balance</code>.
Only the <code>pay_invoice</code> command is described in this NIP, but
other commands might be defined in different NIPs.</p>
<p>Both the request and response events SHOULD contain one
<code>p</code> tag, containing the public key of the <strong>wallet
service</strong> if this is a request, and the public key of the
<strong>user</strong> if this is a response. The response event SHOULD
contain an <code>e</code> tag with the id of the request event it is
responding to. Optionally, a request can have an <code>expiration</code>
tag that has a unix timestamp in seconds. If the request is received
after this timestamp, it should be ignored.</p>
<p>The content of requests and responses is encrypted with <a
href="https://github.com/nostr-protocol/nips/blob/master/04.md.css.html">NIP04</a>,
and is a JSON-RPCish object with a semi-fixed structure:</p>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;pay_invoice&quot;, // method, string
    &quot;params&quot;: { // params, object
        &quot;invoice&quot;: &quot;lnbc50n1...&quot; // command-related data
    }
}</code></pre>
<p>Response:</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;pay_invoice&quot;, //indicates the structure of the result field
    &quot;error&quot;: { //object, non-null in case of error
        &quot;code&quot;: &quot;UNAUTHORIZED&quot;, //string error code, see below
        &quot;message&quot;: &quot;human readable error message&quot;
    },
    &quot;result&quot;: { // result, object. null in case of error.
        &quot;preimage&quot;: &quot;0123456789abcdef...&quot; // command-related data
    }
}</code></pre>
<p>The <code>result_type</code> field MUST contain the name of the
method that this event is responding to. The <code>error</code> field
MUST contain a <code>message</code> field with a human readable error
message and a <code>code</code> field with the error code if the command
was not successful. If the command was successful, the
<code>error</code> field must be null.</p>
<h3 id="error-codes">Error codes</h3>
<ul>
<li><code>RATE_LIMITED</code>: The client is sending commands too fast.
It should retry in a few seconds.</li>
<li><code>NOT_IMPLEMENTED</code>: The command is not known or is
intentionally not implemented.</li>
<li><code>INSUFFICIENT_BALANCE</code>: The wallet does not have enough
funds to cover a fee reserve or the payment amount.</li>
<li><code>QUOTA_EXCEEDED</code>: The wallet has exceeded its spending
quota.</li>
<li><code>RESTRICTED</code>: This public key is not allowed to do this
operation.</li>
<li><code>UNAUTHORIZED</code>: This public key has no wallet
connected.</li>
<li><code>INTERNAL</code>: An internal error.</li>
<li><code>OTHER</code>: Other error.</li>
</ul>
<h2 id="nostr-wallet-connect-uri">Nostr Wallet Connect URI</h2>
<p><strong>client</strong> discovers <strong>wallet service</strong> by
scanning a QR code, handling a deeplink or pasting in a URI.</p>
<p>The <strong>wallet service</strong> generates this connection URI
with protocol <code>nostr+walletconnect://</code> and base path it’s
hex-encoded <code>pubkey</code> with the following query string
parameters:</p>
<ul>
<li><code>relay</code> Required. URL of the relay where the
<strong>wallet service</strong> is connected and will be listening for
events. May be more than one.</li>
<li><code>secret</code> Required. 32-byte randomly generated hex encoded
string. The <strong>client</strong> MUST use this to sign events and
encrypt payloads when communicating with the <strong>wallet
service</strong>.
<ul>
<li>Authorization does not require passing keys back and forth.</li>
<li>The user can have different keys for different applications. Keys
can be revoked and created at will and have arbitrary constraints (eg.
budgets).</li>
<li>The key is harder to leak since it is not shown to the user and
backed up.</li>
<li>It improves privacy because the user’s main key would not be linked
to their payments.</li>
</ul></li>
<li><code>lud16</code> Recommended. A lightning address that clients can
use to automatically setup the <code>lud16</code> field on the user’s
profile if they have none configured.</li>
</ul>
<p>The <strong>client</strong> should then store this connection and use
it when the user wants to perform actions like paying an invoice. Due to
this NIP using ephemeral events, it is recommended to pick relays that
do not close connections on inactivity to not drop events.</p>
<h3 id="example-connection-string">Example connection string</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nostr+walletconnect://b889ff5b1513b641e2a139f661a661364979c5beee91842f8f0ef42ab558e9d4?relay=wss%3A%2F%2Frelay.damus.io</span><span class="kw">&amp;</span><span class="va">secret</span><span class="op">=</span>71a8c14c1407c113601079c4302dab36460f0ccd0ad506f1f2dc73b5100e4f3c</span></code></pre></div>
<h2 id="commands">Commands</h2>
<h3 id="pay_invoice"><code>pay_invoice</code></h3>
<p>Description: Requests payment of an invoice.</p>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;pay_invoice&quot;,
    &quot;params&quot;: {
        &quot;invoice&quot;: &quot;lnbc50n1...&quot;, // bolt11 invoice
        &quot;amount&quot;: 123, // invoice amount in msats, optional
    }
}</code></pre>
<p>Response:</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;pay_invoice&quot;,
    &quot;result&quot;: {
        &quot;preimage&quot;: &quot;0123456789abcdef...&quot; // preimage of the payment
    }
}</code></pre>
<p>Errors: - <code>PAYMENT_FAILED</code>: The payment failed. This may
be due to a timeout, exhausting all routes, insufficient capacity or
similar.</p>
<h3 id="multi_pay_invoice"><code>multi_pay_invoice</code></h3>
<p>Description: Requests payment of multiple invoices.</p>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;multi_pay_invoice&quot;,
    &quot;params&quot;: {
        &quot;invoices&quot;: [
          {&quot;id&quot;:&quot;4da52c32a1&quot;, &quot;invoice&quot;: &quot;lnbc1...&quot;, &quot;amount&quot;: 123}, // bolt11 invoice and amount in msats, amount is optional
          {&quot;id&quot;:&quot;3da52c32a1&quot;, &quot;invoice&quot;: &quot;lnbc50n1...&quot;},
        ],
    }
}</code></pre>
<p>Response:</p>
<p>For every invoice in the request, a separate response event is sent.
To differentiate between the responses, each response event contains an
<code>d</code> tag with the id of the invoice it is responding to, if no
id was given, then the payment hash of the invoice should be used.</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;multi_pay_invoice&quot;,
    &quot;result&quot;: {
        &quot;preimage&quot;: &quot;0123456789abcdef...&quot; // preimage of the payment
    }
}</code></pre>
<p>Errors: - <code>PAYMENT_FAILED</code>: The payment failed. This may
be due to a timeout, exhausting all routes, insufficient capacity or
similar.</p>
<h3 id="pay_keysend"><code>pay_keysend</code></h3>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;pay_keysend&quot;,
    &quot;params&quot;: {
        &quot;amount&quot;: 123, // invoice amount in msats, required
        &quot;pubkey&quot;: &quot;03...&quot;, // payee pubkey, required
        &quot;preimage&quot;: &quot;0123456789abcdef...&quot;, // preimage of the payment, optional
        &quot;tlv_records: [ // tlv records, optional
            {
                &quot;type&quot;: 5482373484, // tlv type
                &quot;value&quot;: &quot;0123456789abcdef&quot; // hex encoded tlv value
            }
        ]
    }
}</code></pre>
<p>Response:</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;pay_keysend&quot;,
    &quot;result&quot;: {
        &quot;preimage&quot;: &quot;0123456789abcdef...&quot;, // preimage of the payment
    }
}</code></pre>
<p>Errors: - <code>PAYMENT_FAILED</code>: The payment failed. This may
be due to a timeout, exhausting all routes, insufficient capacity or
similar.</p>
<h3 id="multi_pay_keysend"><code>multi_pay_keysend</code></h3>
<p>Description: Requests multiple keysend payments.</p>
<p>Has an array of keysends, these follow the same semantics as
<code>pay_keysend</code>, just done in a batch</p>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;multi_pay_keysend&quot;,
    &quot;params&quot;: {
        &quot;keysends&quot;: [
          {&quot;id&quot;: &quot;4c5b24a351&quot;, pubkey&quot;: &quot;03...&quot;, &quot;amount&quot;: 123},
          {&quot;id&quot;: &quot;3da52c32a1&quot;, &quot;pubkey&quot;: &quot;02...&quot;, &quot;amount&quot;: 567, &quot;preimage&quot;: &quot;abc123..&quot;, &quot;tlv_records&quot;: [{&quot;type&quot;: 696969, &quot;value&quot;: &quot;77616c5f6872444873305242454d353736&quot;}]},
        ],
    }
}</code></pre>
<p>Response:</p>
<p>For every keysend in the request, a separate response event is sent.
To differentiate between the responses, each response event contains an
<code>d</code> tag with the id of the keysend it is responding to, if no
id was given, then the pubkey should be used.</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;multi_pay_keysend&quot;,
    &quot;result&quot;: {
        &quot;preimage&quot;: &quot;0123456789abcdef...&quot; // preimage of the payment
    }
}</code></pre>
<p>Errors: - <code>PAYMENT_FAILED</code>: The payment failed. This may
be due to a timeout, exhausting all routes, insufficient capacity or
similar.</p>
<h3 id="make_invoice"><code>make_invoice</code></h3>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;make_invoice&quot;,
    &quot;params&quot;: {
        &quot;amount&quot;: 123, // value in msats
        &quot;description&quot;: &quot;string&quot;, // invoice&#39;s description, optional
        &quot;description_hash&quot;: &quot;string&quot;, // invoice&#39;s description hash, optional
        &quot;expiry&quot;: 213 // expiry in seconds from time invoice is created, optional
    }
}</code></pre>
<p>Response:</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;make_invoice&quot;,
    &quot;result&quot;: {
        &quot;type&quot;: &quot;incoming&quot;, // &quot;incoming&quot; for invoices, &quot;outgoing&quot; for payments
        &quot;invoice&quot;: &quot;string&quot;, // encoded invoice, optional
        &quot;description&quot;: &quot;string&quot;, // invoice&#39;s description, optional
        &quot;description_hash&quot;: &quot;string&quot;, // invoice&#39;s description hash, optional
        &quot;preimage&quot;: &quot;string&quot;, // payment&#39;s preimage, optional if unpaid
        &quot;payment_hash&quot;: &quot;string&quot;, // Payment hash for the payment
        &quot;amount&quot;: 123, // value in msats
        &quot;fees_paid&quot;: 123, // value in msats
        &quot;created_at&quot;: unixtimestamp, // invoice/payment creation time
        &quot;expires_at&quot;: unixtimestamp, // invoice expiration time, optional if not applicable
        &quot;metadata&quot;: {} // generic metadata that can be used to add things like zap/boostagram details for a payer name/comment/etc.
    }
}</code></pre>
<h3 id="lookup_invoice"><code>lookup_invoice</code></h3>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;lookup_invoice&quot;,
    &quot;params&quot;: {
        &quot;payment_hash&quot;: &quot;31afdf1..&quot;, // payment hash of the invoice, one of payment_hash or invoice is required
        &quot;invoice&quot;: &quot;lnbc50n1...&quot; // invoice to lookup
    }
}</code></pre>
<p>Response:</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;lookup_invoice&quot;,
    &quot;result&quot;: {
        &quot;type&quot;: &quot;incoming&quot;, // &quot;incoming&quot; for invoices, &quot;outgoing&quot; for payments
        &quot;invoice&quot;: &quot;string&quot;, // encoded invoice, optional
        &quot;description&quot;: &quot;string&quot;, // invoice&#39;s description, optional
        &quot;description_hash&quot;: &quot;string&quot;, // invoice&#39;s description hash, optional
        &quot;preimage&quot;: &quot;string&quot;, // payment&#39;s preimage, optional if unpaid
        &quot;payment_hash&quot;: &quot;string&quot;, // Payment hash for the payment
        &quot;amount&quot;: 123, // value in msats
        &quot;fees_paid&quot;: 123, // value in msats
        &quot;created_at&quot;: unixtimestamp, // invoice/payment creation time
        &quot;expires_at&quot;: unixtimestamp, // invoice expiration time, optional if not applicable
        &quot;settled_at&quot;: unixtimestamp, // invoice/payment settlement time, optional if unpaid
        &quot;metadata&quot;: {} // generic metadata that can be used to add things like zap/boostagram details for a payer name/comment/etc.
    }
}</code></pre>
<p>Errors: - <code>NOT_FOUND</code>: The invoice could not be found by
the given parameters.</p>
<h3 id="list_transactions"><code>list_transactions</code></h3>
<p>Lists invoices and payments. If <code>type</code> is not specified,
both invoices and payments are returned. The <code>from</code> and
<code>until</code> parameters are timestamps in seconds since epoch. If
<code>from</code> is not specified, it defaults to 0. If
<code>until</code> is not specified, it defaults to the current time.
Transactions are returned in descending order of creation time.</p>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;list_transactions&quot;,
    &quot;params&quot;: {
        &quot;from&quot;: 1693876973, // starting timestamp in seconds since epoch (inclusive), optional
        &quot;until&quot;: 1703225078, // ending timestamp in seconds since epoch (inclusive), optional
        &quot;limit&quot;: 10, // maximum number of invoices to return, optional
        &quot;offset&quot;: 0, // offset of the first invoice to return, optional
        &quot;unpaid&quot;: true, // include unpaid invoices, optional, default false
        &quot;type&quot;: &quot;incoming&quot;, // &quot;incoming&quot; for invoices, &quot;outgoing&quot; for payments, undefined for both
    }
}</code></pre>
<p>Response:</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;list_transactions&quot;,
    &quot;result&quot;: {
        &quot;transactions&quot;: [
            {
               &quot;type&quot;: &quot;incoming&quot;, // &quot;incoming&quot; for invoices, &quot;outgoing&quot; for payments
               &quot;invoice&quot;: &quot;string&quot;, // encoded invoice, optional
               &quot;description&quot;: &quot;string&quot;, // invoice&#39;s description, optional
               &quot;description_hash&quot;: &quot;string&quot;, // invoice&#39;s description hash, optional
               &quot;preimage&quot;: &quot;string&quot;, // payment&#39;s preimage, optional if unpaid
               &quot;payment_hash&quot;: &quot;string&quot;, // Payment hash for the payment
               &quot;amount&quot;: 123, // value in msats
               &quot;fees_paid&quot;: 123, // value in msats
               &quot;created_at&quot;: unixtimestamp, // invoice/payment creation time
               &quot;expires_at&quot;: unixtimestamp, // invoice expiration time, optional if not applicable
               &quot;settled_at&quot;: unixtimestamp, // invoice/payment settlement time, optional if unpaid
               &quot;metadata&quot;: {} // generic metadata that can be used to add things like zap/boostagram details for a payer name/comment/etc.
           }
        ],
    },
}</code></pre>
<h3 id="get_balance"><code>get_balance</code></h3>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;get_balance&quot;,
    &quot;params&quot;: {
    }
}</code></pre>
<p>Response:</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;get_balance&quot;,
    &quot;result&quot;: {
        &quot;balance&quot;: 10000, // user&#39;s balance in msats
    }
}</code></pre>
<h3 id="get_info"><code>get_info</code></h3>
<p>Request:</p>
<pre class="jsonc"><code>{
    &quot;method&quot;: &quot;get_info&quot;,
    &quot;params&quot;: {
    }
}</code></pre>
<p>Response:</p>
<pre class="jsonc"><code>{
    &quot;result_type&quot;: &quot;get_info&quot;,
    &quot;result&quot;: {
            &quot;alias&quot;: &quot;string&quot;,
            &quot;color&quot;: &quot;hex string&quot;,
            &quot;pubkey&quot;: &quot;hex string&quot;,
            &quot;network&quot;: &quot;string&quot;, // mainnet, testnet, signet, or regtest
            &quot;block_height&quot;: 1,
            &quot;block_hash&quot;: &quot;hex string&quot;,
            &quot;methods&quot;: [&quot;pay_invoice&quot;, &quot;get_balance&quot;, &quot;make_invoice&quot;, &quot;lookup_invoice&quot;, &quot;list_transactions&quot;, &quot;get_info&quot;], // list of supported methods for this connection
    }
}</code></pre>
<h2 id="example-pay-invoice-flow">Example pay invoice flow</h2>
<ol start="0" type="1">
<li>The user scans the QR code generated by the <strong>wallet
service</strong> with their <strong>client</strong> application, they
follow a <code>nostr+walletconnect://</code> deeplink or configure the
connection details manually.</li>
<li><strong>client</strong> sends an event to the <strong>wallet
service</strong> with kind <code>23194</code>. The content is a
<code>pay_invoice</code> request. The private key is the secret from the
connection string above.</li>
<li><strong>wallet service</strong> verifies that the author’s key is
authorized to perform the payment, decrypts the payload and sends the
payment.</li>
<li><strong>wallet service</strong> responds to the event by sending an
event with kind <code>23195</code> and content being a response either
containing an error message or a preimage.</li>
</ol>
<h2 id="using-a-dedicated-relay">Using a dedicated relay</h2>
<p>This NIP does not specify any requirements on the type of relays
used. However, if the user is using a custodial service it might make
sense to use a relay that is hosted by the custodial service. The relay
may then enforce authentication to prevent metadata leaks. Not depending
on a 3rd party relay would also improve reliability in this case.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>46</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-46---nostr-remote-signing">NIP-46 - Nostr Remote
Signing</h1>
<h2 id="rationale">Rationale</h2>
<p>Private keys should be exposed to as few systems - apps, operating
systems, devices - as possible as each system adds to the attack
surface.</p>
<p>This NIP describes a method for 2-way communication between a remote
signer and a Nostr client. The remote signer could be, for example, a
hardware device dedicated to signing Nostr events, while the client is a
normal Nostr client.</p>
<h2 id="terminology">Terminology</h2>
<ul>
<li><strong>Local keypair</strong>: A local public and private key-pair
used to encrypt content and communicate with the remote signer. Usually
created by the client application.</li>
<li><strong>Remote user pubkey</strong>: The public key that the user
wants to sign as. The remote signer has control of the private key that
matches this public key.</li>
<li><strong>Remote signer pubkey</strong>: This is the public key of the
remote signer itself. This is needed in both <code>create_account</code>
command because you don’t yet have a remote user pubkey.</li>
</ul>
<p>All pubkeys specified in this NIP are in hex format.</p>
<h2 id="initiating-a-connection">Initiating a connection</h2>
<p>To initiate a connection between a client and a remote signer there
are a few different options.</p>
<h3 id="direct-connection-initiated-by-remote-signer">Direct connection
initiated by remote signer</h3>
<p>This is most common in a situation where you have your own nsecbunker
or other type of remote signer and want to connect through a client that
supports remote signing.</p>
<p>The remote signer would provide a connection token in the form:</p>
<pre><code>bunker://&lt;remote-user-pubkey&gt;?relay=&lt;wss://relay-to-connect-on&gt;&amp;relay=&lt;wss://another-relay-to-connect-on&gt;&amp;secret=&lt;optional-secret-value&gt;</code></pre>
<p>This token is pasted into the client by the user and the client then
uses the details to connect to the remote signer via the specified
relay(s).</p>
<h3 id="direct-connection-initiated-by-the-client">Direct connection
initiated by the client</h3>
<p>In this case, basically the opposite direction of the first case, the
client provides a connection token (or encodes the token in a QR code)
and the signer initiates a connection to the client via the specified
relay(s).</p>
<pre><code>nostrconnect://&lt;local-keypair-pubkey&gt;?relay=&lt;wss://relay-to-connect-on&gt;&amp;metadata=&lt;json metadata in the form: {&quot;name&quot;:&quot;...&quot;, &quot;url&quot;: &quot;...&quot;, &quot;description&quot;: &quot;...&quot;}&gt;</code></pre>
<h2 id="the-flow">The flow</h2>
<ol type="1">
<li>Client creates a local keypair. This keypair doesn’t need to be
communicated to the user since it’s largely disposable (i.e. the user
doesn’t need to see this pubkey). Clients might choose to store it
locally and they should delete it when the user logs out.</li>
<li>Client gets the remote user pubkey (either via a
<code>bunker://</code> connection string or a NIP-05 login-flow; shown
below)</li>
<li>Clients use the local keypair to send requests to the remote signer
by <code>p</code>-tagging and encrypting to the remote user pubkey.</li>
<li>The remote signer responds to the client by <code>p</code>-tagging
and encrypting to the local keypair pubkey.</li>
</ol>
<h3 id="example-flow-for-signing-an-event">Example flow for signing an
event</h3>
<ul>
<li>Remote user pubkey (e.g. signing as)
<code>fa984bd7dbb282f07e16e7ae87b26a2a7b9b90b7246a44771f0cf5ae58018f52</code></li>
<li>Local pubkey is
<code>eff37350d839ce3707332348af4549a96051bd695d3223af4aabce4993531d86</code></li>
</ul>
<h4 id="signature-request">Signature request</h4>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">24133</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;eff37350d839ce3707332348af4549a96051bd695d3223af4aabce4993531d86&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="er">nip04(</span><span class="fu">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;random_string&gt;</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;method&quot;</span><span class="fu">:</span> <span class="st">&quot;sign_event&quot;</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;params&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">json_stringified(&lt;</span><span class="fu">{</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>            <span class="er">content</span><span class="fu">:</span> <span class="st">&quot;Hello, I&#39;m signing remotely&quot;</span><span class="fu">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            <span class="er">kind</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            <span class="er">tags</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="er">created_at</span><span class="fu">:</span> <span class="dv">1714078911</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="er">&gt;)</span><span class="ot">]</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="er">)</span><span class="fu">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;fa984bd7dbb282f07e16e7ae87b26a2a7b9b90b7246a44771f0cf5ae58018f52&quot;</span><span class="ot">]]</span><span class="fu">,</span> <span class="er">//</span> <span class="er">p-tags</span> <span class="er">the</span> <span class="er">remote</span> <span class="er">user</span> <span class="er">pubkey</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-event">Response event</h4>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">24133</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;fa984bd7dbb282f07e16e7ae87b26a2a7b9b90b7246a44771f0cf5ae58018f52&quot;</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="er">nip04(</span><span class="fu">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;random_string&gt;</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;result&quot;</span><span class="fu">:</span> <span class="er">json_stringified(&lt;signed-event&gt;)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="er">)</span><span class="fu">,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;eff37350d839ce3707332348af4549a96051bd695d3223af4aabce4993531d86&quot;</span><span class="ot">]]</span><span class="fu">,</span> <span class="er">//</span> <span class="er">p-tags</span> <span class="er">the</span> <span class="er">local</span> <span class="er">keypair</span> <span class="er">pubkey</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="diagram">Diagram</h4>
<figure>
<img src="https://i.nostr.build/P3gW.png" alt="signing-example" />
<figcaption aria-hidden="true">signing-example</figcaption>
</figure>
<h2 id="request-events-kind-24133">Request Events
<code>kind: 24133</code></h2>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;id&gt;</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">24133</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="er">&lt;local_keypair_pubkey&gt;</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="er">&lt;nip04(&lt;request&gt;)&gt;</span><span class="fu">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;remote_user_pubkey&gt;</span><span class="ot">]]</span><span class="fu">,</span> <span class="er">//</span> <span class="er">NB</span><span class="fu">:</span> <span class="er">in</span> <span class="er">the</span> <span class="er">`create_account`</span> <span class="er">event</span><span class="fu">,</span> <span class="er">the</span> <span class="er">remote</span> <span class="er">signer</span> <span class="er">pubkey</span> <span class="er">should</span> <span class="er">be</span> <span class="er">`p`</span> <span class="er">tagged.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="er">&lt;unix</span> <span class="er">timestamp</span> <span class="er">in</span> <span class="er">seconds&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The <code>content</code> field is a JSON-RPC-like message that is <a
href="https://github.com/nostr-protocol/nips/blob/master/04.md.css.html">NIP-04</a>
encrypted and has the following structure:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;random_string&gt;</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;method&quot;</span><span class="fu">:</span> <span class="er">&lt;method_name&gt;</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;params&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">array_of_strings</span><span class="ot">]</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><code>id</code> is a random string that is a request ID. This same
ID will be sent back in the response payload.</li>
<li><code>method</code> is the name of the method/command (detailed
below).</li>
<li><code>params</code> is a positional array of string parameters.</li>
</ul>
<h3 id="methodscommands">Methods/Commands</h3>
<p>Each of the following are methods that the client sends to the remote
signer.</p>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 34%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Params</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>connect</code></td>
<td><code>[&lt;remote_user_pubkey&gt;, &lt;optional_secret&gt;, &lt;optional_requested_permissions&gt;]</code></td>
<td>“ack”</td>
</tr>
<tr class="even">
<td><code>sign_event</code></td>
<td><code>[&lt;{kind, content, tags, created_at}&gt;]</code></td>
<td><code>json_stringified(&lt;signed_event&gt;)</code></td>
</tr>
<tr class="odd">
<td><code>ping</code></td>
<td><code>[]</code></td>
<td>“pong”</td>
</tr>
<tr class="even">
<td><code>get_relays</code></td>
<td><code>[]</code></td>
<td><code>json_stringified({&lt;relay_url&gt;: {read: &lt;boolean&gt;, write: &lt;boolean&gt;}})</code></td>
</tr>
<tr class="odd">
<td><code>get_public_key</code></td>
<td><code>[]</code></td>
<td><code>&lt;hex-pubkey&gt;</code></td>
</tr>
<tr class="even">
<td><code>nip04_encrypt</code></td>
<td><code>[&lt;third_party_pubkey&gt;, &lt;plaintext_to_encrypt&gt;]</code></td>
<td><code>&lt;nip04_ciphertext&gt;</code></td>
</tr>
<tr class="odd">
<td><code>nip04_decrypt</code></td>
<td><code>[&lt;third_party_pubkey&gt;, &lt;nip04_ciphertext_to_decrypt&gt;]</code></td>
<td><code>&lt;plaintext&gt;</code></td>
</tr>
<tr class="even">
<td><code>nip44_encrypt</code></td>
<td><code>[&lt;third_party_pubkey&gt;, &lt;plaintext_to_encrypt&gt;]</code></td>
<td><code>&lt;nip44_ciphertext&gt;</code></td>
</tr>
<tr class="odd">
<td><code>nip44_decrypt</code></td>
<td><code>[&lt;third_party_pubkey&gt;, &lt;nip44_ciphertext_to_decrypt&gt;]</code></td>
<td><code>&lt;plaintext&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="requested-permissions">Requested permissions</h3>
<p>The <code>connect</code> method may be provided with
<code>optional_requested_permissions</code> for user convenience. The
permissions are a comma-separated list of <code>method[:params]</code>,
i.e. <code>nip04_encrypt,sign_event:4</code> meaning permissions to call
<code>nip04_encrypt</code> and to call <code>sign_event</code> with
<code>kind:4</code>. Optional parameter for <code>sign_event</code> is
the kind number, parameters for other methods are to be defined
later.</p>
<h2 id="response-events-kind24133">Response Events
<code>kind:24133</code></h2>
<div class="sourceCode" id="cb7"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;id&gt;</span><span class="fu">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">24133</span><span class="fu">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="er">&lt;remote_signer_pubkey&gt;</span><span class="fu">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="er">&lt;nip04(&lt;response&gt;)&gt;</span><span class="fu">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;local_keypair_pubkey&gt;</span><span class="ot">]]</span><span class="fu">,</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="er">&lt;unix</span> <span class="er">timestamp</span> <span class="er">in</span> <span class="er">seconds&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The <code>content</code> field is a JSON-RPC-like message that is <a
href="https://github.com/nostr-protocol/nips/blob/master/04.md.css.html">NIP-04</a>
encrypted and has the following structure:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;request_id&gt;</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;result&quot;</span><span class="fu">:</span> <span class="er">&lt;results_string&gt;</span><span class="fu">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="er">&lt;optional_error_string&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><code>id</code> is the request ID that this response is for.</li>
<li><code>results</code> is a string of the result of the call (this can
be either a string or a JSON stringified object)</li>
<li><code>error</code>, <em>optionally</em>, it is an error in string
form, if any. Its presence indicates an error with the request.</li>
</ul>
<h3 id="auth-challenges">Auth Challenges</h3>
<p>An Auth Challenge is a response that a remote signer can send back
when it needs the user to authenticate via other means. This is
currently used in the OAuth-like flow enabled by signers like <a
href="https://github.com/kind-0/nsecbunkerd/">Nsecbunker</a>. The
response <code>content</code> object will take the following form:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;request_id&gt;</span><span class="fu">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;result&quot;</span><span class="fu">:</span> <span class="st">&quot;auth_url&quot;</span><span class="fu">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="er">&lt;URL_to_display_to_end_user&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Clients should display (in a popup or new tab) the URL from the
<code>error</code> field and then subscribe/listen for another response
from the remote signer (reusing the same request ID). This event will be
sent once the user authenticates in the other window (or will never
arrive if the user doesn’t authenticate). It’s also possible to add a
<code>redirect_uri</code> url parameter to the auth_url, which is
helpful in situations when a client cannot open a new window or tab to
display the auth challenge.</p>
<h4 id="example-event-signing-request-with-auth-challenge">Example event
signing request with auth challenge</h4>
<figure>
<img src="https://i.nostr.build/W3aj.png"
alt="signing-example-with-auth-challenge" />
<figcaption
aria-hidden="true">signing-example-with-auth-challenge</figcaption>
</figure>
<h2 id="remote-signer-commands">Remote Signer Commands</h2>
<p>Remote signers might support additional commands when communicating
directly with it. These commands follow the same flow as noted above,
the only difference is that when the client sends a request event, the
<code>p</code>-tag is the pubkey of the remote signer itself and the
<code>content</code> payload is encrypted to the same remote signer
pubkey.</p>
<h3 id="methodscommands-1">Methods/Commands</h3>
<p>Each of the following are methods that the client sends to the remote
signer.</p>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 44%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Params</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>create_account</code></td>
<td><code>[&lt;username&gt;, &lt;domain&gt;, &lt;optional_email&gt;, &lt;optional_requested_permissions&gt;]</code></td>
<td><code>&lt;newly_created_remote_user_pubkey&gt;</code></td>
</tr>
</tbody>
</table>
<h2 id="appendix">Appendix</h2>
<h3 id="nip-05-login-flow">NIP-05 Login Flow</h3>
<p>Clients might choose to present a more familiar login flow, so users
can type a NIP-05 address instead of a <code>bunker://</code>
string.</p>
<p>When the user types a NIP-05 the client:</p>
<ul>
<li>Queries the <code>/.well-known/nostr.json</code> file from the
domain for the NIP-05 address provided to get the user’s pubkey (this is
the <strong>remote user pubkey</strong>)</li>
<li>In the same <code>/.well-known/nostr.json</code> file, queries for
the <code>nip46</code> key to get the relays that the remote signer will
be listening on.</li>
<li>Now the client has enough information to send commands to the remote
signer on behalf of the user.</li>
</ul>
<h3 id="oauth-like-flow">OAuth-like Flow</h3>
<h4 id="remote-signer-discovery-via-nip-89">Remote signer discovery via
NIP-89</h4>
<p>In this last case, most often used to facilitate an OAuth-like signin
flow, the client first looks for remote signers that have announced
themselves via NIP-89 application handler events.</p>
<p>First the client will query for <code>kind: 31990</code> events that
have a <code>k</code> tag of <code>24133</code>.</p>
<p>These are generally shown to a user, and once the user selects which
remote signer to use and provides the remote user pubkey they want to
use (via npub, pubkey, or nip-05 value), the client can initiate a
connection. Note that it’s on the user to select the remote signer that
is actually managing the remote key that they would like to use in this
case. If the remote user pubkey is managed on another remote signer, the
connection will fail.</p>
<p>In addition, it’s important that clients validate that the pubkey of
the announced remote signer matches the pubkey of the <code>_</code>
entry in the <code>/.well-known/nostr.json</code> file of the remote
signer’s announced domain.</p>
<p>Clients that allow users to create new accounts should also consider
validating the availability of a given username in the namespace of
remote signer’s domain by checking the
<code>/.well-known/nostr.json</code> file for existing usernames.
Clients can then show users feedback in the UI before sending a
<code>create_account</code> event to the remote signer and receiving an
error in return. Ideally, remote signers would also respond with
understandable error messages if a client tries to create an account
with an existing username.</p>
<h4
id="example-oauth-like-flow-to-create-a-new-user-account-with-nsecbunker">Example
Oauth-like flow to create a new user account with Nsecbunker</h4>
<p>Coming soon…</p>
<h2 id="references">References</h2>
<ul>
<li><a
href="https://github.com/nostr-protocol/nips/blob/master/04.md.css.html">NIP-04 -
Encryption</a></li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>45</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-45">NIP-45</h1>
<h2 id="event-counts">Event Counts</h2>
<p><code>draft</code> <code>optional</code></p>
<p>Relays may support the verb <code>COUNT</code>, which provides a
mechanism for obtaining event counts.</p>
<h2 id="motivation">Motivation</h2>
<p>Some queries a client may want to execute against connected relays
are prohibitively expensive, for example, in order to retrieve follower
counts for a given pubkey, a client must query all kind-3 events
referring to a given pubkey only to count them. The result may be
cached, either by a client or by a separate indexing server as an
alternative, but both options erode the decentralization of the network
by creating a second-layer protocol on top of Nostr.</p>
<h2 id="filters-and-return-values">Filters and return values</h2>
<p>This NIP defines the verb <code>COUNT</code>, which accepts a
subscription id and filters as specified in <a href="01.md.css.html">NIP 01</a>
for the verb <code>REQ</code>. Multiple filters are OR’d together and
aggregated into a single count result.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;COUNT&quot;</span><span class="ot">,</span> <span class="er">&lt;subscription_id&gt;</span><span class="ot">,</span> <span class="er">&lt;filters</span> <span class="er">JSON&gt;...</span><span class="ot">]</span></span></code></pre></div>
<p>Counts are returned using a <code>COUNT</code> response in the form
<code>{"count": &lt;integer&gt;}</code>. Relays may use probabilistic
counts to reduce compute requirements. In case a relay uses
probabilistic counts, it MAY indicate it in the response with
<code>approximate</code> key
i.e. <code>{"count": &lt;integer&gt;, "approximate": &lt;true|false&gt;}</code>.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;COUNT&quot;</span><span class="ot">,</span> <span class="er">&lt;subscription_id&gt;</span><span class="ot">,</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="er">&lt;integer&gt;</span><span class="fu">}</span><span class="ot">]</span></span></code></pre></div>
<p>Whenever the relay decides to refuse to fulfill the
<code>COUNT</code> request, it MUST return a <code>CLOSED</code>
message.</p>
<h2 id="examples">Examples</h2>
<h3 id="followers-count">Followers count</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;COUNT&quot;</span><span class="ot">,</span> <span class="er">&lt;subscription_id&gt;</span><span class="ot">,</span> <span class="fu">{</span><span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">3</span><span class="ot">]</span><span class="fu">,</span> <span class="dt">&quot;#p&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">&lt;pubkey&gt;</span><span class="ot">]</span><span class="fu">}</span><span class="ot">]</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;COUNT&quot;</span><span class="ot">,</span> <span class="er">&lt;subscription_id&gt;</span><span class="ot">,</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">238</span><span class="fu">}</span><span class="ot">]</span></span></code></pre></div>
<h3 id="count-posts-and-reactions">Count posts and reactions</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;COUNT&quot;</span><span class="ot">,</span> <span class="er">&lt;subscription_id&gt;</span><span class="ot">,</span> <span class="fu">{</span><span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">7</span><span class="ot">]</span><span class="fu">,</span> <span class="dt">&quot;authors&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">&lt;pubkey&gt;</span><span class="ot">]</span><span class="fu">}</span><span class="ot">]</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;COUNT&quot;</span><span class="ot">,</span> <span class="er">&lt;subscription_id&gt;</span><span class="ot">,</span> <span class="fu">{</span><span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">}</span><span class="ot">]</span></span></code></pre></div>
<h3 id="count-posts-approximately">Count posts approximately</h3>
<pre><code>[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;kinds&quot;: [1]}]
[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;count&quot;: 93412452, &quot;approximate&quot;: true}]</code></pre>
<h3 id="relay-refuses-to-count">Relay refuses to count</h3>
<pre><code>[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;kinds&quot;: [4], &quot;authors&quot;: [&lt;pubkey&gt;], &quot;#p&quot;: [&lt;pubkey&gt;]}]
[&quot;CLOSED&quot;, &lt;subscription_id&gt;, &quot;auth-required: cannot count other people&#39;s DMs&quot;]</code></pre>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>44</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-44">NIP-44</h1>
<h2 id="encrypted-payloads-versioned">Encrypted Payloads
(Versioned)</h2>
<p><code>optional</code></p>
<p>The NIP introduces a new data format for keypair-based encryption.
This NIP is versioned to allow multiple algorithm choices to exist
simultaneously. This format may be used for many things, but MUST be
used in the context of a signed event as described in NIP 01.</p>
<p><em>Note</em>: this format DOES NOT define any <code>kind</code>s
related to a new direct messaging standard, only the encryption required
to define one. It SHOULD NOT be used as a drop-in replacement for NIP 04
payloads.</p>
<h2 id="versions">Versions</h2>
<p>Currently defined encryption algorithms:</p>
<ul>
<li><code>0x00</code> - Reserved</li>
<li><code>0x01</code> - Deprecated and undefined</li>
<li><code>0x02</code> - secp256k1 ECDH, HKDF, padding, ChaCha20,
HMAC-SHA256, base64</li>
</ul>
<h2 id="limitations">Limitations</h2>
<p>Every nostr user has their own public key, which solves key
distribution problems present in other solutions. However, nostr’s
relay-based architecture makes it difficult to implement more robust
private messaging protocols with things like metadata hiding, forward
secrecy, and post compromise secrecy.</p>
<p>The goal of this NIP is to have a <em>simple</em> way to encrypt
payloads used in the context of a signed event. When applying this NIP
to any use case, it’s important to keep in mind your users’ threat model
and this NIP’s limitations. For high-risk situations, users should chat
in specialized E2EE messaging software and limit use of nostr to
exchanging contacts.</p>
<p>On its own, messages sent using this scheme have a number of
important shortcomings:</p>
<ul>
<li>No deniability: it is possible to prove an event was signed by a
particular key</li>
<li>No forward secrecy: when a key is compromised, it is possible to
decrypt all previous conversations</li>
<li>No post-compromise security: when a key is compromised, it is
possible to decrypt all future conversations</li>
<li>No post-quantum security: a powerful quantum computer would be able
to decrypt the messages</li>
<li>IP address leak: user IP may be seen by relays and all
intermediaries between user and relay</li>
<li>Date leak: <code>created_at</code> is public, since it is a part of
NIP 01 event</li>
<li>Limited message size leak: padding only partially obscures true
message length</li>
<li>No attachments: they are not supported</li>
</ul>
<p>Lack of forward secrecy may be partially mitigated by only sending
messages to trusted relays, and asking relays to delete stored messages
after a certain duration has elapsed.</p>
<h2 id="version-2">Version 2</h2>
<p>NIP-44 version 2 has the following design characteristics:</p>
<ul>
<li>Payloads are authenticated using a MAC before signing rather than
afterwards because events are assumed to be signed as specified in
NIP-01. The outer signature serves to authenticate the full payload, and
MUST be validated before decrypting.</li>
<li>ChaCha is used instead of AES because it’s faster and has <a
href="https://datatracker.ietf.org/doc/draft-irtf-cfrg-aead-limits/">better
security against multi-key attacks</a>.</li>
<li>ChaCha is used instead of XChaCha because XChaCha has not been
standardized. Also, xChaCha’s improved collision resistance of nonces
isn’t necessary since every message has a new (key, nonce) pair.</li>
<li>HMAC-SHA256 is used instead of Poly1305 because polynomial MACs are
much easier to forge.</li>
<li>SHA256 is used instead of SHA3 or BLAKE because it is already used
in nostr. Also BLAKE’s speed advantage is smaller in non-parallel
environments.</li>
<li>A custom padding scheme is used instead of padmé because it provides
better leakage reduction for small messages.</li>
<li>Base64 encoding is used instead of another compression algorithm
because it is widely available, and is already used in nostr.</li>
</ul>
<h3 id="encryption">Encryption</h3>
<ol type="1">
<li>Calculate a conversation key
<ul>
<li>Execute ECDH (scalar multiplication) of public key B by private key
A Output <code>shared_x</code> must be unhashed, 32-byte encoded x
coordinate of the shared point</li>
<li>Use HKDF-extract with sha256, <code>IKM=shared_x</code> and
<code>salt=utf8_encode('nip44-v2')</code></li>
<li>HKDF output will be a <code>conversation_key</code> between two
users.</li>
<li>It is always the same, when key roles are swapped:
<code>conv(a, B) == conv(b, A)</code></li>
</ul></li>
<li>Generate a random 32-byte nonce
<ul>
<li>Always use <a
href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator">CSPRNG</a></li>
<li>Don’t generate a nonce from message content</li>
<li>Don’t re-use the same nonce between messages: doing so would make
them decryptable, but won’t leak the long-term key</li>
</ul></li>
<li>Calculate message keys
<ul>
<li>The keys are generated from <code>conversation_key</code> and
<code>nonce</code>. Validate that both are 32 bytes long</li>
<li>Use HKDF-expand, with sha256, <code>PRK=conversation_key</code>,
<code>info=nonce</code> and <code>L=76</code></li>
<li>Slice 76-byte HKDF output into: <code>chacha_key</code> (bytes
0..32), <code>chacha_nonce</code> (bytes 32..44), <code>hmac_key</code>
(bytes 44..76)</li>
</ul></li>
<li>Add padding
<ul>
<li>Content must be encoded from UTF-8 into byte array</li>
<li>Validate plaintext length. Minimum is 1 byte, maximum is 65535
bytes</li>
<li>Padding format is:
<code>[plaintext_length: u16][plaintext][zero_bytes]</code></li>
<li>Padding algorithm is related to powers-of-two, with min padded msg
size of 32</li>
<li>Plaintext length is encoded in big-endian as first 2 bytes of the
padded blob</li>
</ul></li>
<li>Encrypt padded content
<ul>
<li>Use ChaCha20, with key and nonce from step 3</li>
</ul></li>
<li>Calculate MAC (message authentication code)
<ul>
<li>AAD (additional authenticated data) is used - instead of calculating
MAC on ciphertext, it’s calculated over a concatenation of
<code>nonce</code> and <code>ciphertext</code></li>
<li>Validate that AAD (nonce) is 32 bytes</li>
</ul></li>
<li>Base64-encode (with padding) params using
<code>concat(version, nonce, ciphertext, mac)</code></li>
</ol>
<p>Encrypted payloads MUST be included in an event’s payload, hashed,
and signed as defined in NIP 01, using schnorr signature scheme over
secp256k1.</p>
<h3 id="decryption">Decryption</h3>
<p>Before decryption, the event’s pubkey and signature MUST be validated
as defined in NIP 01. The public key MUST be a valid non-zero secp256k1
curve point, and the signature must be valid secp256k1 schnorr
signature. For exact validation rules, refer to BIP-340.</p>
<ol type="1">
<li>Check if first payload’s character is <code>#</code>
<ul>
<li><code>#</code> is an optional future-proof flag that means
non-base64 encoding is used</li>
<li>The <code>#</code> is not present in base64 alphabet, but, instead
of throwing <code>base64 is invalid</code>, implementations MUST
indicate that the encryption version is not yet supported</li>
</ul></li>
<li>Decode base64
<ul>
<li>Base64 is decoded into
<code>version, nonce, ciphertext, mac</code></li>
<li>If the version is unknown, implementations must indicate that the
encryption version is not supported</li>
<li>Validate length of base64 message to prevent DoS on base64 decoder:
it can be in range from 132 to 87472 chars</li>
<li>Validate length of decoded message to verify output of the decoder:
it can be in range from 99 to 65603 bytes</li>
</ul></li>
<li>Calculate conversation key
<ul>
<li>See step 1 of <a href="#Encryption">encryption</a></li>
</ul></li>
<li>Calculate message keys
<ul>
<li>See step 3 of <a href="#Encryption">encryption</a></li>
</ul></li>
<li>Calculate MAC (message authentication code) with AAD and compare
<ul>
<li>Stop and throw an error if MAC doesn’t match the decoded one from
step 2</li>
<li>Use constant-time comparison algorithm</li>
</ul></li>
<li>Decrypt ciphertext
<ul>
<li>Use ChaCha20 with key and nonce from step 3</li>
</ul></li>
<li>Remove padding
<ul>
<li>Read the first two BE bytes of plaintext that correspond to
plaintext length</li>
<li>Verify that the length of sliced plaintext matches the value of the
two BE bytes</li>
<li>Verify that calculated padding from step 3 of the <a
href="#Encryption">encryption</a> process matches the actual
padding</li>
</ul></li>
</ol>
<h3 id="details">Details</h3>
<ul>
<li>Cryptographic methods
<ul>
<li><code>secure_random_bytes(length)</code> fetches randomness from
CSPRNG.</li>
<li><code>hkdf(IKM, salt, info, L)</code> represents HKDF <a
href="https://datatracker.ietf.org/doc/html/rfc5869">(RFC 5869)</a> with
SHA256 hash function comprised of methods
<code>hkdf_extract(IKM, salt)</code> and
<code>hkdf_expand(OKM, info, L)</code>.</li>
<li><code>chacha20(key, nonce, data)</code> is ChaCha20 <a
href="https://datatracker.ietf.org/doc/html/rfc8439">(RFC 8439)</a> with
starting counter set to 0.</li>
<li><code>hmac_sha256(key, message)</code> is HMAC <a
href="https://datatracker.ietf.org/doc/html/rfc2104">(RFC
2104)</a>.</li>
<li><code>secp256k1_ecdh(priv_a, pub_b)</code> is multiplication of
point B by scalar a (<code>a ⋅ B</code>), defined in <a
href="https://github.com/bitcoin/bips/blob/e918b50731397872ad2922a1b08a5a4cd1d6d546/bip-0340.mediawiki">BIP340</a>.
The operation produces a shared point, and we encode the shared point’s
32-byte x coordinate, using method <code>bytes(P)</code> from BIP340.
Private and public keys must be validated as per BIP340: pubkey must be
a valid, on-curve point, and private key must be a scalar in range
<code>[1, secp256k1_order - 1]</code>.</li>
</ul></li>
<li>Operators
<ul>
<li><code>x[i:j]</code>, where <code>x</code> is a byte array and
<code>i, j &lt;= 0</code> returns a <code>(j - i)</code>-byte array with
a copy of the <code>i</code>-th byte (inclusive) to the
<code>j</code>-th byte (exclusive) of <code>x</code>.</li>
</ul></li>
<li>Constants <code>c</code>:
<ul>
<li><code>min_plaintext_size</code> is 1. 1b msg is padded to 32b.</li>
<li><code>max_plaintext_size</code> is 65535 (64kb - 1). It is padded to
65536.</li>
</ul></li>
<li>Functions
<ul>
<li><code>base64_encode(string)</code> and
<code>base64_decode(bytes)</code> are Base64 (<a
href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a>, with
padding)</li>
<li><code>concat</code> refers to byte array concatenation</li>
<li><code>is_equal_ct(a, b)</code> is constant-time equality check of 2
byte arrays</li>
<li><code>utf8_encode(string)</code> and <code>utf8_decode(bytes)</code>
transform string to byte array and back</li>
<li><code>write_u8(number)</code> restricts number to values 0..255 and
encodes into Big-Endian uint8 byte array</li>
<li><code>write_u16_be(number)</code> restricts number to values
0..65535 and encodes into Big-Endian uint16 byte array</li>
<li><code>zeros(length)</code> creates byte array of length
<code>length &gt;= 0</code>, filled with zeros</li>
<li><code>floor(number)</code> and <code>log2(number)</code> are
well-known mathematical methods</li>
</ul></li>
</ul>
<h3 id="implementation-pseudocode">Implementation pseudocode</h3>
<p>The following is a collection of python-like pseudocode functions
which implement the above primitives, intended to guide implementers. A
collection of implementations in different languages is available at
https://github.com/paulmillr/nip44.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculates length of the padded byte array.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_padded_len(unpadded_len):</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  next_power <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> (floor(log2(unpadded_len <span class="op">-</span> <span class="dv">1</span>))) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> next_power <span class="op">&lt;=</span> <span class="dv">256</span>:</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    chunk <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    chunk <span class="op">=</span> next_power <span class="op">/</span> <span class="dv">8</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> unpadded_len <span class="op">&lt;=</span> <span class="dv">32</span>:</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">32</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> chunk <span class="op">*</span> (floor((<span class="bu">len</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> chunk) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Converts unpadded plaintext to padded bytearray</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pad(plaintext):</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  unpadded <span class="op">=</span> utf8_encode(plaintext)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  unpadded_len <span class="op">=</span> <span class="bu">len</span>(plaintext)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (unpadded_len <span class="op">&lt;</span> c.min_plaintext_size <span class="kw">or</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      unpadded_len <span class="op">&gt;</span> c.max_plaintext_size): <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;invalid plaintext length&#39;</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  prefix <span class="op">=</span> write_u16_be(unpadded_len)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  suffix <span class="op">=</span> zeros(calc_padded_len(unpadded_len) <span class="op">-</span> unpadded_len)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> concat(prefix, unpadded, suffix)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Converts padded bytearray to unpadded plaintext</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> unpad(padded):</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  unpadded_len <span class="op">=</span> read_uint16_be(padded[<span class="dv">0</span>:<span class="dv">2</span>])</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  unpadded <span class="op">=</span> padded[<span class="dv">2</span>:<span class="dv">2</span><span class="op">+</span>unpadded_len]</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (unpadded_len <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="bu">len</span>(unpadded) <span class="op">!=</span> unpadded_len <span class="kw">or</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="bu">len</span>(padded) <span class="op">!=</span> <span class="dv">2</span> <span class="op">+</span> calc_padded_len(unpadded_len)): <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;invalid padding&#39;</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> utf8_decode(unpadded)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># metadata: always 65b (version: 1b, nonce: 32b, max: 32b)</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># plaintext: 1b to 0xffff</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># padded plaintext: 32b to 0xffff</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ciphertext: 32b+2 to 0xffff+2</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># raw payload: 99 (65+32+2) to 65603 (65+0xffff+2)</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># compressed payload (base64): 132b to 87472b</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> decode_payload(payload):</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  plen <span class="op">=</span> <span class="bu">len</span>(payload)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> plen <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> payload[<span class="dv">0</span>] <span class="op">==</span> <span class="st">&#39;#&#39;</span>: <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;unknown version&#39;</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> plen <span class="op">&lt;</span> <span class="dv">132</span> <span class="kw">or</span> plen <span class="op">&gt;</span> <span class="dv">87472</span>: <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;invalid payload size&#39;</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> base64_decode(payload)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  dlen <span class="op">=</span> <span class="bu">len</span>(d)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> dlen <span class="op">&lt;</span> <span class="dv">99</span> <span class="kw">or</span> dlen <span class="op">&gt;</span> <span class="dv">65603</span>: <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;invalid data size&#39;</span>)<span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  vers <span class="op">=</span> data[<span class="dv">0</span>]</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> vers <span class="op">!=</span> <span class="dv">2</span>: <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;unknown version &#39;</span> <span class="op">+</span> vers)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  nonce <span class="op">=</span> data[<span class="dv">1</span>:<span class="dv">33</span>]</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  ciphertext <span class="op">=</span> data[<span class="dv">33</span>:dlen <span class="op">-</span> <span class="dv">32</span>]</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  mac <span class="op">=</span> data[dlen <span class="op">-</span> <span class="dv">32</span>:dlen]</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (nonce, ciphertext, mac)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hmac_aad(key, message, aad):</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(aad) <span class="op">!=</span> <span class="dv">32</span>: <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;AAD associated data must be 32 bytes&#39;</span>)<span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> hmac(sha256, key, concat(aad, message))<span class="op">;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculates long-term key between users A and B: `get_key(Apriv, Bpub) == get_key(Bpriv, Apub)`</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_conversation_key(private_key_a, public_key_b):</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  shared_x <span class="op">=</span> secp256k1_ecdh(private_key_a, public_key_b)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> hkdf_extract(IKM<span class="op">=</span>shared_x, salt<span class="op">=</span>utf8_encode(<span class="st">&#39;nip44-v2&#39;</span>))</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculates unique per-message key</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_message_keys(conversation_key, nonce):</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(conversation_key) <span class="op">!=</span> <span class="dv">32</span>: <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;invalid conversation_key length&#39;</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(nonce) <span class="op">!=</span> <span class="dv">32</span>: <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;invalid nonce length&#39;</span>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  keys <span class="op">=</span> hkdf_expand(OKM<span class="op">=</span>conversation_key, info<span class="op">=</span>nonce, L<span class="op">=</span><span class="dv">76</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  chacha_key <span class="op">=</span> keys[<span class="dv">0</span>:<span class="dv">32</span>]</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  chacha_nonce <span class="op">=</span> keys[<span class="dv">32</span>:<span class="dv">44</span>]</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  hmac_key <span class="op">=</span> keys[<span class="dv">44</span>:<span class="dv">76</span>]</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (chacha_key, chacha_nonce, hmac_key)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encrypt(plaintext, conversation_key, nonce):</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  (chacha_key, chacha_nonce, hmac_key) <span class="op">=</span> get_message_keys(conversation_key, nonce)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  padded <span class="op">=</span> pad(plaintext)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  ciphertext <span class="op">=</span> chacha20(key<span class="op">=</span>chacha_key, nonce<span class="op">=</span>chacha_nonce, data<span class="op">=</span>padded)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  mac <span class="op">=</span> hmac_aad(key<span class="op">=</span>hmac_key, message<span class="op">=</span>ciphertext, aad<span class="op">=</span>nonce)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> base64_encode(concat(write_u8(<span class="dv">2</span>), nonce, ciphertext, mac))</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> decrypt(payload, conversation_key):</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  (nonce, ciphertext, mac) <span class="op">=</span> decode_payload(payload)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  (chacha_key, chacha_nonce, hmac_key) <span class="op">=</span> get_message_keys(conversation_key, nonce)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  calculated_mac <span class="op">=</span> hmac_aad(key<span class="op">=</span>hmac_key, message<span class="op">=</span>ciphertext, aad<span class="op">=</span>nonce)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> is_equal_ct(calculated_mac, mac): <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&#39;invalid MAC&#39;</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>  padded_plaintext <span class="op">=</span> chacha20(key<span class="op">=</span>chacha_key, nonce<span class="op">=</span>chacha_nonce, data<span class="op">=</span>ciphertext)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> unpad(padded_plaintext)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage:</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="co">#   conversation_key = get_conversation_key(sender_privkey, recipient_pubkey)</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="co">#   nonce = secure_random_bytes(32)</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   payload = encrypt(&#39;hello world&#39;, conversation_key, nonce)</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   &#39;hello world&#39; == decrypt(payload, conversation_key)</span></span></code></pre></div>
<h3 id="audit">Audit</h3>
<p>The v2 of the standard was audited by <a
href="https://cure53.de">Cure53</a> in December 2023. Check out <a
href="https://github.com/paulmillr/nip44/blob/ce63c2eaf345e9f7f93b48f829e6bdeb7e7d7964/audit-2023.12.pdf">audit-2023.12.pdf</a>
and <a
href="https://cure53.de/audit-report_nip44-implementations.pdf">auditor’s
website</a>.</p>
<h3 id="tests-and-code">Tests and code</h3>
<p>A collection of implementations in different languages is available
at https://github.com/paulmillr/nip44.</p>
<p>We publish extensive test vectors. Instead of having it in the
document directly, a sha256 checksum of vectors is provided:</p>
<pre><code>269ed0f69e4c192512cc779e78c555090cebc7c785b609e338a62afc3ce25040  nip44.vectors.json</code></pre>
<p>Example of a test vector from the file:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sec1&quot;</span><span class="fu">:</span> <span class="st">&quot;0000000000000000000000000000000000000000000000000000000000000001&quot;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sec2&quot;</span><span class="fu">:</span> <span class="st">&quot;0000000000000000000000000000000000000000000000000000000000000002&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;conversation_key&quot;</span><span class="fu">:</span> <span class="st">&quot;c41c775356fd92eadc63ff5a0dc1da211b268cbea22316767095b2871ea1412d&quot;</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;nonce&quot;</span><span class="fu">:</span> <span class="st">&quot;0000000000000000000000000000000000000000000000000000000000000001&quot;</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;plaintext&quot;</span><span class="fu">:</span> <span class="st">&quot;a&quot;</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;payload&quot;</span><span class="fu">:</span> <span class="st">&quot;AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABee0G5VSK0/9YypIObAtDKfYEAjD35uVkHyB0F4DwrcNaCXlCWZKaArsGrY6M9wnuTMxWfp1RTN9Xga8no+kF5Vsb&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The file also contains intermediate values. A quick guidance with
regards to its usage:</p>
<ul>
<li><code>valid.get_conversation_key</code>: calculate conversation_key
from secret key sec1 and public key pub2</li>
<li><code>valid.get_message_keys</code>: calculate chacha_key,
chacha_nonce, hmac_key from conversation_key and nonce</li>
<li><code>valid.calc_padded_len</code>: take unpadded length (first
value), calculate padded length (second value)</li>
<li><code>valid.encrypt_decrypt</code>: emulate real conversation.
Calculate pub2 from sec2, verify conversation_key from (sec1, pub2),
encrypt, verify payload, then calculate pub1 from sec1, verify
conversation_key from (sec2, pub1), decrypt, verify plaintext.</li>
<li><code>valid.encrypt_decrypt_long_msg</code>: same as previous step,
but instead of a full plaintext and payload, their checksum is
provided.</li>
<li><code>invalid.encrypt_msg_lengths</code></li>
<li><code>invalid.get_conversation_key</code>: calculating
conversation_key must throw an error</li>
<li><code>invalid.decrypt</code>: decrypting message content must throw
an error</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>42</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-42">NIP-42</h1>
<h2 id="authentication-of-clients-to-relays">Authentication of clients
to relays</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines a way for clients to authenticate to relays by
signing an ephemeral event.</p>
<h2 id="motivation">Motivation</h2>
<p>A relay may want to require clients to authenticate to access
restricted resources. For example,</p>
<ul>
<li>A relay may request payment or other forms of whitelisting to
publish events – this can naïvely be achieved by limiting publication to
events signed by the whitelisted key, but with this NIP they may choose
to accept any events as long as they are published from an authenticated
user;</li>
<li>A relay may limit access to <code>kind: 4</code> DMs to only the
parties involved in the chat exchange, and for that it may require
authentication before clients can query for that kind.</li>
<li>A relay may limit subscriptions of any kind to paying users or users
whitelisted through any other means, and require authentication.</li>
</ul>
<h2 id="definitions">Definitions</h2>
<h3 id="new-client-relay-protocol-messages">New client-relay protocol
messages</h3>
<p>This NIP defines a new message, <code>AUTH</code>, which relays CAN
send when they support authentication and clients can send to relays
when they want to authenticate. When sent by relays the message has the
following form:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;AUTH&quot;</span><span class="ot">,</span> <span class="er">&lt;challenge-string&gt;</span><span class="ot">]</span></span></code></pre></div>
<p>And, when sent by clients, the following form:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;AUTH&quot;</span><span class="ot">,</span> <span class="er">&lt;signed-event-json&gt;</span><span class="ot">]</span></span></code></pre></div>
<p><code>AUTH</code> messages sent by clients MUST be answered with an
<code>OK</code> message, like any <code>EVENT</code> message.</p>
<h3 id="canonical-authentication-event">Canonical authentication
event</h3>
<p>The signed event is an ephemeral event not meant to be published or
queried, it must be of <code>kind: 22242</code> and it should have at
least two tags, one for the relay URL and one for the challenge string
as received from the relay. Relays MUST exclude <code>kind: 22242</code>
events from being broadcasted to any client. <code>created_at</code>
should be the current time. Example:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">22242</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;relay&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://relay.example.com/&quot;</span><span class="ot">],</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;challenge&quot;</span><span class="ot">,</span> <span class="st">&quot;challengestringhere&quot;</span><span class="ot">]</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="ok-and-closed-machine-readable-prefixes"><code>OK</code> and
<code>CLOSED</code> machine-readable prefixes</h3>
<p>This NIP defines two new prefixes that can be used in <code>OK</code>
(in response to event writes by clients) and <code>CLOSED</code> (in
response to rejected subscriptions by clients):</p>
<ul>
<li><code>"auth-required: "</code> - for when a client has not performed
<code>AUTH</code> and the relay requires that to fulfill the query or
write the event.</li>
<li><code>"restricted: "</code> - for when a client has already
performed <code>AUTH</code> but the key used to perform it is still not
allowed by the relay or is exceeding its authorization.</li>
</ul>
<h2 id="protocol-flow">Protocol flow</h2>
<p>At any moment the relay may send an <code>AUTH</code> message to the
client containing a challenge. The challenge is valid for the duration
of the connection or until another challenge is sent by the relay. The
client MAY decide to send its <code>AUTH</code> event at any point and
the authenticated session is valid afterwards for the duration of the
connection.</p>
<h3
id="auth-required-in-response-to-a-req-message"><code>auth-required</code>
in response to a <code>REQ</code> message</h3>
<p>Given that a relay is likely to require clients to perform
authentication only for certain jobs, like answering a <code>REQ</code>
or accepting an <code>EVENT</code> write, these are some expected common
flows:</p>
<pre><code>relay: [&quot;AUTH&quot;, &quot;&lt;challenge&gt;&quot;]
client: [&quot;REQ&quot;, &quot;sub_1&quot;, {&quot;kinds&quot;: [4]}]
relay: [&quot;CLOSED&quot;, &quot;sub_1&quot;, &quot;auth-required: we can&#39;t serve DMs to unauthenticated users&quot;]
client: [&quot;AUTH&quot;, {&quot;id&quot;: &quot;abcdef...&quot;, ...}]
relay: [&quot;OK&quot;, &quot;abcdef...&quot;, true, &quot;&quot;]
client: [&quot;REQ&quot;, &quot;sub_1&quot;, {&quot;kinds&quot;: [4]}]
relay: [&quot;EVENT&quot;, &quot;sub_1&quot;, {...}]
relay: [&quot;EVENT&quot;, &quot;sub_1&quot;, {...}]
relay: [&quot;EVENT&quot;, &quot;sub_1&quot;, {...}]
relay: [&quot;EVENT&quot;, &quot;sub_1&quot;, {...}]
...</code></pre>
<p>In this case, the <code>AUTH</code> message from the relay could be
sent right as the client connects or it can be sent immediately before
the <code>CLOSED</code> is sent. The only requirement is that <em>the
client must have a stored challenge associated with that relay</em> so
it can act upon that in response to the <code>auth-required</code>
<code>CLOSED</code> message.</p>
<h3
id="auth-required-in-response-to-an-event-message"><code>auth-required</code>
in response to an <code>EVENT</code> message</h3>
<p>The same flow is valid for when a client wants to write an
<code>EVENT</code> to the relay, except now the relay sends back an
<code>OK</code> message instead of a <code>CLOSED</code> message:</p>
<pre><code>relay: [&quot;AUTH&quot;, &quot;&lt;challenge&gt;&quot;]
client: [&quot;EVENT&quot;, {&quot;id&quot;: &quot;012345...&quot;, ...}]
relay: [&quot;OK&quot;, &quot;012345...&quot;, false, &quot;auth-required: we only accept events from registered users&quot;]
client: [&quot;AUTH&quot;, {&quot;id&quot;: &quot;abcdef...&quot;, ...}]
relay: [&quot;OK&quot;, &quot;abcdef...&quot;, true, &quot;&quot;]
client: [&quot;EVENT&quot;, {&quot;id&quot;: &quot;012345...&quot;, ...}]
relay: [&quot;OK&quot;, &quot;012345...&quot;, true, &quot;&quot;]</code></pre>
<h2 id="signed-event-verification">Signed Event Verification</h2>
<p>To verify <code>AUTH</code> messages, relays must ensure:</p>
<ul>
<li>that the <code>kind</code> is <code>22242</code>;</li>
<li>that the event <code>created_at</code> is close (e.g. within ~10
minutes) of the current time;</li>
<li>that the <code>"challenge"</code> tag matches the challenge sent
before;</li>
<li>that the <code>"relay"</code> tag matches the relay URL:
<ul>
<li>URL normalization techniques can be applied. For most cases just
checking if the domain name is correct should be enough.</li>
</ul></li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>40</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-40">NIP-40</h1>
<h2 id="expiration-timestamp">Expiration Timestamp</h2>
<p><code>draft</code> <code>optional</code></p>
<p>The <code>expiration</code> tag enables users to specify a unix
timestamp at which the message SHOULD be considered expired (by relays
and clients) and SHOULD be deleted by relays.</p>
<h4 id="spec">Spec</h4>
<pre><code>tag: expiration
values:
 - [UNIX timestamp in seconds]: required</code></pre>
<h4 id="example">Example</h4>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;pub-key&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1000000000</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;expiration&quot;</span><span class="ot">,</span> <span class="st">&quot;1600000000&quot;</span><span class="ot">]</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;This message will expire at the specified timestamp and be deleted by relays.</span><span class="ch">\n</span><span class="st">&quot;</span><span class="fu">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;event-id&gt;&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Note: The timestamp should be in the same format as the created_at
timestamp and should be interpreted as the time at which the message
should be deleted by relays.</p>
<h2 id="client-behavior">Client Behavior</h2>
<p>Clients SHOULD use the <code>supported_nips</code> field to learn if
a relay supports this NIP. Clients SHOULD NOT send expiration events to
relays that do not support this NIP.</p>
<p>Clients SHOULD ignore events that have expired.</p>
<h2 id="relay-behavior">Relay Behavior</h2>
<p>Relays MAY NOT delete expired messages immediately on expiration and
MAY persist them indefinitely. Relays SHOULD NOT send expired events to
clients, even if they are stored. Relays SHOULD drop any events that are
published to them if they are expired. An expiration timestamp does not
affect storage of ephemeral events.</p>
<h2 id="suggested-use-cases">Suggested Use Cases</h2>
<ul>
<li>Temporary announcements - This tag can be used to make temporary
announcements. For example, an event organizer could use this tag to
post announcements about an upcoming event.</li>
<li>Limited-time offers - This tag can be used by businesses to make
limited-time offers that expire after a certain amount of time. For
example, a business could use this tag to make a special offer that is
only available for a limited time.</li>
</ul>
<h4 id="warning">Warning</h4>
<p>The events could be downloaded by third parties as they are publicly
accessible all the time on the relays. So don’t consider expiring
messages as a security feature for your conversations or other uses.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>39</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-39">NIP-39</h1>
<h2 id="external-identities-in-profiles">External Identities in
Profiles</h2>
<p><code>draft</code> <code>optional</code></p>
<h2 id="abstract">Abstract</h2>
<p>Nostr protocol users may have other online identities such as
usernames, profile pages, keypairs etc. they control and they may want
to include this data in their profile metadata so clients can parse,
validate and display this information.</p>
<h2 id="i-tag-on-a-metadata-event"><code>i</code> tag on a metadata
event</h2>
<p>A new optional <code>i</code> tag is introduced for
<code>kind 0</code> metadata event contents in addition to name, about,
picture fields as included in <a
href="https://github.com/nostr-protocol/nips/blob/master/01.md.css.html">NIP-01</a>:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;i&quot;</span><span class="ot">,</span> <span class="st">&quot;github:semisol&quot;</span><span class="ot">,</span> <span class="st">&quot;9721ce4ee4fceb91c9711ca2a6c9a5ab&quot;</span><span class="ot">],</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;i&quot;</span><span class="ot">,</span> <span class="st">&quot;twitter:semisol_public&quot;</span><span class="ot">,</span> <span class="st">&quot;1619358434134196225&quot;</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;i&quot;</span><span class="ot">,</span> <span class="st">&quot;mastodon:bitcoinhackers.org/@semisol&quot;</span><span class="ot">,</span> <span class="st">&quot;109775066355589974&quot;</span><span class="ot">]</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;i&quot;</span><span class="ot">,</span> <span class="st">&quot;telegram:1087295469&quot;</span><span class="ot">,</span> <span class="st">&quot;nostrdirectory/770&quot;</span><span class="ot">]</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>An <code>i</code> tag will have two parameters, which are defined as
the following: 1. <code>platform:identity</code>: This is the platform
name (for example <code>github</code>) and the identity on that platform
(for example <code>semisol</code>) joined together with <code>:</code>.
2. <code>proof</code>: String or object that points to the proof of
owning this identity.</p>
<p>Clients SHOULD process any <code>i</code> tags with more than 2
values for future extensibility. Identity provider names SHOULD only
include <code>a-z</code>, <code>0-9</code> and the characters
<code>._-/</code> and MUST NOT include <code>:</code>. Identity names
SHOULD be normalized if possible by replacing uppercase letters with
lowercase letters, and if there are multiple aliases for an entity the
primary one should be used.</p>
<h2 id="claim-types">Claim types</h2>
<h3 id="github"><code>github</code></h3>
<p>Identity: A GitHub username.</p>
<p>Proof: A GitHub Gist ID. This Gist should be created by
<code>&lt;identity&gt;</code> with a single file that has the text
<code>Verifying that I control the following Nostr public key: &lt;npub encoded public key&gt;</code>.
This can be located at
<code>https://gist.github.com/&lt;identity&gt;/&lt;proof&gt;</code>.</p>
<h3 id="twitter"><code>twitter</code></h3>
<p>Identity: A Twitter username.</p>
<p>Proof: A Tweet ID. The tweet should be posted by
<code>&lt;identity&gt;</code> and have the text
<code>Verifying my account on nostr My Public Key: "&lt;npub encoded public key&gt;"</code>.
This can be located at
<code>https://twitter.com/&lt;identity&gt;/status/&lt;proof&gt;</code>.</p>
<h3 id="mastodon"><code>mastodon</code></h3>
<p>Identity: A Mastodon instance and username in the format
<code>&lt;instance&gt;/@&lt;username&gt;</code>.</p>
<p>Proof: A Mastodon post ID. This post should be published by
<code>&lt;username&gt;@&lt;instance&gt;</code> and have the text
<code>Verifying that I control the following Nostr public key: "&lt;npub encoded public key&gt;"</code>.
This can be located at
<code>https://&lt;identity&gt;/&lt;proof&gt;</code>.</p>
<h3 id="telegram"><code>telegram</code></h3>
<p>Identity: A Telegram user ID.</p>
<p>Proof: A string in the format <code>&lt;ref&gt;/&lt;id&gt;</code>
which points to a message published in the public channel or group with
name <code>&lt;ref&gt;</code> and message ID <code>&lt;id&gt;</code>.
This message should be sent by user ID <code>&lt;identity&gt;</code> and
have the text
<code>Verifying that I control the following Nostr public key: "&lt;npub encoded public key&gt;"</code>.
This can be located at <code>https://t.me/&lt;proof&gt;</code>.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>38</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-38">NIP-38</h1>
<h2 id="user-statuses">User Statuses</h2>
<p><code>draft</code> <code>optional</code></p>
<h2 id="abstract">Abstract</h2>
<p>This NIP enables a way for users to share live statuses such as what
music they are listening to, as well as what they are currently doing:
work, play, out of office, etc.</p>
<h2 id="live-statuses">Live Statuses</h2>
<p>A special event with <code>kind:30315</code> “User Status” is defined
as an <em>optionally expiring</em> <em>parameterized replaceable
event</em>, where the <code>d</code> tag represents the status type:</p>
<p>For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">30315</span><span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;Sign up for nostrasia!&quot;</span><span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;d&quot;</span><span class="op">,</span> <span class="st">&quot;general&quot;</span>]<span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;r&quot;</span><span class="op">,</span> <span class="st">&quot;https://nostr.world&quot;</span>]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">30315</span><span class="op">,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;Intergalatic - Beastie Boys&quot;</span><span class="op">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;d&quot;</span><span class="op">,</span> <span class="st">&quot;music&quot;</span>]<span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;r&quot;</span><span class="op">,</span> <span class="st">&quot;spotify:search:Intergalatic%20-%20Beastie%20Boys&quot;</span>]<span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;expiration&quot;</span><span class="op">,</span> <span class="st">&quot;1692845589&quot;</span>]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Two common status types are defined: <code>general</code> and
<code>music</code>. <code>general</code> represent general statuses:
“Working”, “Hiking”, etc.</p>
<p><code>music</code> status events are for live streaming what you are
currently listening to. The expiry of the <code>music</code> status
should be when the track will stop playing.</p>
<p>Any other status types can be used but they are not defined by this
NIP.</p>
<p>The status MAY include an <code>r</code>, <code>p</code>,
<code>e</code> or <code>a</code> tag linking to a URL, profile, note, or
parameterized replaceable event.</p>
<h1 id="client-behavior">Client behavior</h1>
<p>Clients MAY display this next to the username on posts or profiles to
provide live user status information.</p>
<h1 id="use-cases">Use Cases</h1>
<ul>
<li>Calendar nostr apps that update your general status when you’re in a
meeting</li>
<li>Nostr Nests that update your general status with a link to the nest
when you join</li>
<li>Nostr music streaming services that update your music status when
you’re listening</li>
<li>Podcasting apps that update your music status when you’re listening
to a podcast, with a link for others to listen as well</li>
<li>Clients can use the system media player to update playing music
status</li>
</ul>
<p>The <code>content</code> MAY include emoji(s), or <a
href="30.md.css.html">NIP-30</a> custom emoji(s). If the <code>content</code> is
an empty string then the client should clear the status.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>36</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-36">NIP-36</h1>
<h2 id="sensitive-content-content-warning">Sensitive Content / Content
Warning</h2>
<p><code>draft</code> <code>optional</code></p>
<p>The <code>content-warning</code> tag enables users to specify if the
event’s content needs to be approved by readers to be shown. Clients can
hide the content until the user acts on it.</p>
<p><code>l</code> and <code>L</code> tags MAY be also be used as defined
in <a href="32.md.css.html">NIP-32</a> with the <code>content-warning</code> or
other namespace to support further qualification and querying.</p>
<h4 id="spec">Spec</h4>
<pre><code>tag: content-warning
options:
 - [reason]: optional</code></pre>
<h4 id="example">Example</h4>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;pub-key&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1000000000</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;t&quot;</span><span class="ot">,</span> <span class="st">&quot;hastag&quot;</span><span class="ot">],</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;L&quot;</span><span class="ot">,</span> <span class="st">&quot;content-warning&quot;</span><span class="ot">],</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;l&quot;</span><span class="ot">,</span> <span class="st">&quot;reason&quot;</span><span class="ot">,</span> <span class="st">&quot;content-warning&quot;</span><span class="ot">],</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;L&quot;</span><span class="ot">,</span> <span class="st">&quot;social.nos.ontology&quot;</span><span class="ot">],</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;l&quot;</span><span class="ot">,</span> <span class="st">&quot;NS-nud&quot;</span><span class="ot">,</span> <span class="st">&quot;social.nos.ontology&quot;</span><span class="ot">],</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;content-warning&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;optional reason&gt;&quot;</span><span class="ot">]</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;sensitive content with #hastag</span><span class="ch">\n</span><span class="st">&quot;</span><span class="fu">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;event-id&gt;&quot;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>34</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-34">NIP-34</h1>
<h2 id="git-stuff"><code>git</code> stuff</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines all the ways code collaboration using and adjacent
to <a href="https://git-scm.com/"><code>git</code></a> can be done using
Nostr.</p>
<h2 id="repository-announcements">Repository announcements</h2>
<p>Git repositories are hosted in Git-enabled servers, but their
existence can be announced using Nostr events, as well as their
willingness to receive patches, bug reports and comments in general.</p>
<pre class="jsonc"><code>{
  &quot;kind&quot;: 30617,
  &quot;content&quot;: &quot;&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;&lt;repo-id&gt;&quot;], // usually kebab-case short name
    [&quot;name&quot;, &quot;&lt;human-readable project name&gt;&quot;],
    [&quot;description&quot;, &quot;brief human-readable project description&gt;&quot;],
    [&quot;web&quot;, &quot;&lt;url for browsing&gt;&quot;, ...], // a webpage url, if the git server being used provides such a thing
    [&quot;clone&quot;, &quot;&lt;url for git-cloning&gt;&quot;, ...], // a url to be given to `git clone` so anyone can clone it
    [&quot;relays&quot;, &quot;&lt;relay-url&gt;&quot;, ...] // relays that this repository will monitor for patches and issues
    [&quot;r&quot;, &quot;&lt;earliest-unique-commit-id&gt;&quot;, &quot;euc&quot;]
    [&quot;maintainers&quot;, &quot;&lt;other-recognized-maintainer&gt;&quot;, ...]
  ]
}</code></pre>
<p>The tags <code>web</code>, <code>clone</code>, <code>relays</code>,
<code>maintainers</code> can have multiple values.</p>
<p>The <code>r</code> tag annotated with the <code>"euc"</code> marker
should be the commit ID of the earliest unique commit of this repo, made
to identify it among forks and group it with other repositories hosted
elsewhere that may represent essentially the same project. In most cases
it will be the root commit of a repository. In case of a permanent fork
between two projects, then the first commit after the fork should be
used.</p>
<p>Except <code>d</code>, all tags are optional.</p>
<h2 id="patches">Patches</h2>
<p>Patches can be sent by anyone to any repository. Patches to a
specific repository SHOULD be sent to the relays specified in that
repository’s announcement event’s <code>"relays"</code> tag. Patch
events SHOULD include an <code>a</code> tag pointing to that
repository’s announcement address.</p>
<p>Patches in a patch set SHOULD include a NIP-10 <code>e</code>
<code>reply</code> tag pointing to the previous patch.</p>
<p>The first patch revision in a patch revision SHOULD include a NIP-10
<code>e</code> <code>reply</code> to the original root patch.</p>
<pre class="jsonc"><code>{
  &quot;kind&quot;: 1617,
  &quot;content&quot;: &quot;&lt;patch&gt;&quot;, // contents of &lt;git format-patch&gt;
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;30617:&lt;base-repo-owner-pubkey&gt;:&lt;base-repo-id&gt;&quot;],
    [&quot;r&quot;, &quot;&lt;earliest-unique-commit-id-of-repo&gt;&quot;] // so clients can subscribe to all patches sent to a local git repo
    [&quot;p&quot;, &quot;&lt;repository-owner&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;other-user&gt;&quot;], // optionally send the patch to another user to bring it to their attention

    [&quot;t&quot;, &quot;root&quot;], // ommited for additional patches in a series
    // for the first patch in a revision
    [&quot;t&quot;, &quot;root-revision&quot;],

    // optional tags for when it is desirable that the merged patch has a stable commit id
    // these fields are necessary for ensuring that the commit resulting from applying a patch
    // has the same id as it had in the proposer&#39;s machine -- all these tags can be omitted
    // if the maintainer doesn&#39;t care about these things
    [&quot;commit&quot;, &quot;&lt;current-commit-id&gt;&quot;],
    [&quot;r&quot;, &quot;&lt;current-commit-id&gt;&quot;] // so clients can find existing patches for a specific commit
    [&quot;parent-commit&quot;, &quot;&lt;parent-commit-id&gt;&quot;],
    [&quot;commit-pgp-sig&quot;, &quot;-----BEGIN PGP SIGNATURE-----...&quot;], // empty string for unsigned commit
    [&quot;committer&quot;, &quot;&lt;name&gt;&quot;, &quot;&lt;email&gt;&quot;, &quot;&lt;timestamp&gt;&quot;, &quot;&lt;timezone offset in minutes&gt;&quot;],
  ]
}</code></pre>
<p>The first patch in a series MAY be a cover letter in the format
produced by <code>git format-patch</code>.</p>
<h2 id="issues">Issues</h2>
<p>Issues are Markdown text that is just human-readable conversational
threads related to the repository: bug reports, feature requests,
questions or comments of any kind. Like patches, these SHOULD be sent to
the relays specified in that repository’s announcement event’s
<code>"relays"</code> tag.</p>
<pre class="jsonc"><code>{
  &quot;kind&quot;: 1621,
  &quot;content&quot;: &quot;&lt;markdown text&gt;&quot;,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;30617:&lt;base-repo-owner-pubkey&gt;:&lt;base-repo-id&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;repository-owner&gt;&quot;]
  ]
}</code></pre>
<h2 id="replies">Replies</h2>
<p>Replies are also Markdown text. The difference is that they MUST be
issued as replies to either a <code>kind:1621</code> <em>issue</em> or a
<code>kind:1617</code> <em>patch</em> event. The threading of replies
and patches should follow NIP-10 rules.</p>
<pre class="jsonc"><code>{
  &quot;kind&quot;: 1622,
  &quot;content&quot;: &quot;&lt;markdown text&gt;&quot;,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;30617:&lt;base-repo-owner-pubkey&gt;:&lt;base-repo-id&gt;&quot;, &quot;&lt;relay-url&gt;&quot;],
    [&quot;e&quot;, &quot;&lt;issue-or-patch-id-hex&gt;&quot;, &quot;&quot;, &quot;root&quot;],

    // other &quot;e&quot; and &quot;p&quot; tags should be applied here when necessary, following the threading rules of NIP-10
    [&quot;p&quot;, &quot;&lt;patch-author-pubkey-hex&gt;&quot;, &quot;&quot;, &quot;mention&quot;],
    [&quot;e&quot;, &quot;&lt;previous-reply-id-hex&gt;&quot;, &quot;&quot;, &quot;reply&quot;],
    // ...
  ]
}</code></pre>
<h2 id="status">Status</h2>
<p>Root Patches and Issues have a Status that defaults to ‘Open’ and can
be set by issuing Status events.</p>
<pre class="jsonc"><code>{
  &quot;kind&quot;: 1630, // Open
  &quot;kind&quot;: 1631, // Applied / Merged for Patches; Resolved for Issues
  &quot;kind&quot;: 1632, // Closed
  &quot;kind&quot;: 1633, // Draft
  &quot;content&quot;: &quot;&lt;markdown text&gt;&quot;,
  &quot;tags&quot;: [
    [&quot;e&quot;, &quot;&lt;issue-or-original-root-patch-id-hex&gt;&quot;, &quot;&quot;, &quot;root&quot;],
    [&quot;e&quot;, &quot;&lt;accepted-revision-root-id-hex&gt;&quot;, &quot;&quot;, &quot;reply&quot;], // for when revisions applied
    [&quot;p&quot;, &quot;&lt;repository-owner&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;root-event-author&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;revision-author&gt;&quot;],

    // optional for improved subscription filter efficiency
    [&quot;a&quot;, &quot;30617:&lt;base-repo-owner-pubkey&gt;:&lt;base-repo-id&gt;&quot;, &quot;&lt;relay-url&gt;&quot;],
    [&quot;r&quot;, &quot;&lt;earliest-unique-commit-id-of-repo&gt;&quot;]

    // optional for `1631` status
    [&quot;e&quot;, &quot;&lt;applied-or-merged-patch-event-id&gt;&quot;, &quot;&quot;, &quot;mention&quot;], // for each
    // when merged
    [&quot;merge-commit&quot;, &quot;&lt;merge-commit-id&gt;&quot;]
    [&quot;r&quot;, &quot;&lt;merge-commit-id&gt;&quot;]
    // when applied
    [&quot;applied-as-commits&quot;, &quot;&lt;commit-id-in-master-branch&gt;&quot;, ...]
    [&quot;r&quot;, &quot;&lt;applied-commit-id&gt;&quot;] // for each
  ]
}</code></pre>
<p>The Status event with the largest created_at date is valid.</p>
<p>The Status of a patch-revision defaults to either that of the
root-patch, or <code>1632</code> (Closed) if the root-patch’s Status is
<code>1631</code> and the patch-revision isn’t tagged in the
<code>1631</code> event.</p>
<h2 id="possible-things-to-be-added-later">Possible things to be added
later</h2>
<ul>
<li>“branch merge” kind (specifying a URL from where to fetch the branch
to be merged)</li>
<li>inline file comments kind (we probably need one for patches and a
different one for merged files)</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>33</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-33">NIP-33</h1>
<h2 id="parameterized-replaceable-events">Parameterized Replaceable
Events</h2>
<p><code>final</code> <code>mandatory</code></p>
<p>Moved to <a href="01.md.css.html">NIP-01</a>.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>32</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-32">NIP-32</h1>
<h2 id="labeling">Labeling</h2>
<p><code>draft</code> <code>optional</code></p>
<p>A label is a <code>kind 1985</code> event that is used to label other
entities. This supports a number of use cases, including distributed
moderation, collection management, license assignment, and content
classification.</p>
<p>This NIP introduces two new tags:</p>
<ul>
<li><code>L</code> denotes a label namespace</li>
<li><code>l</code> denotes a label</li>
</ul>
<h2 id="label-namespace-tag">Label Namespace Tag</h2>
<p>An <code>L</code> tag can be any string, but publishers SHOULD ensure
they are unambiguous by using a well-defined namespace (such as an ISO
standard) or reverse domain name notation.</p>
<p><code>L</code> tags are REQUIRED in order to support searching by
namespace rather than by a specific tag. The special <code>ugc</code>
(“user generated content”) namespace MAY be used when the label content
is provided by an end user.</p>
<p><code>L</code> tags starting with <code>#</code> indicate that the
label target should be associated with the label’s value. This is a way
of attaching standard nostr tags to events, pubkeys, relays, urls,
etc.</p>
<h2 id="label-tag">Label Tag</h2>
<p>An <code>l</code> tag’s value can be any string. <code>l</code> tags
MUST include a <code>mark</code> matching an <code>L</code> tag value in
the same event.</p>
<h2 id="label-target">Label Target</h2>
<p>The label event MUST include one or more tags representing the object
or objects being labeled: <code>e</code>, <code>p</code>,
<code>a</code>, <code>r</code>, or <code>t</code> tags. This allows for
labeling of events, people, relays, or topics respectively. As with
NIP-01, a relay hint SHOULD be included when using <code>e</code> and
<code>p</code> tags.</p>
<h2 id="content">Content</h2>
<p>Labels should be short, meaningful strings. Longer discussions, such
as for a review, or an explanation of why something was labeled the way
it was, should go in the event’s <code>content</code> field.</p>
<h2 id="self-reporting">Self-Reporting</h2>
<p><code>l</code> and <code>L</code> tags MAY be added to other event
kinds to support self-reporting. For events with a kind other than 1985,
labels refer to the event itself.</p>
<h2 id="example-events">Example events</h2>
<p>A suggestion that multiple pubkeys be associated with the
<code>permies</code> topic.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1985</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;L&quot;</span><span class="ot">,</span> <span class="st">&quot;#t&quot;</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;l&quot;</span><span class="ot">,</span> <span class="st">&quot;permies&quot;</span><span class="ot">,</span> <span class="st">&quot;#t&quot;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;pubkey1&gt;</span><span class="ot">,</span> <span class="er">&lt;relay_url&gt;</span><span class="ot">],</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;pubkey2&gt;</span><span class="ot">,</span> <span class="er">&lt;relay_url&gt;</span><span class="ot">]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>A report flagging violence toward a human being as defined by
ontology.example.com.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1985</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;L&quot;</span><span class="ot">,</span> <span class="st">&quot;com.example.ontology&quot;</span><span class="ot">],</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;l&quot;</span><span class="ot">,</span> <span class="st">&quot;VI-hum&quot;</span><span class="ot">,</span> <span class="st">&quot;com.example.ontology&quot;</span><span class="ot">],</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;pubkey1&gt;</span><span class="ot">,</span> <span class="er">&lt;relay_url&gt;</span><span class="ot">],</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;pubkey2&gt;</span><span class="ot">,</span> <span class="er">&lt;relay_url&gt;</span><span class="ot">]</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>A moderation suggestion for a chat event.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1985</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;L&quot;</span><span class="ot">,</span> <span class="st">&quot;nip28.moderation&quot;</span><span class="ot">],</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;l&quot;</span><span class="ot">,</span> <span class="st">&quot;approve&quot;</span><span class="ot">,</span> <span class="st">&quot;nip28.moderation&quot;</span><span class="ot">],</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;kind40_event_id&gt;</span><span class="ot">,</span> <span class="er">&lt;relay_url&gt;</span><span class="ot">]</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Assignment of a license to an event.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1985</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;L&quot;</span><span class="ot">,</span> <span class="st">&quot;license&quot;</span><span class="ot">],</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;l&quot;</span><span class="ot">,</span> <span class="st">&quot;MIT&quot;</span><span class="ot">,</span> <span class="st">&quot;license&quot;</span><span class="ot">],</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;event_id&gt;</span><span class="ot">,</span> <span class="er">&lt;relay_url&gt;</span><span class="ot">]</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Publishers can self-label by adding <code>l</code> tags to their own
non-1985 events. In this case, the kind 1 event’s author is labeling
their note as being related to Milan, Italy using ISO 3166-2.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;L&quot;</span><span class="ot">,</span> <span class="st">&quot;ISO-3166-2&quot;</span><span class="ot">],</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;l&quot;</span><span class="ot">,</span> <span class="st">&quot;IT-MI&quot;</span><span class="ot">,</span> <span class="st">&quot;ISO-3166-2&quot;</span><span class="ot">]</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;It&#39;s beautiful here in Milan!&quot;</span><span class="fu">,</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="other-notes">Other Notes</h2>
<p>When using this NIP to bulk-label many targets at once, events may be
deleted and a replacement may be published. We have opted not to use
parameterizable/replaceable events for this due to the complexity in
coming up with a standard <code>d</code> tag. In order to avoid
ambiguity when querying, publishers SHOULD limit labeling events to a
single namespace.</p>
<p>Before creating a vocabulary, explore how your use case may have
already been designed and imitate that design if possible. Reverse
domain name notation is encouraged to avoid namespace clashes, but for
the sake of interoperability all namespaces should be considered open
for public use, and not proprietary. In other words, if there is a
namespace that fits your use case, use it even if it points to someone
else’s domain name.</p>
<p>Vocabularies MAY choose to fully qualify all labels within a
namespace (for example,
<code>["l", "com.example.vocabulary:my-label"]</code>. This may be
preferred when defining more formal vocabularies that should not be
confused with another namespace when querying without an <code>L</code>
tag. For these vocabularies, all labels SHOULD include the namespace
(rather than mixing qualified and unqualified labels).</p>
<p>A good heuristic for whether a use case fits this NIP is whether
labels would ever be unique. For example, many events might be labeled
with a particular place, topic, or pubkey, but labels with specific
values like “John Doe” or “3.18743” are not labels, they are values, and
should be handled in some other way.</p>
<h2 id="appendix-known-ontologies">Appendix: Known Ontologies</h2>
<p>Below is a non-exhaustive list of ontologies currently in widespread
use.</p>
<ul>
<li>(social.ontolo.categories)[https://ontolo.social/]</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>31</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-31">NIP-31</h1>
<h2 id="dealing-with-unknown-event-kinds">Dealing with unknown event
kinds</h2>
<p><code>draft</code> <code>optional</code></p>
<p>When creating a new custom event kind that is part of a custom
protocol and isn’t meant to be read as text (like <code>kind:1</code>),
clients should use an <code>alt</code> tag to write a short
human-readable plaintext summary of what that event is about.</p>
<p>The intent is that social clients, used to display only
<code>kind:1</code> notes, can still show something in case a custom
event pops up in their timelines. The content of the <code>alt</code>
tag should provide enough context for a user that doesn’t know anything
about this event kind to understand what it is.</p>
<p>These clients that only know <code>kind:1</code> are not expected to
ask relays for events of different kinds, but users could still
reference these weird events on their notes, and without proper context
these could be nonsensical notes. Having the fallback text makes that
situation much better – even if only for making the user aware that they
should try to view that custom event elsewhere.</p>
<p><code>kind:1</code>-centric clients can make interacting with these
event kinds more functional by supporting <a
href="https://github.com/nostr-protocol/nips/blob/master/89.md.css.html">NIP-89</a>.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>30</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-30">NIP-30</h1>
<h2 id="custom-emoji">Custom Emoji</h2>
<p><code>draft</code> <code>optional</code></p>
<p>Custom emoji may be added to <strong>kind 0</strong>, <strong>kind
1</strong>, <strong>kind 7</strong> (<a href="25.md.css.html">NIP-25</a>) and
<strong>kind 30315</strong> (<a href="38.md.css.html">NIP-38</a>) events by
including one or more <code>"emoji"</code> tags, in the form:</p>
<pre><code>[&quot;emoji&quot;, &lt;shortcode&gt;, &lt;image-url&gt;]</code></pre>
<p>Where:</p>
<ul>
<li><code>&lt;shortcode&gt;</code> is a name given for the emoji, which
MUST be comprised of only alphanumeric characters and underscores.</li>
<li><code>&lt;image-url&gt;</code> is a URL to the corresponding image
file of the emoji.</li>
</ul>
<p>For each emoji tag, clients should parse emoji shortcodes (aka
“emojify”) like <code>:shortcode:</code> in the event to display custom
emoji.</p>
<p>Clients may allow users to add custom emoji to an event by including
<code>:shortcode:</code> identifier in the event, and adding the
relevant <code>"emoji"</code> tags.</p>
<h3 id="kind-0-events">Kind 0 events</h3>
<p>In kind 0 events, the <code>name</code> and <code>about</code> fields
should be emojified.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;{</span><span class="ch">\&quot;</span><span class="st">name</span><span class="ch">\&quot;</span><span class="st">:</span><span class="ch">\&quot;</span><span class="st">Alex Gleason :soapbox:</span><span class="ch">\&quot;</span><span class="st">}&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;emoji&quot;</span><span class="ot">,</span> <span class="st">&quot;soapbox&quot;</span><span class="ot">,</span> <span class="st">&quot;https://gleasonator.com/emoji/Gleasonator/soapbox.png&quot;</span><span class="ot">]</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;79c2cae114ea28a981e7559b4fe7854a473521a8d22a66bbab9fa248eb820ff6&quot;</span><span class="fu">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1682790000</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="kind-1-events">Kind 1 events</h3>
<p>In kind 1 events, the <code>content</code> should be emojified.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Hello :gleasonator: 😂 :ablobcatrainbow: :disputed: yolo&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;emoji&quot;</span><span class="ot">,</span> <span class="st">&quot;ablobcatrainbow&quot;</span><span class="ot">,</span> <span class="st">&quot;https://gleasonator.com/emoji/blobcat/ablobcatrainbow.png&quot;</span><span class="ot">],</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;emoji&quot;</span><span class="ot">,</span> <span class="st">&quot;disputed&quot;</span><span class="ot">,</span> <span class="st">&quot;https://gleasonator.com/emoji/Fun/disputed.png&quot;</span><span class="ot">],</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;emoji&quot;</span><span class="ot">,</span> <span class="st">&quot;gleasonator&quot;</span><span class="ot">,</span> <span class="st">&quot;https://gleasonator.com/emoji/Gleasonator/gleasonator.png&quot;</span><span class="ot">]</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;79c2cae114ea28a981e7559b4fe7854a473521a8d22a66bbab9fa248eb820ff6&quot;</span><span class="fu">,</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1682630000</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>29</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-29">NIP-29</h1>
<h2 id="relay-based-groups">Relay-based Groups</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines a standard for groups that are only writable by a
closed set of users. They can be public for reading by external users or
not.</p>
<p>Groups are identified by a random string of any length that serves as
an <em>id</em>.</p>
<p>There is no way to create a group, what happens is just that relays
(most likely when asked by users) will create rules around some specific
ids so these ids can serve as an actual group, henceforth messages sent
to that group will be subject to these rules.</p>
<p>Normally a group will originally belong to one specific relay, but
the community may choose to move the group to other relays or even fork
the group so it exists in different forms – still using the same
<em>id</em> – across different relays.</p>
<h2 id="relay-generated-events">Relay-generated events</h2>
<p>Relays are supposed to generate the events that describe group
metadata and group admins. These are parameterized replaceable events
signed by the relay keypair directly, with the group <em>id</em> as the
<code>d</code> tag.</p>
<h2 id="group-identifier">Group identifier</h2>
<p>A group may be identified by a string in the format
<code>&lt;host&gt;'&lt;group-id&gt;</code>. For example, a group with
<em>id</em> <code>abcdef</code> hosted at the relay
<code>wss://groups.nostr.com</code> would be identified by the string
<code>groups.nostr.com'abcdef</code>.</p>
<h2 id="the-h-tag">The <code>h</code> tag</h2>
<p>Events sent by users to groups (chat messages, text notes, moderation
events etc) must have an <code>h</code> tag with the value set to the
group <em>id</em>.</p>
<h2 id="timeline-references">Timeline references</h2>
<p>In order to not be used out of context, events sent to these groups
may contain references to previous events seen from the same relay in
the <code>previous</code> tag. The choice of which previous events to
pick belongs to the clients. The references are to be made using the
first 8 characters (4 bytes) of any event in the last 50 events seen by
the user in the relay, excluding events by themselves. There can be any
number of references (including zero), but it’s recommended that clients
include at least 3 and that relays enforce this.</p>
<p>This is a hack to prevent messages from being broadcasted to external
relays that have forks of one group out of context. Relays are expected
to reject any events that contain timeline references to events not
found in their own database. Clients should also check these to keep
relays honest about them.</p>
<h2 id="late-publication">Late publication</h2>
<p>Relays should prevent late publication (messages published now with a
timestamp from days or even hours ago) unless they are open to receive a
group forked or moved from another relay.</p>
<h2 id="event-definitions">Event definitions</h2>
<ul>
<li><em>text root note</em> (<code>kind:11</code>)</li>
</ul>
<p>This is the basic unit of a “microblog” root text note sent to a
group.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">11</span><span class="op">,</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;hello my friends lovers of pizza&quot;</span><span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;h&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;group-id&gt;&quot;</span>]<span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;previous&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;event-id-first-chars&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;event-id-first-chars&gt;&quot;</span><span class="op">,</span> <span class="op">...</span>]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
<ul>
<li><em>threaded text reply</em> (<code>kind:12</code>)</li>
</ul>
<p>This is the basic unit of a “microblog” reply note sent to a group.
It’s the same as <code>kind:11</code>, except for the fact that it must
be used whenever it’s in reply to some other note (either in reply to a
<code>kind:11</code> or a <code>kind:12</code>). <code>kind:12</code>
events SHOULD use NIP-10 markers, leaving an empty relay url:</p>
<ul>
<li><p><code>["e", "&lt;kind-11-root-id&gt;", "", "root"]</code></p></li>
<li><p><code>["e", "&lt;kind-12-event-id&gt;", "", "reply"]</code></p></li>
<li><p><em>chat message</em> (<code>kind:9</code>)</p></li>
</ul>
<p>This is the basic unit of a <em>chat message</em> sent to a
group.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;hello my friends lovers of pizza&quot;</span><span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;h&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;group-id&gt;&quot;</span>]<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;previous&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;event-id-first-chars&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;event-id-first-chars&gt;&quot;</span><span class="op">,</span> <span class="op">...</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
<ul>
<li><em>chat message threaded reply</em> (<code>kind:10</code>)</li>
</ul>
<p>Similar to <code>kind:12</code>, this is the basic unit of a chat
message sent to a group. This is intended for in-chat threads that may
be hidden by default. Not all in-chat replies MUST use
<code>kind:10</code>, only when the intention is to create a hidden
thread that isn’t part of the normal flow of the chat (although clients
are free to display those by default too).</p>
<p><code>kind:10</code> SHOULD use NIP-10 markers, just like
<code>kind:12</code>.</p>
<ul>
<li><em>join request</em> (<code>kind:9021</code>)</li>
</ul>
<p>Any user can send one of these events to the relay in order to be
automatically or manually added to the group. If the group is
<code>open</code> the relay will automatically issue a
<code>kind:9000</code> in response adding this user. Otherwise group
admins may choose to query for these requests and act upon them.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">9021</span><span class="op">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;optional reason&quot;</span><span class="op">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;h&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;group-id&gt;&quot;</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li><em>moderation events</em> (<code>kinds:9000-9020</code>)
(optional)</li>
</ul>
<p>Clients can send these events to a relay in order to accomplish a
moderation action. Relays must check if the pubkey sending the event is
capable of performing the given action. The relay may discard the event
after taking action or keep it as a moderation log.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">90</span><span class="er">xx</span><span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;optional reason&quot;</span><span class="op">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;h&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;group-id&gt;&quot;</span>]<span class="op">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;previous&quot;</span><span class="op">,</span> <span class="op">...</span>]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Each moderation action uses a different kind and requires different
arguments, which are given as tags. These are defined in the following
table:</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>kind</th>
<th>name</th>
<th>tags</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>9000</td>
<td><code>add-user</code></td>
<td><code>p</code> (pubkey hex)</td>
</tr>
<tr class="even">
<td>9001</td>
<td><code>remove-user</code></td>
<td><code>p</code> (pubkey hex)</td>
</tr>
<tr class="odd">
<td>9002</td>
<td><code>edit-metadata</code></td>
<td><code>name</code>, <code>about</code>, <code>picture</code>
(string)</td>
</tr>
<tr class="even">
<td>9003</td>
<td><code>add-permission</code></td>
<td><code>p</code> (pubkey), <code>permission</code> (name)</td>
</tr>
<tr class="odd">
<td>9004</td>
<td><code>remove-permission</code></td>
<td><code>p</code> (pubkey), <code>permission</code> (name)</td>
</tr>
<tr class="even">
<td>9005</td>
<td><code>delete-event</code></td>
<td><code>e</code> (id hex)</td>
</tr>
<tr class="odd">
<td>9006</td>
<td><code>edit-group-status</code></td>
<td><code>public</code> or <code>private</code>, <code>open</code> or
<code>closed</code></td>
</tr>
</tbody>
</table>
<ul>
<li><em>group metadata</em> (<code>kind:39000</code>) (optional)</li>
</ul>
<p>This event defines the metadata for the group – basically how clients
should display it. It must be generated and signed by the relay in which
is found. Relays shouldn’t accept these events if they’re signed by
anyone else.</p>
<p>If the group is forked and hosted in multiple relays, there will be
multiple versions of this event in each different relay and so on.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">39000</span><span class="op">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;d&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;group-id&gt;&quot;</span>]<span class="op">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="st">&quot;Pizza Lovers&quot;</span>]<span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;picture&quot;</span><span class="op">,</span> <span class="st">&quot;https://pizza.com/pizza.png&quot;</span>]<span class="op">,</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;about&quot;</span><span class="op">,</span> <span class="st">&quot;a group for people who love pizza&quot;</span>]<span class="op">,</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;public&quot;</span>]<span class="op">,</span> <span class="co">// or [&quot;private&quot;]</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;open&quot;</span>] <span class="co">// or [&quot;closed&quot;]</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>name</code>, <code>picture</code> and <code>about</code> are
basic metadata for the group for display purposes. <code>public</code>
signals the group can be <em>read</em> by anyone, while
<code>private</code> signals that only AUTHed users can read.
<code>open</code> signals that anyone can request to join and the
request will be automatically granted, while <code>closed</code> signals
that members must be pre-approved or that requests to join will be
manually handled.</p>
<ul>
<li><em>group admins</em> (<code>kind:39001</code>) (optional)</li>
</ul>
<p>Similar to the group metadata, this event is supposed to be generated
by relays that host the group.</p>
<p>Each admin gets a label that is only used for display purposes, and a
list of permissions it has are listed afterwards. These permissions can
inform client building UI, but ultimately are evaluated by the relay in
order to become effective.</p>
<p>The list of capabilities, as defined by this NIP, for now, is the
following:</p>
<ul>
<li><code>add-user</code></li>
<li><code>edit-metadata</code></li>
<li><code>delete-event</code></li>
<li><code>remove-user</code></li>
<li><code>add-permission</code></li>
<li><code>remove-permission</code></li>
<li><code>edit-group-status</code></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">39001</span><span class="op">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;list of admins for the pizza lovers group&quot;</span><span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;d&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;group-id&gt;&quot;</span>]<span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;p&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;pubkey1-as-hex&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;ceo&quot;</span><span class="op">,</span> <span class="st">&quot;add-user&quot;</span><span class="op">,</span> <span class="st">&quot;edit-metadata&quot;</span><span class="op">,</span> <span class="st">&quot;delete-event&quot;</span><span class="op">,</span> <span class="st">&quot;remove-user&quot;</span>]<span class="op">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;p&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;pubkey2-as-hex&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;secretary&quot;</span><span class="op">,</span> <span class="st">&quot;add-user&quot;</span><span class="op">,</span> <span class="st">&quot;delete-event&quot;</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li><em>group members</em> (<code>kind:39002</code>) (optional)</li>
</ul>
<p>Similar to <em>group admins</em>, this event is supposed to be
generated by relays that host the group.</p>
<p>It’s a NIP-51-like list of pubkeys that are members of the group.
Relays might choose to not to publish this information or to restrict
what pubkeys can fetch it.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">39002</span><span class="fu">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;list of members for the pizza lovers group&quot;</span><span class="fu">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;group-id&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;admin1&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;member-pubkey1&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;&lt;member-pubkey2&gt;&quot;</span><span class="ot">],</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="storing-the-list-of-groups-a-user-belongs-to">Storing the list
of groups a user belongs to</h2>
<p>A definition for kind <code>10009</code> was included in <a
href="51.md.css.html">NIP-51</a> that allows clients to store the list of groups
a user wants to remember being in.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>28</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-28">NIP-28</h1>
<h2 id="public-chat">Public Chat</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines new event kinds for public chat channels, channel
messages, and basic client-side moderation.</p>
<p>It reserves five event kinds (40-44) for immediate use:</p>
<ul>
<li><code>40 - channel create</code></li>
<li><code>41 - channel metadata</code></li>
<li><code>42 - channel message</code></li>
<li><code>43 - hide message</code></li>
<li><code>44 - mute user</code></li>
</ul>
<p>Client-centric moderation gives client developers discretion over
what types of content they want included in their apps, while imposing
no additional requirements on relays.</p>
<h2 id="kind-40-create-channel">Kind 40: Create channel</h2>
<p>Create a public chat channel.</p>
<p>In the channel creation <code>content</code> field, Client SHOULD
include basic channel metadata (<code>name</code>, <code>about</code>,
<code>picture</code> and <code>relays</code> as specified in kind
41).</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;{</span><span class="ch">\&quot;</span><span class="st">name</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">Demo Channel</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">about</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">A test channel.</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">picture</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">https://placekitten.com/200/200</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">relays</span><span class="ch">\&quot;</span><span class="st">: [</span><span class="ch">\&quot;</span><span class="st">wss://nos.lol</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">wss://nostr.mom</span><span class="ch">\&quot;</span><span class="st">]}&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="kind-41-set-channel-metadata">Kind 41: Set channel metadata</h2>
<p>Update a channel’s public metadata.</p>
<p>Clients and relays SHOULD handle kind 41 events similar to kind 33
replaceable events, where the information is used to update the
metadata, without modifying the event id for the channel.Only the most
recent kind 41 is needed to be stored.</p>
<p>Clients SHOULD ignore kind 41s from pubkeys other than the kind 40
pubkey.</p>
<p>Clients SHOULD support basic metadata fields:</p>
<ul>
<li><code>name</code> - string - Channel name</li>
<li><code>about</code> - string - Channel description</li>
<li><code>picture</code> - string - URL of channel picture</li>
<li><code>relays</code> - array - List of relays to download and
broadcast events to</li>
</ul>
<p>Clients MAY add additional metadata fields.</p>
<p>Clients SHOULD use <a href="10.md.css.html">NIP-10</a> marked “e” tags to
recommend a relay.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;{</span><span class="ch">\&quot;</span><span class="st">name</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">Updated Demo Channel</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">about</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">Updating a test channel.</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">picture</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">https://placekitten.com/201/201</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">relays</span><span class="ch">\&quot;</span><span class="st">: [</span><span class="ch">\&quot;</span><span class="st">wss://nos.lol</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">wss://nostr.mom</span><span class="ch">\&quot;</span><span class="st">]}&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;channel_create_event_id&gt;</span><span class="ot">,</span> <span class="er">&lt;relay-url&gt;</span><span class="ot">]]</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="kind-42-create-channel-message">Kind 42: Create channel
message</h2>
<p>Send a text message to a channel.</p>
<p>Clients SHOULD use <a href="10.md.css.html">NIP-10</a> marked “e” tags to
recommend a relay and specify whether it is a reply or root message.</p>
<p>Clients SHOULD append <a href="10.md.css.html">NIP-10</a> “p” tags to
replies.</p>
<p>Root message:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="er">&lt;string&gt;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;kind_</span><span class="dv">40</span><span class="er">_event_id&gt;</span><span class="ot">,</span> <span class="er">&lt;relay-url&gt;</span><span class="ot">,</span> <span class="st">&quot;root&quot;</span><span class="ot">]]</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Reply to another message:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="er">&lt;string&gt;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;kind_</span><span class="dv">40</span><span class="er">_event_id&gt;</span><span class="ot">,</span> <span class="er">&lt;relay-url&gt;</span><span class="ot">,</span> <span class="st">&quot;root&quot;</span><span class="ot">],</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;kind_</span><span class="dv">42</span><span class="er">_event_id&gt;</span><span class="ot">,</span> <span class="er">&lt;relay-url&gt;</span><span class="ot">,</span> <span class="st">&quot;reply&quot;</span><span class="ot">],</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;pubkey&gt;</span><span class="ot">,</span> <span class="er">&lt;relay-url&gt;</span><span class="ot">],</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="er">...</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="kind-43-hide-message">Kind 43: Hide message</h2>
<p>User no longer wants to see a certain message.</p>
<p>The <code>content</code> may optionally include metadata such as a
<code>reason</code>.</p>
<p>Clients SHOULD hide event 42s shown to a given user, if there is an
event 43 from that user matching the event 42 <code>id</code>.</p>
<p>Clients MAY hide event 42s for other users other than the user who
sent the event 43.</p>
<p>(For example, if three users ‘hide’ an event giving a reason that
includes the word ‘pornography’, a Nostr client that is an iOS app may
choose to hide that message for all iOS clients.)</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;{</span><span class="ch">\&quot;</span><span class="st">reason</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">Dick pic</span><span class="ch">\&quot;</span><span class="st">}&quot;</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;kind_</span><span class="dv">42</span><span class="er">_event_id&gt;</span><span class="ot">]]</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="kind-44-mute-user">Kind 44: Mute user</h2>
<p>User no longer wants to see messages from another user.</p>
<p>The <code>content</code> may optionally include metadata such as a
<code>reason</code>.</p>
<p>Clients SHOULD hide event 42s shown to a given user, if there is an
event 44 from that user matching the event 42 <code>pubkey</code>.</p>
<p>Clients MAY hide event 42s for users other than the user who sent the
event 44.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;{</span><span class="ch">\&quot;</span><span class="st">reason</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">Posting dick pics</span><span class="ch">\&quot;</span><span class="st">}&quot;</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="er">&lt;pubkey&gt;</span><span class="ot">]]</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="relay-recommendations">Relay recommendations</h2>
<p>Clients SHOULD use the relay URLs of the metadata events.</p>
<p>Clients MAY use any relay URL. For example, if a relay hosting the
original kind 40 event for a channel goes offline, clients could instead
fetch channel data from a backup relay, or a relay that clients trust
more than the original relay.</p>
<h2 id="motivation">Motivation</h2>
<p>If we’re solving censorship-resistant communication for social media,
we may as well solve it also for Telegram-style messaging.</p>
<p>We can bring the global conversation out from walled gardens into a
true public square open to all.</p>
<h2 id="additional-info">Additional info</h2>
<ul>
<li><a href="https://github.com/ArcadeCity/arcade/pull/28">Chat demo PR
with fiatjaf+jb55 comments</a></li>
<li><a href="https://t.me/nostr_protocol/29566">Conversation about
NIP16</a></li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>27</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-27">NIP-27</h1>
<h2 id="text-note-references">Text Note References</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This document standardizes the treatment given by clients of inline
references of other events and profiles inside the <code>.content</code>
of any event that has readable text in its <code>.content</code> (such
as kinds 1 and 30023).</p>
<p>When creating an event, clients should include mentions to other
profiles and to other events in the middle of the <code>.content</code>
using <a href="21.md.css.html">NIP-21</a> codes, such as
<code>nostr:nprofile1qqsw3dy8cpu...6x2argwghx6egsqstvg</code>.</p>
<p>Including <a href="10.md.css.html">NIP-10</a>-style tags
(<code>["e", &lt;hex-id&gt;, &lt;relay-url&gt;, &lt;marker&gt;]</code>)
for each reference is optional, clients should do it whenever they want
the profile being mentioned to be notified of the mention, or when they
want the referenced event to recognize their mention as a reply.</p>
<p>A reader client that receives an event with such
<code>nostr:...</code> mentions in its <code>.content</code> can do any
desired context augmentation (for example, linking to the profile or
showing a preview of the mentioned event contents) it wants in the
process. If turning such mentions into links, they could become internal
links, <a href="21.md.css.html">NIP-21</a> links or direct links to web clients
that will handle these references.</p>
<hr />
<h2 id="example-of-a-profile-mention-process">Example of a profile
mention process</h2>
<p>Suppose Bob is writing a note in a client that has
search-and-autocomplete functionality for users that is triggered when
they write the character <code>@</code>.</p>
<p>As Bob types <code>"hello @mat"</code> the client will prompt him to
autocomplete with <a
href="https://gateway.nostr.com/p/2c7cc62a697ea3a7826521f3fd34f0cb273693cbe5e9310f35449f43622a5cdc">mattn’s
profile</a>, showing a picture and name.</p>
<p>Bob presses “enter” and now he sees his typed note as
<code>"hello @mattn"</code>, <code>@mattn</code> is highlighted,
indicating that it is a mention. Internally, however, the event looks
like this:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;hello nostr:nprofile1qqszclxx9f5haga8sfjjrulaxncvkfekj097t6f3pu65f86rvg49ehqj6f9dh&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1679790774</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;f39e9b451a73d62abc5016cffdd294b1a904e2f34536a208874fe5e22bbd47cf&quot;</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798&quot;</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;f8c8bab1b90cc3d2ae1ad999e6af8af449ad8bb4edf64807386493163e29162b5852a796a8f474d6b1001cddbaac0de4392838574f5366f03cc94cf5dfb43f4d&quot;</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;p&quot;</span><span class="ot">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;2c7cc62a697ea3a7826521f3fd34f0cb273693cbe5e9310f35449f43622a5cdc&quot;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>(Alternatively, the mention could have been a
<code>nostr:npub1...</code> URL.)</p>
<p>After Bob publishes this event and Carol sees it, her client will
initially display the <code>.content</code> as it is, but later it will
parse the <code>.content</code> and see that there is a
<code>nostr:</code> URL in there, decode it, extract the public key from
it (and possibly relay hints), fetch that profile from its internal
database or relays, then replace the full URL with the name
<code>@mattn</code>, with a link to the internal page view for that
profile.</p>
<h2 id="verbose-and-probably-unnecessary-considerations">Verbose and
probably unnecessary considerations</h2>
<ul>
<li>The example above was very concrete, but it doesn’t mean all clients
have to implement the same flow. There could be clients that do not
support autocomplete at all, so they just allow users to paste raw <a
href="19.md.css.html">NIP-19</a> codes into the body of text, then prefix these
with <code>nostr:</code> before publishing the event.</li>
<li>The flow for referencing other events is similar: a user could paste
a <code>note1...</code> or <code>nevent1...</code> code and the client
will turn that into a <code>nostr:note1...</code> or
<code>nostr:nevent1...</code> URL. Then upon reading such references the
client may show the referenced note in a preview box or something like
that – or nothing at all.</li>
<li>Other display procedures can be employed: for example, if a client
that is designed for dealing with only <code>kind:1</code> text notes
sees, for example, a <a href="23.md.css.html"><code>kind:30023</code></a>
<code>nostr:naddr1...</code> URL reference in the <code>.content</code>,
it can, for example, decide to turn that into a link to some hardcoded
webapp capable of displaying such events.</li>
<li>Clients may give the user the option to include or not include tags
for mentioned events or profiles. If someone wants to mention
<code>mattn</code> without notifying them, but still have a nice
augmentable/clickable link to their profile inside their note, they can
instruct their client to <em>not</em> create a <code>["p", ...]</code>
tag for that specific mention.</li>
<li>In the same way, if someone wants to reference another note but
their reference is not meant to show up along other replies to that same
note, their client can choose to not include a corresponding
<code>["e", ...]</code> tag for any given <code>nostr:nevent1...</code>
URL inside <code>.content</code>. Clients may decide to expose these
advanced functionalities to users or be more opinionated about
things.</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>26</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-26">NIP-26</h1>
<h2 id="delegated-event-signing">Delegated Event Signing</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines how events can be delegated so that they can be
signed by other keypairs.</p>
<p>Another application of this proposal is to abstract away the use of
the ‘root’ keypairs when interacting with clients. For example, a user
could generate new keypairs for each client they wish to use and
authorize those keypairs to generate events on behalf of their root
pubkey, where the root keypair is stored in cold storage.</p>
<h4 id="introducing-the-delegation-tag">Introducing the ‘delegation’
tag</h4>
<p>This NIP introduces a new tag: <code>delegation</code> which is
formatted as follows:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;delegation&quot;</span><span class="ot">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;pubkey</span> <span class="er">of</span> <span class="er">the</span> <span class="er">delegator&gt;</span><span class="ot">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;conditions</span> <span class="er">query</span> <span class="er">string&gt;</span><span class="ot">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;delegation</span> <span class="er">token:</span> <span class="dv">64</span><span class="er">-byte</span> <span class="er">Schnorr</span> <span class="er">signature</span> <span class="er">of</span> <span class="er">the</span> <span class="er">sha256</span> <span class="er">hash</span> <span class="er">of</span> <span class="er">the</span> <span class="er">delegation</span> <span class="er">string&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<h5 id="delegation-token">Delegation Token</h5>
<p>The <strong>delegation token</strong> should be a 64-byte Schnorr
signature of the sha256 hash of the following string:</p>
<pre><code>nostr:delegation:&lt;pubkey of publisher (delegatee)&gt;:&lt;conditions query string&gt;</code></pre>
<h5 id="conditions-query-string">Conditions Query String</h5>
<p>The following fields and operators are supported in the above query
string:</p>
<p><em>Fields</em>: 1. <code>kind</code> - <em>Operators</em>: -
<code>=${KIND_NUMBER}</code> - delegatee may only sign events of this
kind 2. <code>created_at</code> - <em>Operators</em>: -
<code>&lt;${TIMESTAMP}</code> - delegatee may only sign events created
<strong><em>before</em></strong> the specified timestamp -
<code>&gt;${TIMESTAMP}</code> - delegatee may only sign events created
<strong><em>after</em></strong> the specified timestamp</p>
<p>In order to create a single condition, you must use a supported field
and operator. Multiple conditions can be used in a single query string,
including on the same field. Conditions must be combined with
<code>&amp;</code>.</p>
<p>For example, the following condition strings are valid:</p>
<ul>
<li><code>kind=1&amp;created_at&lt;1675721813</code></li>
<li><code>kind=0&amp;kind=1&amp;created_at&gt;1675721813</code></li>
<li><code>kind=1&amp;created_at&gt;1674777689&amp;created_at&lt;1675721813</code></li>
</ul>
<p>For the vast majority of use-cases, it is advisable that: 1. Query
strings should include a <code>created_at</code>
<strong><em>after</em></strong> condition reflecting the current time,
to prevent the delegatee from publishing historic notes on the
delegator’s behalf. 2. Query strings should include a
<code>created_at</code> <strong><em>before</em></strong> condition that
is not empty and is not some extremely distant time in the future. If
delegations are not limited in time scope, they expose similar security
risks to simply using the root key for authentication.</p>
<h4 id="example">Example</h4>
<pre><code># Delegator:
privkey: ee35e8bb71131c02c1d7e73231daa48e9953d329a4b701f7133c8f46dd21139c
pubkey:  8e0d3d3eb2881ec137a11debe736a9086715a8c8beeeda615780064d68bc25dd

# Delegatee:
privkey: 777e4f60b4aa87937e13acc84f7abcc3c93cc035cb4c1e9f7a9086dd78fffce1
pubkey:  477318cfb5427b9cfc66a9fa376150c1ddbc62115ae27cef72417eb959691396</code></pre>
<p>Delegation string to grant note publishing authorization to the
delegatee (477318cf) from now, for the next 30 days, given the current
timestamp is <code>1674834236</code>.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="er">nostr:delegation:477318cfb5427b9cfc66a9fa376150c1ddbc62115ae27cef72417eb959691396:kind=1&amp;created_at&gt;1674834236&amp;created_at&lt;1677426236</span></span></code></pre></div>
<p>The delegator (8e0d3d3e) then signs a SHA256 hash of the above
delegation string, the result of which is the delegation token:</p>
<pre><code>6f44d7fe4f1c09f3954640fb58bd12bae8bb8ff4120853c4693106c82e920e2b898f1f9ba9bd65449a987c39c0423426ab7b53910c0c6abfb41b30bc16e5f524</code></pre>
<p>The delegatee (477318cf) can now construct an event on behalf of the
delegator (8e0d3d3e). The delegatee then signs the event with its own
private key and publishes.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;e93c6095c3db1c31d15ac771f8fc5fb672f6e52cd25505099f62cd055523224f&quot;</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;477318cfb5427b9cfc66a9fa376150c1ddbc62115ae27cef72417eb959691396&quot;</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1677426298</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;delegation&quot;</span><span class="ot">,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;8e0d3d3eb2881ec137a11debe736a9086715a8c8beeeda615780064d68bc25dd&quot;</span><span class="ot">,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;kind=1&amp;created_at&gt;1674834236&amp;created_at&lt;1677426236&quot;</span><span class="ot">,</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;6f44d7fe4f1c09f3954640fb58bd12bae8bb8ff4120853c4693106c82e920e2b898f1f9ba9bd65449a987c39c0423426ab7b53910c0c6abfb41b30bc16e5f524&quot;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Hello, world!&quot;</span><span class="fu">,</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;633db60e2e7082c13a47a6b19d663d45b2a2ebdeaf0b4c35ef83be2738030c54fc7fd56d139652937cdca875ee61b51904a1d0d0588a6acd6168d7be2909d693&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The event should be considered a valid delegation if the conditions
are satisfied (<code>kind=1</code>,
<code>created_at&gt;1674834236</code> and
<code>created_at&lt;1677426236</code> in this example) and, upon
validation of the delegation token, are found to be unchanged from the
conditions in the original delegation string.</p>
<p>Clients should display the delegated note as if it was published
directly by the delegator (8e0d3d3e).</p>
<h4 id="relay-client-support">Relay &amp; Client Support</h4>
<p>Relays should answer requests such as
<code>["REQ", "", {"authors": ["A"]}]</code> by querying both the
<code>pubkey</code> and delegation tags <code>[1]</code> value.</p>
<p>Relays SHOULD allow the delegator (8e0d3d3e) to delete the events
published by the delegatee (477318cf).</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>25</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-25">NIP-25</h1>
<h2 id="reactions">Reactions</h2>
<p><code>draft</code> <code>optional</code></p>
<p>A reaction is a <code>kind 7</code> event that is used to react to
other events.</p>
<p>The generic reaction, represented by the <code>content</code> set to
a <code>+</code> string, SHOULD be interpreted as a “like” or
“upvote”.</p>
<p>A reaction with <code>content</code> set to <code>-</code> SHOULD be
interpreted as a “dislike” or “downvote”. It SHOULD NOT be counted as a
“like”, and MAY be displayed as a downvote or dislike on a post. A
client MAY also choose to tally likes against dislikes in a reddit-like
system of upvotes and downvotes, or display them as separate
tallies.</p>
<p>The <code>content</code> MAY be an emoji, or <a
href="30.md.css.html">NIP-30</a> custom emoji in this case it MAY be interpreted
as a “like” or “dislike”, or the client MAY display this emoji reaction
on the post. If the <code>content</code> is an empty string then the
client should consider it a “+”.</p>
<h2 id="tags">Tags</h2>
<p>The reaction event SHOULD include <code>a</code>, <code>e</code> and
<code>p</code> tags pointing to the note the user is reacting to. The
<code>p</code> tag allows authors to be notified. The <code>e</code>
tags enables clients to pull all the reactions to individual events and
<code>a</code> tags enables clients to seek reactions for all versions
of a replaceable event.</p>
<p>The <code>e</code> tag MUST be the <code>id</code> of the note that
is being reacted to.</p>
<p>The <code>a</code> tag MUST contain the coordinates
(<code>kind:pubkey:d-tag</code>) of the replaceable being reacted
to.</p>
<p>The <code>p</code> tag MUST be the <code>pubkey</code> of the event
being reacted to.</p>
<p>The reaction event MAY include a <code>k</code> tag with the
stringified kind number of the reacted event as its value.</p>
<p>Example code</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">make_like_event</span><span class="op">(</span><span class="va">pubkey</span><span class="op">:</span> <span class="dt">String</span><span class="op">,</span> <span class="va">privkey</span><span class="op">:</span> <span class="dt">String</span><span class="op">,</span> <span class="va">liked</span><span class="op">:</span> <span class="dt">NostrEvent</span><span class="op">)</span> -&gt; <span class="fu">NostrEvent</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    tags<span class="op">.</span>append<span class="op">([</span><span class="st">&quot;e&quot;</span><span class="op">,</span> liked<span class="op">.</span>id<span class="op">])</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    tags<span class="op">.</span>append<span class="op">([</span><span class="st">&quot;p&quot;</span><span class="op">,</span> liked<span class="op">.</span>pubkey<span class="op">])</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    tags<span class="op">.</span>append<span class="op">([</span><span class="st">&quot;k&quot;</span><span class="op">,</span> liked<span class="op">.</span>kind<span class="op">])</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="va">ev</span> <span class="op">=</span> NostrEvent<span class="op">(</span>content<span class="op">:</span> <span class="st">&quot;+&quot;</span><span class="op">,</span> pubkey<span class="op">:</span> pubkey<span class="op">,</span> kind<span class="op">:</span> <span class="dv">7</span><span class="op">,</span> tags<span class="op">:</span> tags<span class="op">)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    ev<span class="op">.</span>calculate_id<span class="op">()</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    ev<span class="op">.</span>sign<span class="op">(</span>privkey<span class="op">:</span> privkey<span class="op">)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> ev</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="custom-emoji-reaction">Custom Emoji Reaction</h2>
<p>The client may specify a custom emoji (<a href="30.md.css.html">NIP-30</a>)
<code>:shortcode:</code> in the reaction content. The client should
refer to the emoji tag and render the content as an emoji if shortcode
is specified.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">7</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;:soapbox:&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;emoji&quot;</span><span class="ot">,</span> <span class="st">&quot;soapbox&quot;</span><span class="ot">,</span> <span class="st">&quot;https://gleasonator.com/emoji/Gleasonator/soapbox.png&quot;</span><span class="ot">]</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;79c2cae114ea28a981e7559b4fe7854a473521a8d22a66bbab9fa248eb820ff6&quot;</span><span class="fu">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1682790000</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The content can be set only one <code>:shortcode:</code>. And emoji
tag should be one.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>24</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-24">NIP-24</h1>
<h2 id="extra-metadata-fields-and-tags">Extra metadata fields and
tags</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines extra optional fields added to events.</p>
<h1 id="kind-0">kind 0</h1>
<p>These are extra fields not specified in NIP-01 that may be present in
the stringified JSON of metadata events:</p>
<ul>
<li><code>display_name</code>: an alternative, bigger name with richer
characters than <code>name</code>. <code>name</code> should always be
set regardless of the presence of <code>display_name</code> in the
metadata.</li>
<li><code>website</code>: a web URL related in any way to the event
author.</li>
<li><code>banner</code>: an URL to a wide (~1024x768) picture to be
optionally displayed in the background of a profile screen.</li>
<li><code>bot</code>: a boolean to clarify that the content is entirely
or partially the result of automation, such as with chatbots or
newsfeeds.</li>
</ul>
<h3 id="deprecated-fields">Deprecated fields</h3>
<p>These are fields that should be ignored or removed when found in the
wild:</p>
<ul>
<li><code>displayName</code>: use <code>display_name</code>
instead.</li>
<li><code>username</code>: use <code>name</code> instead.</li>
</ul>
<h1 id="kind-3">kind 3</h1>
<p>These are extra fields not specified in NIP-02 that may be present in
the stringified JSON of contacts events:</p>
<h3 id="deprecated-fields-1">Deprecated fields</h3>
<ul>
<li><code>{&lt;relay-url&gt;: {"read": &lt;true|false&gt;, "write": &lt;true|false&gt;}, ...}</code>:
an object of relays used by a user to read/write. <a
href="65.md.css.html">NIP-65</a> should be used instead.</li>
</ul>
<h1 id="tags">tags</h1>
<p>These tags may be present in multiple event kinds. Whenever a
different meaning is not specified by some more specific NIP, they have
the following meanings:</p>
<ul>
<li><code>r</code>: a web URL the event is referring to in some way</li>
<li><code>title</code>: name of <a href="51.md.css.html">NIP-51</a> sets, <a
href="52.md.css.html">NIP-52</a> calendar event, <a href="53.md.css.html">NIP-53</a> live
event or <a href="99.md.css.html">NIP-99</a> listing</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>23</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-23">NIP-23</h1>
<h2 id="long-form-content">Long-form Content</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines <code>kind:30023</code> (a <em>parameterized
replaceable event</em>) for long-form text content, generally referred
to as “articles” or “blog posts”. <code>kind:30024</code> has the same
structure as <code>kind:30023</code> and is used to save long form
drafts.</p>
<p>“Social” clients that deal primarily with <code>kind:1</code> notes
should not be expected to implement this NIP.</p>
<h3 id="format">Format</h3>
<p>The <code>.content</code> of these events should be a string text in
Markdown syntax. To maximize compatibility and readability between
different clients and devices, any client that is creating long form
notes:</p>
<ul>
<li><p>MUST NOT hard line-break paragraphs of text, such as arbitrary
line breaks at 80 column boundaries.</p></li>
<li><p>MUST NOT support adding HTML to Markdown.</p></li>
</ul>
<h3 id="metadata">Metadata</h3>
<p>For the date of the last update the <code>.created_at</code> field
should be used, for “tags”/“hashtags” (i.e. topics about which the event
might be of relevance) the <code>t</code> tag should be used, as per
NIP-12.</p>
<p>Other metadata fields can be added as tags to the event as necessary.
Here we standardize 4 that may be useful, although they remain strictly
optional:</p>
<ul>
<li><code>"title"</code>, for the article title</li>
<li><code>"image"</code>, for a URL pointing to an image to be shown
along with the title</li>
<li><code>"summary"</code>, for the article summary</li>
<li><code>"published_at"</code>, for the timestamp in unix seconds
(stringified) of the first time the article was published</li>
</ul>
<h3 id="editability">Editability</h3>
<p>These articles are meant to be editable, so they should make use of
the parameterized replaceability feature and include a <code>d</code>
tag with an identifier for the article. Clients should take care to only
publish and read these events from relays that implement that. If they
don’t do that they should also take care to hide old versions of the
same article they may receive.</p>
<h3 id="linking">Linking</h3>
<p>The article may be linked to using the <a href="19.md.css.html">NIP-19</a>
<code>naddr</code> code along with the <code>a</code> tag.</p>
<h3 id="references">References</h3>
<p>References to other Nostr notes, articles or profiles must be made
according to <a href="27.md.css.html">NIP-27</a>, i.e. by using <a
href="21.md.css.html">NIP-21</a> <code>nostr:...</code> links and optionally
adding tags for these (see example below).</p>
<h2 id="example-event">Example Event</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">30023</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1675642635</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;Lorem [ipsum][nostr:nevent1qqst8cujky046negxgwwm5ynqwn53t8aqjr6afd8g59nfqwxpdhylpcpzamhxue69uhhyetvv9ujuetcv9khqmr99e3k7mg8arnc9] dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span><span class="ch">\n\n</span><span class="st">Read more at nostr:naddr1qqzkjurnw4ksz9thwden5te0wfjkccte9ehx7um5wghx7un8qgs2d90kkcq3nk2jry62dyf50k0h36rhpdtd594my40w9pkal876jxgrqsqqqa28pccpzu.&quot;</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="st">&quot;lorem-ipsum&quot;</span><span class="ot">],</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;title&quot;</span><span class="ot">,</span> <span class="st">&quot;Lorem Ipsum&quot;</span><span class="ot">],</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;published_at&quot;</span><span class="ot">,</span> <span class="st">&quot;1296962229&quot;</span><span class="ot">],</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;t&quot;</span><span class="ot">,</span> <span class="st">&quot;placeholder&quot;</span><span class="ot">],</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="st">&quot;b3e392b11f5d4f28321cedd09303a748acfd0487aea5a7450b3481c60b6e4f87&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://relay.example.com&quot;</span><span class="ot">],</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;30023:a695f6b60119d9521934a691347d9f78e8770b56da16bb255ee286ddf9fda919:ipsum&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://relay.nostr.org&quot;</span><span class="ot">]</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;...&quot;</span><span class="fu">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;...&quot;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>21</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-21">NIP-21</h1>
<h2 id="nostr-uri-scheme"><code>nostr:</code> URI scheme</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP standardizes the usage of a common URI scheme for maximum
interoperability and openness in the network.</p>
<p>The scheme is <code>nostr:</code>.</p>
<p>The identifiers that come after are expected to be the same as those
defined in <a
href="https://github.com/nostr-protocol/nips/blob/master/19.md.css.html">NIP-19</a>
(except <code>nsec</code>).</p>
<h2 id="examples">Examples</h2>
<ul>
<li><code>nostr:npub1sn0wdenkukak0d9dfczzeacvhkrgz92ak56egt7vdgzn8pv2wfqqhrjdv9</code></li>
<li><code>nostr:nprofile1qqsrhuxx8l9ex335q7he0f09aej04zpazpl0ne2cgukyawd24mayt8gpp4mhxue69uhhytnc9e3k7mgpz4mhxue69uhkg6nzv9ejuumpv34kytnrdaksjlyr9p</code></li>
<li><code>nostr:note1fntxtkcy9pjwucqwa.md.css.htmldn7v03wwwsu9j330jj350nvhpky2tuaspk6nqc</code></li>
<li><code>nostr:nevent1qqstna2yrezu5wghjvswqqculvvwxsrcvu7uc0f78gan4xqhvz49d9spr3mhxue69uhkummnw3ez6un9d3shjtn4de6x2argwghx6egpr4mhxue69uhkummnw3ez6ur4vgh8wetvd3hhyer9wghxuet5nxnepm</code></li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>20</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-20">NIP-20</h1>
<h2 id="command-results">Command Results</h2>
<p><code>final</code> <code>mandatory</code></p>
<p>Moved to <a href="01.md.css.html">NIP-01</a>.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>19</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-19">NIP-19</h1>
<h2 id="bech32-encoded-entities">bech32-encoded entities</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP standardizes bech32-formatted strings that can be used to
display keys, ids and other information in clients. These formats are
not meant to be used anywhere in the core protocol, they are only meant
for displaying to users, copy-pasting, sharing, rendering QR codes and
inputting data.</p>
<p>It is recommended that ids and keys are stored in either hex or
binary format, since these formats are closer to what must actually be
used the core protocol.</p>
<h2 id="bare-keys-and-ids">Bare keys and ids</h2>
<p>To prevent confusion and mixing between private keys, public keys and
event ids, which are all 32 byte strings. bech32-(not-m) encoding with
different prefixes can be used for each of these entities.</p>
<p>These are the possible bech32 prefixes:</p>
<ul>
<li><code>npub</code>: public keys</li>
<li><code>nsec</code>: private keys</li>
<li><code>note</code>: note ids</li>
</ul>
<p>Example: the hex public key
<code>3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d</code>
translates to
<code>npub180cvv07tjdrrgpa0j7j7tmnyl2yr6yr7l8j4s3evf6u64th6gkwsyjh6w6</code>.</p>
<p>The bech32 encodings of keys and ids are not meant to be used inside
the standard NIP-01 event formats or inside the filters, they’re meant
for human-friendlier display and input only. Clients should still accept
keys in both hex and npub format for now, and convert internally.</p>
<h2 id="shareable-identifiers-with-extra-metadata">Shareable identifiers
with extra metadata</h2>
<p>When sharing a profile or an event, an app may decide to include
relay information and other metadata such that other apps can locate and
display these entities more easily.</p>
<p>For these events, the contents are a binary-encoded list of
<code>TLV</code> (type-length-value), with <code>T</code> and
<code>L</code> being 1 byte each (<code>uint8</code>, i.e. a number in
the range of 0-255), and <code>V</code> being a sequence of bytes of the
size indicated by <code>L</code>.</p>
<p>These are the possible bech32 prefixes with <code>TLV</code>:</p>
<ul>
<li><code>nprofile</code>: a nostr profile</li>
<li><code>nevent</code>: a nostr event</li>
<li><code>nrelay</code>: a nostr relay</li>
<li><code>naddr</code>: a nostr <em>replaceable event</em>
coordinate</li>
</ul>
<p>These possible standardized <code>TLV</code> types are indicated
here:</p>
<ul>
<li><code>0</code>: <code>special</code>
<ul>
<li>depends on the bech32 prefix:
<ul>
<li>for <code>nprofile</code> it will be the 32 bytes of the profile
public key</li>
<li>for <code>nevent</code> it will be the 32 bytes of the event id</li>
<li>for <code>nrelay</code>, this is the relay URL</li>
<li>for <code>naddr</code>, it is the identifier (the <code>"d"</code>
tag) of the event being referenced. For non-parameterized replaceable
events, use an empty string.</li>
</ul></li>
</ul></li>
<li><code>1</code>: <code>relay</code>
<ul>
<li>for <code>nprofile</code>, <code>nevent</code> and
<code>naddr</code>, <em>optionally</em>, a relay in which the entity
(profile or event) is more likely to be found, encoded as ascii</li>
<li>this may be included multiple times</li>
</ul></li>
<li><code>2</code>: <code>author</code>
<ul>
<li>for <code>naddr</code>, the 32 bytes of the pubkey of the event</li>
<li>for <code>nevent</code>, <em>optionally</em>, the 32 bytes of the
pubkey of the event</li>
</ul></li>
<li><code>3</code>: <code>kind</code>
<ul>
<li>for <code>naddr</code>, the 32-bit unsigned integer of the kind,
big-endian</li>
<li>for <code>nevent</code>, <em>optionally</em>, the 32-bit unsigned
integer of the kind, big-endian</li>
</ul></li>
</ul>
<h2 id="examples">Examples</h2>
<ul>
<li><code>npub10elfcs4fr0l0r8af98jlmgdh9c8tcxjvz9qkw038js35mp4dma8qzvjptg</code>
should decode into the public key hex
<code>7e7e9c42a91bfef19fa929e5fda1b72e0ebc1a4c1141673e2794234d86addf4e</code>
and vice-versa</li>
<li><code>nsec1vl029mgpspedva04g90vltkh6fvh240zqtv9k0t9af8935ke9laqsnlfe5</code>
should decode into the private key hex
<code>67dea2ed018072d675f5415ecfaed7d2597555e202d85b3d65ea4e58d2d92ffa</code>
and vice-versa</li>
<li><code>nprofile1qqsrhuxx8l9ex335q7he0f09aej04zpazpl0ne2cgukyawd24mayt8gpp4mhxue69uhhytnc9e3k7mgpz4mhxue69uhkg6nzv9ejuumpv34kytnrdaksjlyr9p</code>
should decode into a profile with the following TLV items:
<ul>
<li>pubkey:
<code>3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d</code></li>
<li>relay: <code>wss://r.x.com</code></li>
<li>relay: <code>wss://djbas.sadkb.com</code></li>
</ul></li>
</ul>
<h2 id="notes">Notes</h2>
<ul>
<li><code>npub</code> keys MUST NOT be used in NIP-01 events or in
NIP-05 JSON responses, only the hex format is supported there.</li>
<li>When decoding a bech32-formatted string, TLVs that are not
recognized or supported should be ignored, rather than causing an
error.</li>
</ul>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>18</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-18">NIP-18</h1>
<h2 id="reposts">Reposts</h2>
<p><code>draft</code> <code>optional</code></p>
<p>A repost is a <code>kind 6</code> event that is used to signal to
followers that a <code>kind 1</code> text note is worth reading.</p>
<p>The <code>content</code> of a repost event is <em>the stringified
JSON of the reposted note</em>. It MAY also be empty, but that is not
recommended.</p>
<p>The repost event MUST include an <code>e</code> tag with the
<code>id</code> of the note that is being reposted. That tag MUST
include a relay URL as its third entry to indicate where it can be
fetched.</p>
<p>The repost SHOULD include a <code>p</code> tag with the
<code>pubkey</code> of the event being reposted.</p>
<h2 id="quote-reposts">Quote Reposts</h2>
<p>Quote reposts are <code>kind 1</code> events with an embedded
<code>q</code> tag of the note being quote reposted. The <code>q</code>
tag ensures quote reposts are not pulled and included as replies in
threads. It also allows you to easily pull and count all of the quotes
for a post.</p>
<h2 id="generic-reposts">Generic Reposts</h2>
<p>Since <code>kind 6</code> reposts are reserved for
<code>kind 1</code> contents, we use <code>kind 16</code> as a “generic
repost”, that can include any kind of event inside other than
<code>kind 1</code>.</p>
<p><code>kind 16</code> reposts SHOULD contain a <code>k</code> tag with
the stringified kind number of the reposted event as its value.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>17</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-17">NIP-17</h1>
<h2 id="private-direct-messages">Private Direct Messages</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines an encrypted direct messaging scheme using <a
href="44.md.css.html">NIP-44</a> encryption and <a href="59.md.css.html">NIP-59</a> seals
and gift wraps.</p>
<h2 id="direct-message-kind">Direct Message Kind</h2>
<p>Kind <code>14</code> is a chat message. <code>p</code> tags identify
one or more receivers of the message.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;usual hash&gt;&quot;</span><span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;pubkey&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;sender-pubkey&gt;&quot;</span><span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;created_at&quot;</span><span class="op">:</span> <span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">14</span><span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;p&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;receiver-1-pubkey&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;relay-url&gt;&quot;</span>]<span class="op">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;p&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;receiver-2-pubkey&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;relay-url&gt;&quot;</span>]<span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;e&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;kind-14-id&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;relay-url&gt;&quot;</span><span class="op">,</span> <span class="st">&quot;reply&quot;</span>] <span class="co">// if this is a reply</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;subject&quot;</span><span class="op">,</span> <span class="st">&quot;&lt;conversation-title&gt;&quot;</span>]<span class="op">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at"> </span> <span class="op">...</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;message-in-plain-text&gt;&quot;</span><span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>.content</code> MUST be plain text. Fields <code>id</code> and
<code>created_at</code> are required.</p>
<p>Tags that mention, quote and assemble threading structures MUST
follow <a href="10.md.css.html">NIP-10</a>.</p>
<p>Kind <code>14</code>s MUST never be signed. If it is signed, the
message might leak to relays and become <strong>fully
public</strong>.</p>
<h2 id="chat-rooms">Chat Rooms</h2>
<p>The set of <code>pubkey</code> + <code>p</code> tags defines a chat
room. If a new <code>p</code> tag is added or a current one is removed,
a new room is created with clean message history.</p>
<p>Clients SHOULD render messages of the same room in a continuous
thread.</p>
<p>An optional <code>subject</code> tag defines the current name/topic
of the conversation. Any member can change the topic by simply
submitting a new <code>subject</code> to an existing <code>pubkey</code>
+ <code>p</code>-tags room. There is no need to send
<code>subject</code> in every message. The newest <code>subject</code>
in the thread is the subject of the conversation.</p>
<h2 id="encrypting">Encrypting</h2>
<p>Following <a href="59.md.css.html">NIP-59</a>, the <strong>unsigned</strong>
<code>kind:14</code> chat message must be sealed (<code>kind:13</code>)
and then gift-wrapped (<code>kind:1059</code>) to each receiver and the
sender individually.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;usual hash&gt;&quot;</span><span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;pubkey&quot;</span><span class="op">:</span> randomPublicKey<span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;created_at&quot;</span><span class="op">:</span> <span class="fu">randomTimeUpTo2DaysInThePast</span>()<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">1059</span><span class="op">,</span> <span class="co">// gift wrap</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;p&quot;</span><span class="op">,</span> receiverPublicKey<span class="op">,</span> <span class="st">&quot;&lt;relay-url&gt;&quot;</span>] <span class="co">// receiver</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="fu">nip44Encrypt</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;usual hash&gt;&quot;</span><span class="op">,</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;pubkey&quot;</span><span class="op">:</span> senderPublicKey<span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;created_at&quot;</span><span class="op">:</span> <span class="fu">randomTimeUpTo2DaysInThePast</span>()<span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">13</span><span class="op">,</span> <span class="co">// seal</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;tags&quot;</span><span class="op">:</span> []<span class="op">,</span> <span class="co">// no tags</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="fu">nip44Encrypt</span>(unsignedKind14<span class="op">,</span> senderPrivateKey<span class="op">,</span> receiverPublicKey)<span class="op">,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;sig&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;signed by senderPrivateKey&gt;&quot;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    randomPrivateKey<span class="op">,</span> receiverPublicKey</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;sig&quot;</span><span class="op">:</span> <span class="st">&quot;&lt;signed by randomPrivateKey&gt;&quot;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The encryption algorithm MUST use the latest version of <a
href="44.md.css.html">NIP-44</a>.</p>
<p>Clients MUST verify if pubkey of the <code>kind:13</code> is the same
pubkey on the <code>kind:14</code>, otherwise any sender can impersonate
others by simply changing the pubkey on <code>kind:14</code>.</p>
<p>Clients SHOULD randomize <code>created_at</code> in up to two days in
the past in both the seal and the gift wrap to make sure grouping by
<code>created_at</code> doesn’t reveal any metadata.</p>
<p>The gift wrap’s <code>p</code>-tag can be the receiver’s main pubkey
or an alias key created to receive DMs without exposing the receiver’s
identity.</p>
<p>Clients CAN offer disappearing messages by setting an
<code>expiration</code> tag in the gift wrap of each receiver or by not
generating a gift wrap to the sender’s public key</p>
<h2 id="publishing">Publishing</h2>
<p>Kind <code>10050</code> indicates the user’s preferred relays to
receive DMs. The event MUST include a list of <code>relay</code> tags
with relay URIs.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kind&quot;</span><span class="op">:</span> <span class="dv">10050</span><span class="op">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="op">:</span> [</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;relay&quot;</span><span class="op">,</span> <span class="st">&quot;wss://inbox.nostr.wine&quot;</span>]<span class="op">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">&quot;relay&quot;</span><span class="op">,</span> <span class="st">&quot;wss://myrelay.nostr1.com&quot;</span>]<span class="op">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;content&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">//...other fields</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Clients SHOULD publish kind <code>14</code> events to the
<code>10050</code>-listed relays. If that is not found that indicates
the user is not ready to receive messages under this NIP and clients
shouldn’t try.</p>
<h2 id="relays">Relays</h2>
<p>It’s advisable that relays do not serve <code>kind:14</code> to
clients other than the ones tagged in them.</p>
<p>It’s advisable that users choose relays that conform to these
practices.</p>
<p>Clients SHOULD guide users to keep <code>kind:10050</code> lists
small (1-3 relays) and SHOULD spread it to as many relays as viable.</p>
<h2 id="benefits-limitations">Benefits &amp; Limitations</h2>
<p>This NIP offers the following privacy and security features:</p>
<ol type="1">
<li><strong>No Metadata Leak</strong>: Participant identities, each
message’s real date and time, event kinds, and other event tags are all
hidden from the public. Senders and receivers cannot be linked with
public information alone.</li>
<li><strong>No Public Group Identifiers</strong>: There is no public
central queue, channel or otherwise converging identifier to correlate
or count all messages in the same group.</li>
<li><strong>No Moderation</strong>: There are no group admins: no
invitations or bans.</li>
<li><strong>No Shared Secrets</strong>: No secret must be known to all
members that can leak or be mistakenly shared</li>
<li><strong>Fully Recoverable</strong>: Messages can be fully
recoverable by any client with the user’s private key</li>
<li><strong>Optional Forward Secrecy</strong>: Users and clients can
opt-in for “disappearing messages”.</li>
<li><strong>Uses Public Relays</strong>: Messages can flow through
public relays without loss of privacy. Private relays can increase
privacy further, but they are not required.</li>
<li><strong>Cold Storage</strong>: Users can unilaterally opt-in to
sharing their messages with a separate key that is exclusive for DM
backup and recovery.</li>
</ol>
<p>The main limitation of this approach is having to send a separate
encrypted event to each receiver. Group chats with more than 100
participants should find a more suitable messaging scheme.</p>
<h2 id="implementation">Implementation</h2>
<p>Clients implementing this NIP should by default only connect to the
set of relays found in their <code>kind:10050</code> list. From that
they should be able to load all messages both sent and received as well
as get new live updates, making it for a very simple and lightweight
implementation that should be fast.</p>
<p>When sending a message to anyone, clients must then connect to the
relays in the receiver’s <code>kind:10050</code> and send the events
there, but can disconnect right after unless more messages are expected
to be sent (e.g. the chat tab is still selected). Clients should also
send a copy of their outgoing messages to their own
<code>kind:10050</code> relay set.</p>
<h2 id="examples">Examples</h2>
<p>This example sends the message <code>Hola, que tal?</code> from
<code>nsec1w8udu59ydjvedgs3yv5qccshcj8k05fh3l60k9x57asjrqdpa00qkmr89m</code>
to
<code>nsec12ywtkplvyq5t6twdqwwygavp5lm4fhuang89c943nf2z92eez43szvn4dt</code>.</p>
<p>The two final GiftWraps, one to the receiver and the other to the
sender, are:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="st">&quot;2886780f7349afc1344047524540ee716f7bdc1b64191699855662330bf235d8&quot;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span><span class="st">&quot;8f8a7ec43b77d25799281207e1a47f7a654755055788f7482653f9c9661c6d51&quot;</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span><span class="dv">1703128320</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;kind&quot;</span><span class="fu">:</span><span class="dv">1059</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;tags&quot;</span><span class="fu">:</span><span class="ot">[</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span> <span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;918e2da906df4ccd12c8ac672d8335add131a4cf9d27ce42b3bb3625755f0788&quot;</span><span class="ot">]</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>   <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;content&quot;</span><span class="fu">:</span><span class="st">&quot;AsqzdlMsG304G8h08bE67dhAR1gFTzTckUUyuvndZ8LrGCvwI4pgC3d6hyAK0Wo9gtkLqSr2rT2RyHlE5wRqbCOlQ8WvJEKwqwIJwT5PO3l2RxvGCHDbd1b1o40ZgIVwwLCfOWJ86I5upXe8K5AgpxYTOM1BD+SbgI5jOMA8tgpRoitJedVSvBZsmwAxXM7o7sbOON4MXHzOqOZpALpS2zgBDXSAaYAsTdEM4qqFeik+zTk3+L6NYuftGidqVluicwSGS2viYWr5OiJ1zrj1ERhYSGLpQnPKrqDaDi7R1KrHGFGyLgkJveY/45y0rv9aVIw9IWF11u53cf2CP7akACel2WvZdl1htEwFu/v9cFXD06fNVZjfx3OssKM/uHPE9XvZttQboAvP5UoK6lv9o3d+0GM4/3zP+yO3C0NExz1ZgFmbGFz703YJzM+zpKCOXaZyzPjADXp8qBBeVc5lmJqiCL4solZpxA1865yPigPAZcc9acSUlg23J1dptFK4n3Tl5HfSHP+oZ/QS/SHWbVFCtq7ZMQSRxLgEitfglTNz9P1CnpMwmW/Y4Gm5zdkv0JrdUVrn2UO9ARdHlPsW5ARgDmzaxnJypkfoHXNfxGGXWRk0sKLbz/ipnaQP/eFJv/ibNuSfqL6E4BnN/tHJSHYEaTQ/PdrA2i9laG3vJti3kAl5Ih87ct0w/tzYfp4SRPhEF1zzue9G/16eJEMzwmhQ5Ec7jJVcVGa4RltqnuF8unUu3iSRTQ+/MNNUkK6Mk+YuaJJs6Fjw6tRHuWi57SdKKv7GGkr0zlBUU2Dyo1MwpAqzsCcCTeQSv+8qt4wLf4uhU9Br7F/L0ZY9bFgh6iLDCdB+4iABXyZwT7Ufn762195hrSHcU4Okt0Zns9EeiBOFxnmpXEslYkYBpXw70GmymQfJlFOfoEp93QKCMS2DAEVeI51dJV1e+6t3pCSsQN69Vg6jUCsm1TMxSs2VX4BRbq562+VffchvW2BB4gMjsvHVUSRl8i5/ZSDlfzSPXcSGALLHBRzy+gn0oXXJ/447VHYZJDL3Ig8+QW5oFMgnWYhuwI5QSLEyflUrfSz+Pdwn/5eyjybXKJftePBD9Q+8NQ8zulU5sqvsMeIx/bBUx0fmOXsS3vjqCXW5IjkmSUV7q54GewZqTQBlcx+90xh/LSUxXex7UwZwRnifvyCbZ+zwNTHNb12chYeNjMV7kAIr3cGQv8vlOMM8ajyaZ5KVy7HpSXQjz4PGT2/nXbL5jKt8Lx0erGXsSsazkdoYDG3U&quot;</span><span class="fu">,</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;sig&quot;</span><span class="fu">:</span><span class="st">&quot;a3c6ce632b145c0869423c1afaff4a6d764a9b64dedaf15f170b944ead67227518a72e455567ca1c2a0d187832cecbde7ed478395ec4c95dd3e71749ed66c480&quot;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="st">&quot;162b0611a1911cfcb30f8a5502792b346e535a45658b3a31ae5c178465509721&quot;</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span><span class="st">&quot;626be2af274b29ea4816ad672ee452b7cf96bbb4836815a55699ae402183f512&quot;</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span><span class="dv">1702711587</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;kind&quot;</span><span class="fu">:</span><span class="dv">1059</span><span class="fu">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;tags&quot;</span><span class="fu">:</span><span class="ot">[</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span> <span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;44900586091b284416a0c001f677f9c49f7639a55c3f1e2ec130a8e1a7998e1b&quot;</span><span class="ot">]</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>   <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;content&quot;</span><span class="fu">:</span><span class="st">&quot;AsTClTzr0gzXXji7uye5UB6LYrx3HDjWGdkNaBS6BAX9CpHa+Vvtt5oI2xJrmWLen+Fo2NBOFazvl285Gb3HSM82gVycrzx1HUAaQDUG6HI7XBEGqBhQMUNwNMiN2dnilBMFC3Yc8ehCJT/gkbiNKOpwd2rFibMFRMDKai2mq2lBtPJF18oszKOjA+XlOJV8JRbmcAanTbEK5nA/GnG3eGUiUzhiYBoHomj3vztYYxc0QYHOx0WxiHY8dsC6jPsXC7f6k4P+Hv5ZiyTfzvjkSJOckel1lZuE5SfeZ0nduqTlxREGeBJ8amOykgEIKdH2VZBZB+qtOMc7ez9dz4wffGwBDA7912NFS2dPBr6txHNxBUkDZKFbuD5wijvonZDvfWq43tZspO4NutSokZB99uEiRH8NAUdGTiNb25m9JcDhVfdmABqTg5fIwwTwlem5aXIy8b66lmqqz2LBzJtnJDu36bDwkILph3kmvaKPD8qJXmPQ4yGpxIbYSTCohgt2/I0TKJNmqNvSN+IVoUuC7ZOfUV9lOV8Ri0AMfSr2YsdZ9ofV5o82ClZWlWiSWZwy6ypa7CuT1PEGHzywB4CZ5ucpO60Z7hnBQxHLiAQIO/QhiBp1rmrdQZFN6PUEjFDloykoeHe345Yqy9Ke95HIKUCS9yJurD+nZjjgOxZjoFCsB1hQAwINTIS3FbYOibZnQwv8PXvcSOqVZxC9U0+WuagK7IwxzhGZY3vLRrX01oujiRrevB4xbW7Oxi/Agp7CQGlJXCgmRE8Rhm+Vj2s+wc/4VLNZRHDcwtfejogjrjdi8p6nfUyqoQRRPARzRGUnnCbh+LqhigT6gQf3sVilnydMRScEc0/YYNLWnaw9nbyBa7wFBAiGbJwO40k39wj+xT6HTSbSUgFZzopxroO3f/o4+ubx2+IL3fkev22mEN38+dFmYF3zE+hpE7jVxrJpC3EP9PLoFgFPKCuctMnjXmeHoiGs756N5r1Mm1ffZu4H19MSuALJlxQR7VXE/LzxRXDuaB2u9days/6muP6gbGX1ASxbJd/ou8+viHmSC/ioHzNjItVCPaJjDyc6bv+gs1NPCt0qZ69G+JmgHW/PsMMeL4n5bh74g0fJSHqiI9ewEmOG/8bedSREv2XXtKV39STxPweceIOh0k23s3N6+wvuSUAJE7u1LkDo14cobtZ/MCw/QhimYPd1u5HnEJvRhPxz0nVPz0QqL/YQeOkAYk7uzgeb2yPzJ6DBtnTnGDkglekhVzQBFRJdk740LEj6swkJ&quot;</span><span class="fu">,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&quot;sig&quot;</span><span class="fu">:</span><span class="st">&quot;c94e74533b482aa8eeeb54ae72a5303e0b21f62909ca43c8ef06b0357412d6f8a92f96e1a205102753777fd25321a58fba3fb384eee114bd53ce6c06a1c22bab&quot;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>16</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-16">NIP-16</h1>
<h2 id="event-treatment">Event Treatment</h2>
<p><code>final</code> <code>mandatory</code></p>
<p>Moved to <a href="01.md.css.html">NIP-01</a>.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>15</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-15">NIP-15</h1>
<h2 id="nostr-marketplace">Nostr Marketplace</h2>
<p><code>draft</code> <code>optional</code></p>
<p>Based on https://github.com/lnbits/Diagon-Alley.</p>
<p>Implemented in <a
href="https://github.com/lnbits/nostrmarket">NostrMarket</a> and <a
href="https://github.com/PlebeianTech/plebeian-market">Plebeian
Market</a>.</p>
<h2 id="terms">Terms</h2>
<ul>
<li><code>merchant</code> - seller of products with NOSTR key-pair</li>
<li><code>customer</code> - buyer of products with NOSTR key-pair</li>
<li><code>product</code> - item for sale by the
<code>merchant</code></li>
<li><code>stall</code> - list of products controlled by
<code>merchant</code> (a <code>merchant</code> can have multiple
stalls)</li>
<li><code>marketplace</code> - clientside software for searching
<code>stalls</code> and purchasing <code>products</code></li>
</ul>
<h2 id="nostr-marketplace-clients">Nostr Marketplace Clients</h2>
<h3 id="merchant-admin">Merchant admin</h3>
<p>Where the <code>merchant</code> creates, updates and deletes
<code>stalls</code> and <code>products</code>, as well as where they
manage sales, payments and communication with
<code>customers</code>.</p>
<p>The <code>merchant</code> admin software can be purely clientside,
but for <code>convenience</code> and uptime, implementations will likely
have a server client listening for NOSTR events.</p>
<h3 id="marketplace">Marketplace</h3>
<p><code>Marketplace</code> software should be entirely clientside,
either as a stand-alone app, or as a purely frontend webpage. A
<code>customer</code> subscribes to different merchant NOSTR public
keys, and those <code>merchants</code> <code>stalls</code> and
<code>products</code> become listed and searchable. The marketplace
client is like any other ecommerce site, with basket and checkout.
<code>Marketplaces</code> may also wish to include a
<code>customer</code> support area for direct message communication with
<code>merchants</code>.</p>
<h2
id="merchant-publishingupdating-products-event"><code>Merchant</code>
publishing/updating products (event)</h2>
<p>A merchant can publish these events: | Kind | | Description | | ——— |
—————— | ————————————————————————————————————— | | <code>0</code> |
<code>set_meta</code> | The merchant description (similar with any
<code>nostr</code> public key). | | <code>30017</code> |
<code>set_stall</code> | Create or update a stall. | |
<code>30018</code> | <code>set_product</code> | Create or update a
product. | | <code>4</code> | <code>direct_message</code> | Communicate
with the customer. The messages can be plain-text or JSON. | |
<code>5</code> | <code>delete</code> | Delete a product or a stall.
|</p>
<h3 id="event-30017-create-or-update-a-stall.">Event <code>30017</code>:
Create or update a stall.</h3>
<p><strong>Event Content</strong></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">id</span> <span class="er">generated</span> <span class="er">by</span> <span class="er">the</span> <span class="er">merchant.</span> <span class="er">Sequential</span> <span class="er">IDs</span> <span class="er">(`0`</span><span class="fu">,</span> <span class="er">`1`</span><span class="fu">,</span> <span class="er">`2`...)</span> <span class="er">are</span> <span class="er">discouraged&gt;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">stall</span> <span class="er">name&gt;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">stall</span> <span class="er">description&gt;</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;currency&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">currency</span> <span class="er">used&gt;</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;shipping&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">id</span> <span class="er">of</span> <span class="er">the</span> <span class="er">shipping</span> <span class="er">zone</span><span class="fu">,</span> <span class="er">generated</span> <span class="er">by</span> <span class="er">the</span> <span class="er">merchant&gt;</span><span class="fu">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">zone</span> <span class="er">name&gt;</span><span class="fu">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;cost&quot;</span><span class="fu">:</span> <span class="er">&lt;float</span><span class="fu">,</span> <span class="er">base</span> <span class="er">cost</span> <span class="er">for</span> <span class="er">shipping.</span> <span class="er">The</span> <span class="er">currency</span> <span class="er">is</span> <span class="er">defined</span> <span class="er">at</span> <span class="er">the</span> <span class="er">stall</span> <span class="er">level&gt;</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;regions&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">&lt;string</span><span class="ot">,</span> <span class="er">regions</span> <span class="er">included</span> <span class="er">in</span> <span class="er">this</span> <span class="er">zone&gt;</span><span class="ot">]</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Fields that are not self-explanatory: - <code>shipping</code>: - an
array with possible shipping zones for this stall. - the customer MUST
choose exactly one of those shipping zones. - shipping to different
zones can have different costs. For some goods (digital for example) the
cost can be zero. - the <code>id</code> is an internal value used by the
merchant. This value must be sent back as the customer selection. - each
shipping zone contains the base cost for orders made to that shipping
zone, but a specific shipping cost per product can also be specified if
the shipping cost for that product is higher than what’s specified by
the base cost.</p>
<p><strong>Event Tags</strong></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="er">&lt;string</span><span class="ot">,</span> <span class="er">id</span> <span class="er">of</span> <span class="er">stall</span><span class="ot">]]</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li>the <code>d</code> tag is required, its value MUST be the same as
the stall <code>id</code>.</li>
</ul>
<h3 id="event-30018-create-or-update-a-product">Event
<code>30018</code>: Create or update a product</h3>
<p><strong>Event Content</strong></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">id</span> <span class="er">generated</span> <span class="er">by</span> <span class="er">the</span> <span class="er">merchant</span> <span class="er">(sequential</span> <span class="er">ids</span> <span class="er">are</span> <span class="er">discouraged)&gt;</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;stall_id&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">id</span> <span class="er">of</span> <span class="er">the</span> <span class="er">stall</span> <span class="er">to</span> <span class="er">which</span> <span class="er">this</span> <span class="er">product</span> <span class="er">belong</span> <span class="er">to&gt;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">product</span> <span class="er">name&gt;</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">product</span> <span class="er">description&gt;</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;images&quot;</span><span class="fu">:</span> <span class="er">&lt;</span><span class="ot">[</span><span class="er">string</span><span class="ot">]</span><span class="fu">,</span> <span class="er">array</span> <span class="er">of</span> <span class="er">image</span> <span class="er">URLs</span><span class="fu">,</span> <span class="er">optional&gt;</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;currency&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">currency</span> <span class="er">used&gt;</span><span class="fu">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="er">&lt;float</span><span class="fu">,</span> <span class="er">cost</span> <span class="er">of</span> <span class="er">product&gt;</span><span class="fu">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;quantity&quot;</span><span class="fu">:</span> <span class="er">&lt;int</span> <span class="er">or</span> <span class="kw">null</span><span class="fu">,</span> <span class="er">available</span> <span class="er">items&gt;</span><span class="fu">,</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;specs&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="er">&lt;string</span><span class="ot">,</span> <span class="er">spec</span> <span class="er">key&gt;</span><span class="ot">,</span> <span class="er">&lt;string</span><span class="ot">,</span> <span class="er">spec</span> <span class="er">value&gt;</span><span class="ot">]</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;shipping&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">id</span> <span class="er">of</span> <span class="er">the</span> <span class="er">shipping</span> <span class="er">zone</span> <span class="er">(must</span> <span class="er">match</span> <span class="er">one</span> <span class="er">of</span> <span class="er">the</span> <span class="er">zones</span> <span class="er">defined</span> <span class="er">for</span> <span class="er">the</span> <span class="er">stall)&gt;</span><span class="fu">,</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;cost&quot;</span><span class="fu">:</span> <span class="er">&lt;float</span><span class="fu">,</span> <span class="er">extra</span> <span class="er">cost</span> <span class="er">for</span> <span class="er">shipping.</span> <span class="er">The</span> <span class="er">currency</span> <span class="er">is</span> <span class="er">defined</span> <span class="er">at</span> <span class="er">the</span> <span class="er">stall</span> <span class="er">level&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Fields that are not self-explanatory: - <code>quantity</code> can be
null in the case of items with unlimited availability, like digital
items, or services - <code>specs</code>: - an optional array of key pair
values. It allows for the Customer UI to present product specifications
in a structure mode. It also allows comparison between products - eg:
<code>[["operating_system", "Android 12.0"], ["screen_size", "6.4 inches"], ["connector_type", "USB Type C"]]</code></p>
<pre><code>_Open_: better to move `spec` in the `tags` section of the event?</code></pre>
<ul>
<li><code>shipping</code>:
<ul>
<li>an <em>optional</em> array of extra costs to be used per shipping
zone, only for products that require special shipping costs to be added
to the base shipping cost defined in the stall</li>
<li>the <code>id</code> should match the id of the shipping zone, as
defined in the <code>shipping</code> field of the stall</li>
<li>to calculate the total cost of shipping for an order, the user will
choose a shipping option during checkout, and then the client must
consider this costs:
<ul>
<li>the <code>base cost from the stall</code> for the chosen shipping
option</li>
<li>the result of multiplying the product units by the
<code>shipping costs specified in the product</code>, if any.</li>
</ul></li>
</ul></li>
</ul>
<p><strong>Event Tags</strong></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  <span class="er">&quot;tags&quot;:</span> <span class="ot">[</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;d&quot;</span><span class="ot">,</span> <span class="er">&lt;string</span><span class="ot">,</span> <span class="er">id</span> <span class="er">of</span> <span class="er">product</span><span class="ot">],</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;t&quot;</span><span class="ot">,</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="ot">,</span> <span class="er">product</span> <span class="er">category</span><span class="ot">],</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;t&quot;</span><span class="ot">,</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="ot">,</span> <span class="er">product</span> <span class="er">category</span><span class="ot">],</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="er">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span></code></pre></div>
<ul>
<li>the <code>d</code> tag is required, its value MUST be the same as
the product <code>id</code>.</li>
<li>the <code>t</code> tag is as searchable tag, it represents different
categories that the product can be part of (<code>food</code>,
<code>fruits</code>). Multiple <code>t</code> tags can be present.</li>
</ul>
<h2 id="checkout-events">Checkout events</h2>
<p>All checkout events are sent as JSON strings using (<a
href="https://github.com/nostr-protocol/nips/blob/master/04.md.css.html">NIP-04</a>).</p>
<p>The <code>merchant</code> and the <code>customer</code> can exchange
JSON messages that represent different actions. Each <code>JSON</code>
message <code>MUST</code> have a <code>type</code> field indicating the
what the JSON represents. Possible types:</p>
<table>
<thead>
<tr class="header">
<th>Message Type</th>
<th>Sent By</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>Customer</td>
<td>New Order</td>
</tr>
<tr class="even">
<td>1</td>
<td>Merchant</td>
<td>Payment Request</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Merchant</td>
<td>Order Status Update</td>
</tr>
</tbody>
</table>
<h3 id="step-1-customer-order-event">Step 1: <code>customer</code> order
(event)</h3>
<p>The below JSON goes in content of <a
href="https://github.com/nostr-protocol/nips/blob/master/04.md.css.html">NIP-04</a>.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">id</span> <span class="er">generated</span> <span class="er">by</span> <span class="er">the</span> <span class="er">customer&gt;</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">???&gt;</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;address&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">for</span> <span class="er">physical</span> <span class="er">goods</span> <span class="er">an</span> <span class="er">address</span> <span class="er">should</span> <span class="er">be</span> <span class="er">provided&gt;</span><span class="fu">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;string (optional), message for merchant&gt;,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;</span><span class="er">contact</span><span class="st">&quot;: {</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;</span><span class="er">nostr</span><span class="st">&quot;: &lt;32-bytes hex of a pubkey&gt;,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;</span><span class="er">phone</span><span class="st">&quot;: &lt;string (optional), if the customer wants to be contacted by phone&gt;,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;</span><span class="er">email</span><span class="st">&quot;: &lt;string (optional), if the customer wants to be contacted by email&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">  },</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;</span><span class="er">items</span><span class="st">&quot;: [</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="st">      &quot;</span><span class="er">product_id</span><span class="st">&quot;: &lt;string, id of the product&gt;,</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="st">      &quot;</span><span class="er">quantity</span><span class="st">&quot;: &lt;int, how many products the customer is ordering&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="st">  ],</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;</span><span class="er">shipping_id</span><span class="st">&quot;: &lt;string, id of the shipping zone&gt;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span></code></pre></div>
<p><em>Open</em>: is <code>contact.nostr</code> required?</p>
<h3 id="step-2-merchant-request-payment-event">Step 2:
<code>merchant</code> request payment (event)</h3>
<p>Sent back from the merchant for payment. Any payment option is valid
that the merchant can check.</p>
<p>The below JSON goes in <code>content</code> of <a
href="https://github.com/nostr-protocol/nips/blob/master/04.md.css.html">NIP-04</a>.</p>
<p><code>payment_options</code>/<code>type</code> include:</p>
<ul>
<li><code>url</code> URL to a payment page, stripe, paypal,
btcpayserver, etc</li>
<li><code>btc</code> onchain bitcoin address</li>
<li><code>ln</code> bitcoin lightning invoice</li>
<li><code>lnurl</code> bitcoin lnurl-pay</li>
</ul>
<div class="sourceCode" id="cb7"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">id</span> <span class="er">of</span> <span class="er">the</span> <span class="er">order&gt;</span><span class="fu">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">message</span> <span class="er">to</span> <span class="er">customer</span><span class="fu">,</span> <span class="er">optional&gt;</span><span class="fu">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;payment_options&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">option</span> <span class="er">type&gt;</span><span class="fu">,</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;link&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">url</span><span class="fu">,</span> <span class="er">btc</span> <span class="er">address</span><span class="fu">,</span> <span class="er">ln</span> <span class="er">invoice</span><span class="fu">,</span> <span class="er">etc&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">option</span> <span class="er">type&gt;</span><span class="fu">,</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;link&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">url</span><span class="fu">,</span> <span class="er">btc</span> <span class="er">address</span><span class="fu">,</span> <span class="er">ln</span> <span class="er">invoice</span><span class="fu">,</span> <span class="er">etc&gt;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">option</span> <span class="er">type&gt;</span><span class="fu">,</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;link&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">url</span><span class="fu">,</span> <span class="er">btc</span> <span class="er">address</span><span class="fu">,</span> <span class="er">ln</span> <span class="er">invoice</span><span class="fu">,</span> <span class="er">etc&gt;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="step-3-merchant-verify-paymentshipped-event">Step 3:
<code>merchant</code> verify payment/shipped (event)</h3>
<p>Once payment has been received and processed.</p>
<p>The below JSON goes in <code>content</code> of <a
href="https://github.com/nostr-protocol/nips/blob/master/04.md.css.html">NIP-04</a>.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">id</span> <span class="er">of</span> <span class="er">the</span> <span class="er">order&gt;</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span><span class="fu">,</span> <span class="er">message</span> <span class="er">to</span> <span class="er">customer&gt;</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;paid&quot;</span><span class="fu">:</span> <span class="er">&lt;bool:</span> <span class="er">has</span> <span class="er">received</span> <span class="er">payment&gt;</span><span class="fu">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;shipped&quot;</span><span class="fu">:</span> <span class="er">&lt;bool:</span> <span class="er">has</span> <span class="er">been</span> <span class="er">shipped&gt;</span><span class="fu">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="customize-marketplace">Customize Marketplace</h2>
<p>Create a customized user experience using the <code>naddr</code> from
<a
href="https://github.com/nostr-protocol/nips/blob/master/19.md.css.html#shareable-identifiers-with-extra-metadata">NIP-19</a>.
The use of <code>naddr</code> enables easy sharing of marketplace events
while incorporating a rich set of metadata. This metadata can include
relays, merchant profiles, and more. Subsequently, it allows merchants
to be grouped into a market, empowering the market creator to configure
the marketplace’s user interface and user experience, and share that
marketplace. This customization can encompass elements such as market
name, description, logo, banner, themes, and even color schemes,
offering a tailored and unique marketplace experience.</p>
<h3 id="event-30019-create-or-update-marketplace-uiux">Event
<code>30019</code>: Create or update marketplace UI/UX</h3>
<p><strong>Event Content</strong></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">market</span> <span class="er">name&gt;</span><span class="fu">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;about&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">market</span> <span class="er">description&gt;</span><span class="fu">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ui&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;picture&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">market</span> <span class="er">logo</span> <span class="er">image</span> <span class="er">URL&gt;</span><span class="fu">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;banner&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">market</span> <span class="er">logo</span> <span class="er">banner</span> <span class="er">URL&gt;</span><span class="fu">,</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;theme&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">market</span> <span class="er">theme&gt;</span><span class="fu">,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;darkMode&quot;</span><span class="fu">:</span> <span class="er">&lt;bool</span><span class="fu">,</span> <span class="er">true/false&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;merchants&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">array</span> <span class="er">of</span> <span class="er">pubkeys</span> <span class="er">(optional)</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>This event leverages naddr to enable comprehensive customization and
sharing of marketplace configurations, fostering a unique and engaging
marketplace environment.</p>
<h2 id="auctions">Auctions</h2>
<h3 id="event-30020-create-or-update-a-product-sold-as-an-auction">Event
<code>30020</code>: Create or update a product sold as an auction</h3>
<p><strong>Event Content</strong>:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;String</span><span class="fu">,</span> <span class="er">UUID</span> <span class="er">generated</span> <span class="er">by</span> <span class="er">the</span> <span class="er">merchant.</span> <span class="er">Sequential</span> <span class="er">IDs</span> <span class="er">(`0`</span><span class="fu">,</span> <span class="er">`1`</span><span class="fu">,</span> <span class="er">`2`...)</span> <span class="er">are</span> <span class="er">discouraged&gt;</span><span class="fu">,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;stall_id&quot;</span><span class="fu">:</span> <span class="er">&lt;String</span><span class="fu">,</span> <span class="er">UUID</span> <span class="er">of</span> <span class="er">the</span> <span class="er">stall</span> <span class="er">to</span> <span class="er">which</span> <span class="er">this</span> <span class="er">product</span> <span class="er">belong</span> <span class="er">to&gt;</span><span class="fu">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="er">&lt;String</span><span class="fu">,</span> <span class="er">product</span> <span class="er">name&gt;</span><span class="fu">,</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="er">&lt;String</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">product</span> <span class="er">description&gt;</span><span class="fu">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;images&quot;</span><span class="fu">:</span> <span class="er">&lt;</span><span class="ot">[</span><span class="er">String</span><span class="ot">]</span><span class="fu">,</span> <span class="er">array</span> <span class="er">of</span> <span class="er">image</span> <span class="er">URLs</span><span class="fu">,</span> <span class="er">optional&gt;</span><span class="fu">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;starting_bid&quot;</span><span class="fu">:</span> <span class="er">&lt;int&gt;</span><span class="fu">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;start_date&quot;</span><span class="fu">:</span> <span class="er">&lt;int</span> <span class="er">(optional)</span> <span class="er">UNIX</span> <span class="er">timestamp</span><span class="fu">,</span> <span class="er">date</span> <span class="er">the</span> <span class="er">auction</span> <span class="er">started</span> <span class="er">/</span> <span class="er">will</span> <span class="er">start&gt;</span><span class="fu">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;duration&quot;</span><span class="fu">:</span> <span class="er">&lt;int</span><span class="fu">,</span> <span class="er">number</span> <span class="er">of</span> <span class="er">seconds</span> <span class="er">the</span> <span class="er">auction</span> <span class="er">will</span> <span class="er">run</span> <span class="er">for</span><span class="fu">,</span> <span class="er">excluding</span> <span class="er">eventual</span> <span class="er">time</span> <span class="er">extensions</span> <span class="er">that</span> <span class="er">might</span> <span class="er">happen&gt;</span><span class="fu">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;specs&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="ot">[</span><span class="er">&lt;String</span><span class="ot">,</span> <span class="er">spec</span> <span class="er">key&gt;</span><span class="ot">,</span> <span class="er">&lt;String</span><span class="ot">,</span> <span class="er">spec</span> <span class="er">value&gt;</span><span class="ot">]</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;shipping&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">&lt;String</span><span class="fu">,</span> <span class="er">UUID</span> <span class="er">of</span> <span class="er">the</span> <span class="er">shipping</span> <span class="er">zone.</span> <span class="er">Must</span> <span class="er">match</span> <span class="er">one</span> <span class="er">of</span> <span class="er">the</span> <span class="er">zones</span> <span class="er">defined</span> <span class="er">for</span> <span class="er">the</span> <span class="er">stall&gt;</span><span class="fu">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;cost&quot;</span><span class="fu">:</span> <span class="er">&lt;float</span><span class="fu">,</span> <span class="er">extra</span> <span class="er">cost</span> <span class="er">for</span> <span class="er">shipping.</span> <span class="er">The</span> <span class="er">currency</span> <span class="er">is</span> <span class="er">defined</span> <span class="er">at</span> <span class="er">the</span> <span class="er">stall</span> <span class="er">level&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<blockquote>
<p>[!NOTE] Items sold as an auction are very similar in structure to
fixed-price items, with some important differences worth noting.</p>
</blockquote>
<ul>
<li><p>The <code>start_date</code> can be set to a date in the future if
the auction is scheduled to start on that date, or can be omitted if the
start date is unknown/hidden. If the start date is not specified, the
auction will have to be edited later to set an actual date.</p></li>
<li><p>The auction runs for an initial number of seconds after the
<code>start_date</code>, specified by <code>duration</code>.</p></li>
</ul>
<h3 id="event-1021-bid">Event <code>1021</code>: Bid</h3>
<div class="sourceCode" id="cb11"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="er">&lt;int</span><span class="fu">,</span> <span class="er">amount</span> <span class="er">of</span> <span class="er">sats&gt;</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;event</span> <span class="er">ID</span> <span class="er">of</span> <span class="er">the</span> <span class="er">auction</span> <span class="er">to</span> <span class="er">bid</span> <span class="er">on&gt;</span><span class="ot">]]</span><span class="fu">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Bids are simply events of kind <code>1021</code> with a
<code>content</code> field specifying the amount, in the currency of the
auction. Bids must reference an auction.</p>
<blockquote>
<p>[!NOTE] Auctions can be edited as many times as desired (they are
“parameterized replaceable events”) by the author - even after the
start_date, but they cannot be edited after they have received the first
bid! This is enforced by the fact that bids reference the event ID of
the auction (rather than the product UUID), which changes with every new
version of the auctioned product. So a bid is always attached to one
“version”. Editing the auction after a bid would result in the new
product losing the bid!</p>
</blockquote>
<h3 id="event-1022-bid-confirmation">Event <code>1022</code>: Bid
confirmation</h3>
<p><strong>Event Content</strong>:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="er">&lt;String</span><span class="fu">,</span> <span class="dt">&quot;accepted&quot;</span> <span class="er">|</span> <span class="dt">&quot;rejected&quot;</span> <span class="er">|</span> <span class="dt">&quot;pending&quot;</span> <span class="er">|</span> <span class="dt">&quot;winner&quot;</span><span class="er">&gt;</span><span class="fu">,</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="er">&lt;String</span> <span class="er">(optional)&gt;</span><span class="fu">,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;duration_extended&quot;</span><span class="fu">:</span> <span class="er">&lt;int</span> <span class="er">(optional)</span><span class="fu">,</span> <span class="er">number</span> <span class="er">of</span> <span class="er">seconds&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Event Tags</strong>:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>  <span class="er">&quot;tags&quot;:</span> <span class="ot">[[</span><span class="st">&quot;e&quot;</span> <span class="er">&lt;event</span> <span class="er">ID</span> <span class="er">of</span> <span class="er">the</span> <span class="er">bid</span> <span class="er">being</span> <span class="er">confirmed&gt;</span><span class="ot">],</span> <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;event</span> <span class="er">ID</span> <span class="er">of</span> <span class="er">the</span> <span class="er">auction&gt;</span><span class="ot">]]</span><span class="er">,</span></span></code></pre></div>
<p>Bids should be confirmed by the merchant before being considered as
valid by other clients. So clients should subscribe to <em>bid
confirmation</em> events (kind <code>1022</code>) for every auction that
they follow, in addition to the actual bids and should check that the
pubkey of the bid confirmation matches the pubkey of the merchant (in
addition to checking the signature).</p>
<p>The <code>content</code> field is a JSON which includes <em>at
least</em> a <code>status</code>. <code>winner</code> is how the
<em>winning bid</em> is replied to after the auction ends and the
winning bid is picked by the merchant.</p>
<p>The reasons for which a bid can be marked as <code>rejected</code> or
<code>pending</code> are up to the merchant’s implementation and
configuration - they could be anything from basic validation errors
(amount too low) to the bidder being blacklisted or to the bidder
lacking sufficient <em>trust</em>, which could lead to the bid being
marked as <code>pending</code> until sufficient verification is
performed. The difference between the two is that <code>pending</code>
bids <em>might</em> get approved after additional steps are taken by the
bidder, whereas <code>rejected</code> bids can not be later
approved.</p>
<p>An additional <code>message</code> field can appear in the
<code>content</code> JSON to give further context as of why a bid is
<code>rejected</code> or <code>pending</code>.</p>
<p>Another thing that can happen is - if bids happen very close to the
end date of the auction - for the merchant to decide to extend the
auction duration for a few more minutes. This is done by passing a
<code>duration_extended</code> field as part of a bid confirmation,
which would contain a number of seconds by which the initial duration is
extended. So the actual end date of an auction is always
<code>start_date + duration + (SUM(c.duration_extended) FOR c in all confirmations</code>.</p>
<h2 id="customer-support-events">Customer support events</h2>
<p>Customer support is handled over whatever communication method was
specified. If communicating via nostr, NIP-04 is used
https://github.com/nostr-protocol/nips/blob/master/04.md.css.html.</p>
<h2 id="additional">Additional</h2>
<p>Standard data models can be found
<a href="https://raw.githubusercontent.com/lnbits/nostrmarket/main/models.py">here</a></p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>14</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-14">NIP-14</h1>
<h2 id="subject-tag-in-text-events">Subject tag in Text events</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines the use of the “subject” tag in text (kind: 1)
events. (implemented in more-speech)</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;subject&quot;</span><span class="er">:</span> <span class="er">&lt;string&gt;</span><span class="ot">]</span></span></code></pre></div>
<p>Browsers often display threaded lists of messages. The contents of
the subject tag can be used in such lists, instead of the more ad hoc
approach of using the first few words of the message. This is very
similar to the way email browsers display lists of incoming emails by
subject rather than by contents.</p>
<p>When replying to a message with a subject, clients SHOULD replicate
the subject tag. Clients MAY adorn the subject to denote that it is a
reply. e.g. by prepending “Re:”.</p>
<p>Subjects should generally be shorter than 80 chars. Long subjects
will likely be trimmed by clients.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>13</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-13">NIP-13</h1>
<h2 id="proof-of-work">Proof of Work</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines a way to generate and interpret Proof of Work for
nostr notes. Proof of Work (PoW) is a way to add a proof of
computational work to a note. This is a bearer proof that all relays and
clients can universally validate with a small amount of code. This proof
can be used as a means of spam deterrence.</p>
<p><code>difficulty</code> is defined to be the number of leading zero
bits in the <code>NIP-01</code> id. For example, an id of
<code>000000000e9d97a1ab09fc381030b346cdd7a142ad57e6df0b46dc9bef6c7e2d</code>
has a difficulty of <code>36</code> with <code>36</code> leading 0
bits.</p>
<p><code>002f...</code> is <code>0000 0000 0010 1111...</code> in
binary, which has 10 leading zeroes. Do not forget to count leading
zeroes for hex digits &lt;= <code>7</code>.</p>
<h2 id="mining">Mining</h2>
<p>To generate PoW for a <code>NIP-01</code> note, a <code>nonce</code>
tag is used:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;It&#39;s just me mining my own business&quot;</span><span class="fu">,</span> <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="st">&quot;nonce&quot;</span><span class="ot">,</span> <span class="st">&quot;1&quot;</span><span class="ot">,</span> <span class="st">&quot;21&quot;</span><span class="ot">]]</span><span class="fu">}</span></span></code></pre></div>
<p>When mining, the second entry to the nonce tag is updated, and then
the id is recalculated (see <a href="./01.md.css.html">NIP-01</a>). If the id has
the desired number of leading zero bits, the note has been mined. It is
recommended to update the <code>created_at</code> as well during this
process.</p>
<p>The third entry to the nonce tag <code>SHOULD</code> contain the
target difficulty. This allows clients to protect against situations
where bulk spammers targeting a lower difficulty get lucky and match a
higher difficulty. For example, if you require 40 bits to reply to your
thread and see a committed target of 30, you can safely reject it even
if the note has 40 bits difficulty. Without a committed target
difficulty you could not reject it. Committing to a target difficulty is
something all honest miners should be ok with, and clients
<code>MAY</code> reject a note matching a target difficulty if it is
missing a difficulty commitment.</p>
<h2 id="example-mined-note">Example mined note</h2>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;000006d8c378af1779d2feebc7603a125d99eca0ccf1085959b307f64e5dd358&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;a48380f4cfcc1ad5378294fcac36439770f9c878dd880ffa94bb74ea54a6f243&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;created_at&quot;</span><span class="fu">:</span> <span class="dv">1651794653</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;nonce&quot;</span><span class="ot">,</span> <span class="st">&quot;776797&quot;</span><span class="ot">,</span> <span class="st">&quot;21&quot;</span><span class="ot">]</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;It&#39;s just me mining my own business&quot;</span><span class="fu">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sig&quot;</span><span class="fu">:</span> <span class="st">&quot;284622fc0a3f4f1303455d5175f7ba962a3300d136085b9566801bc2e0699de0c7e31e44c81fb40ad9049173742e904713c3594a1da0fc5d2382a25c11aba977&quot;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="validating">Validating</h2>
<p>Here is some reference C code for calculating the difficulty (aka
number of leading zero bits) in a nostr event id:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> countLeadingZeroes<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>hex<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> strlen<span class="op">(</span>hex<span class="op">);</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> nibble <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>strtol<span class="op">((</span><span class="dt">char</span><span class="op">[]){</span>hex<span class="op">[</span>i<span class="op">],</span> <span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">},</span> NULL<span class="op">,</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>nibble <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            count <span class="op">+=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            count <span class="op">+=</span> __builtin_clz<span class="op">(</span>nibble<span class="op">)</span> <span class="op">-</span> <span class="dv">28</span><span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> count<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;Usage: </span><span class="sc">%s</span><span class="st"> &lt;hex_string&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>hex_string <span class="op">=</span> argv<span class="op">[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> result <span class="op">=</span> countLeadingZeroes<span class="op">(</span>hex_string<span class="op">);</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Leading zeroes in hex string </span><span class="sc">%s</span><span class="st">: </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> hex_string<span class="op">,</span> result<span class="op">);</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Here is some JavaScript code for doing the same thing:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// hex should be a hexadecimal string (with no 0x prefix)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">countLeadingZeroes</span>(hex) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> hex<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nibble <span class="op">=</span> <span class="pp">parseInt</span>(hex[i]<span class="op">,</span> <span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (nibble <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      count <span class="op">+=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      count <span class="op">+=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">clz32</span>(nibble) <span class="op">-</span> <span class="dv">28</span><span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span><span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> count<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="querying-relays-for-pow-notes">Querying relays for PoW
notes</h2>
<p>If relays allow searching on prefixes, you can use this as a way to
filter notes of a certain difficulty:</p>
<pre><code>$ echo &#39;[&quot;REQ&quot;, &quot;subid&quot;, {&quot;ids&quot;: [&quot;000000000&quot;]}]&#39;  | websocat wss://some-relay.com | jq -c &#39;.[2]&#39;
{&quot;id&quot;:&quot;000000000121637feeb68a06c8fa7abd25774bdedfa9b6ef648386fb3b70c387&quot;, ...}</code></pre>
<h2 id="delegated-proof-of-work">Delegated Proof of Work</h2>
<p>Since the <code>NIP-01</code> note id does not commit to any
signature, PoW can be outsourced to PoW providers, perhaps for a fee.
This provides a way for clients to get their messages out to
PoW-restricted relays without having to do any work themselves, which is
useful for energy-constrained devices like mobile phones.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>12</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-12">NIP-12</h1>
<h2 id="generic-tag-queries">Generic Tag Queries</h2>
<p><code>final</code> <code>mandatory</code></p>
<p>Moved to <a href="01.md.css.html">NIP-01</a>.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>11</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-11">NIP-11</h1>
<h2 id="relay-information-document">Relay Information Document</h2>
<p><code>draft</code> <code>optional</code></p>
<p>Relays may provide server metadata to clients to inform them of
capabilities, administrative contacts, and various server attributes.
This is made available as a JSON document over HTTP, on the same URI as
the relay’s websocket.</p>
<p>When a relay receives an HTTP(s) request with an <code>Accept</code>
header of <code>application/nostr+json</code> to a URI supporting
WebSocket upgrades, they SHOULD return a document with the following
structure.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">identifying</span> <span class="er">relay&gt;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">with</span> <span class="er">detailed</span> <span class="er">information&gt;</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="er">&lt;administrative</span> <span class="er">contact</span> <span class="er">pubkey&gt;</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;contact&quot;</span><span class="fu">:</span> <span class="er">&lt;administrative</span> <span class="er">alternate</span> <span class="er">contact&gt;</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;supported_nips&quot;</span><span class="fu">:</span> <span class="er">&lt;a</span> <span class="er">list</span> <span class="er">of</span> <span class="er">NIP</span> <span class="er">numbers</span> <span class="er">supported</span> <span class="er">by</span> <span class="er">the</span> <span class="er">relay&gt;</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;software&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">identifying</span> <span class="er">relay</span> <span class="er">software</span> <span class="er">URL&gt;</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="er">&lt;string</span> <span class="er">version</span> <span class="er">identifier&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Any field may be omitted, and clients MUST ignore any additional
fields they do not understand. Relays MUST accept CORS requests by
sending <code>Access-Control-Allow-Origin</code>,
<code>Access-Control-Allow-Headers</code>, and
<code>Access-Control-Allow-Methods</code> headers.</p>
<h2 id="field-descriptions">Field Descriptions</h2>
<h3 id="name">Name</h3>
<p>A relay may select a <code>name</code> for use in client software.
This is a string, and SHOULD be less than 30 characters to avoid client
truncation.</p>
<h3 id="description">Description</h3>
<p>Detailed plain-text information about the relay may be contained in
the <code>description</code> string. It is recommended that this contain
no markup, formatting or line breaks for word wrapping, and simply use
double newline characters to separate paragraphs. There are no
limitations on length.</p>
<h3 id="pubkey">Pubkey</h3>
<p>An administrative contact may be listed with a <code>pubkey</code>,
in the same format as Nostr events (32-byte hex for a
<code>secp256k1</code> public key). If a contact is listed, this
provides clients with a recommended address to send encrypted direct
messages (See <a href="17.md.css.html">NIP-17</a>) to a system administrator.
Expected uses of this address are to report abuse or illegal content,
file bug reports, or request other technical assistance.</p>
<p>Relay operators have no obligation to respond to direct messages.</p>
<h3 id="contact">Contact</h3>
<p>An alternative contact may be listed under the <code>contact</code>
field as well, with the same purpose as <code>pubkey</code>. Use of a
Nostr public key and direct message SHOULD be preferred over this.
Contents of this field SHOULD be a URI, using schemes such as
<code>mailto</code> or <code>https</code> to provide users with a means
of contact.</p>
<h3 id="supported-nips">Supported NIPs</h3>
<p>As the Nostr protocol evolves, some functionality may only be
available by relays that implement a specific <code>NIP</code>. This
field is an array of the integer identifiers of <code>NIP</code>s that
are implemented in the relay. Examples would include <code>1</code>, for
<code>"NIP-01"</code> and <code>9</code>, for <code>"NIP-09"</code>.
Client-side <code>NIPs</code> SHOULD NOT be advertised, and can be
ignored by clients.</p>
<h3 id="software">Software</h3>
<p>The relay server implementation MAY be provided in the
<code>software</code> attribute. If present, this MUST be a URL to the
project’s homepage.</p>
<h3 id="version">Version</h3>
<p>The relay MAY choose to publish its software version as a string
attribute. The string format is defined by the relay implementation. It
is recommended this be a version number or commit identifier.</p>
<h2 id="extra-fields">Extra Fields</h2>
<h3 id="server-limitations">Server Limitations</h3>
<p>These are limitations imposed by the relay on clients. Your client
should expect that requests which exceed these <em>practical</em>
limitations are rejected or fail immediately.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;limitation&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;max_message_length&quot;</span><span class="fu">:</span> <span class="dv">16384</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;max_subscriptions&quot;</span><span class="fu">:</span> <span class="dv">20</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;max_filters&quot;</span><span class="fu">:</span> <span class="dv">100</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;max_limit&quot;</span><span class="fu">:</span> <span class="dv">5000</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;max_subid_length&quot;</span><span class="fu">:</span> <span class="dv">100</span><span class="fu">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;max_event_tags&quot;</span><span class="fu">:</span> <span class="dv">100</span><span class="fu">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;max_content_length&quot;</span><span class="fu">:</span> <span class="dv">8196</span><span class="fu">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;min_pow_difficulty&quot;</span><span class="fu">:</span> <span class="dv">30</span><span class="fu">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;auth_required&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;payment_required&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;restricted_writes&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;created_at_lower_limit&quot;</span><span class="fu">:</span> <span class="dv">31536000</span><span class="fu">,</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;created_at_upper_limit&quot;</span><span class="fu">:</span> <span class="dv">3</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><p><code>max_message_length</code>: this is the maximum number of
bytes for incoming JSON that the relay will attempt to decode and act
upon. When you send large subscriptions, you will be limited by this
value. It also effectively limits the maximum size of any event. Value
is calculated from <code>[</code> to <code>]</code> and is after UTF-8
serialization (so some unicode characters will cost 2-3 bytes). It is
equal to the maximum size of the WebSocket message frame.</p></li>
<li><p><code>max_subscriptions</code>: total number of subscriptions
that may be active on a single websocket connection to this relay. It’s
possible that authenticated clients with a (paid) relationship to the
relay may have higher limits.</p></li>
<li><p><code>max_filters</code>: maximum number of filter values in each
subscription. Must be one or higher.</p></li>
<li><p><code>max_subid_length</code>: maximum length of subscription id
as a string.</p></li>
<li><p><code>max_limit</code>: the relay server will clamp each filter’s
<code>limit</code> value to this number. This means the client won’t be
able to get more than this number of events from a single subscription
filter. This clamping is typically done silently by the relay, but with
this number, you can know that there are additional results if you
narrowed your filter’s time range or other parameters.</p></li>
<li><p><code>max_event_tags</code>: in any event, this is the maximum
number of elements in the <code>tags</code> list.</p></li>
<li><p><code>max_content_length</code>: maximum number of characters in
the <code>content</code> field of any event. This is a count of unicode
characters. After serializing into JSON it may be larger (in bytes), and
is still subject to the <code>max_message_length</code>, if
defined.</p></li>
<li><p><code>min_pow_difficulty</code>: new events will require at least
this difficulty of PoW, based on <a href="13.md.css.html">NIP-13</a>, or they
will be rejected by this server.</p></li>
<li><p><code>auth_required</code>: this relay requires <a
href="42.md.css.html">NIP-42</a> authentication to happen before a new connection
may perform any other action. Even if set to False, authentication may
be required for specific actions.</p></li>
<li><p><code>payment_required</code>: this relay requires payment before
a new connection may perform any action.</p></li>
<li><p><code>restricted_writes</code>: this relay requires some kind of
condition to be fulfilled in order to accept events (not necessarily,
but including <code>payment_required</code> and
<code>min_pow_difficulty</code>). This should only be set to
<code>true</code> when users are expected to know the relay policy
before trying to write to it – like belonging to a special pubkey-based
whitelist or writing only events of a specific niche kind or content.
Normal anti-spam heuristics, for example, do not qualify.</p></li>
<li><p><code>created_at_lower_limit</code>: ‘created_at’ lower
limit</p></li>
<li><p><code>created_at_upper_limit</code>: ‘created_at’ upper
limit</p></li>
</ul>
<h3 id="event-retention">Event Retention</h3>
<p>There may be a cost associated with storing data forever, so relays
may wish to state retention times. The values stated here are defaults
for unauthenticated users and visitors. Paid users would likely have
other policies.</p>
<p>Retention times are given in seconds, with <code>null</code>
indicating infinity. If zero is provided, this means the event will not
be stored at all, and preferably an error will be provided when those
are received.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;retention&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="ot">[</span><span class="dv">5</span><span class="ot">,</span> <span class="dv">7</span><span class="ot">],</span> <span class="ot">[</span><span class="dv">40</span><span class="ot">,</span> <span class="dv">49</span><span class="ot">]]</span><span class="fu">,</span> <span class="dt">&quot;time&quot;</span><span class="fu">:</span> <span class="dv">3600</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="dv">40000</span><span class="ot">,</span> <span class="dv">49999</span><span class="ot">]]</span><span class="fu">,</span> <span class="dt">&quot;time&quot;</span><span class="fu">:</span> <span class="dv">100</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="ot">[[</span><span class="dv">30000</span><span class="ot">,</span> <span class="dv">39999</span><span class="ot">]]</span><span class="fu">,</span> <span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">1000</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="dt">&quot;time&quot;</span><span class="fu">:</span> <span class="dv">3600</span><span class="fu">,</span> <span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">10000</span><span class="fu">}</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><code>retention</code> is a list of specifications: each will apply
to either all kinds, or a subset of kinds. Ranges may be specified for
the kind field as a tuple of inclusive start and end values. Events of
indicated kind (or all) are then limited to a <code>count</code> and/or
time period.</p>
<p>It is possible to effectively blacklist Nostr-based protocols that
rely on a specific <code>kind</code> number, by giving a retention time
of zero for those <code>kind</code> values. While that is unfortunate,
it does allow clients to discover servers that will support their
protocol quickly via a single HTTP fetch.</p>
<p>There is no need to specify retention times for <em>ephemeral
events</em> since they are not retained.</p>
<h3 id="content-limitations">Content Limitations</h3>
<p>Some relays may be governed by the arbitrary laws of a nation state.
This may limit what content can be stored in cleartext on those relays.
All clients are encouraged to use encryption to work around this
limitation.</p>
<p>It is not possible to describe the limitations of each country’s laws
and policies which themselves are typically vague and constantly
shifting.</p>
<p>Therefore, this field allows the relay operator to indicate which
countries’ laws might end up being enforced on them, and then indirectly
on their users’ content.</p>
<p>Users should be able to avoid relays in countries they don’t like,
and/or select relays in more favourable zones. Exposing this flexibility
is up to the client software.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;relay_countries&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="st">&quot;CA&quot;</span><span class="ot">,</span> <span class="st">&quot;US&quot;</span> <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><code>relay_countries</code>: a list of two-level ISO country codes
(ISO 3166-1 alpha-2) whose laws and policies may affect this relay.
<code>EU</code> may be used for European Union countries.</li>
</ul>
<p>Remember that a relay may be hosted in a country which is not the
country of the legal entities who own the relay, so it’s very likely a
number of countries are involved.</p>
<h3 id="community-preferences">Community Preferences</h3>
<p>For public text notes at least, a relay may try to foster a local
community. This would encourage users to follow the global feed on that
relay, in addition to their usual individual follows. To support this
goal, relays MAY specify some of the following values.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;language_tags&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;en&quot;</span><span class="ot">,</span> <span class="st">&quot;en-419&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;sfw-only&quot;</span><span class="ot">,</span> <span class="st">&quot;bitcoin-only&quot;</span><span class="ot">,</span> <span class="st">&quot;anime&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;posting_policy&quot;</span><span class="fu">:</span> <span class="st">&quot;https://example.com/posting-policy.html&quot;</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li><p><code>language_tags</code> is an ordered list of <a
href="https://en.wikipedia.org/wiki/IETF_language_tag">IETF language
tags</a> indicating the major languages spoken on the relay.</p></li>
<li><p><code>tags</code> is a list of limitations on the topics to be
discussed. For example <code>sfw-only</code> indicates that only “Safe
For Work” content is encouraged on this relay. This relies on
assumptions of what the “work” “community” feels “safe” talking about.
In time, a common set of tags may emerge that allow users to find relays
that suit their needs, and client software will be able to parse these
tags easily. The <code>bitcoin-only</code> tag indicates that any
<em>altcoin</em>, <em>“crypto”</em> or <em>blockchain</em> comments will
be ridiculed without mercy.</p></li>
<li><p><code>posting_policy</code> is a link to a human-readable page
which specifies the community policies for the relay. In cases where
<code>sfw-only</code> is True, it’s important to link to a page which
gets into the specifics of your posting policy.</p></li>
</ul>
<p>The <code>description</code> field should be used to describe your
community goals and values, in brief. The <code>posting_policy</code> is
for additional detail and legal terms. Use the <code>tags</code> field
to signify limitations on content, or topics to be discussed, which
could be machine processed by appropriate client software.</p>
<h3 id="pay-to-relay">Pay-to-Relay</h3>
<p>Relays that require payments may want to expose their fee
schedules.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;payments_url&quot;</span><span class="fu">:</span> <span class="st">&quot;https://my-relay/payments&quot;</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;fees&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;admission&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">1000000</span><span class="fu">,</span> <span class="dt">&quot;unit&quot;</span><span class="fu">:</span> <span class="st">&quot;msats&quot;</span> <span class="fu">}</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;subscription&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">5000000</span><span class="fu">,</span> <span class="dt">&quot;unit&quot;</span><span class="fu">:</span> <span class="st">&quot;msats&quot;</span><span class="fu">,</span> <span class="dt">&quot;period&quot;</span><span class="fu">:</span> <span class="dv">2592000</span> <span class="fu">}</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;publication&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span> <span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">4</span><span class="ot">]</span><span class="fu">,</span> <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">100</span><span class="fu">,</span> <span class="dt">&quot;unit&quot;</span><span class="fu">:</span> <span class="st">&quot;msats&quot;</span> <span class="fu">}</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="icon">Icon</h3>
<p>A URL pointing to an image to be used as an icon for the relay.
Recommended to be squared in shape.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;icon&quot;</span><span class="fu">:</span> <span class="st">&quot;https://nostr.build/i/53866b44135a27d624e99c6165cabd76ac8f72797209700acb189fce75021f47.jpg&quot;</span><span class="fu">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="examples">Examples</h3>
<p>As of 2 May 2023 the following command provided these results:</p>
<p>``` ~&gt; curl -H “Accept: application/nostr+json”
https://eden.nostr.land | jq</p>
<p>{ “description”: “nostr.land family of relays (us-or-01)”, “name”:
“nostr.land”, “pubkey”:
“52b4a076bcbbbdc3a1aefa3735816cf74993b1b8db202b01c883c58be7fad8bd”,
“software”: “custom”, “supported_nips”: [ 1, 2, 4, 9, 11, 12, 16, 20,
22, 28, 33, 40 ], “version”: “1.0.1”, “limitation”: {
“payment_required”: true, “max_message_length”: 65535, “max_event_tags”:
2000, “max_subscriptions”: 20, “auth_required”: false }, “payments_url”:
“https://eden.nostr.land”, “fees”: { “subscription”: [ { “amount”:
2500000, “unit”: “msats”, “period”: 2592000 } ] }, }</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>10</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-10">NIP-10</h1>
<h2 id="on-e-and-p-tags-in-text-events-kind-1.">On “e” and “p” tags in
Text Events (kind 1).</h2>
<p><code>draft</code> <code>optional</code></p>
<h2 id="abstract">Abstract</h2>
<p>This NIP describes how to use “e” and “p” tags in text events,
especially those that are replies to other text events. It helps clients
thread the replies into a tree rooted at the original event.</p>
<h2 id="positional-e-tags-deprecated">Positional “e” tags
(DEPRECATED)</h2>
<blockquote>
<p>This scheme is in common use; but should be considered
deprecated.</p>
</blockquote>
<p><code>["e", &lt;event-id&gt;, &lt;relay-url&gt;]</code> as per
NIP-01.</p>
<p>Where:</p>
<ul>
<li><code>&lt;event-id&gt;</code> is the id of the event being
referenced.</li>
<li><code>&lt;relay-url&gt;</code> is the URL of a recommended relay
associated with the reference. Many clients treat this field as
optional.</li>
</ul>
<p><strong>The positions of the “e” tags within the event denote
specific meanings as follows</strong>:</p>
<ul>
<li><p>No “e” tag: <br> This event is not a reply to, nor does it refer
to, any other event.</p></li>
<li><p>One “e” tag: <br> <code>["e", &lt;id&gt;]</code>: The id of the
event to which this event is a reply.</p></li>
<li><p>Two “e” tags: <code>["e", &lt;root-id&gt;]</code>,
<code>["e", &lt;reply-id&gt;]</code> <br> <code>&lt;root-id&gt;</code>
is the id of the event at the root of the reply chain.
<code>&lt;reply-id&gt;</code> is the id of the article to which this
event is a reply.</p></li>
<li><p>Many “e” tags: <code>["e", &lt;root-id&gt;]</code>
<code>["e", &lt;mention-id&gt;]</code>, …,
<code>["e", &lt;reply-id&gt;]</code><br> There may be any number of
<code>&lt;mention-ids&gt;</code>. These are the ids of events which may,
or may not be in the reply chain. They are citing from this event.
<code>root-id</code> and <code>reply-id</code> are as above.</p></li>
</ul>
<blockquote>
<p>This scheme is deprecated because it creates ambiguities that are
difficult, or impossible to resolve when an event references another but
is not a reply.</p>
</blockquote>
<h2 id="marked-e-tags-preferred">Marked “e” tags (PREFERRED)</h2>
<p><code>["e", &lt;event-id&gt;, &lt;relay-url&gt;, &lt;marker&gt;]</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;event-id&gt;</code> is the id of the event being
referenced.</li>
<li><code>&lt;relay-url&gt;</code> is the URL of a recommended relay
associated with the reference. Clients SHOULD add a valid
<code>&lt;relay-URL&gt;</code> field, but may instead leave it as
<code>""</code>.</li>
<li><code>&lt;marker&gt;</code> is optional and if present is one of
<code>"reply"</code>, <code>"root"</code>, or
<code>"mention"</code>.</li>
</ul>
<p>Those marked with <code>"reply"</code> denote the id of the reply
event being responded to. Those marked with <code>"root"</code> denote
the root id of the reply thread being responded to. For top level
replies (those replying directly to the root event), only the
<code>"root"</code> marker should be used. Those marked with
<code>"mention"</code> denote a quoted or reposted event id.</p>
<p>A direct reply to the root of a thread should have a single marked
“e” tag of type “root”.</p>
<blockquote>
<p>This scheme is preferred because it allows events to mention others
without confusing them with <code>&lt;reply-id&gt;</code> or
<code>&lt;root-id&gt;</code>.</p>
</blockquote>
<h2 id="the-p-tag">The “p” tag</h2>
<p>Used in a text event contains a list of pubkeys used to record who is
involved in a reply thread.</p>
<p>When replying to a text event E the reply event’s “p” tags should
contain all of E’s “p” tags as well as the <code>"pubkey"</code> of the
event being replied to.</p>
<p>Example: Given a text event authored by <code>a1</code> with “p” tags
[<code>p1</code>, <code>p2</code>, <code>p3</code>] then the “p” tags of
the reply should be [<code>a1</code>, <code>p1</code>, <code>p2</code>,
<code>p3</code>] in no particular order.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>09</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-09">NIP-09</h1>
<h2 id="event-deletion">Event Deletion</h2>
<p><code>draft</code> <code>optional</code></p>
<p>A special event with kind <code>5</code>, meaning “deletion” is
defined as having a list of one or more <code>e</code> tags, each
referencing an event the author is requesting to be deleted.</p>
<p>Each tag entry must contain an “e” event id and/or <code>a</code>
tags intended for deletion.</p>
<p>The event’s <code>content</code> field MAY contain a text note
describing the reason for the deletion.</p>
<p>For example:</p>
<pre><code>{
  &quot;kind&quot;: 5,
  &quot;pubkey&quot;: &lt;32-bytes hex-encoded public key of the event creator&gt;,
  &quot;tags&quot;: [
    [&quot;e&quot;, &quot;dcd59..464a2&quot;],
    [&quot;e&quot;, &quot;968c5..ad7a4&quot;],
    [&quot;a&quot;, &quot;&lt;kind&gt;:&lt;pubkey&gt;:&lt;d-identifier&gt;&quot;]
  ],
  &quot;content&quot;: &quot;these posts were published by accident&quot;,
  ...other fields
}</code></pre>
<p>Relays SHOULD delete or stop publishing any referenced events that
have an identical <code>pubkey</code> as the deletion request. Clients
SHOULD hide or otherwise indicate a deletion status for referenced
events.</p>
<p>Relays SHOULD continue to publish/share the deletion events
indefinitely, as clients may already have the event that’s intended to
be deleted. Additionally, clients SHOULD broadcast deletion events to
other relays which don’t have it.</p>
<h2 id="client-usage">Client Usage</h2>
<p>Clients MAY choose to fully hide any events that are referenced by
valid deletion events. This includes text notes, direct messages, or
other yet-to-be defined event kinds. Alternatively, they MAY show the
event along with an icon or other indication that the author has
“disowned” the event. The <code>content</code> field MAY also be used to
replace the deleted events’ own content, although a user interface
should clearly indicate that this is a deletion reason, not the original
content.</p>
<p>A client MUST validate that each event <code>pubkey</code> referenced
in the <code>e</code> tag of the deletion request is identical to the
deletion request <code>pubkey</code>, before hiding or deleting any
event. Relays can not, in general, perform this validation and should
not be treated as authoritative.</p>
<p>Clients display the deletion event itself in any way they choose,
e.g., not at all, or with a prominent notice.</p>
<h2 id="relay-usage">Relay Usage</h2>
<p>Relays MAY validate that a deletion event only references events that
have the same <code>pubkey</code> as the deletion itself, however this
is not required since relays may not have knowledge of all referenced
events.</p>
<h2 id="deleting-a-deletion">Deleting a Deletion</h2>
<p>Publishing a deletion event against a deletion has no effect. Clients
and relays are not obliged to support “undelete” functionality.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>08</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<blockquote>
<p><strong>Warning</strong> <code>unrecommended</code>: deprecated in
favor of <a href="27.md.css.html">NIP-27</a></p>
</blockquote>
<h1 id="nip-08">NIP-08</h1>
<h2 id="handling-mentions">Handling Mentions</h2>
<p><code>final</code> <code>unrecommended</code>
<code>optional</code></p>
<p>This document standardizes the treatment given by clients of inline
mentions of other events and pubkeys inside the content of
<code>text_note</code>s.</p>
<p>Clients that want to allow tagged mentions they MUST show an
autocomplete component or something analogous to that whenever the user
starts typing a special key (for example, “@”) or presses some button to
include a mention etc – or these clients can come up with other ways to
unambiguously differentiate between mentions and normal text.</p>
<p>Once a mention is identified, for example, the pubkey
<code>27866e9d854c78ae625b867eefdfa9580434bc3e675be08d2acb526610d96fbe</code>,
the client MUST add that pubkey to the <code>.tags</code> with the tag
<code>p</code>, then replace its textual reference (inside
<code>.content</code>) with the notation <code>#[index]</code> in which
“index” is equal to the 0-based index of the related tag in the tags
array.</p>
<p>The same process applies for mentioning event IDs.</p>
<p>A client that receives a <code>text_note</code> event with such
<code>#[index]</code> mentions in its <code>.content</code> CAN do a
search-and-replace using the actual contents from the <code>.tags</code>
array with the actual pubkey or event ID that is mentioned, doing any
desired context augmentation (for example, linking to the pubkey or
showing a preview of the mentioned event contents) it wants in the
process.</p>
<p>Where <code>#[index]</code> has an <code>index</code> that is outside
the range of the tags array or points to a tag that is not an
<code>e</code> or <code>p</code> tag or a tag otherwise declared to
support this notation, the client MUST NOT perform such replacement or
augmentation, but instead display it as normal text.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>07</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-07">NIP-07</h1>
<h2
id="window.nostr-capability-for-web-browsers"><code>window.nostr</code>
capability for web browsers</h2>
<p><code>draft</code> <code>optional</code></p>
<p>The <code>window.nostr</code> object may be made available by web
browsers or extensions and websites or web-apps may make use of it after
checking its availability.</p>
<p>That object must define the following methods:</p>
<pre><code>async window.nostr.getPublicKey(): string // returns a public key as hex
async window.nostr.signEvent(event: { created_at: number, kind: number, tags: string[][], content: string }): Event // takes an event object, adds `id`, `pubkey` and `sig` and returns it</code></pre>
<p>Aside from these two basic above, the following functions can also be
implemented optionally:</p>
<pre><code>async window.nostr.getRelays(): { [url: string]: {read: boolean, write: boolean} } // returns a basic map of relay urls to relay policies
async window.nostr.nip04.encrypt(pubkey, plaintext): string // returns ciphertext and iv as specified in nip-04 (deprecated)
async window.nostr.nip04.decrypt(pubkey, ciphertext): string // takes ciphertext and iv as specified in nip-04 (deprecated)
async window.nostr.nip44.encrypt(pubkey, plaintext): string // returns ciphertext as specified in nip-44
async window.nostr.nip44.decrypt(pubkey, ciphertext): string // takes ciphertext as specified in nip-44</code></pre>
<h3 id="implementation">Implementation</h3>
<p>See
https://github.com/aljazceru/awesome-nostr#nip-07-browser-extensions.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>06</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="nip-06">NIP-06</h1>
<h2 id="basic-key-derivation-from-mnemonic-seed-phrase">Basic key
derivation from mnemonic seed phrase</h2>
<p><code>draft</code> <code>optional</code></p>
<p><a href="https://bips.xyz/39">BIP39</a> is used to generate mnemonic
seed words and derive a binary seed from them.</p>
<p><a href="https://bips.xyz/32">BIP32</a> is used to derive the path
<code>m/44'/1237'/&lt;account&gt;'/0/0</code> (according to the Nostr
entry on <a
href="https://github.com/satoshilabs/slips/blob/master/slip-0044.md.css.html">SLIP44</a>).</p>
<p>A basic client can simply use an <code>account</code> of
<code>0</code> to derive a single key. For more advanced use-cases you
can increment <code>account</code>, allowing generation of practically
infinite keys from the 5-level path with hardened derivation.</p>
<p>Other types of clients can still get fancy and use other derivation
paths for their own other purposes.</p>
<h3 id="test-vectors">Test vectors</h3>
<p>mnemonic: leader monkey parrot ring guide accident before fence
cannon height naive bean<br />
private key (hex):
7f7ff03d123792d6ac594bfa67bf6d0c0ab55b6b1fdb6249303fe861f1ccba9a<br />
nsec:
nsec10allq0gjx7fddtzef0ax0.md.css.htmlps9t2kmtrldkyjfs8l5xruwvh2dq0lhhkp<br />
public key (hex):
17162c921dc4d2518f9a101db33695df1afb56ab82f5ff3e5da6eec3ca5cd917<br />
npub:
npub1zutzeysacnf9rru6zqwmxd54mud0k44tst6l70ja5mhv8jjumytsd2x7nu</p>
<hr />
<p>mnemonic: what bleak badge arrange retreat wolf trade produce cricket
blur garlic valid proud rude strong choose busy staff weather area salt
hollow arm fade<br />
private key (hex):
c15d739894c81a2fcfd3a2df85a0d2c0dbc47a280d092799f144d73d7ae78add<br />
nsec:
nsec1c9wh8xy5eqdzln7n5t0ctgxjcrdug73gp5yj0x03gntn67h83twssdfhel<br />
public key (hex):
d41b22899549e1f3d335a31002cfd382174006e166d3e658e3a5eecdb6463573<br />
npub:
npub16sdj9zv4f8sl85e45vgq9n7nsgt5qphpvmf7vk8r5hh.md.css.htmljxx4es8rq74h</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>05</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-05">NIP-05</h1>
<h2 id="mapping-nostr-keys-to-dns-based-internet-identifiers">Mapping
Nostr keys to DNS-based internet identifiers</h2>
<p><code>final</code> <code>optional</code></p>
<p>On events of kind <code>0</code> (<code>metadata</code>) one can
specify the key <code>"nip05"</code> with an <a
href="https://datatracker.ietf.org/doc/html/rfc5322#section-3.4.1">internet
identifier</a> (an email-like address) as the value. Although there is a
link to a very liberal “internet identifier” specification above, NIP-05
assumes the <code>&lt;local-part&gt;</code> part will be restricted to
the characters <code>a-z0-9-_.</code>, case-insensitive.</p>
<p>Upon seeing that, the client splits the identifier into
<code>&lt;local-part&gt;</code> and <code>&lt;domain&gt;</code> and use
these values to make a GET request to
<code>https://&lt;domain&gt;/.well-known/nostr.json?name=&lt;local-part&gt;</code>.</p>
<p>The result should be a JSON document object with a key
<code>"names"</code> that should then be a mapping of names to hex
formatted public keys. If the public key for the given
<code>&lt;name&gt;</code> matches the <code>pubkey</code> from the
<code>metadata</code> event, the client then concludes that the given
pubkey can indeed be referenced by its identifier.</p>
<h3 id="example">Example</h3>
<p>If a client sees an event like this:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;pubkey&quot;</span><span class="fu">:</span> <span class="st">&quot;b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;{</span><span class="ch">\&quot;</span><span class="st">name</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">bob</span><span class="ch">\&quot;</span><span class="st">, </span><span class="ch">\&quot;</span><span class="st">nip05</span><span class="ch">\&quot;</span><span class="st">: </span><span class="ch">\&quot;</span><span class="st">bob@example.com</span><span class="ch">\&quot;</span><span class="st">}&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>It will make a GET request to
<code>https://example.com/.well-known/nostr.json?name=bob</code> and get
back a response that will look like</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;names&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;bob&quot;</span><span class="fu">:</span> <span class="st">&quot;b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>or with the <strong>recommended</strong> <code>"relays"</code>
attribute:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;names&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;bob&quot;</span><span class="fu">:</span> <span class="st">&quot;b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;relays&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="st">&quot;wss://relay.example.com&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://relay2.example.com&quot;</span> <span class="ot">]</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>If the pubkey matches the one given in <code>"names"</code> (as in
the example above) that means the association is right and the
<code>"nip05"</code> identifier is valid and can be displayed.</p>
<p>The recommended <code>"relays"</code> attribute may contain an object
with public keys as properties and arrays of relay URLs as values. When
present, that can be used to help clients learn in which relays the
specific user may be found. Web servers which serve
<code>/.well-known/nostr.json</code> files dynamically based on the
query string SHOULD also serve the relays data for any name they serve
in the same reply when that is available.</p>
<h2 id="finding-users-from-their-nip-05-identifier">Finding users from
their NIP-05 identifier</h2>
<p>A client may implement support for finding users’ public keys from
<em>internet identifiers</em>, the flow is the same as above, but
reversed: first the client fetches the <em>well-known</em> URL and from
there it gets the public key of the user, then it tries to fetch the
kind <code>0</code> event for that user and check if it has a matching
<code>"nip05"</code>.</p>
<h2 id="notes">Notes</h2>
<h3
id="clients-must-always-follow-public-keys-not-nip-05-addresses">Clients
must always follow public keys, not NIP-05 addresses</h3>
<p>For example, if after finding that <code>bob@bob.com</code> has the
public key <code>abc...def</code>, the user clicks a button to follow
that profile, the client must keep a primary reference to
<code>abc...def</code>, not <code>bob@bob.com</code>. If, for any
reason, the address
<code>https://bob.com/.well-known/nostr.json?name=bob</code> starts
returning the public key <code>1d2...e3f</code> at any time in the
future, the client must not replace <code>abc...def</code> in his list
of followed profiles for the user (but it should stop displaying
“bob@bob.com” for that user, as that will have become an invalid
<code>"nip05"</code> property).</p>
<h3 id="public-keys-must-be-in-hex-format">Public keys must be in hex
format</h3>
<p>Keys must be returned in hex format. Keys in NIP-19 <code>npub</code>
format are only meant to be used for display in client UIs, not in this
NIP.</p>
<h3 id="user-discovery-implementation-suggestion">User Discovery
implementation suggestion</h3>
<p>A client can also use this to allow users to search other profiles.
If a client has a search box or something like that, a user may be able
to type “bob@example.com” there and the client would recognize that and
do the proper queries to obtain a pubkey and suggest that to the
user.</p>
<h3 id="showing-just-the-domain-as-an-identifier">Showing just the
domain as an identifier</h3>
<p>Clients may treat the identifier <code>_@domain</code> as the “root”
identifier, and choose to display it as just the
<code>&lt;domain&gt;</code>. For example, if Bob owns
<code>bob.com</code>, he may not want an identifier like
<code>bob@bob.com</code> as that is redundant. Instead, Bob can use the
identifier <code>_@bob.com</code> and expect Nostr clients to show and
treat that as just <code>bob.com</code> for all purposes.</p>
<h3
id="reasoning-for-the-.well-knownnostr.jsonnamelocal-part-format">Reasoning
for the <code>/.well-known/nostr.json?name=&lt;local-part&gt;</code>
format</h3>
<p>By adding the <code>&lt;local-part&gt;</code> as a query string
instead of as part of the path, the protocol can support both dynamic
servers that can generate JSON on-demand and static servers with a JSON
file in it that may contain multiple names.</p>
<h3 id="allowing-access-from-javascript-apps">Allowing access from
JavaScript apps</h3>
<p>JavaScript Nostr apps may be restricted by browser <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>
policies that prevent them from accessing
<code>/.well-known/nostr.json</code> on the user’s domain. When CORS
prevents JS from loading a resource, the JS program sees it as a network
failure identical to the resource not existing, so it is not possible
for a pure-JS app to tell the user for certain that the failure was
caused by a CORS issue. JS Nostr apps that see network failures
requesting <code>/.well-known/nostr.json</code> files may want to
recommend to users that they check the CORS policy of their servers,
e.g.:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-sI</span> https://example.com/.well-known/nostr.json<span class="pp">?</span>name=bob <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-i</span> ^Access-Control</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Access-Control-Allow-Origin:</span> <span class="pp">*</span></span></code></pre></div>
<p>Users should ensure that their <code>/.well-known/nostr.json</code>
is served with the HTTP header
<code>Access-Control-Allow-Origin: *</code> to ensure it can be
validated by pure JS apps running in modern browsers.</p>
<h3 id="security-constraints">Security Constraints</h3>
<p>The <code>/.well-known/nostr.json</code> endpoint MUST NOT return any
HTTP redirects.</p>
<p>Fetchers MUST ignore any HTTP redirects given by the
<code>/.well-known/nostr.json</code> endpoint.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>04</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<blockquote>
<p><strong>Warning</strong> <code>unrecommended</code>: deprecated in
favor of <a href="17.md.css.html">NIP-17</a></p>
</blockquote>
<h1 id="nip-04">NIP-04</h1>
<h2 id="encrypted-direct-message">Encrypted Direct Message</h2>
<p><code>final</code> <code>unrecommended</code>
<code>optional</code></p>
<p>A special event with kind <code>4</code>, meaning “encrypted direct
message”. It is supposed to have the following attributes:</p>
<p><strong><code>content</code></strong> MUST be equal to the
base64-encoded, aes-256-cbc encrypted string of anything a user wants to
write, encrypted using a shared cipher generated by combining the
recipient’s public-key with the sender’s private-key; this appended by
the base64-encoded initialization vector as if it was a querystring
parameter named “iv”. The format is the following:
<code>"content": "&lt;encrypted_text&gt;?iv=&lt;initialization_vector&gt;"</code>.</p>
<p><strong><code>tags</code></strong> MUST contain an entry identifying
the receiver of the message (such that relays may naturally forward this
event to them), in the form
<code>["p", "&lt;pubkey, as a hex string&gt;"]</code>.</p>
<p><strong><code>tags</code></strong> MAY contain an entry identifying
the previous message in a conversation or a message we are explicitly
replying to (such that contextual, more organized conversations may
happen), in the form <code>["e", "&lt;event_id&gt;"]</code>.</p>
<p><strong>Note</strong>: By default in the <a
href="https://github.com/bitcoin-core/secp256k1">libsecp256k1</a> ECDH
implementation, the secret is the SHA256 hash of the shared point (both
X and Y coordinates). In Nostr, only the X coordinate of the shared
point is used as the secret and it is NOT hashed. If using libsecp256k1,
a custom function that copies the X coordinate must be passed as the
<code>hashfp</code> argument in <code>secp256k1_ecdh</code>. See <a
href="https://github.com/bitcoin-core/secp256k1/blob/master/src/modules/ecdh/main_impl.h#L29">here</a>.</p>
<p>Code sample for generating such an event in JavaScript:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> crypto <span class="im">from</span> <span class="st">&#39;crypto&#39;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> secp <span class="im">from</span> <span class="st">&#39;@noble/secp256k1&#39;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> sharedPoint <span class="op">=</span> secp<span class="op">.</span><span class="fu">getSharedSecret</span>(ourPrivateKey<span class="op">,</span> <span class="st">&#39;02&#39;</span> <span class="op">+</span> theirPublicKey)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> sharedX <span class="op">=</span> sharedPoint<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">33</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> iv <span class="op">=</span> crypto<span class="op">.</span><span class="fu">randomFillSync</span>(<span class="kw">new</span> <span class="bu">Uint8Array</span>(<span class="dv">16</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> cipher <span class="op">=</span> crypto<span class="op">.</span><span class="fu">createCipheriv</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;aes-256-cbc&#39;</span><span class="op">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Buffer</span><span class="op">.</span><span class="fu">from</span>(sharedX)<span class="op">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  iv</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> encryptedMessage <span class="op">=</span> cipher<span class="op">.</span><span class="fu">update</span>(text<span class="op">,</span> <span class="st">&#39;utf8&#39;</span><span class="op">,</span> <span class="st">&#39;base64&#39;</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>encryptedMessage <span class="op">+=</span> cipher<span class="op">.</span><span class="fu">final</span>(<span class="st">&#39;base64&#39;</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> ivBase64 <span class="op">=</span> <span class="bu">Buffer</span><span class="op">.</span><span class="fu">from</span>(iv<span class="op">.</span><span class="at">buffer</span>)<span class="op">.</span><span class="fu">toString</span>(<span class="st">&#39;base64&#39;</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="bu">event</span> <span class="op">=</span> {</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pubkey</span><span class="op">:</span> ourPubKey<span class="op">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">created_at</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span>)<span class="op">,</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">kind</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">tags</span><span class="op">:</span> [[<span class="st">&#39;p&#39;</span><span class="op">,</span> theirPublicKey]]<span class="op">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">content</span><span class="op">:</span> encryptedMessage <span class="op">+</span> <span class="st">&#39;?iv=&#39;</span> <span class="op">+</span> ivBase64</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="security-warning">Security Warning</h2>
<p>This standard does not go anywhere near what is considered the
state-of-the-art in encrypted communication between peers, and it leaks
metadata in the events, therefore it must not be used for anything you
really need to keep secret, and only with relays that use
<code>AUTH</code> to restrict who can fetch your <code>kind:4</code>
events.</p>
<h2 id="client-implementation-warning">Client Implementation
Warning</h2>
<p>Clients <em>should not</em> search and replace public key or note
references from the <code>.content</code>. If processed like a regular
text note (where <code>@npub...</code> is replaced with
<code>#[0]</code> with a <code>["p", "..."]</code> tag) the tags are
leaked and the mentioned user will receive the message in their
inbox.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>03</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-03">NIP-03</h1>
<h2 id="opentimestamps-attestations-for-events">OpenTimestamps
Attestations for Events</h2>
<p><code>draft</code> <code>optional</code></p>
<p>This NIP defines an event with <code>kind:1040</code> that can
contain an <a href="https://opentimestamps.org/">OpenTimestamps</a>
proof for any other event:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">1040</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tags&quot;</span><span class="er">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;e&quot;</span><span class="ot">,</span> <span class="er">&lt;event-id&gt;</span><span class="ot">,</span> <span class="er">&lt;relay-url&gt;</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;alt&quot;</span><span class="ot">,</span> <span class="st">&quot;opentimestamps attestation&quot;</span><span class="ot">]</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="er">&lt;base64-encoded</span> <span class="er">OTS</span> <span class="er">file</span> <span class="er">data&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li>The OpenTimestamps proof MUST prove the referenced <code>e</code>
event id as its digest.</li>
<li>The <code>content</code> MUST be the full content of an
<code>.ots</code> file containing at least one Bitcoin attestation. This
file SHOULD contain a <strong>single</strong> Bitcoin attestation (as
not more than one valid attestation is necessary and less bytes is
better than more) and no reference to “pending” attestations since they
are useless in this context.</li>
</ul>
<h3 id="example-opentimestamps-proof-verification-flow">Example
OpenTimestamps proof verification flow</h3>
<p>Using <a href="https://github.com/fiatjaf/nak"><code>nak</code></a>,
<a href="https://jqlang.github.io/jq/"><code>jq</code></a> and <a
href="https://github.com/fiatjaf/ots"><code>ots</code></a>:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~</span><span class="op">&gt;</span> nak req <span class="at">-i</span> e71c6ea722987debdb60f81f9ea4f604b5ac0664120dd64fb9d23abc4ec7c323 wss://nostr-pub.wellorder.net <span class="kw">|</span> <span class="ex">jq</span> <span class="at">-r</span> .content <span class="kw">|</span> <span class="ex">ots</span> verify</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> using <span class="ex">an</span> esplora server at https://blockstream.info/api</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> sequence ending on block 810391 is valid</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">timestamp</span> validated at block <span class="pp">[</span><span class="ss">810391</span><span class="pp">]</span></span></code></pre></div>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>02</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-02">NIP-02</h1>
<h2 id="follow-list">Follow List</h2>
<p><code>final</code> <code>optional</code></p>
<p>A special event with kind <code>3</code>, meaning “follow list” is
defined as having a list of <code>p</code> tags, one for each of the
followed/known profiles one is following.</p>
<p>Each tag entry should contain the key for the profile, a relay URL
where events from that key can be found (can be set to an empty string
if not needed), and a local name (or “petname”) for that profile (can
also be set to an empty string or not provided), i.e.,
<code>["p", &lt;32-bytes hex key&gt;, &lt;main relay URL&gt;, &lt;petname&gt;]</code>.
The <code>content</code> can be anything and should be ignored.</p>
<p>For example:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;91cf9..4e5ca&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://alicerelay.com/&quot;</span><span class="ot">,</span> <span class="st">&quot;alice&quot;</span><span class="ot">],</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;14aeb..8dad4&quot;</span><span class="ot">,</span> <span class="st">&quot;wss://bobrelay.com/nostr&quot;</span><span class="ot">,</span> <span class="st">&quot;bob&quot;</span><span class="ot">],</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;612ae..e610f&quot;</span><span class="ot">,</span> <span class="st">&quot;ws://carolrelay.com/ws&quot;</span><span class="ot">,</span> <span class="st">&quot;carol&quot;</span><span class="ot">]</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;content&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="er">...other</span> <span class="er">fields</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Every new following list that gets published overwrites the past
ones, so it should contain all entries. Relays and clients SHOULD delete
past following lists as soon as they receive a new one.</p>
<p>Whenever new follows are added to an existing list, clients SHOULD
append them to the end of the list, so they are stored in chronological
order.</p>
<h2 id="uses">Uses</h2>
<h3 id="follow-list-backup">Follow list backup</h3>
<p>If one believes a relay will store their events for sufficient time,
they can use this kind-3 event to backup their following list and
recover on a different device.</p>
<h3 id="profile-discovery-and-context-augmentation">Profile discovery
and context augmentation</h3>
<p>A client may rely on the kind-3 event to display a list of followed
people by profiles one is browsing; make lists of suggestions on who to
follow based on the follow lists of other people one might be following
or browsing; or show the data in other contexts.</p>
<h3 id="relay-sharing">Relay sharing</h3>
<p>A client may publish a follow list with good relays for each of their
follows so other clients may use these to update their internal relay
lists if needed, increasing censorship-resistance.</p>
<h3 id="petname-scheme">Petname scheme</h3>
<p>The data from these follow lists can be used by clients to construct
local <a
href="http://www.skyhunter.com/marcs/petnames/IntroPetNames.html">“petname”</a>
tables derived from other people’s follow lists. This alleviates the
need for global human-readable names. For example:</p>
<p>A user has an internal follow list that says</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;21df6d143fb96c2ec9d63726bf9edc71&quot;</span><span class="ot">,</span> <span class="st">&quot;&quot;</span><span class="ot">,</span> <span class="st">&quot;erin&quot;</span><span class="ot">]</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>And receives two follow lists, one from
<code>21df6d143fb96c2ec9d63726bf9edc71</code> that says</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;a8bb3d884d5d90b413d9891fe4c4e46d&quot;</span><span class="ot">,</span> <span class="st">&quot;&quot;</span><span class="ot">,</span> <span class="st">&quot;david&quot;</span><span class="ot">]</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>and another from <code>a8bb3d884d5d90b413d9891fe4c4e46d</code> that
says</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;p&quot;</span><span class="ot">,</span> <span class="st">&quot;f57f54057d2a7af0efecc8b0b66f5708&quot;</span><span class="ot">,</span> <span class="st">&quot;&quot;</span><span class="ot">,</span> <span class="st">&quot;frank&quot;</span><span class="ot">]</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>When the user sees <code>21df6d143fb96c2ec9d63726bf9edc71</code> the
client can show <em>erin</em> instead; When the user sees
<code>a8bb3d884d5d90b413d9891fe4c4e46d</code> the client can show
<em>david.erin</em> instead; When the user sees
<code>f57f54057d2a7af0efecc8b0b66f5708</code> the client can show
<em>frank.david.erin</em> instead.</p>
</body>
</html>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>01</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="nip-01">NIP-01</h1>
<h2 id="basic-protocol-flow-description">Basic protocol flow
description</h2>
<p><code>draft</code> <code>mandatory</code></p>
<p>This NIP defines the basic protocol that should be implemented by
everybody. New NIPs may add new optional (or mandatory) fields and
messages and features to the structures and flows described here.</p>
<h2 id="events-and-signatures">Events and signatures</h2>
<p>Each user has a keypair. Signatures, public key, and encodings are
done according to the <a href="https://bips.xyz/340">Schnorr signatures
standard for the curve <code>secp256k1</code></a>.</p>
<p>The only object type that exists is the <code>event</code>, which has
the following format on the wire:</p>
<pre class="jsonc"><code>{
  &quot;id&quot;: &lt;32-bytes lowercase hex-encoded sha256 of the serialized event data&gt;,
  &quot;pubkey&quot;: &lt;32-bytes lowercase hex-encoded public key of the event creator&gt;,
  &quot;created_at&quot;: &lt;unix timestamp in seconds&gt;,
  &quot;kind&quot;: &lt;integer between 0 and 65535&gt;,
  &quot;tags&quot;: [
    [&lt;arbitrary string&gt;...],
    // ...
  ],
  &quot;content&quot;: &lt;arbitrary string&gt;,
  &quot;sig&quot;: &lt;64-bytes lowercase hex of the signature of the sha256 hash of the serialized event data, which is the same as the &quot;id&quot; field&gt;
}</code></pre>
<p>To obtain the <code>event.id</code>, we <code>sha256</code> the
serialized event. The serialization is done over the UTF-8
JSON-serialized string (which is described below) of the following
structure:</p>
<pre><code>[
  0,
  &lt;pubkey, as a lowercase hex string&gt;,
  &lt;created_at, as a number&gt;,
  &lt;kind, as a number&gt;,
  &lt;tags, as an array of arrays of non-null strings&gt;,
  &lt;content, as a string&gt;
]</code></pre>
<p>To prevent implementation differences from creating a different event
ID for the same event, the following rules MUST be followed while
serializing: - No whitespace, line breaks or other unnecessary
formatting should be included in the output JSON. - No characters except
the following should be escaped, and instead should be included
verbatim: - A line break, <code>0x0A</code>, as <code>\n</code> - A
double quote, <code>0x22</code>, as <code>\"</code> - A backslash,
<code>0x5C</code>, as <code>\\</code> - A carriage return,
<code>0x0D</code>, as <code>\r</code> - A tab character,
<code>0x09</code>, as <code>\t</code> - A backspace, <code>0x08</code>,
as <code>\b</code> - A form feed, <code>0x0C</code>, as <code>\f</code>
- UTF-8 should be used for encoding.</p>
<h3 id="tags">Tags</h3>
<p>Each tag is an array of one or more strings, with some conventions
around them. Take a look at the example below:</p>
<pre class="jsonc"><code>{
  &quot;tags&quot;: [
    [&quot;e&quot;, &quot;5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36&quot;, &quot;wss://nostr.example.com&quot;],
    [&quot;p&quot;, &quot;f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca&quot;],
    [&quot;a&quot;, &quot;30023:f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca:abcd&quot;, &quot;wss://nostr.example.com&quot;],
    [&quot;alt&quot;, &quot;reply&quot;],
    // ...
  ],
  // ...
}</code></pre>
<p>The first element of the tag array is referred to as the tag
<em>name</em> or <em>key</em> and the second as the tag <em>value</em>.
So we can safely say that the event above has an <code>e</code> tag set
to
<code>"5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36"</code>,
an <code>alt</code> tag set to <code>"reply"</code> and so on. All
elements after the second do not have a conventional name.</p>
<p>This NIP defines 3 standard tags that can be used across all event
kinds with the same meaning. They are as follows:</p>
<ul>
<li>The <code>e</code> tag, used to refer to an event:
<code>["e", &lt;32-bytes lowercase hex of the id of another event&gt;, &lt;recommended relay URL, optional&gt;]</code></li>
<li>The <code>p</code> tag, used to refer to another user:
<code>["p", &lt;32-bytes lowercase hex of a pubkey&gt;, &lt;recommended relay URL, optional&gt;]</code></li>
<li>The <code>a</code> tag, used to refer to a (maybe parameterized)
replaceable event
<ul>
<li>for a parameterized replaceable event:
<code>["a", &lt;kind integer&gt;:&lt;32-bytes lowercase hex of a pubkey&gt;:&lt;d tag value&gt;, &lt;recommended relay URL, optional&gt;]</code></li>
<li>for a non-parameterized replaceable event:
<code>["a", &lt;kind integer&gt;:&lt;32-bytes lowercase hex of a pubkey&gt;:, &lt;recommended relay URL, optional&gt;]</code></li>
</ul></li>
</ul>
<p>As a convention, all single-letter (only english alphabet letters:
a-z, A-Z) key tags are expected to be indexed by relays, such that it is
possible, for example, to query or subscribe to events that reference
the event
<code>"5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36"</code>
by using the
<code>{"#e": ["5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36"]}</code>
filter.</p>
<h3 id="kinds">Kinds</h3>
<p>Kinds specify how clients should interpret the meaning of each event
and the other fields of each event (e.g. an <code>"r"</code> tag may
have a meaning in an event of kind 1 and an entirely different meaning
in an event of kind 10002). Each NIP may define the meaning of a set of
kinds that weren’t defined elsewhere. This NIP defines two basic
kinds:</p>
<ul>
<li><code>0</code>: <strong>metadata</strong>: the <code>content</code>
is set to a stringified JSON object
<code>{name: &lt;username&gt;, about: &lt;string&gt;, picture: &lt;url, string&gt;}</code>
describing the user who created the event. A relay may delete older
events once it gets a new one for the same pubkey.</li>
<li><code>1</code>: <strong>text note</strong>: the <code>content</code>
is set to the <strong>plaintext</strong> content of a note (anything the
user wants to say). Content that must be parsed, such as Markdown and
HTML, should not be used. Clients should also not parse content as
those.</li>
</ul>
<p>And also a convention for kind ranges that allow for easier
experimentation and flexibility of relay implementation:</p>
<ul>
<li>for kind <code>n</code> such that
<code>1000 &lt;= n &lt; 10000</code>, events are
<strong>regular</strong>, which means they’re all expected to be stored
by relays.</li>
<li>for kind <code>n</code> such that
<code>10000 &lt;= n &lt; 20000 || n == 0 || n == 3</code>, events are
<strong>replaceable</strong>, which means that, for each combination of
<code>pubkey</code> and <code>kind</code>, only the latest event MUST be
stored by relays, older versions MAY be discarded.</li>
<li>for kind <code>n</code> such that
<code>20000 &lt;= n &lt; 30000</code>, events are
<strong>ephemeral</strong>, which means they are not expected to be
stored by relays.</li>
<li>for kind <code>n</code> such that
<code>30000 &lt;= n &lt; 40000</code>, events are <strong>parameterized
replaceable</strong>, which means that, for each combination of
<code>pubkey</code>, <code>kind</code> and the <code>d</code> tag’s
first value, only the latest event MUST be stored by relays, older
versions MAY be discarded.</li>
</ul>
<p>In case of replaceable events with the same timestamp, the event with
the lowest id (first in lexical order) should be retained, and the other
discarded.</p>
<p>When answering to <code>REQ</code> messages for replaceable events
such as <code>{"kinds":[0],"authors":[&lt;hex-key&gt;]}</code>, even if
the relay has more than one version stored, it SHOULD return just the
latest one.</p>
<p>These are just conventions and relay implementations may differ.</p>
<h2 id="communication-between-clients-and-relays">Communication between
clients and relays</h2>
<p>Relays expose a websocket endpoint to which clients can connect.
Clients SHOULD open a single websocket connection to each relay and use
it for all their subscriptions. Relays MAY limit number of connections
from specific IP/client/etc.</p>
<h3
id="from-client-to-relay-sending-events-and-creating-subscriptions">From
client to relay: sending events and creating subscriptions</h3>
<p>Clients can send 3 types of messages, which must be JSON arrays,
according to the following patterns:</p>
<ul>
<li><code>["EVENT", &lt;event JSON as defined above&gt;]</code>, used to
publish events.</li>
<li><code>["REQ", &lt;subscription_id&gt;, &lt;filters1&gt;, &lt;filters2&gt;, ...]</code>,
used to request events and subscribe to new updates.</li>
<li><code>["CLOSE", &lt;subscription_id&gt;]</code>, used to stop
previous subscriptions.</li>
</ul>
<p><code>&lt;subscription_id&gt;</code> is an arbitrary, non-empty
string of max length 64 chars. It represents a subscription per
connection. Relays MUST manage <code>&lt;subscription_id&gt;</code>s
independently for each WebSocket connection.
<code>&lt;subscription_id&gt;</code>s are not guaranteed to be globally
unique.</p>
<p><code>&lt;filtersX&gt;</code> is a JSON object that determines what
events will be sent in that subscription, it can have the following
attributes:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ids&quot;</span><span class="fu">:</span> <span class="er">&lt;a</span> <span class="er">list</span> <span class="er">of</span> <span class="er">event</span> <span class="er">ids&gt;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;authors&quot;</span><span class="fu">:</span> <span class="er">&lt;a</span> <span class="er">list</span> <span class="er">of</span> <span class="er">lowercase</span> <span class="er">pubkeys</span><span class="fu">,</span> <span class="er">the</span> <span class="er">pubkey</span> <span class="er">of</span> <span class="er">an</span> <span class="er">event</span> <span class="er">must</span> <span class="er">be</span> <span class="er">one</span> <span class="er">of</span> <span class="er">these&gt;</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kinds&quot;</span><span class="fu">:</span> <span class="er">&lt;a</span> <span class="er">list</span> <span class="er">of</span> <span class="er">a</span> <span class="er">kind</span> <span class="er">numbers&gt;</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;#&lt;single-letter (a-zA-Z)&gt;&quot;</span><span class="fu">:</span> <span class="er">&lt;a</span> <span class="er">list</span> <span class="er">of</span> <span class="er">tag</span> <span class="er">values</span><span class="fu">,</span> <span class="er">for</span> <span class="er">#e</span> <span class="er">—</span> <span class="er">a</span> <span class="er">list</span> <span class="er">of</span> <span class="er">event</span> <span class="er">ids</span><span class="fu">,</span> <span class="er">for</span> <span class="er">#p</span> <span class="er">—</span> <span class="er">a</span> <span class="er">list</span> <span class="er">of</span> <span class="er">pubkeys</span><span class="fu">,</span> <span class="er">etc.&gt;</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;since&quot;</span><span class="fu">:</span> <span class="er">&lt;an</span> <span class="er">integer</span> <span class="er">unix</span> <span class="er">timestamp</span> <span class="er">in</span> <span class="er">seconds</span><span class="fu">,</span> <span class="er">events</span> <span class="er">must</span> <span class="er">be</span> <span class="er">newer</span> <span class="er">than</span> <span class="er">this</span> <span class="er">to</span> <span class="er">pass&gt;</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;until&quot;</span><span class="fu">:</span> <span class="er">&lt;an</span> <span class="er">integer</span> <span class="er">unix</span> <span class="er">timestamp</span> <span class="er">in</span> <span class="er">seconds</span><span class="fu">,</span> <span class="er">events</span> <span class="er">must</span> <span class="er">be</span> <span class="er">older</span> <span class="er">than</span> <span class="er">this</span> <span class="er">to</span> <span class="er">pass&gt;</span><span class="fu">,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;limit&quot;</span><span class="fu">:</span> <span class="er">&lt;maximum</span> <span class="er">number</span> <span class="er">of</span> <span class="er">events</span> <span class="er">relays</span> <span class="er">SHOULD</span> <span class="er">return</span> <span class="er">in</span> <span class="er">the</span> <span class="er">initial</span> <span class="er">query&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Upon receiving a <code>REQ</code> message, the relay SHOULD query its
internal database and return events that match the filter, then store
that filter and send again all future events it receives to that same
websocket until the websocket is closed. The <code>CLOSE</code> event is
received with the same <code>&lt;subscription_id&gt;</code> or a new
<code>REQ</code> is sent using the same
<code>&lt;subscription_id&gt;</code>, in which case relay MUST overwrite
the previous subscription.</p>
<p>Filter attributes containing lists (<code>ids</code>,
<code>authors</code>, <code>kinds</code> and tag filters like
<code>#e</code>) are JSON arrays with one or more values. At least one
of the arrays’ values must match the relevant field in an event for the
condition to be considered a match. For scalar event attributes such as
<code>authors</code> and <code>kind</code>, the attribute from the event
must be contained in the filter list. In the case of tag attributes such
as <code>#e</code>, for which an event may have multiple values, the
event and filter condition values must have at least one item in
common.</p>
<p>The <code>ids</code>, <code>authors</code>, <code>#e</code> and
<code>#p</code> filter lists MUST contain exact 64-character lowercase
hex values.</p>
<p>The <code>since</code> and <code>until</code> properties can be used
to specify the time range of events returned in the subscription. If a
filter includes the <code>since</code> property, events with
<code>created_at</code> greater than or equal to <code>since</code> are
considered to match the filter. The <code>until</code> property is
similar except that <code>created_at</code> must be less than or equal
to <code>until</code>. In short, an event matches a filter if
<code>since &lt;= created_at &lt;= until</code> holds.</p>
<p>All conditions of a filter that are specified must match for an event
for it to pass the filter, i.e., multiple conditions are interpreted as
<code>&amp;&amp;</code> conditions.</p>
<p>A <code>REQ</code> message may contain multiple filters. In this
case, events that match any of the filters are to be returned, i.e.,
multiple filters are to be interpreted as <code>||</code>
conditions.</p>
<p>The <code>limit</code> property of a filter is only valid for the
initial query and MUST be ignored afterwards. When <code>limit: n</code>
is present it is assumed that the events returned in the initial query
will be the last <code>n</code> events ordered by the
<code>created_at</code>. It is safe to return less events than
<code>limit</code> specifies, but it is expected that relays do not
return (much) more events than requested so clients don’t get
unnecessarily overwhelmed by data.</p>
<h3 id="from-relay-to-client-sending-events-and-notices">From relay to
client: sending events and notices</h3>
<p>Relays can send 5 types of messages, which must also be JSON arrays,
according to the following patterns:</p>
<ul>
<li><code>["EVENT", &lt;subscription_id&gt;, &lt;event JSON as defined above&gt;]</code>,
used to send events requested by clients.</li>
<li><code>["OK", &lt;event_id&gt;, &lt;true|false&gt;, &lt;message&gt;]</code>,
used to indicate acceptance or denial of an <code>EVENT</code>
message.</li>
<li><code>["EOSE", &lt;subscription_id&gt;]</code>, used to indicate the
<em>end of stored events</em> and the beginning of events newly received
in real-time.</li>
<li><code>["CLOSED", &lt;subscription_id&gt;, &lt;message&gt;]</code>,
used to indicate that a subscription was ended on the server side.</li>
<li><code>["NOTICE", &lt;message&gt;]</code>, used to send
human-readable error messages or other things to clients.</li>
</ul>
<p>This NIP defines no rules for how <code>NOTICE</code> messages should
be sent or treated.</p>
<ul>
<li><code>EVENT</code> messages MUST be sent only with a subscription ID
related to a subscription previously initiated by the client (using the
<code>REQ</code> message above).</li>
<li><code>OK</code> messages MUST be sent in response to
<code>EVENT</code> messages received from clients, they must have the
3rd parameter set to <code>true</code> when an event has been accepted
by the relay, <code>false</code> otherwise. The 4th parameter MUST
always be present, but MAY be an empty string when the 3rd is
<code>true</code>, otherwise it MUST be a string formed by a
machine-readable single-word prefix followed by a <code>:</code> and
then a human-readable message. Some examples:
<ul>
<li><code>["OK", "b1a649ebe8...", true, ""]</code></li>
<li><code>["OK", "b1a649ebe8...", true, "pow: difficulty 25&gt;=24"]</code></li>
<li><code>["OK", "b1a649ebe8...", true, "duplicate: already have this event"]</code></li>
<li><code>["OK", "b1a649ebe8...", false, "blocked: you are banned from posting here"]</code></li>
<li><code>["OK", "b1a649ebe8...", false, "blocked: please register your pubkey at https://my-expensive-relay.example.com"]</code></li>
<li><code>["OK", "b1a649ebe8...", false, "rate-limited: slow down there chief"]</code></li>
<li><code>["OK", "b1a649ebe8...", false, "invalid: event creation date is too far off from the current time"]</code></li>
<li><code>["OK", "b1a649ebe8...", false, "pow: difficulty 26 is less than 30"]</code></li>
<li><code>["OK", "b1a649ebe8...", false, "error: could not connect to the database"]</code></li>
</ul></li>
<li><code>CLOSED</code> messages MUST be sent in response to a
<code>REQ</code> when the relay refuses to fulfill it. It can also be
sent when a relay decides to kill a subscription on its side before a
client has disconnected or sent a <code>CLOSE</code>. This message uses
the same pattern of <code>OK</code> messages with the machine-readable
prefix and human-readable message. Some examples:
<ul>
<li><code>["CLOSED", "sub1", "duplicate: sub1 already opened"]</code></li>
<li><code>["CLOSED", "sub1", "unsupported: filter contains unknown elements"]</code></li>
<li><code>["CLOSED", "sub1", "error: could not connect to the database"]</code></li>
<li><code>["CLOSED", "sub1", "error: shutting down idle subscription"]</code></li>
</ul></li>
<li>The standardized machine-readable prefixes for <code>OK</code> and
<code>CLOSED</code> are: <code>duplicate</code>, <code>pow</code>,
<code>blocked</code>, <code>rate-limited</code>, <code>invalid</code>,
and <code>error</code> for when none of that fits.</li>
</ul>
</body>
</html>

